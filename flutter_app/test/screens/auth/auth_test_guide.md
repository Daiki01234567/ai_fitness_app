# 認証機能テストガイド

このドキュメントは、認証機能のテスト手順を説明します。
技術的な知識がなくても、以下の手順に従ってテストを実行できます。

## 事前準備

### 1. Firebase エミュレータの起動

ターミナルで以下のコマンドを実行：

```bash
cd C:\Users\katos\Desktop\ai-fitness-app
firebase emulators:start
```

エミュレータが起動すると、以下の URL でアクセスできます：
- Auth エミュレータ: http://localhost:9099
- Firestore エミュレータ: http://localhost:8080
- Emulator UI: http://localhost:4000

### 2. アプリの起動

別のターミナルで：

```bash
cd C:\Users\katos\Desktop\ai-fitness-app\flutter_app
flutter run
```

## テストシナリオ

### TC-001: ログイン画面の表示

**手順:**
1. アプリを起動する
2. スプラッシュ画面が表示される
3. ログイン画面に遷移する

**期待結果:**
- [x] ロゴが表示される
- [x] 「AI Fitness」のタイトルが表示される
- [x] メールアドレス入力欄がある
- [x] パスワード入力欄がある
- [x] 「ログイン」ボタンがある
- [x] 「パスワードをお忘れですか？」リンクがある
- [x] 「Googleでログイン」ボタンがある
- [x] 「Appleでログイン」ボタンがある
- [x] 「新規登録」リンクがある

---

### TC-002: 新規登録（正常系）

**手順:**
1. ログイン画面で「新規登録」をタップ
2. Step 1 で以下を入力：
   - 名前: テストユーザー
   - メール: test@example.com
   - パスワード: Test1234
   - パスワード確認: Test1234
3. 利用規約とプライバシーポリシーにチェック
4. 「次へ」をタップ
5. Step 2 で以下を入力：
   - 身長: 170
   - 体重: 65
   - 生年月日: 2000/1/1
   - 目標: 筋力アップ
6. 「登録する」をタップ

**期待結果:**
- [x] Step 1 → Step 2 に遷移する
- [x] 登録が成功する
- [x] ホーム画面に遷移する
- [x] 確認メール送信のメッセージが表示される

---

### TC-003: 新規登録（バリデーションエラー）

**手順:**
1. 新規登録画面を開く
2. 空のまま「次へ」をタップ

**期待結果:**
- [ ] 名前のエラーメッセージが表示される
- [ ] メールのエラーメッセージが表示される
- [ ] パスワードのエラーメッセージが表示される

**手順（続き）:**
3. 無効なメールアドレスを入力（例: invalid-email）
4. 短いパスワードを入力（例: abc）

**期待結果:**
- [ ] 「メールアドレスの形式が正しくありません」
- [ ] 「パスワードは8文字以上で入力してください」

---

### TC-004: ログイン（正常系）

**手順:**
1. TC-002 で作成したアカウントでログイン
2. メール: test@example.com
3. パスワード: Test1234
4. 「ログイン」をタップ

**期待結果:**
- [ ] ローディング表示される
- [ ] ホーム画面に遷移する
- [ ] ユーザー名が表示される

---

### TC-005: ログイン（エラー系）

**手順:**
1. 存在しないメールアドレスでログイン

**期待結果:**
- [ ] 「ユーザーが見つかりません」エラー

**手順:**
2. 正しいメール、間違ったパスワードでログイン

**期待結果:**
- [ ] 「パスワードが正しくありません」エラー

---

### TC-006: パスワードリセット

**手順:**
1. ログイン画面で「パスワードをお忘れですか？」をタップ
2. 登録済みメールアドレスを入力
3. 「リセットメールを送信」をタップ

**期待結果:**
- [ ] 成功画面が表示される
- [ ] 「メールを送信しました」メッセージ
- [ ] Emulator UI でメール送信が確認できる

---

### TC-007: ログアウト

**手順:**
1. ログイン状態でホーム画面を表示
2. 右上のログアウトボタンをタップ

**期待結果:**
- [ ] ログイン画面に遷移する

---

### TC-008: メール未確認の警告

**手順:**
1. 新規登録直後にホーム画面を確認

**期待結果:**
- [ ] 「メールアドレスが確認されていません」警告が表示
- [ ] 「再送信」ボタンがある

---

## テスト完了チェックリスト

- [ ] TC-001: ログイン画面の表示
- [ ] TC-002: 新規登録（正常系）
- [ ] TC-003: 新規登録（バリデーションエラー）
- [ ] TC-004: ログイン（正常系）
- [ ] TC-005: ログイン（エラー系）
- [ ] TC-006: パスワードリセット
- [ ] TC-007: ログアウト
- [ ] TC-008: メール未確認の警告

## トラブルシューティング

### エミュレータに接続できない

```bash
# エミュレータを再起動
firebase emulators:start --only auth,firestore
```

### アプリがビルドできない

```bash
# 依存関係を再インストール
cd flutter_app
flutter clean
flutter pub get
```

### テストユーザーをリセットしたい

1. http://localhost:4000 にアクセス
2. Authentication タブを開く
3. ユーザーを削除

## 自動テストの実行

```bash
cd flutter_app
flutter test
```
