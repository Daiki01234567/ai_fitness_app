# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## âš ï¸ é‡è¦ãªåˆ¶ç´„äº‹é …

### å¿…ãšå®ˆã‚‹ã¹ãé–‹ç™ºãƒ«ãƒ¼ãƒ«

1. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå„ªå…ˆã®åŸå‰‡**
   - ã‚³ãƒ¼ãƒ‰å®Ÿè£…ãƒ»è¨­è¨ˆãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ã‚¿ã‚¹ã‚¯åˆ†è§£ãªã©ã‚’è¡Œã†éš›ã¯ã€**å¿…ãš `docs/common/specs` ã¨ `docs/expo/specs` ã¾ãŸã¯ `docs/flutter/specs` é…ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æœ€å„ªå…ˆã§å‚ç…§ã—ã¦ãã ã•ã„**
   - æ¨æ¸¬ã§ã¯ãªãã€**è¦ä»¶å®šç¾©æ›¸ãƒ»å„ç¨®è¨­è¨ˆæ›¸ãƒ»ãƒãƒªã‚·ãƒ¼é¡ã‚’æ ¹æ‹ ã«åˆ¤æ–­ã—ã¦ãã ã•ã„**

2. **æ¨æ¸¬ã‚’è¡Œã†å ´åˆã®æ˜ç¤º**
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ›¸ã‹ã‚Œã¦ã„ãªã„ã“ã¨ã‚’å®Ÿè£…ã™ã‚‹å ´åˆã¯ã€**ã€Œæ¨æ¸¬ã§ã‚ã‚‹ã€ã€Œæš«å®šæ¡ˆã§ã‚ã‚‹ã€ã“ã¨ã‚’æ˜ç¤º**ã—ã¦ãã ã•ã„
   - å¿…ãš**é¸æŠè‚¢ã¨ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã‚’æç¤º**ã—ã¦ãã ã•ã„

3. **ä»•æ§˜æ›¸ã®å‚ç…§é †åº**
   1. ã¾ãš `docs/common/specs` ã®æ©Ÿèƒ½è¦ä»¶ãƒ»éæ©Ÿèƒ½è¦ä»¶ã‚’ç¢ºèª
   2. `docs/expo/specs`ï¼ˆExpoç‰ˆï¼‰ã¾ãŸã¯ `docs/flutter/specs`ï¼ˆFlutterç‰ˆï¼‰ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å›ºæœ‰æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã¨é–‹ç™ºè¨ˆç”»ã‚’ç¢ºèª
   3. è©²å½“ã™ã‚‹è¨­è¨ˆæ›¸ï¼ˆFirestore, API, BigQueryç­‰ï¼‰ã§è©³ç´°è¨­è¨ˆã‚’ç¢ºèª
   4. å®Ÿè£…ã«å…¥ã‚‹å‰ã«é–¢é€£ã™ã‚‹å…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèª

## ğŸ“ ä»•æ§˜æ›¸ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€è¦§

### å…±é€šä»•æ§˜æ›¸ï¼ˆ`docs/common/specs`ï¼‰
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ»æ³•å‹™ãƒ»ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯é–¢é€£ï¼ˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ éä¾å­˜ï¼‰

| ã‚«ãƒ†ã‚´ãƒª | ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |
|---------|---------|------|
| æ¦‚è¦ | `01_ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦_v1_0.md` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã€å¸‚å ´åˆ†æã€5ç¨®ç›®å®šç¾© |
| è¦ä»¶ | `02-1_æ©Ÿèƒ½è¦ä»¶_v1_0.md` | 38æ©Ÿèƒ½è¦ä»¶ï¼ˆFR-001~FR-038ï¼‰ |
| è¦ä»¶ | `02-2_éæ©Ÿèƒ½è¦ä»¶_v1_0.md` | 43éæ©Ÿèƒ½è¦ä»¶ï¼ˆNFR-001~NFR-043ï¼‰ |
| ãƒ‡ãƒ¼ã‚¿ | `03_Firestoreãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸_v1_0.md` | ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ« |
| API | `04_APIè¨­è¨ˆæ›¸_Firebase_Functions_v1_0.md` | Cloud Functions APIä»•æ§˜ï¼ˆStripeçµ±åˆï¼‰ |
| åˆ†æ | `05_BigQueryè¨­è¨ˆæ›¸_v1_0.md` | åˆ†æåŸºç›¤è¨­è¨ˆ |
| ãƒ­ã‚¸ãƒƒã‚¯ | `06_ãƒ•ã‚©ãƒ¼ãƒ è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯_v1_0.md` | 5ç¨®ç›®ã®ãƒ•ã‚©ãƒ¼ãƒ è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆMediaPipeï¼‰ |
| æ³•ä»¤ | `07_ãƒ‡ãƒ¼ã‚¿å‡¦ç†è¨˜éŒ²_ROPA_v1_0.md` | GDPRæº–æ‹ ã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†è¨˜éŒ² |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | `08_ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼_v1_0.md` | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ |
| æ³•å‹™ | `09_åˆ©ç”¨è¦ç´„_v1_0.md` | åˆ©ç”¨è¦ç´„ï¼ˆ5ç¨®ç›®å¯¾å¿œï¼‰ |
| æ³•å‹™ | `10_ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼_v1_0.md` | ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ |

### Expoå›ºæœ‰ä»•æ§˜æ›¸ï¼ˆ`docs/expo/specs`ï¼‰
Expo/React Nativeå›ºæœ‰ã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã¨é–‹ç™ºè¨ˆç”»

| ã‚«ãƒ†ã‚´ãƒª | ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |
|---------|---------|------|
| æŠ€è¡“ | `01_æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯_v1_0.md` | Zustand, Expo Router, React Native Paper, MediaPipeçµ±åˆ |
| é–‹ç™º | `02_é–‹ç™ºè¨ˆç”»_v1_0.md` | Phase 1-5è©³ç´°ã‚¿ã‚¹ã‚¯ã€é€±æ¬¡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ |
| UI | `07_ç”»é¢é·ç§»å›³_ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ _v1_0.md` | 15ç”»é¢ã®é·ç§»ã¨UIè¨­è¨ˆ |

### Flutterå›ºæœ‰ä»•æ§˜æ›¸ï¼ˆ`docs/flutter/specs`ï¼‰
Flutter/Dartå›ºæœ‰ã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã¨é–‹ç™ºè¨ˆç”»

| ã‚«ãƒ†ã‚´ãƒª | ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |
|---------|---------|------|
| æŠ€è¡“ | `01_æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯_v1_0.md` | Riverpod, GoRouter, Material 3, google_mlkit_pose_detectionçµ±åˆ |
| é–‹ç™º | `02_é–‹ç™ºè¨ˆç”»_v1_0.md` | Phase 1-5è©³ç´°ã‚¿ã‚¹ã‚¯ã€é€±æ¬¡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ |

### é–‹ç™ºãƒã‚±ãƒƒãƒˆï¼ˆ`docs/expo/tickets`ï¼‰
| ã‚«ãƒ†ã‚´ãƒª | å†…å®¹ |
|---------|------|
| ãƒã‚±ãƒƒãƒˆ | `000-ticket-overview.md` + `001-071.md`ï¼ˆ71ãƒã‚±ãƒƒãƒˆã€Phase 1-4ï¼‰ |

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

AIã‚’æ´»ç”¨ã—ãŸãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ã‚¢ãƒ—ãƒªï¼ˆMediaPipeã«ã‚ˆã‚‹ã‚ªãƒ³ãƒ‡ãƒã‚¤ã‚¹å§¿å‹¢æ¤œå‡ºï¼‰ã€‚æ—¥æœ¬å¸‚å ´å‘ã‘ã§GDPRæº–æ‹ ã€è–¬æ©Ÿæ³•ä¸Šã®åŒ»ç™‚æ©Ÿå™¨ã«ã¯è©²å½“ã—ãªã„ã€‚

- **Firebase Project ID**: `tokyo-list-478804-e5`
- **é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º**: MVP Phase 1-5 (0-8ãƒ¶æœˆ+ï¼‰
- **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**:
  - **Expoç‰ˆ**: Expo/React Native + Firebase Functions (TypeScript/Node 24) + Firestore + BigQuery
  - **Flutterç‰ˆ**: Flutter (Dart 3.10+) + Firebase Functions (TypeScript/Node 24) + Firestore + BigQuery
- **å¯¾è±¡ç¨®ç›®**: ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆã€ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—ã€ã‚¢ãƒ¼ãƒ ã‚«ãƒ¼ãƒ«ã€ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚ºã€ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹ï¼ˆ5ç¨®ç›®ï¼‰

## é–‹ç™ºã‚³ãƒãƒ³ãƒ‰

### Expo/React Native (expo_app/)
```bash
npm install                        # ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npx expo start                     # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npx expo start --android           # Androidã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§å®Ÿè¡Œ
npx expo start --ios               # iOSã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§å®Ÿè¡Œ
npm test                           # Jestãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run lint                       # ESLintãƒã‚§ãƒƒã‚¯
npm run type-check                 # TypeScriptå‹ãƒã‚§ãƒƒã‚¯
npx expo prebuild                  # ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆï¼ˆMediaPipeç”¨ï¼‰
```

### Flutter (flutter_app/)
```bash
flutter pub get                    # ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
flutter analyze                    # é™çš„è§£æ
flutter run                        # ãƒ‡ãƒã‚¤ã‚¹å®Ÿè¡Œ
flutter test                       # å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
flutter test test/screens/auth/    # ç‰¹å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ†ã‚¹ãƒˆ
dart run build_runner build        # Freezed/Riverpodã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
dart run build_runner watch        # ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰
```

### Firebase Functions (functions/)
```bash
npm install                 # ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm run lint                # ESLint (Google style, double quotes)
npm run lint:fix            # ESLintè‡ªå‹•ä¿®æ­£
npm run format              # Prettier ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
npm run build               # TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
npm run build:watch         # ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰
npm test                    # Jestãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test:watch          # ãƒ†ã‚¹ãƒˆã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰
npm run test:coverage       # ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ
npm run serve               # ãƒ­ãƒ¼ã‚«ãƒ«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
```

### Firebaseæ“ä½œ (ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆ)
```bash
firebase emulators:start                   # ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿èµ·å‹• (UI: localhost:4000)
firebase deploy                            # å…¨ä½“ãƒ‡ãƒ—ãƒ­ã‚¤
firebase deploy --only functions           # Functions ã®ã¿
firebase deploy --only firestore:rules     # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã®ã¿
```

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹æ§‹é€ 

#### Expoç‰ˆ (expo_app/)
```
expo_app/
â”œâ”€â”€ app/                          # Expo Routerï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰
â”‚   â”œâ”€â”€ (auth)/                   # èªè¨¼é–¢é€£ç”»é¢ã‚°ãƒ«ãƒ¼ãƒ—
â”‚   â”œâ”€â”€ (tabs)/                   # ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢ã‚°ãƒ«ãƒ¼ãƒ—
â”‚   â”œâ”€â”€ _layout.tsx               # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â””â”€â”€ index.tsx                 # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ components/                   # å†åˆ©ç”¨å¯èƒ½ãªUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ training/                 # ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â””â”€â”€ common/                   # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ services/                     # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
â”‚   â”œâ”€â”€ auth/                     # Firebaseèªè¨¼ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”œâ”€â”€ training/                 # ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â””â”€â”€ mediapipe/                # MediaPipeçµ±åˆ
â”œâ”€â”€ store/                        # ZustandçŠ¶æ…‹ç®¡ç†ã‚¹ãƒˆã‚¢
â”‚   â”œâ”€â”€ authStore.ts              # èªè¨¼çŠ¶æ…‹
â”‚   â””â”€â”€ trainingStore.ts          # ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°çŠ¶æ…‹
â”œâ”€â”€ types/                        # TypeScriptå‹å®šç¾©
â”œâ”€â”€ utils/                        # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â””â”€â”€ __tests__/                    # Jestãƒ†ã‚¹ãƒˆ
```

#### Flutterç‰ˆ (flutter_app/)
```
flutter_app/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ main.dart                 # ã‚¢ãƒ—ãƒªã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã€FirebaseåˆæœŸåŒ–
â”‚   â”œâ”€â”€ firebase_options.dart     # Firebaseè¨­å®šï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ auth/                 # èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ã€çŠ¶æ…‹ç®¡ç†ï¼ˆRiverpodï¼‰
â”‚   â”‚   â”œâ”€â”€ router/               # GoRouterãƒ™ãƒ¼ã‚¹ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â”œâ”€â”€ theme/                # Material 3ãƒ†ãƒ¼ãƒ
â”‚   â”‚   â”œâ”€â”€ utils/                # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç­‰ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â””â”€â”€ widgets/              # å…±é€šã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ
â”‚   â””â”€â”€ screens/                  # ç”»é¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆauth/, home/, splash/ï¼‰
â””â”€â”€ test/                         # ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

functions/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                  # é–¢æ•°ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã€ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š
â”‚   â”œâ”€â”€ auth/                     # Auth triggersï¼ˆonCreate, onDelete, customClaimsï¼‰
â”‚   â”œâ”€â”€ api/                      # HTTP callableé–¢æ•°ï¼ˆusers/, stripe/ï¼‰
â”‚   â”œâ”€â”€ middleware/               # èªè¨¼ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™
â”‚   â”œâ”€â”€ services/                 # BigQueryã€CloudTasksã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”œâ”€â”€ types/                    # TypeScriptå‹å®šç¾©
â”‚   â””â”€â”€ utils/                    # ãƒ­ã‚¬ãƒ¼ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚¨ãƒ©ãƒ¼å‡¦ç†
â””â”€â”€ tests/                        # Jestãƒ†ã‚¹ãƒˆã€ãƒ¢ãƒƒã‚¯

firebase/
â”œâ”€â”€ firestore.rules               # Firestoreã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«
â”œâ”€â”€ firestore.indexes.json        # ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å®šç¾©
â””â”€â”€ storage.rules                 # Storageã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«

docs/
â”œâ”€â”€ common/specs/                 # å…±é€šä»•æ§˜æ›¸ï¼ˆ11ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”œâ”€â”€ expo/
â”‚   â”œâ”€â”€ specs/                    # Expoå›ºæœ‰ä»•æ§˜æ›¸ï¼ˆ3ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â””â”€â”€ tickets/                  # é–‹ç™ºãƒã‚±ãƒƒãƒˆï¼ˆ000-071ï¼‰
â””â”€â”€ flutter/
    â””â”€â”€ specs/                    # Flutterå›ºæœ‰ä»•æ§˜æ›¸ï¼ˆ2ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
```

### çŠ¶æ…‹ç®¡ç†ãƒ»ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

**Expoç‰ˆ**:
- **Zustand**: ã‚·ãƒ³ãƒ—ãƒ«ã§æŸ”è»ŸãªçŠ¶æ…‹ç®¡ç†ï¼ˆ`authStore`, `trainingStore`ï¼‰
- **Expo Router**: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€èªè¨¼çŠ¶æ…‹ã«å¿œã˜ãŸè‡ªå‹•ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
- **React Context**: ãƒ†ãƒ¼ãƒã€èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®æä¾›

**Flutterç‰ˆ**:
- **Riverpod**: `authStateProvider` ã§èªè¨¼çŠ¶æ…‹ç®¡ç†ã€`ProviderScope` ã§DI
- **GoRouter**: `appRouterProvider` ã§èªè¨¼çŠ¶æ…‹ã«å¿œã˜ãŸãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆåˆ¶å¾¡
- **Freezed**: ä¸å¤‰çŠ¶æ…‹ã‚¯ãƒ©ã‚¹ç”Ÿæˆï¼ˆ`*.freezed.dart`ï¼‰

### Firebase Functions ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š

```typescript
setGlobalOptions({
  region: "asia-northeast1",  // æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³
  maxInstances: 10,           // ã‚³ã‚¹ãƒˆåˆ¶å¾¡
  memory: "256MiB",
  timeoutSeconds: 60,
});
```

### ä»•æ§˜æ›¸ã®å‚ç…§é †åºï¼ˆå®Ÿè£…æ™‚ï¼‰

1. **å…±é€šä»•æ§˜æ›¸ã‹ã‚‰é–‹å§‹**:
   - `docs/common/specs/02-1_æ©Ÿèƒ½è¦ä»¶_v1_0.md` â†’ æ©Ÿèƒ½è¦ä»¶ï¼ˆFR-xxxï¼‰
   - `docs/common/specs/02-2_éæ©Ÿèƒ½è¦ä»¶_v1_0.md` â†’ éæ©Ÿèƒ½è¦ä»¶ï¼ˆNFR-xxxï¼‰
   - `docs/common/specs/03_Firestoreãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸_v1_0.md` â†’ ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
   - `docs/common/specs/04_APIè¨­è¨ˆæ›¸_Firebase_Functions_v1_0.md` â†’ APIä»•æ§˜

2. **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å›ºæœ‰ä»•æ§˜æ›¸ã§æŠ€è¡“è©³ç´°ç¢ºèª**:

   **Expoç‰ˆ**:
   - `docs/expo/specs/01_æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯_v1_0.md` â†’ ä½¿ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€MediaPipeçµ±åˆ
   - `docs/expo/specs/02_é–‹ç™ºè¨ˆç”»_v1_0.md` â†’ Phaseã€ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
   - `docs/expo/specs/07_ç”»é¢é·ç§»å›³_ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ _v1_0.md` â†’ UIè¨­è¨ˆ

   **Flutterç‰ˆ**:
   - `docs/flutter/specs/01_æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯_v1_0.md` â†’ Riverpod, GoRouter, google_mlkit_pose_detection
   - `docs/flutter/specs/02_é–‹ç™ºè¨ˆç”»_v1_0.md` â†’ Phaseã€ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³

3. **å¿…è¦ã«å¿œã˜ã¦å°‚é–€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§**:
   - `docs/common/specs/06_ãƒ•ã‚©ãƒ¼ãƒ è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯_v1_0.md` â†’ MediaPipeå§¿å‹¢æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯
   - `docs/common/specs/08_ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼_v1_0.md` â†’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª (Expo/React Native ã¾ãŸã¯ Flutter)
    â†“ MediaPipe / ML Kit ã§ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†ï¼ˆãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼å„ªå…ˆã€30fpsç›®æ¨™ï¼‰
    â†“ ã‚¹ã‚±ãƒ«ãƒˆãƒ³ãƒ‡ãƒ¼ã‚¿ã®ã¿é€ä¿¡ï¼ˆ33é–¢ç¯€Ã—4å€¤ï¼‰
Cloud Function (HTTPS ãƒˆãƒªã‚¬ãƒ¼)
    â†“ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¾Œ Firestore ä¿å­˜
    â†“ Cloud Task ã§éåŒæœŸå‡¦ç†
BigQueryï¼ˆåŒ¿ååŒ–ã•ã‚ŒãŸåˆ†æãƒ‡ãƒ¼ã‚¿ï¼‰
    â†“ 2å¹´ä¿å­˜ï¼ˆGDPRæº–æ‹ ï¼‰
```

### æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼ï¼ˆStripeçµ±åˆï¼‰

```
ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª
    â†“ Stripe Checkoutã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã¾ãŸã¯Payment Sheetè¡¨ç¤º
Stripe
    â†“ æ±ºæ¸ˆå®Œäº†Webhook â†’ Cloud Function
Cloud Function
    â†“ Firestoreï¼ˆusers/{userId}/subscriptionStatus æ›´æ–°ï¼‰
    â†“ ã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ¬ãƒ¼ãƒ æ›´æ–°ï¼ˆFirebase Authï¼‰
ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª
    â†“ ãƒˆãƒ¼ã‚¯ãƒ³å†å–å¾— â†’ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ©Ÿèƒ½ã‚¢ãƒ³ãƒ­ãƒƒã‚¯
```

### é‡è¦ãªãƒ‘ã‚¿ãƒ¼ãƒ³

**ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼å„ªå…ˆå‡¦ç†**:
- ã‚«ãƒ¡ãƒ©æ˜ åƒã¯ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰å‡ºãªã„
- MediaPipe ã¯ã‚ªãƒ³ãƒ‡ãƒã‚¤ã‚¹å®Ÿè¡Œï¼ˆç›®æ¨™30fpsã€æœ€ä½15fpsï¼‰
- éª¨æ ¼é–¢ç¯€ãƒ‡ãƒ¼ã‚¿ã®ã¿é€ä¿¡

**GDPRæº–æ‹ **:
- å‰Šé™¤30æ—¥é–“çŒ¶äºˆæœŸé–“ï¼ˆ`deletionScheduled` ãƒ•ãƒ©ã‚°ï¼‰
- Firestore ãƒ«ãƒ¼ãƒ«ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ¬ãƒ™ãƒ«ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- åŒæ„è¿½è·¡ã¯åˆ¥ã®ä¸å¤‰ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
- `tosAccepted`ã€`ppAccepted` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼èª­ã¿å–ã‚Šå°‚ç”¨

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å±¤**:
1. TLS 1.3 ã«ã‚ˆã‚‹é€šä¿¡æš—å·åŒ–
2. Firebase Auth ã¨ã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ¬ãƒ¼ãƒ 
3. Firestore ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ¬ãƒ™ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«
4. ä¿å­˜æ™‚æš—å·åŒ–ï¼ˆGoogleç®¡ç†ï¼‰

**ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**:
- Firestore ãƒˆãƒªã‚¬ãƒ¼ã«ã‚ˆã‚‹ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
- Cloud Tasks ã«ã‚ˆã‚‹ãƒªãƒˆãƒ©ã‚¤ï¼ˆæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼‰
- Dead Letter Queue ã«ã‚ˆã‚‹å¤±æ•—å‡¦ç†
- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«é–¢æ•°ã«ã‚ˆã‚‹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### Firestoreä¸»è¦ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

`docs/common/specs/03_Firestoreãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸_v1_0.md` ã‚ˆã‚Šï¼š

- **Users**: ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã€åŒæ„ãƒ•ãƒ©ã‚°ã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã€`deletionScheduled` çŠ¶æ…‹
- **Sessions**: `poseData` ã¨ `sessionMetadata` ã‚’å«ã‚€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿
- **Consents**: åŒæ„å¤‰æ›´ã®ä¸å¤‰ç›£æŸ»ãƒ­ã‚°
- **DataDeletionRequests**: 30æ—¥çŒ¶äºˆæœŸé–“ç®¡ç†
- **BigQuerySyncFailures**: åˆ†æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®DLQ
- **StripeCustomers**: Stripeé¡§å®¢IDã¨ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æƒ…å ±ï¼ˆPhase 3ï¼‰

### ãƒ•ã‚©ãƒ¼ãƒ è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆ5ç¨®ç›®ï¼‰

`docs/common/specs/06_ãƒ•ã‚©ãƒ¼ãƒ è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯_v1_0.md` ã«ã‚ˆã‚‹å§¿å‹¢æ¤œå‡ºã‚’ä½¿ç”¨ï¼š

- **Expoç‰ˆ**: MediaPipe Poseï¼ˆãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çµŒç”±ï¼‰
- **Flutterç‰ˆ**: google_mlkit_pose_detectionï¼ˆML Kitã€MediaPipeãƒ™ãƒ¼ã‚¹ï¼‰

1. **ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ**: è†è§’åº¦ 90-110Â°ã€è†ãŒã¤ã¾å…ˆã‚’è¶Šãˆãªã„ã‹ãƒã‚§ãƒƒã‚¯
2. **ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—**: ä½“ã®ãƒ©ã‚¤ãƒ³ç¶­æŒã€è‚˜è§’åº¦ 90Â°
3. **ã‚¢ãƒ¼ãƒ ã‚«ãƒ¼ãƒ«**: è‚˜è§’åº¦ 30-160Â°ã€åå‹•æ¤œå‡º
4. **ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º**: è…•ã®æŒ™ä¸Šè§’åº¦ 70-90Â°ã€å·¦å³å¯¾ç§°æ€§ãƒã‚§ãƒƒã‚¯
5. **ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹**: è‚˜ã®è»Œé“ã€è…°ã®åã‚Šãƒã‚§ãƒƒã‚¯

å„ç¨®ç›®ã¯çŠ¶æ…‹ãƒã‚·ãƒ³ã«ã‚ˆã‚‹ãƒ¬ãƒƒãƒ—ã‚«ã‚¦ãƒ³ãƒˆã¨0-100ç‚¹ã®ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã‚’å®Ÿè£…ã€‚
ä¸¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¨ã‚‚33ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã€ä¿¡é ¼åº¦é–¾å€¤0.7ã‚’ä½¿ç”¨ã€‚

## ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³ï¼ˆ2025å¹´12æœˆæ™‚ç‚¹ï¼‰

**å®Œäº†æ¸ˆã¿**:
- åŒ…æ‹¬çš„ãªä»•æ§˜æ›¸ï¼ˆå…±é€š11ãƒ•ã‚¡ã‚¤ãƒ« + Expoå›ºæœ‰3ãƒ•ã‚¡ã‚¤ãƒ« + Flutterå›ºæœ‰2ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
- é–‹ç™ºãƒã‚±ãƒƒãƒˆä½œæˆï¼ˆ000-071ã€Phase 1-4ï¼‰
- Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— (`tokyo-list-478804-e5`)
- Expo/React NativeåŸºæœ¬ç’°å¢ƒæ§‹ç¯‰
- FlutteråŸºæœ¬ç’°å¢ƒæ§‹ç¯‰ï¼ˆèªè¨¼ç”»é¢ã€ãƒ›ãƒ¼ãƒ ç”»é¢ã€RiverpodçŠ¶æ…‹ç®¡ç†ã€GoRouterãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰
- èªè¨¼ç”»é¢å®Ÿè£…ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ã€ç™»éŒ²ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆï¼‰
- ãƒ›ãƒ¼ãƒ ç”»é¢ãƒ»ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³åŸºç›¤

**Phase 1 é€²è¡Œä¸­** (0-2ãƒ¶æœˆ):
- Firebase FunctionsåŸºç›¤æ§‹ç¯‰
- Firestore ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«å®Ÿè£…
- å§¿å‹¢æ¤œå‡ºçµ±åˆæº–å‚™ï¼ˆExpoç‰ˆ: MediaPipeã€Flutterç‰ˆ: ML Kitï¼‰

**Phase 2 è¨ˆç”»ä¸­** (2-7ãƒ¶æœˆ):
- å§¿å‹¢æ¤œå‡ºå®Ÿè£…ï¼ˆ5ç¨®ç›®ï¼‰
- ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²æ©Ÿèƒ½
- BigQueryåˆ†æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

**Phase 3 æœªç€æ‰‹** (8ãƒ¶æœˆä»¥é™):
- Stripeæ±ºæ¸ˆçµ±åˆ
- Appleèªè¨¼
- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†

## ã‚¿ã‚¹ã‚¯ç®¡ç†ã¨ãƒã‚±ãƒƒãƒˆé‹ç”¨

é–‹ç™ºã‚¿ã‚¹ã‚¯ã¯ `docs/expo/tickets/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç•ªå·ä»˜ããƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ000-071ï¼‰ã¨ã—ã¦ç®¡ç†ã€‚

**é€²æ—ç®¡ç†**:
- ãƒã‚±ãƒƒãƒˆå†…ã®Todoã‚¢ã‚¤ãƒ†ãƒ ã¯ `[ ]` â†’ `[x]` ã§å®Œäº†ãƒãƒ¼ã‚¯
- ä½œæ¥­å®Œäº†å¾Œã¯å³åº§ã«æ›´æ–°
- `000-ticket-overview.md` ã§å…¨ä½“é€²æ—ã‚’ç¢ºèª

## é–‹ç™ºä¸Šã®åˆ¶ç´„

### æ³•çš„è¦ä»¶

**è–¬æ©Ÿæ³•**:
- åŒ»ç™‚æ©Ÿå™¨ã§ã¯ãªã„
- ã€Œæ²»ç™‚ã€ã€Œè¨ºæ–­ã€ã€Œæ²»ã™ã€ã¨ã„ã£ãŸç”¨èªã¯ä½¿ç”¨ç¦æ­¢
- ä½¿ç”¨å¯èƒ½ï¼šã€Œãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ã€ã€Œé‹å‹•ã€ã€Œãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€ã€Œå¥åº·ç¶­æŒã€

**GDPR**:
- 72æ™‚é–“ä»¥å†…ã®é•åé€šçŸ¥
- ãƒ‡ãƒ¼ã‚¿æœ€å°åŒ–åŸå‰‡
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©åˆ©ï¼ˆã‚¢ã‚¯ã‚»ã‚¹ã€å‰Šé™¤ã€ãƒãƒ¼ã‚¿ãƒ“ãƒªãƒ†ã‚£ï¼‰
- è©³ç´°ã¯ `docs/common/specs/07_ãƒ‡ãƒ¼ã‚¿å‡¦ç†è¨˜éŒ²_ROPA_v1_0.md` å‚ç…§

**åˆ©ç”¨è¦ç´„ãƒ»ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼**:
- `docs/common/specs/09_åˆ©ç”¨è¦ç´„_v1_0.md` ã§å…¨æ–‡ç¢ºèªï¼ˆ5ç¨®ç›®å¯¾å¿œï¼‰
- `docs/common/specs/10_ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼_v1_0.md` ã§å…¨æ–‡ç¢ºèª

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶

**MediaPipe**:
- å¯¾è±¡ãƒ‡ãƒã‚¤ã‚¹ã§æœ€ä½30fpsï¼ˆNFR-024ã€NFR-025ï¼‰
- ä½ã‚¹ãƒšãƒƒã‚¯ãƒ‡ãƒã‚¤ã‚¹ã§ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…

**Cloud Functions**:
- æœ€å¤§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°ï¼š10ï¼ˆã‚³ã‚¹ãƒˆåˆ¶å¾¡ï¼‰
- ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆå¯¾ç­–ï¼ˆNFR-037ï¼‰

**BigQuery**:
- ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚¤ãƒ³ã‚µãƒ¼ãƒˆä½¿ç”¨ï¼ˆãƒãƒƒãƒå‡¦ç†ã§ã¯ãªã„ï¼‰
- ãƒ‡ãƒ¼ã‚¿ä¿å­˜æœŸé–“ï¼š2å¹´ï¼ˆGDPRæº–æ‹ ï¼‰

### ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«

**TypeScript**:
- ESLint Google ã‚¹ã‚¿ã‚¤ãƒ«
- ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆä½¿ç”¨
- strict ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹

**Flutter**:
- flutter_lints ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ«ãƒ¼ãƒ«é©ç”¨

**è¨€èª**:
- ã‚³ãƒ¼ãƒ‰å†…ã‚³ãƒ¡ãƒ³ãƒˆï¼šè‹±èªï¼ˆä¿å®ˆæ€§ã®ãŸã‚ï¼‰
- UI ãƒ†ã‚­ã‚¹ãƒˆï¼šæ—¥æœ¬èªï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¸‚å ´ï¼‰
- **æ—¥æœ¬èªã§è¨˜è¿°ã™ã‚‹ã‚‚ã®ï¼ˆåŸå‰‡ï¼‰**:
  - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆï¼ˆREADMEã€è¨­è¨ˆæ›¸ã€ãƒã‚±ãƒƒãƒˆç­‰ï¼‰
  - Docstring / JSDoc / DartDoc
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ãƒ»ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ï¼‰
  - ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ»ã‚¬ã‚¤ãƒ‰
  - ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  - PRã®èª¬æ˜æ–‡
- **è‹±èªã§è¨˜è¿°ã™ã‚‹ã‚‚ã®**:
  - ã‚³ãƒ¼ãƒ‰å†…ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆï¼‰
  - å¤‰æ•°åãƒ»é–¢æ•°åãƒ»ã‚¯ãƒ©ã‚¹å
  - å†…éƒ¨ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰

## ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### TypeScript/React Native (Expo)

- **å‹å®‰å…¨æ€§**: `any` ã‚’é¿ã‘ã€æ˜ç¤ºçš„ãªå‹å®šç¾©ã‚’ä½¿ç”¨ï¼ˆZodç­‰ã§ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚‚è¿½åŠ ï¼‰
- **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ**: é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå„ªå…ˆã€React Hooksæ´»ç”¨ã€å°ã•ãåˆ†å‰²
- **çŠ¶æ…‹ç®¡ç† (Zustand)**: ã‚¹ãƒˆã‚¢ã¯æ©Ÿèƒ½å˜ä½ã§åˆ†å‰²ã€ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã‚’æ˜ç¤ºçš„ã«å®šç¾©
- **éåŒæœŸå‡¦ç†**: `async/await` + `try/catch`ã€TanStack Queryï¼ˆReact Queryï¼‰ã§ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç®¡ç†
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: `React.memo`ã§ãƒ¡ãƒ¢åŒ–ã€`useMemo`/`useCallback`ã‚’é©åˆ‡ã«ä½¿ç”¨ã€FlatListã§é…å»¶èª­ã¿è¾¼ã¿
- **MediaPipeçµ±åˆ**: ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çµŒç”±ã€30fpsç¶­æŒã€ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¹ã‚­ãƒƒãƒ—è€ƒæ…®

### Dart/Flutter

- **Null Safety**: `?.`, `??` ã‚’æ´»ç”¨ã€`late` ã¯åˆæœŸåŒ–ä¿è¨¼æ™‚ã®ã¿
- **Widgetè¨­è¨ˆ**: StatelessWidgetå„ªå…ˆã€`const` ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ä½¿ç”¨ã€å°ã•ãåˆ†å‰²
- **çŠ¶æ…‹ç®¡ç† (Riverpod)**: Provideræ©Ÿèƒ½åˆ†å‰²ã€Notifierå†…ã§çŠ¶æ…‹å¤‰æ›´å®Œçµã€UI/ãƒ­ã‚¸ãƒƒã‚¯åˆ†é›¢
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: `ListView.builder`ã§é…å»¶èª­ã¿è¾¼ã¿ã€ML Kitã¯30fpsç¶­æŒï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ ã‚¹ã‚­ãƒƒãƒ—è€ƒæ…®ï¼‰
- **ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ**: Freezedã§ä¸å¤‰ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã€`dart run build_runner build` ã§ç”Ÿæˆ

### TypeScript (Firebase Functions)

- **å‹å®‰å…¨æ€§**: `any` ã‚’é¿ã‘ `unknown` + å‹ã‚¬ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã€å¼•æ•°ã¨æˆ»ã‚Šå€¤ã«å‹ã‚’æ˜ç¤º
- **éåŒæœŸå‡¦ç†**: `async/await` + `try/catch`ã€ä¸¦åˆ—å‡¦ç†ã¯ `Promise.all()`
- **é–¢æ•°è¨­è¨ˆ**: å˜ä¸€è²¬ä»»ã€ç´”ç²‹é–¢æ•°å„ªå…ˆã€å†ªç­‰æ€§ã‚’ä¿ã¤
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: `functions.https.HttpsError` ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¿”ã™ã€ãƒ­ã‚°ã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å«ã‚ã‚‹ï¼ˆã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–æƒ…å ±ã¯é™¤å¤–ï¼‰
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: Firestoreèª­ã¿å–ã‚Šæœ€å°åŒ–ã€ãƒãƒƒãƒã¯500ä»¶ä»¥ä¸‹ã€ä¸è¦ãªã‚¤ãƒ³ãƒãƒ¼ãƒˆå‰Šæ¸›ï¼ˆã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆå¯¾ç­–ï¼‰

### Firebase Functions ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
export const updateUserProfile = functions.https.onCall(async (data, context) => {
  if (!context.auth) throw new functions.https.HttpsError("unauthenticated", "èªè¨¼ãŒå¿…è¦ã§ã™");
  if (context.auth.uid !== data.userId) throw new functions.https.HttpsError("permission-denied", "æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“");
  // ... validation and processing
});
```

### ãƒ­ã‚°å‡ºåŠ›

```typescript
logger.info("Session created", { userId, sessionId, exerciseType, duration: performance.now() - startTime });
```

### Firebase Security Rules

å‚è€ƒ: https://firebase.google.com/docs/rules

**åŸºæœ¬åŸå‰‡**:
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å…¨æ‹’å¦ï¼ˆæ˜ç¤ºçš„ã«è¨±å¯ã—ãŸã‚‚ã®ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰
- èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ¬ãƒ™ãƒ«ã§ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆ`tosAccepted`, `ppAccepted`, `deletionScheduled` ã¯èª­ã¿å–ã‚Šå°‚ç”¨ï¼‰
- `request.auth.uid` ã§æœ¬äººç¢ºèªã‚’å¾¹åº•

**é‡è¦ãªãƒ‘ã‚¿ãƒ¼ãƒ³**:

```javascript
// ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
function isOwner(userId) { return request.auth != null && request.auth.uid == userId; }

// ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å¤‰æ›´ã®æ¤œè¨¼
allow update: if isOwner(userId)
  && !request.resource.data.diff(resource.data).affectedKeys().hasAny(['tosAccepted', 'ppAccepted', 'deletionScheduled']);

// å‰Šé™¤äºˆå®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ›¸ãè¾¼ã¿ç¦æ­¢
allow write: if isOwner(userId) && !resource.data.deletionScheduled;

// ã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ¬ãƒ¼ãƒ 
function isAdmin() { return request.auth.token.admin == true; }
```

**ãƒ†ã‚¹ãƒˆ**: `firebase emulators:start --only firestore` + `@firebase/rules-unit-testing`

### Cloud IAM (Identity and Access Management)

å‚è€ƒ: https://docs.cloud.google.com/iam/docs/overview

**åŸºæœ¬åŸå‰‡**: æœ€å°æ¨©é™ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã”ã¨ã«å½¹å‰²åˆ†é›¢ã€å®šæœŸçš„ãªæ¨©é™ç›£æŸ»

**ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ§‹æˆ**:
| ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ | æ¨©é™ |
|-------------------|------|
| Cloud Functions SA | Firestoreèª­ã¿æ›¸ã, BigQueryç·¨é›†, Cloud Tasks, Logging |
| BigQueryå‡¦ç† SA | BigQueryã‚¸ãƒ§ãƒ–, ãƒ‡ãƒ¼ã‚¿é–²è¦§ï¼ˆç‰¹å®šãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆï¼‰ |
| ãƒ‡ãƒ—ãƒ­ã‚¤ SA (CI/CD) | Functions/Firestoreãƒ«ãƒ¼ãƒ«ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¤ãƒ¼ |

**ç’°å¢ƒåˆ†é›¢**: `firebase use dev` / `firebase use production` ã§åˆ‡ã‚Šæ›¿ãˆ

---

## åˆ¶ç´„

### é‡è¦è¦ä»¶
- **æ©Ÿèƒ½å®Ÿè£…å‰ã«å¿…ãš `docs/common/specs` ã¨ `docs/expo/specs` ã¾ãŸã¯ `docs/flutter/specs` ã‚’ç¢ºèªã™ã‚‹ã“ã¨**
- **æ¨æ¸¬ç¦æ­¢**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ãªã„å®Ÿè£…ã¯å¿…ãšã€Œæ¨æ¸¬ã€ã¨æ˜è¨˜
- **ä»•æ§˜æ›¸å„ªå…ˆ**: ã‚³ãƒ¼ãƒ‰å®Ÿè£…ã‚ˆã‚Šä»•æ§˜æ›¸ã®å†…å®¹ã‚’å„ªå…ˆï¼ˆä¸Šè¨˜ã€Œä»•æ§˜æ›¸ã®å‚ç…§é †åºã€å‚ç…§ï¼‰
- **ãƒ•ã‚§ãƒ¼ã‚ºå³å®ˆ**: Phase 3ä»¥é™ã®æ©Ÿèƒ½ã‚’Phase 1-2ã§å®Ÿè£…ã—ãªã„
- **æ³•ä»¤éµå®ˆ**: è–¬æ©Ÿæ³•ï¼ˆåŒ»ç™‚ç”¨èªç¦æ­¢ï¼‰ãƒ»GDPRãƒ»å€‹äººæƒ…å ±ä¿è­·æ³•ã‚’å¿…ãšç¢ºèª

### ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½¿ç”¨
- å…¨ã¦ã®ã‚¿ã‚¹ã‚¯ã¯ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨
- ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã¯å¿…ãšèª­ã¾ã›ã‚‹: ã“ã® CLAUDE.md + `docs/common/specs` + `docs/expo/specs` ã¾ãŸã¯ `docs/flutter/specs`
- é©åˆ‡ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒãªã„å ´åˆã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å ±å‘Š

### å‡ºåŠ›è¨€èª
- çµæœã‚µãƒãƒªãƒ¼ã¯æ—¥æœ¬èªã§å‡ºåŠ›ã™ã‚‹ã“ã¨
- ä½œæˆã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆREADMEã€ã‚³ãƒ¡ãƒ³ãƒˆç­‰ï¼‰ã¯æ—¥æœ¬èªã§è¨˜è¿°ã™ã‚‹ã“ã¨
- ã‚³ãƒ¼ãƒ‰å†…ã®å¤‰æ•°åãƒ»é–¢æ•°åã¯è‹±èªã‚’ä½¿ç”¨


### ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™
- 1ãƒ•ã‚¡ã‚¤ãƒ«ã‚ãŸã‚Šã®èª­ã¿è¾¼ã¿ä¸Šé™: 25,000ãƒˆãƒ¼ã‚¯ãƒ³ä»¥ä¸‹
- å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã¯åˆ†å‰²ã—ã¦èª­ã¿è¾¼ã‚€ã“ã¨
