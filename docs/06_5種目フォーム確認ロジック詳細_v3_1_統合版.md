# 5ç¨®ç›®ãƒ•ã‚©ãƒ¼ãƒ ç¢ºèªãƒ­ã‚¸ãƒƒã‚¯è©³ç´° v3.1

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: AIãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ã‚¢ãƒ—ãƒªï¼ˆä»®ç§°ï¼‰  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 3.1 (MVP)  
**ä½œæˆæ—¥**: 2025å¹´11æœˆ  
**æœ€çµ‚æ›´æ–°æ—¥**: 2025å¹´11æœˆ22æ—¥  
**å¯¾è±¡æœŸé–“**: Phase 1-2 (0-4ãƒ¶æœˆ)

---

## ğŸ“‹ v3.1ã§ã®ä¸»ãªå¤‰æ›´ç‚¹

### è¦ä»¶å®šç¾©æ›¸v3.1ãƒ»åˆ©ç”¨è¦ç´„v3.1ã¨ã®æ•´åˆæ€§ç¢ºä¿

âœ… **ç”¨èªã®å®Œå…¨çµ±ä¸€**:
- ã€Œãƒ•ã‚©ãƒ¼ãƒ ç¢ºèªè£œåŠ©æ©Ÿèƒ½ã€ã€Œå‚è€ƒæƒ…å ±ã€ã€Œå‚è€ƒã‚¹ã‚³ã‚¢ã€ã®è¡¨ç¾ã‚’å®Œå…¨çµ±ä¸€
- åŒ»ç™‚æ©Ÿå™¨ã§ãªã„æ—¨ã®æ˜ç¤ºã‚’å¼·åŒ–
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®é©åˆ‡ãªæƒ…å ±æä¾›æ–¹æ³•ã®æ˜ç¢ºåŒ–

âœ… **æ³•çš„è¦ä»¶ã®åæ˜ **:
- åˆ©ç”¨è¦ç´„v3.1ç¬¬3.3æ¡: åŒ»ç™‚æ©Ÿå™¨ã§ãªã„æ—¨ã®æ˜ç¤º
- åˆ©ç”¨è¦ç´„v3.1ç¬¬3.4æ¡: å‚è€ƒæƒ…å ±ã¨ã—ã¦ã®ä½ç½®ã¥ã‘ã®æ˜ç¤º
- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼v3.1ç¬¬2.3æ¡: ã‚ªãƒ³ãƒ‡ãƒã‚¤ã‚¹å‡¦ç†ã®æ˜ç¤º

âœ… **æŠ€è¡“çš„å®Ÿè£…ã®æ˜ç¢ºåŒ–**:
- MediaPipe Poseã®æ¤œå‡ºç²¾åº¦åŸºæº–ã®å…·ä½“åŒ–
- å‚è€ƒã‚¹ã‚³ã‚¢ç®—å‡ºãƒ­ã‚¸ãƒƒã‚¯ã®è©³ç´°åŒ–
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¼·åŒ–

âœ… **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Š**:
- éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã®æ”¹å–„
- è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®å¼·åŒ–
- å‚è€ƒæƒ…å ±ã®é©åˆ‡ãªæç¤ºæ–¹æ³•

---

## ç›®æ¬¡

### Part 1: æ¦‚è¦ã¨å…±é€šä»•æ§˜
1. [æ¦‚è¦](#1-æ¦‚è¦)
2. [å…±é€šä»•æ§˜](#2-å…±é€šä»•æ§˜)
3. [MediaPipe Poseæ¤œå‡ºä»•æ§˜](#3-mediapipe-poseæ¤œå‡ºä»•æ§˜)

### Part 2: 5ç¨®ç›®ã®è©³ç´°ãƒ­ã‚¸ãƒƒã‚¯
4. [ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ](#4-ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ)
5. [ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—](#5-ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—)
6. [ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«](#6-ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«)
7. [ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹](#7-ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹)
8. [ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ](#8-ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ)

### Part 3: å®Ÿè£…ã¨ãƒ†ã‚¹ãƒˆ
9. [å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](#9-å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³)
10. [ãƒ†ã‚¹ãƒˆä»•æ§˜](#10-ãƒ†ã‚¹ãƒˆä»•æ§˜)
11. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶](#11-ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶)

---

## 1. æ¦‚è¦

### 1.1 ç›®çš„

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€AIãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ã‚¢ãƒ—ãƒªï¼ˆä»®ç§°ï¼‰ã®MVPæœŸé–“ï¼ˆPhase 1-2ï¼‰ã«ãŠã„ã¦å¯¾å¿œã™ã‚‹5ç¨®ç›®ã®ãƒ•ã‚©ãƒ¼ãƒ ç¢ºèªè£œåŠ©ãƒ­ã‚¸ãƒƒã‚¯ã‚’è©³ç´°ã«å®šç¾©ã—ã¾ã™ã€‚

**é‡è¦ãªå‰æ**:
- æœ¬æ©Ÿèƒ½ã¯**åŒ»ç™‚æ©Ÿå™¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“**ï¼ˆåˆ©ç”¨è¦ç´„v3.1ç¬¬3.3æ¡ï¼‰
- æä¾›ã™ã‚‹æƒ…å ±ã¯**å‚è€ƒæƒ…å ±**ã§ã™ï¼ˆåˆ©ç”¨è¦ç´„v3.1ç¬¬3.4æ¡ï¼‰
- **è¨ºæ–­ãƒ»æ²»ç™‚ãƒ»äºˆé˜²ã‚’ç›®çš„ã¨ã—ã¾ã›ã‚“**ï¼ˆåˆ©ç”¨è¦ç´„v3.1ç¬¬3.3.2æ¡ï¼‰
- æœ€çµ‚çš„ãªåˆ¤æ–­ã¯**ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã®è²¬ä»»**ã§ã™ï¼ˆåˆ©ç”¨è¦ç´„v3.1ç¬¬7.2æ¡ï¼‰

### 1.2 å¯¾è±¡ç¨®ç›®

MVPæœŸé–“ã§å¯¾å¿œã™ã‚‹5ç¨®ç›®:

| No | ç¨®ç›®å | ã‚«ãƒ†ã‚´ãƒªãƒ¼ | é›ãˆã‚‹éƒ¨ä½ | é›£æ˜“åº¦ | ã‚«ã‚¦ãƒ³ãƒˆæ–¹å¼ |
|----|--------|-----------|-----------|--------|------------|
| 1 | ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ | è‡ªé‡ | ä¸‹åŠèº« | åˆç´š | å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ |
| 2 | ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ— | è‡ªé‡ | èƒ¸ã€è…• | åˆç´š | å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ |
| 3 | ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ« | ãƒ€ãƒ³ãƒ™ãƒ« | è…• | åˆç´š | å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ |
| 4 | ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹ | ãƒ€ãƒ³ãƒ™ãƒ« | è‚© | ä¸­ç´š | å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ |
| 5 | ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ | ãƒ€ãƒ³ãƒ™ãƒ« | èƒŒä¸­ã€ä¸‹åŠèº« | ä¸­ç´š | å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ |

### 1.3 å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å‚ç…§ç®‡æ‰€ |
|-------------|-----------|---------|
| è¦ä»¶å®šç¾©æ›¸ | v3.1 | ç¬¬3ç« : æ©Ÿèƒ½è¦ä»¶ |
| åˆ©ç”¨è¦ç´„ | v3.1 | ç¬¬3ç« : ã‚µãƒ¼ãƒ“ã‚¹ã®æ¦‚è¦ |
| ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ | v3.1 | ç¬¬2ç« : åé›†ã™ã‚‹æƒ…å ± |
| ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸ | v3.1 | ç¬¬3ç« : ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ |
| Firestoreãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸ | v3.1 | ç¬¬4ç« : ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆ |
| ç”»é¢é·ç§»å›³+ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ  | v3.1 | 3.9: ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å®Ÿè¡Œç”»é¢ |

### 1.4 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| é …ç›® | æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|-----|------|-----------|------|
| **éª¨æ ¼æ¤œå‡º** | MediaPipe Pose | v0.10.14 | é–¢ç¯€ä½ç½®ã®æ¤œå‡º |
| **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯** | React Native | 0.73+ | UIãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° |
| **çŠ¶æ…‹ç®¡ç†** | Zustand | 4.5+ | ã‚¢ãƒ—ãƒªçŠ¶æ…‹ç®¡ç† |
| **ã‚«ãƒ¡ãƒ©** | react-native-vision-camera | 4.5.0+ | ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ |
| **å‡¦ç†æ–¹å¼** | ã‚ªãƒ³ãƒ‡ãƒã‚¤ã‚¹ | - | ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­· |

---

## 2. å…±é€šä»•æ§˜

### 2.1 å‚è€ƒã‚¹ã‚³ã‚¢ã®å®šç¾©

**é‡è¦**: ã™ã¹ã¦ã®ã‚¹ã‚³ã‚¢ã¯å‚è€ƒæƒ…å ±ã§ã‚ã‚Šã€è¨ºæ–­ã‚„åŒ»å­¦çš„åˆ¤å®šã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆåˆ©ç”¨è¦ç´„v3.1ç¬¬3.4æ¡ï¼‰ã€‚

#### 2.1.1 å‚è€ƒã‚¹ã‚³ã‚¢ã®ç¯„å›²

| ã‚¹ã‚³ã‚¢ç¯„å›² | è‰² | åˆ¤å®š | è¡¨ç¤ºä¾‹ |
|-----------|---|------|-------|
| **90-100ç‚¹** | ğŸ”µ é’ | å„ªè‰¯ | ã€Œå„ªè‰¯ã§ã™ã€ |
| **70-89ç‚¹** | ğŸŸ¡ é»„ | è‰¯å¥½ï¼ˆæ”¹å–„ä½™åœ°ã‚ã‚Šï¼‰ | ã€Œè‰¯å¥½ã§ã™ã€‚ã•ã‚‰ã«æ”¹å–„ã§ãã¾ã™ã€ |
| **50-69ç‚¹** | ğŸŸ  ã‚ªãƒ¬ãƒ³ã‚¸ | æ³¨æ„ | ã€Œæ³¨æ„ãŒå¿…è¦ã§ã™ã€ |
| **0-49ç‚¹** | ğŸ”´ èµ¤ | è¦æ”¹å–„ | ã€Œæ”¹å–„ãŒå¿…è¦ã§ã™ã€ |

#### 2.1.2 å‚è€ƒã‚¹ã‚³ã‚¢ç®—å‡ºã®åŸºæœ¬å¼

```typescript
/**
 * å‚è€ƒã‚¹ã‚³ã‚¢ç®—å‡ºã®åŸºæœ¬å¼
 * @param idealValue - ç†æƒ³çš„ãªå€¤ï¼ˆè§’åº¦ã€ä½ç½®ãªã©ï¼‰
 * @param actualValue - å®Ÿéš›ã®å€¤
 * @param tolerance - è¨±å®¹ç¯„å›²ï¼ˆåº¦æ•°ã¾ãŸã¯è·é›¢ï¼‰
 * @returns 0-100ã®å‚è€ƒã‚¹ã‚³ã‚¢
 */
function calculateReferenceScore(
  idealValue: number,
  actualValue: number,
  tolerance: number
): number {
  // åå·®ã‚’è¨ˆç®—
  const deviation = Math.abs(idealValue - actualValue);
  
  // è¨±å®¹ç¯„å›²å†…ã®å ´åˆã¯100ç‚¹
  if (deviation <= tolerance) {
    return 100;
  }
  
  // è¨±å®¹ç¯„å›²å¤–ã®å ´åˆã¯åå·®ã«å¿œã˜ã¦ã‚¹ã‚³ã‚¢ã‚’æ¸›ç‚¹
  // åå·®ãŒ tolerance ã®3å€ã‚’è¶…ãˆã‚‹ã¨0ç‚¹
  const score = Math.max(0, 100 - (deviation / tolerance) * 33.33);
  
  return Math.round(score);
}
```

#### 2.1.3 ç·åˆå‚è€ƒã‚¹ã‚³ã‚¢ã®ç®—å‡º

```typescript
/**
 * ç·åˆå‚è€ƒã‚¹ã‚³ã‚¢ã®ç®—å‡º
 * @param checkpoints - å„ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã®ã‚¹ã‚³ã‚¢
 * @returns 0-100ã®ç·åˆå‚è€ƒã‚¹ã‚³ã‚¢
 */
function calculateOverallScore(checkpoints: number[]): number {
  if (checkpoints.length === 0) return 0;
  
  // å…¨ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã®å¹³å‡ã‚’ç®—å‡º
  const average = checkpoints.reduce((sum, score) => sum + score, 0) / checkpoints.length;
  
  return Math.round(average);
}
```

### 2.2 éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ä»•æ§˜

#### 2.2.1 éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°

| ã‚¿ã‚¤ãƒŸãƒ³ã‚° | å†…å®¹ | ä¾‹ |
|-----------|------|---|
| **é–‹å§‹æ™‚** | ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é–‹å§‹ã®åˆå›³ | ã€Œã‚¹ã‚¿ãƒ¼ãƒˆï¼ã€ |
| **ãƒ•ã‚©ãƒ¼ãƒ æ³¨æ„æ™‚** | æ”¹å–„ãƒã‚¤ãƒ³ãƒˆã®æŒ‡æ‘˜ | ã€Œè†ã‚’ã‚‚ã†å°‘ã—æ›²ã’ã¾ã—ã‚‡ã†ã€ |
| **å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ** | å›æ•°ã®ã‚«ã‚¦ãƒ³ãƒˆ | ã€Œ5å›ã€ã€Œ10å›ã€ |
| **ã‚»ãƒƒãƒˆå®Œäº†æ™‚** | ã‚»ãƒƒãƒˆå®Œäº†ã®é€šçŸ¥ | ã€Œã‚»ãƒƒãƒˆå®Œäº†ï¼ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ã€ |
| **ä¼‘æ†©ä¸­** | æ¬¡ã®ã‚»ãƒƒãƒˆã¾ã§ã®æ™‚é–“ | ã€Œæ¬¡ã®ã‚»ãƒƒãƒˆã¾ã§ã‚ã¨10ç§’ã€ |

#### 2.2.2 éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã®å„ªå…ˆåº¦

```typescript
enum VoiceGuidancePriority {
  HIGH = 1,    // å®‰å…¨ã«é–¢ã‚ã‚‹é‡è¦ãªæŒ‡æ‘˜
  MEDIUM = 2,  // ãƒ•ã‚©ãƒ¼ãƒ æ”¹å–„ã®ææ¡ˆ
  LOW = 3,     // å›æ•°ã‚«ã‚¦ãƒ³ãƒˆã€åŠ±ã¾ã—
}

/**
 * éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã®å„ªå…ˆåº¦åˆ¶å¾¡
 * é«˜å„ªå…ˆåº¦ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã¯ä½å„ªå…ˆåº¦ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã‚’ä¸­æ–­ã™ã‚‹
 */
function shouldInterruptGuidance(
  currentPriority: VoiceGuidancePriority,
  newPriority: VoiceGuidancePriority
): boolean {
  return newPriority < currentPriority;
}
```

#### 2.2.3 éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã®é »åº¦åˆ¶é™

```typescript
/**
 * åŒã˜å†…å®¹ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã®é€£ç¶šå†ç”Ÿã‚’é˜²ã
 * æœ€å°é–“éš”: 5ç§’
 */
const VOICE_GUIDANCE_MIN_INTERVAL = 5000; // ãƒŸãƒªç§’

interface VoiceGuidanceState {
  lastGuidanceTime: number;
  lastGuidanceContent: string;
}

function shouldPlayVoiceGuidance(
  content: string,
  state: VoiceGuidanceState
): boolean {
  const now = Date.now();
  
  // åŒã˜å†…å®¹ã§æœ€å°é–“éš”å†…ã®å ´åˆã¯å†ç”Ÿã—ãªã„
  if (
    content === state.lastGuidanceContent &&
    now - state.lastGuidanceTime < VOICE_GUIDANCE_MIN_INTERVAL
  ) {
    return false;
  }
  
  return true;
}
```

### 2.3 è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ä»•æ§˜

#### 2.3.1 éª¨æ ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®è‰²åˆ†ã‘

| è¦ç´  | çŠ¶æ…‹ | è‰² | èª¬æ˜ |
|-----|------|---|------|
| **é–¢ç¯€ç‚¹** | å„ªè‰¯ | ğŸ”µ é’ | ã‚¹ã‚³ã‚¢90-100ç‚¹ |
| **é–¢ç¯€ç‚¹** | è‰¯å¥½ | ğŸŸ¡ é»„ | ã‚¹ã‚³ã‚¢70-89ç‚¹ |
| **é–¢ç¯€ç‚¹** | æ³¨æ„ | ğŸŸ  ã‚ªãƒ¬ãƒ³ã‚¸ | ã‚¹ã‚³ã‚¢50-69ç‚¹ |
| **é–¢ç¯€ç‚¹** | è¦æ”¹å–„ | ğŸ”´ èµ¤ | ã‚¹ã‚³ã‚¢0-49ç‚¹ |
| **é–¢ç¯€ç‚¹** | æœªæ¤œå‡º | âšª ã‚°ãƒ¬ãƒ¼ | æ¤œå‡ºå¤±æ•— |
| **éª¨æ ¼ç·š** | å„ªè‰¯ | ğŸ”µ é’ | ä¸¡ç«¯ã®é–¢ç¯€ãŒå„ªè‰¯ |
| **éª¨æ ¼ç·š** | è‰¯å¥½ | ğŸŸ¡ é»„ | ä¸¡ç«¯ã®é–¢ç¯€ãŒè‰¯å¥½ä»¥ä¸Š |
| **éª¨æ ¼ç·š** | æ³¨æ„ | ğŸŸ  ã‚ªãƒ¬ãƒ³ã‚¸ | ã„ãšã‚Œã‹ã®é–¢ç¯€ãŒæ³¨æ„ |
| **éª¨æ ¼ç·š** | è¦æ”¹å–„ | ğŸ”´ èµ¤ | ã„ãšã‚Œã‹ã®é–¢ç¯€ãŒè¦æ”¹å–„ |

#### 2.3.2 ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

```typescript
/**
 * å‚è€ƒæƒ…å ±ã®ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
 * UIã«ã¯å¸¸ã«ã€Œã“ã‚Œã¯å‚è€ƒæƒ…å ±ã§ã™ã€ã®æ³¨æ„æ›¸ãã‚’è¡¨ç¤º
 */
interface ReferenceInfoDisplay {
  // ç·åˆå‚è€ƒæƒ…å ±
  overallMessage: string;  // ä¾‹: ã€Œè‰¯å¥½ã§ã™ã€
  
  // éƒ¨ä½åˆ¥å‚è€ƒæƒ…å ±
  checkpoints: Array<{
    name: string;      // ä¾‹: ã€Œè†ã®è§’åº¦ã€
    score: number;     // 0-100ã®å‚è€ƒã‚¹ã‚³ã‚¢
    message: string;   // ä¾‹: ã€Œã‚‚ã†å°‘ã—æ›²ã’ã¾ã—ã‚‡ã†ã€
  }>;
  
  // å¿…é ˆã®æ³¨æ„æ›¸ãï¼ˆåˆ©ç”¨è¦ç´„v3.1ç¬¬3.4æ¡æº–æ‹ ï¼‰
  disclaimer: string;  // ã€Œâ„¹ï¸ è¡¨ç¤ºã•ã‚Œã‚‹ã‚¹ã‚³ã‚¢ã¯å‚è€ƒæƒ…å ±ã§ã™ã€
}
```

### 2.4 å›æ•°ã‚«ã‚¦ãƒ³ãƒˆãƒ­ã‚¸ãƒƒã‚¯

#### 2.4.1 ã‚«ã‚¦ãƒ³ãƒˆåˆ¤å®šã®åŸºæœ¬

```typescript
/**
 * 1å›ã®ã‚«ã‚¦ãƒ³ãƒˆåˆ¤å®š
 * ç¨®ç›®ã«ã‚ˆã£ã¦ç•°ãªã‚‹çŠ¶æ…‹é·ç§»ã‚’å®šç¾©
 */
enum RepPhase {
  READY = 'ready',           // é–‹å§‹ä½ç½®
  DESCENDING = 'descending', // ä¸‹é™ä¸­
  BOTTOM = 'bottom',         // æœ€ä¸‹ç‚¹
  ASCENDING = 'ascending',   // ä¸Šæ˜‡ä¸­
  TOP = 'top',               // æœ€ä¸Šç‚¹ï¼ˆ1å›å®Œäº†ï¼‰
}

interface RepCountState {
  currentPhase: RepPhase;
  phaseStartTime: number;
  repCount: number;
}

/**
 * çŠ¶æ…‹é·ç§»ã®åˆ¤å®š
 * @param currentPhase - ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚º
 * @param keyAngle - åˆ¤å®šã«ä½¿ç”¨ã™ã‚‹è§’åº¦
 * @param thresholds - åˆ¤å®šé–¾å€¤
 */
function determineNextPhase(
  currentPhase: RepPhase,
  keyAngle: number,
  thresholds: {
    topAngle: number;
    bottomAngle: number;
    hysteresis: number; // ãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹ï¼ˆãƒãƒ£ã‚¿ãƒªãƒ³ã‚°é˜²æ­¢ï¼‰
  }
): RepPhase {
  // ç¨®ç›®ã”ã¨ã«å…·ä½“çš„ãªåˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
  // è©³ç´°ã¯å„ç¨®ç›®ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§
}
```

#### 2.4.2 ãƒãƒ£ã‚¿ãƒªãƒ³ã‚°é˜²æ­¢

```typescript
/**
 * ãƒãƒ£ã‚¿ãƒªãƒ³ã‚°é˜²æ­¢ã®ãŸã‚ã®æœ€å°ãƒ•ã‚§ãƒ¼ã‚ºæŒç¶šæ™‚é–“
 * 1ã¤ã®ãƒ•ã‚§ãƒ¼ã‚ºã¯æœ€ä½200msæŒç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚‹
 */
const MIN_PHASE_DURATION = 200; // ãƒŸãƒªç§’

function shouldTransitionPhase(
  currentPhaseStartTime: number,
  minDuration: number = MIN_PHASE_DURATION
): boolean {
  const now = Date.now();
  return (now - currentPhaseStartTime) >= minDuration;
}
```

### 2.5 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### 2.5.1 æ¤œå‡ºã‚¨ãƒ©ãƒ¼ã®å‡¦ç†

```typescript
/**
 * MediaPipe Poseæ¤œå‡ºã‚¨ãƒ©ãƒ¼ã®å‡¦ç†
 */
enum DetectionError {
  NO_PERSON_DETECTED = 'no_person_detected',         // äººç‰©ãŒæ¤œå‡ºã•ã‚Œãªã„
  MULTIPLE_PERSONS = 'multiple_persons',             // è¤‡æ•°äººãŒæ¤œå‡ºã•ã‚Œã‚‹
  INSUFFICIENT_VISIBILITY = 'insufficient_visibility', // å¯è¦–æ€§ãŒä¸è¶³
  CAMERA_ERROR = 'camera_error',                     // ã‚«ãƒ¡ãƒ©ã‚¨ãƒ©ãƒ¼
}

interface DetectionErrorHandler {
  error: DetectionError;
  message: string;      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  voiceGuidance: string; // éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹
  severity: 'warning' | 'error';
}

const errorHandlers: Record<DetectionError, DetectionErrorHandler> = {
  [DetectionError.NO_PERSON_DETECTED]: {
    error: DetectionError.NO_PERSON_DETECTED,
    message: 'å…¨èº«ãŒç”»é¢ã«åã¾ã‚‹ã‚ˆã†ã«èª¿æ•´ã—ã¦ãã ã•ã„',
    voiceGuidance: 'å…¨èº«ã‚’ç”»é¢ã«åã‚ã¦ãã ã•ã„',
    severity: 'warning',
  },
  [DetectionError.MULTIPLE_PERSONS]: {
    error: DetectionError.MULTIPLE_PERSONS,
    message: 'ç”»é¢å†…ã«1äººã ã‘æ˜ ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„',
    voiceGuidance: 'ç”»é¢å†…ã«1äººã ã‘æ˜ ã—ã¦ãã ã•ã„',
    severity: 'warning',
  },
  [DetectionError.INSUFFICIENT_VISIBILITY]: {
    error: DetectionError.INSUFFICIENT_VISIBILITY,
    message: 'ã‚ˆã‚Šæ˜ã‚‹ã„å ´æ‰€ã§æ’®å½±ã—ã¦ãã ã•ã„',
    voiceGuidance: 'ã‚‚ã£ã¨æ˜ã‚‹ã„å ´æ‰€ã«ç§»å‹•ã—ã¦ãã ã•ã„',
    severity: 'warning',
  },
  [DetectionError.CAMERA_ERROR]: {
    error: DetectionError.CAMERA_ERROR,
    message: 'ã‚«ãƒ¡ãƒ©ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚ã‚¢ãƒ—ãƒªã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„',
    voiceGuidance: 'ã‚«ãƒ¡ãƒ©ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
    severity: 'error',
  },
};
```

#### 2.5.2 æ¤œå‡ºå“è³ªã®ç›£è¦–

```typescript
/**
 * æ¤œå‡ºå“è³ªã®ç›£è¦–
 * ä¸€å®šæœŸé–“æ¤œå‡ºå“è³ªãŒä½ã„å ´åˆã¯è­¦å‘Šã‚’è¡¨ç¤º
 */
interface DetectionQualityMonitor {
  consecutiveLowQualityFrames: number;
  threshold: number; // é€£ç¶šã—ã¦ä½å“è³ªã¨åˆ¤å®šã™ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ æ•°
}

const QUALITY_WARNING_THRESHOLD = 30; // ç´„1ç§’ï¼ˆ30fpsæƒ³å®šï¼‰

function checkDetectionQuality(
  landmarks: MediaPipeLandmark[],
  monitor: DetectionQualityMonitor
): boolean {
  // ä¸»è¦ãª33é–¢ç¯€ã®ã†ã¡28ç‚¹ä»¥ä¸ŠãŒæ¤œå‡ºã•ã‚Œã¦ã„ã‚‹ã‹
  const visibleLandmarks = landmarks.filter(l => l.visibility > 0.5).length;
  const isQualityOk = visibleLandmarks >= 28;
  
  if (!isQualityOk) {
    monitor.consecutiveLowQualityFrames++;
    
    if (monitor.consecutiveLowQualityFrames >= QUALITY_WARNING_THRESHOLD) {
      // è­¦å‘Šã‚’è¡¨ç¤º
      return false;
    }
  } else {
    monitor.consecutiveLowQualityFrames = 0;
  }
  
  return true;
}
```

---

## 3. MediaPipe Poseæ¤œå‡ºä»•æ§˜

### 3.1 MediaPipe Poseã®æ¦‚è¦

MediaPipe Poseã¯ã€GoogleãŒé–‹ç™ºã—ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ äººä½“å§¿å‹¢æ¨å®šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

#### 3.1.1 æ¤œå‡ºã•ã‚Œã‚‹é–¢ç¯€ç‚¹

MediaPipe Poseã¯33å€‹ã®é–¢ç¯€ç‚¹ï¼ˆãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ï¼‰ã‚’æ¤œå‡ºã—ã¾ã™:

```typescript
/**
 * MediaPipe Poseãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
 * å‚è€ƒ: https://google.github.io/mediapipe/solutions/pose.html
 */
enum PoseLandmark {
  // é¡”ï¼ˆ0-10ï¼‰
  NOSE = 0,
  LEFT_EYE_INNER = 1,
  LEFT_EYE = 2,
  LEFT_EYE_OUTER = 3,
  RIGHT_EYE_INNER = 4,
  RIGHT_EYE = 5,
  RIGHT_EYE_OUTER = 6,
  LEFT_EAR = 7,
  RIGHT_EAR = 8,
  MOUTH_LEFT = 9,
  MOUTH_RIGHT = 10,
  
  // ä¸ŠåŠèº«ï¼ˆ11-16ï¼‰
  LEFT_SHOULDER = 11,
  RIGHT_SHOULDER = 12,
  LEFT_ELBOW = 13,
  RIGHT_ELBOW = 14,
  LEFT_WRIST = 15,
  RIGHT_WRIST = 16,
  
  // æ‰‹ï¼ˆ17-22ï¼‰
  LEFT_PINKY = 17,
  RIGHT_PINKY = 18,
  LEFT_INDEX = 19,
  RIGHT_INDEX = 20,
  LEFT_THUMB = 21,
  RIGHT_THUMB = 22,
  
  // ä¸‹åŠèº«ï¼ˆ23-32ï¼‰
  LEFT_HIP = 23,
  RIGHT_HIP = 24,
  LEFT_KNEE = 25,
  RIGHT_KNEE = 26,
  LEFT_ANKLE = 27,
  RIGHT_ANKLE = 28,
  LEFT_HEEL = 29,
  RIGHT_HEEL = 30,
  LEFT_FOOT_INDEX = 31,
  RIGHT_FOOT_INDEX = 32,
}
```

#### 3.1.2 ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

```typescript
/**
 * MediaPipe Poseã®ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ãƒ‡ãƒ¼ã‚¿
 */
interface MediaPipeLandmark {
  x: number;        // Xåº§æ¨™ï¼ˆ0.0-1.0ã®æ­£è¦åŒ–åº§æ¨™ï¼‰
  y: number;        // Yåº§æ¨™ï¼ˆ0.0-1.0ã®æ­£è¦åŒ–åº§æ¨™ï¼‰
  z: number;        // Zåº§æ¨™ï¼ˆå¥¥è¡Œãã€å˜ä½ã¯Xåº§æ¨™ã¨åŒã˜ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰
  visibility: number; // å¯è¦–æ€§ï¼ˆ0.0-1.0ã€é«˜ã„ã»ã©ä¿¡é ¼æ€§ãŒé«˜ã„ï¼‰
}

/**
 * MediaPipe Poseã®æ¤œå‡ºçµæœ
 */
interface PoseDetectionResult {
  landmarks: MediaPipeLandmark[]; // 33å€‹ã®ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
  worldLandmarks?: MediaPipeLandmark[]; // 3Dä¸–ç•Œåº§æ¨™ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  timestamp: number; // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
}
```

### 3.2 è§’åº¦è¨ˆç®—

#### 3.2.1 2æ¬¡å…ƒè§’åº¦ã®è¨ˆç®—

```typescript
/**
 * 3ç‚¹ã‹ã‚‰è§’åº¦ã‚’è¨ˆç®—ï¼ˆ2Dï¼‰
 * @param pointA - å§‹ç‚¹
 * @param pointB - é ‚ç‚¹ï¼ˆè§’åº¦ã‚’æ¸¬ã‚‹ç‚¹ï¼‰
 * @param pointC - çµ‚ç‚¹
 * @returns è§’åº¦ï¼ˆåº¦æ•°æ³•ã€0-180åº¦ï¼‰
 */
function calculateAngle2D(
  pointA: { x: number; y: number },
  pointB: { x: number; y: number },
  pointC: { x: number; y: number }
): number {
  // ãƒ™ã‚¯ãƒˆãƒ«BAã€BCã‚’è¨ˆç®—
  const vectorBA = {
    x: pointA.x - pointB.x,
    y: pointA.y - pointB.y,
  };
  
  const vectorBC = {
    x: pointC.x - pointB.x,
    y: pointC.y - pointB.y,
  };
  
  // å†…ç©ã‚’è¨ˆç®—
  const dotProduct = vectorBA.x * vectorBC.x + vectorBA.y * vectorBC.y;
  
  // ãƒ™ã‚¯ãƒˆãƒ«ã®å¤§ãã•ã‚’è¨ˆç®—
  const magnitudeBA = Math.sqrt(vectorBA.x ** 2 + vectorBA.y ** 2);
  const magnitudeBC = Math.sqrt(vectorBC.x ** 2 + vectorBC.y ** 2);
  
  // cos(Î¸) = (BAãƒ»BC) / (|BA| * |BC|)
  const cosTheta = dotProduct / (magnitudeBA * magnitudeBC);
  
  // arccos ã§è§’åº¦ã‚’è¨ˆç®—ï¼ˆãƒ©ã‚¸ã‚¢ãƒ³ï¼‰
  const angleRadians = Math.acos(Math.max(-1, Math.min(1, cosTheta)));
  
  // åº¦æ•°æ³•ã«å¤‰æ›
  const angleDegrees = (angleRadians * 180) / Math.PI;
  
  return angleDegrees;
}
```

#### 3.2.2 3æ¬¡å…ƒè§’åº¦ã®è¨ˆç®—

```typescript
/**
 * 3ç‚¹ã‹ã‚‰è§’åº¦ã‚’è¨ˆç®—ï¼ˆ3Dï¼‰
 * @param pointA - å§‹ç‚¹
 * @param pointB - é ‚ç‚¹ï¼ˆè§’åº¦ã‚’æ¸¬ã‚‹ç‚¹ï¼‰
 * @param pointC - çµ‚ç‚¹
 * @returns è§’åº¦ï¼ˆåº¦æ•°æ³•ã€0-180åº¦ï¼‰
 */
function calculateAngle3D(
  pointA: { x: number; y: number; z: number },
  pointB: { x: number; y: number; z: number },
  pointC: { x: number; y: number; z: number }
): number {
  // ãƒ™ã‚¯ãƒˆãƒ«BAã€BCã‚’è¨ˆç®—
  const vectorBA = {
    x: pointA.x - pointB.x,
    y: pointA.y - pointB.y,
    z: pointA.z - pointB.z,
  };
  
  const vectorBC = {
    x: pointC.x - pointB.x,
    y: pointC.y - pointB.y,
    z: pointC.z - pointB.z,
  };
  
  // å†…ç©ã‚’è¨ˆç®—
  const dotProduct = 
    vectorBA.x * vectorBC.x + 
    vectorBA.y * vectorBC.y + 
    vectorBA.z * vectorBC.z;
  
  // ãƒ™ã‚¯ãƒˆãƒ«ã®å¤§ãã•ã‚’è¨ˆç®—
  const magnitudeBA = Math.sqrt(
    vectorBA.x ** 2 + vectorBA.y ** 2 + vectorBA.z ** 2
  );
  const magnitudeBC = Math.sqrt(
    vectorBC.x ** 2 + vectorBC.y ** 2 + vectorBC.z ** 2
  );
  
  // cos(Î¸) = (BAãƒ»BC) / (|BA| * |BC|)
  const cosTheta = dotProduct / (magnitudeBA * magnitudeBC);
  
  // arccos ã§è§’åº¦ã‚’è¨ˆç®—ï¼ˆãƒ©ã‚¸ã‚¢ãƒ³ï¼‰
  const angleRadians = Math.acos(Math.max(-1, Math.min(1, cosTheta)));
  
  // åº¦æ•°æ³•ã«å¤‰æ›
  const angleDegrees = (angleRadians * 180) / Math.PI;
  
  return angleDegrees;
}
```

### 3.3 è·é›¢è¨ˆç®—

#### 3.3.1 2æ¬¡å…ƒè·é›¢

```typescript
/**
 * 2ç‚¹é–“ã®è·é›¢ã‚’è¨ˆç®—ï¼ˆ2Dï¼‰
 * @param pointA - ç‚¹A
 * @param pointB - ç‚¹B
 * @returns è·é›¢
 */
function calculateDistance2D(
  pointA: { x: number; y: number },
  pointB: { x: number; y: number }
): number {
  const dx = pointB.x - pointA.x;
  const dy = pointB.y - pointA.y;
  
  return Math.sqrt(dx ** 2 + dy ** 2);
}
```

#### 3.3.2 3æ¬¡å…ƒè·é›¢

```typescript
/**
 * 2ç‚¹é–“ã®è·é›¢ã‚’è¨ˆç®—ï¼ˆ3Dï¼‰
 * @param pointA - ç‚¹A
 * @param pointB - ç‚¹B
 * @returns è·é›¢
 */
function calculateDistance3D(
  pointA: { x: number; y: number; z: number },
  pointB: { x: number; y: number; z: number }
): number {
  const dx = pointB.x - pointA.x;
  const dy = pointB.y - pointA.y;
  const dz = pointB.z - pointA.z;
  
  return Math.sqrt(dx ** 2 + dy ** 2 + dz ** 2);
}
```

### 3.4 æ¤œå‡ºå“è³ªã®è©•ä¾¡

#### 3.4.1 å¯è¦–æ€§ï¼ˆVisibilityï¼‰ã®è©•ä¾¡

```typescript
/**
 * ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã®å¯è¦–æ€§ã‚’è©•ä¾¡
 * @param landmark - ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
 * @returns å¯è¦–æ€§ã®ãƒ¬ãƒ™ãƒ«
 */
enum VisibilityLevel {
  HIGH = 'high',     // visibility >= 0.8
  MEDIUM = 'medium', // 0.5 <= visibility < 0.8
  LOW = 'low',       // visibility < 0.5
}

function evaluateVisibility(landmark: MediaPipeLandmark): VisibilityLevel {
  if (landmark.visibility >= 0.8) {
    return VisibilityLevel.HIGH;
  } else if (landmark.visibility >= 0.5) {
    return VisibilityLevel.MEDIUM;
  } else {
    return VisibilityLevel.LOW;
  }
}
```

#### 3.4.2 æ¤œå‡ºä¿¡é ¼åº¦ã®ç·åˆè©•ä¾¡

```typescript
/**
 * æ¤œå‡ºçµæœã®ç·åˆçš„ãªä¿¡é ¼åº¦ã‚’è©•ä¾¡
 * @param result - MediaPipe Poseã®æ¤œå‡ºçµæœ
 * @param requiredLandmarks - å¿…é ˆãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é…åˆ—
 * @returns ä¿¡é ¼åº¦ï¼ˆ0.0-1.0ï¼‰
 */
function evaluateDetectionConfidence(
  result: PoseDetectionResult,
  requiredLandmarks: PoseLandmark[]
): number {
  if (result.landmarks.length !== 33) {
    return 0;
  }
  
  // å¿…é ˆãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã®å¯è¦–æ€§ã®å¹³å‡ã‚’è¨ˆç®—
  const visibilities = requiredLandmarks.map(
    index => result.landmarks[index].visibility
  );
  
  const averageVisibility = 
    visibilities.reduce((sum, v) => sum + v, 0) / visibilities.length;
  
  return averageVisibility;
}
```

---

## 4. ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ

### 4.1 ç¨®ç›®æ¦‚è¦

| é …ç›® | å†…å®¹ |
|-----|------|
| **ç¨®ç›®å** | ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆï¼ˆSquatï¼‰ |
| **ã‚«ãƒ†ã‚´ãƒªãƒ¼** | è‡ªé‡ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° |
| **é›ãˆã‚‹éƒ¨ä½** | ä¸‹åŠèº«ï¼ˆå¤§è…¿å››é ­ç­‹ã€å¤§è‡€ç­‹ã€ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°ã‚¹ï¼‰ |
| **é›£æ˜“åº¦** | åˆç´š |
| **æ¨å¥¨ã‚«ãƒ¡ãƒ©å‘ã** | æ¨ªå‘ãï¼ˆå´é¢ã‹ã‚‰æ’®å½±ï¼‰ |
| **ã‚«ã‚¦ãƒ³ãƒˆæ–¹å¼** | å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ |

### 4.2 ãƒ•ã‚©ãƒ¼ãƒ ã®åŸºæº–

#### 4.2.1 é–‹å§‹å§¿å‹¢ï¼ˆReady Positionï¼‰

| ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ | ç†æƒ³çš„ãªçŠ¶æ…‹ |
|---------------|------------|
| **è¶³å¹…** | è‚©å¹…ç¨‹åº¦ |
| **ã¤ã¾å…ˆã®å‘ã** | ã‚„ã‚„å¤–å‘ãï¼ˆ10-15åº¦ï¼‰ |
| **è†ã®è§’åº¦** | ã»ã¼ç›´ç«‹ï¼ˆ170-180åº¦ï¼‰ |
| **è…°ã®ä½ç½®** | ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ« |
| **èƒŒä¸­** | ã¾ã£ã™ã |

#### 4.2.2 ä¸‹é™æ™‚ï¼ˆDescending Phaseï¼‰

| ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ | ç†æƒ³çš„ãªçŠ¶æ…‹ | è¨±å®¹ç¯„å›² |
|---------------|------------|---------|
| **è†ã®è§’åº¦** | 90åº¦ | 80-100åº¦ |
| **è†ã®ä½ç½®** | ã¤ã¾å…ˆã‚ˆã‚Šå‰ã«å‡ºãªã„ | - |
| **è…°ã®é«˜ã•** | è†ã¨åŒã˜é«˜ã• | - |
| **èƒŒä¸­ã®è§’åº¦** | å‚ç›´ã‹ã‚‰30åº¦ä»¥å†… | 20-40åº¦ |
| **é‡å¿ƒ** | ã‹ã‹ã¨å¯„ã‚Š | - |

#### 4.2.3 ä¸Šæ˜‡æ™‚ï¼ˆAscending Phaseï¼‰

| ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ | ç†æƒ³çš„ãªçŠ¶æ…‹ |
|---------------|------------|
| **è†ã®ä¼¸å±•** | ã‚¹ãƒ ãƒ¼ã‚ºã«ä¼¸ã°ã™ |
| **è…°ã®ä¸Šæ˜‡** | è†ã¨åŒæ™‚ã«ä¸ŠãŒã‚‹ |
| **èƒŒä¸­** | ã¾ã£ã™ãã‚’ç¶­æŒ |

### 4.3 MediaPipeä½¿ç”¨ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯

```typescript
/**
 * ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆã§ä½¿ç”¨ã™ã‚‹ä¸»è¦ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
 */
const SQUAT_LANDMARKS = {
  // ä¸‹åŠèº«
  leftHip: PoseLandmark.LEFT_HIP,        // 23
  rightHip: PoseLandmark.RIGHT_HIP,      // 24
  leftKnee: PoseLandmark.LEFT_KNEE,      // 25
  rightKnee: PoseLandmark.RIGHT_KNEE,    // 26
  leftAnkle: PoseLandmark.LEFT_ANKLE,    // 27
  rightAnkle: PoseLandmark.RIGHT_ANKLE,  // 28
  
  // ä¸ŠåŠèº«ï¼ˆèƒŒä¸­ã®å§¿å‹¢ç¢ºèªç”¨ï¼‰
  leftShoulder: PoseLandmark.LEFT_SHOULDER,  // 11
  rightShoulder: PoseLandmark.RIGHT_SHOULDER, // 12
} as const;

/**
 * å¿…é ˆãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ï¼ˆã“ã‚Œã‚‰ãŒæ¤œå‡ºã•ã‚Œãªã„å ´åˆã¯è©•ä¾¡ä¸å¯ï¼‰
 */
const SQUAT_REQUIRED_LANDMARKS = [
  SQUAT_LANDMARKS.leftHip,
  SQUAT_LANDMARKS.rightHip,
  SQUAT_LANDMARKS.leftKnee,
  SQUAT_LANDMARKS.rightKnee,
  SQUAT_LANDMARKS.leftAnkle,
  SQUAT_LANDMARKS.rightAnkle,
];
```

### 4.4 ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã¨å‚è€ƒã‚¹ã‚³ã‚¢ç®—å‡º

#### 4.4.1 è†ã®è§’åº¦

```typescript
/**
 * è†ã®è§’åº¦ã‚’ãƒã‚§ãƒƒã‚¯
 * @param landmarks - MediaPipeãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
 * @param side - å·¦å³ï¼ˆ'left' or 'right'ï¼‰
 * @returns å‚è€ƒã‚¹ã‚³ã‚¢ã¨è§’åº¦
 */
function checkKneeAngle(
  landmarks: MediaPipeLandmark[],
  side: 'left' | 'right'
): { score: number; angle: number; message: string } {
  const hip = side === 'left' ? 
    landmarks[SQUAT_LANDMARKS.leftHip] : 
    landmarks[SQUAT_LANDMARKS.rightHip];
  const knee = side === 'left' ? 
    landmarks[SQUAT_LANDMARKS.leftKnee] : 
    landmarks[SQUAT_LANDMARKS.rightKnee];
  const ankle = side === 'left' ? 
    landmarks[SQUAT_LANDMARKS.leftAnkle] : 
    landmarks[SQUAT_LANDMARKS.rightAnkle];
  
  // è†ã®è§’åº¦ã‚’è¨ˆç®—ï¼ˆè…°-è†-è¶³é¦–ï¼‰
  const angle = calculateAngle2D(hip, knee, ankle);
  
  // ç†æƒ³çš„ãªè§’åº¦: 90åº¦ï¼ˆä¸‹é™æ™‚ï¼‰
  const idealAngle = 90;
  const tolerance = 10; // Â±10åº¦ã®è¨±å®¹ç¯„å›²
  
  // å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const score = calculateReferenceScore(idealAngle, angle, tolerance);
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  let message = '';
  if (score >= 90) {
    message = 'å„ªè‰¯ã§ã™';
  } else if (angle < 80) {
    message = 'è†ã‚’ã‚‚ã†å°‘ã—æµ…ãæ›²ã’ã¾ã—ã‚‡ã†';
  } else if (angle > 100) {
    message = 'è†ã‚’ã‚‚ã†å°‘ã—æ·±ãæ›²ã’ã¾ã—ã‚‡ã†';
  } else {
    message = 'è‰¯å¥½ã§ã™';
  }
  
  return { score, angle, message };
}
```

#### 4.4.2 è†ã®å‰æ–¹çªå‡ºãƒã‚§ãƒƒã‚¯

```typescript
/**
 * è†ãŒã¤ã¾å…ˆã‚ˆã‚Šå‰ã«å‡ºã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯
 * @param landmarks - MediaPipeãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
 * @param side - å·¦å³ï¼ˆ'left' or 'right'ï¼‰
 * @returns å‚è€ƒã‚¹ã‚³ã‚¢ã¨è·é›¢
 */
function checkKneeOverToes(
  landmarks: MediaPipeLandmark[],
  side: 'left' | 'right'
): { score: number; distance: number; message: string } {
  const knee = side === 'left' ? 
    landmarks[SQUAT_LANDMARKS.leftKnee] : 
    landmarks[SQUAT_LANDMARKS.rightKnee];
  const ankle = side === 'left' ? 
    landmarks[SQUAT_LANDMARKS.leftAnkle] : 
    landmarks[SQUAT_LANDMARKS.rightAnkle];
  
  // è†ã¨ã¤ã¾å…ˆï¼ˆè¶³é¦–ã§ä»£ç”¨ï¼‰ã®Xåº§æ¨™ã®å·®ã‚’è¨ˆç®—
  // æ­£ã®å€¤: è†ãŒå‰ã€è² ã®å€¤: è†ãŒå¾Œã‚
  const distance = knee.x - ankle.x;
  
  // ç†æƒ³çš„ãªè·é›¢: 0ï¼ˆè†ãŒã¤ã¾å…ˆã®ãƒ©ã‚¤ãƒ³ä¸Šï¼‰
  // è¨±å®¹ç¯„å›²: ã¤ã¾å…ˆã®5cmå¾Œã‚ã¾ã§
  const idealDistance = 0;
  const tolerance = 0.05; // æ­£è¦åŒ–åº§æ¨™ã§ã®è¨±å®¹ç¯„å›²
  
  // å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  // è†ãŒå‰ã«å‡ºã¦ã„ã‚‹å ´åˆã¯æ¸›ç‚¹
  let score = 100;
  if (distance > tolerance) {
    // è¨±å®¹ç¯„å›²ã‚’è¶…ãˆã¦å‰ã«å‡ºã¦ã„ã‚‹
    score = Math.max(0, 100 - (distance / tolerance - 1) * 50);
  }
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  let message = '';
  if (score >= 90) {
    message = 'å„ªè‰¯ã§ã™';
  } else if (distance > tolerance) {
    message = 'è†ãŒã¤ã¾å…ˆã‚ˆã‚Šå‰ã«å‡ºã¦ã„ã¾ã™';
  } else {
    message = 'è‰¯å¥½ã§ã™';
  }
  
  return { score, distance, message };
}
```

#### 4.4.3 èƒŒä¸­ã®å§¿å‹¢ãƒã‚§ãƒƒã‚¯

```typescript
/**
 * èƒŒä¸­ã®å§¿å‹¢ã‚’ãƒã‚§ãƒƒã‚¯
 * @param landmarks - MediaPipeãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
 * @returns å‚è€ƒã‚¹ã‚³ã‚¢ã¨è§’åº¦
 */
function checkBackPosture(
  landmarks: MediaPipeLandmark[]
): { score: number; angle: number; message: string } {
  const shoulder = landmarks[SQUAT_LANDMARKS.leftShoulder];
  const hip = landmarks[SQUAT_LANDMARKS.leftHip];
  const knee = landmarks[SQUAT_LANDMARKS.leftKnee];
  
  // èƒŒä¸­ã®è§’åº¦ã‚’è¨ˆç®—ï¼ˆè‚©-è…°-è†ï¼‰
  const angle = calculateAngle2D(shoulder, hip, knee);
  
  // ç†æƒ³çš„ãªè§’åº¦: 150åº¦ï¼ˆã‚„ã‚„å‰å‚¾ï¼‰
  const idealAngle = 150;
  const tolerance = 20; // Â±20åº¦ã®è¨±å®¹ç¯„å›²
  
  // å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const score = calculateReferenceScore(idealAngle, angle, tolerance);
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  let message = '';
  if (score >= 90) {
    message = 'å„ªè‰¯ã§ã™';
  } else if (angle < 130) {
    message = 'èƒŒä¸­ã‚’èµ·ã“ã—ã¾ã—ã‚‡ã†';
  } else if (angle > 170) {
    message = 'ã‚„ã‚„å‰å‚¾ã—ã¾ã—ã‚‡ã†';
  } else {
    message = 'è‰¯å¥½ã§ã™';
  }
  
  return { score, angle, message };
}
```

#### 4.4.4 è…°ã®é«˜ã•ãƒã‚§ãƒƒã‚¯

```typescript
/**
 * è…°ã®é«˜ã•ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆè†ã¨åŒã˜é«˜ã•ã¾ã§ä¸‹ãŒã£ã¦ã„ã‚‹ã‹ï¼‰
 * @param landmarks - MediaPipeãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
 * @returns å‚è€ƒã‚¹ã‚³ã‚¢ã¨é«˜ã•ã®å·®
 */
function checkHipHeight(
  landmarks: MediaPipeLandmark[]
): { score: number; heightDiff: number; message: string } {
  const hip = landmarks[SQUAT_LANDMARKS.leftHip];
  const knee = landmarks[SQUAT_LANDMARKS.leftKnee];
  
  // è…°ã¨è†ã®Yåº§æ¨™ã®å·®ã‚’è¨ˆç®—
  // æ­£ã®å€¤: è…°ãŒé«˜ã„ã€è² ã®å€¤: è…°ãŒä½ã„
  const heightDiff = hip.y - knee.y;
  
  // ç†æƒ³çš„ãªå·®: 0ï¼ˆè…°ã¨è†ãŒåŒã˜é«˜ã•ï¼‰
  const idealDiff = 0;
  const tolerance = 0.05; // æ­£è¦åŒ–åº§æ¨™ã§ã®è¨±å®¹ç¯„å›²
  
  // å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const score = calculateReferenceScore(idealDiff, Math.abs(heightDiff), tolerance);
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  let message = '';
  if (score >= 90) {
    message = 'å„ªè‰¯ã§ã™';
  } else if (heightDiff > tolerance) {
    message = 'ã‚‚ã†å°‘ã—æ·±ãä¸‹ã’ã¾ã—ã‚‡ã†';
  } else if (heightDiff < -tolerance) {
    message = 'å°‘ã—æµ…ã‚ã§ã‚‚å¤§ä¸ˆå¤«ã§ã™';
  } else {
    message = 'è‰¯å¥½ã§ã™';
  }
  
  return { score, heightDiff, message };
}
```

### 4.5 å›æ•°ã‚«ã‚¦ãƒ³ãƒˆãƒ­ã‚¸ãƒƒã‚¯

```typescript
/**
 * ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆã®å›æ•°ã‚«ã‚¦ãƒ³ãƒˆçŠ¶æ…‹
 */
interface SquatRepState extends RepCountState {
  minKneeAngle: number; // ç¾åœ¨ã®repã§ã®æœ€å°è†è§’åº¦
  maxKneeAngle: number; // ç¾åœ¨ã®repã§ã®æœ€å¤§è†è§’åº¦
}

/**
 * ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆã®å›æ•°ã‚«ã‚¦ãƒ³ãƒˆåˆ¤å®š
 */
function countSquatRep(
  landmarks: MediaPipeLandmark[],
  state: SquatRepState
): SquatRepState {
  // è†ã®è§’åº¦ã‚’è¨ˆç®—ï¼ˆå·¦å³ã®å¹³å‡ï¼‰
  const leftKneeAngle = calculateAngle2D(
    landmarks[SQUAT_LANDMARKS.leftHip],
    landmarks[SQUAT_LANDMARKS.leftKnee],
    landmarks[SQUAT_LANDMARKS.leftAnkle]
  );
  const rightKneeAngle = calculateAngle2D(
    landmarks[SQUAT_LANDMARKS.rightHip],
    landmarks[SQUAT_LANDMARKS.rightKnee],
    landmarks[SQUAT_LANDMARKS.rightAnkle]
  );
  const avgKneeAngle = (leftKneeAngle + rightKneeAngle) / 2;
  
  // æœ€å°ãƒ»æœ€å¤§è§’åº¦ã‚’æ›´æ–°
  state.minKneeAngle = Math.min(state.minKneeAngle, avgKneeAngle);
  state.maxKneeAngle = Math.max(state.maxKneeAngle, avgKneeAngle);
  
  const now = Date.now();
  const timeSincePhaseStart = now - state.phaseStartTime;
  
  // çŠ¶æ…‹é·ç§»ã®åˆ¤å®š
  switch (state.currentPhase) {
    case RepPhase.READY:
      // é–‹å§‹ä½ç½®ï¼ˆè†ãŒä¼¸ã³ã¦ã„ã‚‹çŠ¶æ…‹ï¼‰
      if (avgKneeAngle < 160 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // ä¸‹é™é–‹å§‹
        state.currentPhase = RepPhase.DESCENDING;
        state.phaseStartTime = now;
        state.minKneeAngle = 180;
      }
      break;
      
    case RepPhase.DESCENDING:
      // ä¸‹é™ä¸­
      if (avgKneeAngle <= 100 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // æœ€ä¸‹ç‚¹åˆ°é”
        state.currentPhase = RepPhase.BOTTOM;
        state.phaseStartTime = now;
      }
      break;
      
    case RepPhase.BOTTOM:
      // æœ€ä¸‹ç‚¹
      if (avgKneeAngle > 100 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // ä¸Šæ˜‡é–‹å§‹
        state.currentPhase = RepPhase.ASCENDING;
        state.phaseStartTime = now;
        state.maxKneeAngle = 0;
      }
      break;
      
    case RepPhase.ASCENDING:
      // ä¸Šæ˜‡ä¸­
      if (avgKneeAngle >= 160 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // æœ€ä¸Šç‚¹åˆ°é”ï¼ˆ1å›å®Œäº†ï¼‰
        state.currentPhase = RepPhase.TOP;
        state.phaseStartTime = now;
        state.repCount++;
        
        // æ¬¡ã®repã®æº–å‚™
        setTimeout(() => {
          state.currentPhase = RepPhase.READY;
          state.phaseStartTime = Date.now();
        }, 100);
      }
      break;
  }
  
  return state;
}
```

### 4.6 éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹

```typescript
/**
 * ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆã®éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹
 */
const SQUAT_VOICE_GUIDANCE = {
  // é–‹å§‹æ™‚
  start: 'ã‚¹ã‚¿ãƒ¼ãƒˆï¼',
  
  // ãƒ•ã‚©ãƒ¼ãƒ æ”¹å–„
  kneeAngleTooShallow: 'è†ã‚’ã‚‚ã†å°‘ã—æ·±ãæ›²ã’ã¾ã—ã‚‡ã†',
  kneeAngleTooDeep: 'è†ã‚’ã‚‚ã†å°‘ã—æµ…ãæ›²ã’ã¾ã—ã‚‡ã†',
  kneeOverToes: 'è†ãŒã¤ã¾å…ˆã‚ˆã‚Šå‰ã«å‡ºã¦ã„ã¾ã™',
  backTooForward: 'èƒŒä¸­ã‚’èµ·ã“ã—ã¾ã—ã‚‡ã†',
  backTooStraight: 'ã‚„ã‚„å‰å‚¾ã—ã¾ã—ã‚‡ã†',
  hipTooHigh: 'ã‚‚ã†å°‘ã—æ·±ãä¸‹ã’ã¾ã—ã‚‡ã†',
  
  // ã‚«ã‚¦ãƒ³ãƒˆ
  repCount: (count: number) => `${count}å›`,
  
  // ã‚»ãƒƒãƒˆå®Œäº†
  setComplete: 'ã‚»ãƒƒãƒˆå®Œäº†ï¼ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼',
  
  // ä¼‘æ†©
  restRemaining: (seconds: number) => `æ¬¡ã®ã‚»ãƒƒãƒˆã¾ã§ã‚ã¨${seconds}ç§’`,
};
```

### 4.7 ç·åˆå‚è€ƒã‚¹ã‚³ã‚¢ç®—å‡º

```typescript
/**
 * ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆã®ç·åˆå‚è€ƒã‚¹ã‚³ã‚¢ã‚’ç®—å‡º
 */
function calculateSquatOverallScore(
  landmarks: MediaPipeLandmark[]
): {
  overallScore: number;
  checkpoints: Array<{
    name: string;
    score: number;
    message: string;
  }>;
} {
  // å„ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã®ã‚¹ã‚³ã‚¢ã‚’ç®—å‡º
  const kneeAngleLeft = checkKneeAngle(landmarks, 'left');
  const kneeAngleRight = checkKneeAngle(landmarks, 'right');
  const kneeOverToesLeft = checkKneeOverToes(landmarks, 'left');
  const kneeOverToesRight = checkKneeOverToes(landmarks, 'right');
  const backPosture = checkBackPosture(landmarks);
  const hipHeight = checkHipHeight(landmarks);
  
  // å·¦å³ã®å¹³å‡ã‚’å–ã‚‹
  const avgKneeAngleScore = (kneeAngleLeft.score + kneeAngleRight.score) / 2;
  const avgKneeOverToesScore = (kneeOverToesLeft.score + kneeOverToesRight.score) / 2;
  
  // ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆé…åˆ—
  const checkpoints = [
    {
      name: 'è†ã®è§’åº¦',
      score: Math.round(avgKneeAngleScore),
      message: kneeAngleLeft.score < kneeAngleRight.score ? 
        kneeAngleLeft.message : kneeAngleRight.message,
    },
    {
      name: 'è†ã®ä½ç½®',
      score: Math.round(avgKneeOverToesScore),
      message: kneeOverToesLeft.score < kneeOverToesRight.score ? 
        kneeOverToesLeft.message : kneeOverToesRight.message,
    },
    {
      name: 'èƒŒä¸­ã®å§¿å‹¢',
      score: backPosture.score,
      message: backPosture.message,
    },
    {
      name: 'è…°ã®é«˜ã•',
      score: hipHeight.score,
      message: hipHeight.message,
    },
  ];
  
  // ç·åˆã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const overallScore = calculateOverallScore(
    checkpoints.map(cp => cp.score)
  );
  
  return {
    overallScore,
    checkpoints,
  };
}
```

---

## 5. ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—

### 5.1 ç¨®ç›®æ¦‚è¦

| é …ç›® | å†…å®¹ |
|-----|------|
| **ç¨®ç›®å** | ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—ï¼ˆPush-upï¼‰ |
| **ã‚«ãƒ†ã‚´ãƒªãƒ¼** | è‡ªé‡ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° |
| **é›ãˆã‚‹éƒ¨ä½** | èƒ¸ï¼ˆå¤§èƒ¸ç­‹ï¼‰ã€è…•ï¼ˆä¸Šè…•ä¸‰é ­ç­‹ï¼‰ã€è‚©ï¼ˆä¸‰è§’ç­‹ï¼‰ |
| **é›£æ˜“åº¦** | åˆç´š |
| **æ¨å¥¨ã‚«ãƒ¡ãƒ©å‘ã** | æ¨ªå‘ãï¼ˆå´é¢ã‹ã‚‰æ’®å½±ï¼‰ |
| **ã‚«ã‚¦ãƒ³ãƒˆæ–¹å¼** | å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ |

### 5.2 ãƒ•ã‚©ãƒ¼ãƒ ã®åŸºæº–

#### 5.2.1 é–‹å§‹å§¿å‹¢ï¼ˆReady Positionï¼‰

| ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ | ç†æƒ³çš„ãªçŠ¶æ…‹ |
|---------------|------------|
| **æ‰‹å¹…** | è‚©å¹…ã‚ˆã‚Šå°‘ã—åºƒã‚ |
| **æ‰‹ã®ä½ç½®** | èƒ¸ã®æ¨ª |
| **è‚˜ã®è§’åº¦** | ã»ã¼ç›´ç«‹ï¼ˆ170-180åº¦ï¼‰ |
| **ä½“ã®ä¸€ç›´ç·š** | é ­-è…°-è¶³é¦–ãŒä¸€ç›´ç·š |
| **è¦–ç·š** | æ–œã‚å‰æ–¹ |

#### 5.2.2 ä¸‹é™æ™‚ï¼ˆDescending Phaseï¼‰

| ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ | ç†æƒ³çš„ãªçŠ¶æ…‹ | è¨±å®¹ç¯„å›² |
|---------------|------------|---------|
| **è‚˜ã®è§’åº¦** | 90åº¦ | 70-110åº¦ |
| **è‚˜ã®é–‹ã** | 45åº¦ï¼ˆä½“ã«å¯¾ã—ã¦ï¼‰ | 30-60åº¦ |
| **ä½“ã®ä¸€ç›´ç·š** | ç¶­æŒ | - |
| **èƒ¸ã®ä½ç½®** | åºŠã‹ã‚‰5-10cm | - |

#### 5.2.3 ä¸Šæ˜‡æ™‚ï¼ˆAscending Phaseï¼‰

| ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ | ç†æƒ³çš„ãªçŠ¶æ…‹ |
|---------------|------------|
| **è‚˜ã®ä¼¸å±•** | ã‚¹ãƒ ãƒ¼ã‚ºã«ä¼¸ã°ã™ |
| **ä½“ã®ä¸€ç›´ç·š** | ç¶­æŒ |
| **è…°ã®ä½ç½®** | ä¸‹ãŒã‚‰ãªã„ã€ä¸ŠãŒã‚‰ãªã„ |

### 5.3 MediaPipeä½¿ç”¨ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯

```typescript
/**
 * ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—ã§ä½¿ç”¨ã™ã‚‹ä¸»è¦ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
 */
const PUSHUP_LANDMARKS = {
  // ä¸ŠåŠèº«
  leftShoulder: PoseLandmark.LEFT_SHOULDER,  // 11
  rightShoulder: PoseLandmark.RIGHT_SHOULDER, // 12
  leftElbow: PoseLandmark.LEFT_ELBOW,        // 13
  rightElbow: PoseLandmark.RIGHT_ELBOW,      // 14
  leftWrist: PoseLandmark.LEFT_WRIST,        // 15
  rightWrist: PoseLandmark.RIGHT_WRIST,      // 16
  
  // ä½“ã®ä¸€ç›´ç·šç¢ºèªç”¨
  leftHip: PoseLandmark.LEFT_HIP,            // 23
  rightHip: PoseLandmark.RIGHT_HIP,          // 24
  leftAnkle: PoseLandmark.LEFT_ANKLE,        // 27
  rightAnkle: PoseLandmark.RIGHT_ANKLE,      // 28
  
  // é ­ï¼ˆè¦–ç·šç¢ºèªç”¨ï¼‰
  nose: PoseLandmark.NOSE,                   // 0
} as const;

/**
 * å¿…é ˆãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
 */
const PUSHUP_REQUIRED_LANDMARKS = [
  PUSHUP_LANDMARKS.leftShoulder,
  PUSHUP_LANDMARKS.rightShoulder,
  PUSHUP_LANDMARKS.leftElbow,
  PUSHUP_LANDMARKS.rightElbow,
  PUSHUP_LANDMARKS.leftWrist,
  PUSHUP_LANDMARKS.rightWrist,
  PUSHUP_LANDMARKS.leftHip,
  PUSHUP_LANDMARKS.rightHip,
];
```

### 5.4 ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã¨å‚è€ƒã‚¹ã‚³ã‚¢ç®—å‡º

#### 5.4.1 è‚˜ã®è§’åº¦

```typescript
/**
 * è‚˜ã®è§’åº¦ã‚’ãƒã‚§ãƒƒã‚¯
 */
function checkElbowAngle(
  landmarks: MediaPipeLandmark[],
  side: 'left' | 'right'
): { score: number; angle: number; message: string } {
  const shoulder = side === 'left' ? 
    landmarks[PUSHUP_LANDMARKS.leftShoulder] : 
    landmarks[PUSHUP_LANDMARKS.rightShoulder];
  const elbow = side === 'left' ? 
    landmarks[PUSHUP_LANDMARKS.leftElbow] : 
    landmarks[PUSHUP_LANDMARKS.rightElbow];
  const wrist = side === 'left' ? 
    landmarks[PUSHUP_LANDMARKS.leftWrist] : 
    landmarks[PUSHUP_LANDMARKS.rightWrist];
  
  // è‚˜ã®è§’åº¦ã‚’è¨ˆç®—ï¼ˆè‚©-è‚˜-æ‰‹é¦–ï¼‰
  const angle = calculateAngle2D(shoulder, elbow, wrist);
  
  // ç†æƒ³çš„ãªè§’åº¦: 90åº¦ï¼ˆä¸‹é™æ™‚ï¼‰
  const idealAngle = 90;
  const tolerance = 20; // Â±20åº¦ã®è¨±å®¹ç¯„å›²
  
  // å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const score = calculateReferenceScore(idealAngle, angle, tolerance);
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  let message = '';
  if (score >= 90) {
    message = 'å„ªè‰¯ã§ã™';
  } else if (angle < 70) {
    message = 'è‚˜ã‚’ã‚‚ã†å°‘ã—æµ…ãæ›²ã’ã¾ã—ã‚‡ã†';
  } else if (angle > 110) {
    message = 'è‚˜ã‚’ã‚‚ã†å°‘ã—æ·±ãæ›²ã’ã¾ã—ã‚‡ã†';
  } else {
    message = 'è‰¯å¥½ã§ã™';
  }
  
  return { score, angle, message };
}
```

#### 5.4.2 ä½“ã®ä¸€ç›´ç·šãƒã‚§ãƒƒã‚¯

```typescript
/**
 * ä½“ãŒä¸€ç›´ç·šã«ãªã£ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
 */
function checkBodyAlignment(
  landmarks: MediaPipeLandmark[]
): { score: number; deviation: number; message: string } {
  const shoulder = landmarks[PUSHUP_LANDMARKS.leftShoulder];
  const hip = landmarks[PUSHUP_LANDMARKS.leftHip];
  const ankle = landmarks[PUSHUP_LANDMARKS.leftAnkle];
  
  // è‚©-è…°-è¶³é¦–ã®è§’åº¦ã‚’è¨ˆç®—
  // ä¸€ç›´ç·šã®å ´åˆã¯180åº¦
  const angle = calculateAngle2D(shoulder, hip, ankle);
  
  // ç†æƒ³çš„ãªè§’åº¦: 180åº¦ï¼ˆä¸€ç›´ç·šï¼‰
  const idealAngle = 180;
  const tolerance = 10; // Â±10åº¦ã®è¨±å®¹ç¯„å›²
  
  // åå·®ã‚’è¨ˆç®—
  const deviation = Math.abs(idealAngle - angle);
  
  // å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const score = calculateReferenceScore(idealAngle, angle, tolerance);
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  let message = '';
  if (score >= 90) {
    message = 'å„ªè‰¯ã§ã™';
  } else if (angle < 170) {
    message = 'è…°ã‚’ä¸Šã’ã¾ã—ã‚‡ã†';
  } else {
    message = 'è‰¯å¥½ã§ã™';
  }
  
  return { score, deviation, message };
}
```

#### 5.4.3 è‚˜ã®é–‹ãè§’åº¦ãƒã‚§ãƒƒã‚¯

```typescript
/**
 * è‚˜ã®é–‹ãè§’åº¦ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆä½“ã«å¯¾ã—ã¦45åº¦ãŒç†æƒ³ï¼‰
 */
function checkElbowFlare(
  landmarks: MediaPipeLandmark[],
  side: 'left' | 'right'
): { score: number; angle: number; message: string } {
  const shoulder = side === 'left' ? 
    landmarks[PUSHUP_LANDMARKS.leftShoulder] : 
    landmarks[PUSHUP_LANDMARKS.rightShoulder];
  const elbow = side === 'left' ? 
    landmarks[PUSHUP_LANDMARKS.leftElbow] : 
    landmarks[PUSHUP_LANDMARKS.rightElbow];
  const hip = side === 'left' ? 
    landmarks[PUSHUP_LANDMARKS.leftHip] : 
    landmarks[PUSHUP_LANDMARKS.rightHip];
  
  // è‚©-è‚˜ã®ãƒ™ã‚¯ãƒˆãƒ«ã¨è‚©-è…°ã®ãƒ™ã‚¯ãƒˆãƒ«ã®è§’åº¦ã‚’è¨ˆç®—
  const shoulderToElbow = {
    x: elbow.x - shoulder.x,
    y: elbow.y - shoulder.y,
  };
  
  const shoulderToHip = {
    x: hip.x - shoulder.x,
    y: hip.y - shoulder.y,
  };
  
  // ãƒ™ã‚¯ãƒˆãƒ«é–“ã®è§’åº¦ã‚’è¨ˆç®—
  const dotProduct = shoulderToElbow.x * shoulderToHip.x + shoulderToElbow.y * shoulderToHip.y;
  const magnitudeSE = Math.sqrt(shoulderToElbow.x ** 2 + shoulderToElbow.y ** 2);
  const magnitudeSH = Math.sqrt(shoulderToHip.x ** 2 + shoulderToHip.y ** 2);
  const cosTheta = dotProduct / (magnitudeSE * magnitudeSH);
  const angle = (Math.acos(Math.max(-1, Math.min(1, cosTheta))) * 180) / Math.PI;
  
  // ç†æƒ³çš„ãªè§’åº¦: 45åº¦
  const idealAngle = 45;
  const tolerance = 15; // Â±15åº¦ã®è¨±å®¹ç¯„å›²
  
  // å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const score = calculateReferenceScore(idealAngle, angle, tolerance);
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  let message = '';
  if (score >= 90) {
    message = 'å„ªè‰¯ã§ã™';
  } else if (angle < 30) {
    message = 'è‚˜ã‚’å°‘ã—é–‹ãã¾ã—ã‚‡ã†';
  } else if (angle > 60) {
    message = 'è‚˜ã‚’å°‘ã—é–‰ã˜ã¾ã—ã‚‡ã†';
  } else {
    message = 'è‰¯å¥½ã§ã™';
  }
  
  return { score, angle, message };
}
```

### 5.5 å›æ•°ã‚«ã‚¦ãƒ³ãƒˆãƒ­ã‚¸ãƒƒã‚¯

```typescript
/**
 * ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—ã®å›æ•°ã‚«ã‚¦ãƒ³ãƒˆçŠ¶æ…‹
 */
interface PushupRepState extends RepCountState {
  minElbowAngle: number;
  maxElbowAngle: number;
}

/**
 * ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—ã®å›æ•°ã‚«ã‚¦ãƒ³ãƒˆåˆ¤å®š
 */
function countPushupRep(
  landmarks: MediaPipeLandmark[],
  state: PushupRepState
): PushupRepState {
  // è‚˜ã®è§’åº¦ã‚’è¨ˆç®—ï¼ˆå·¦å³ã®å¹³å‡ï¼‰
  const leftElbowAngle = calculateAngle2D(
    landmarks[PUSHUP_LANDMARKS.leftShoulder],
    landmarks[PUSHUP_LANDMARKS.leftElbow],
    landmarks[PUSHUP_LANDMARKS.leftWrist]
  );
  const rightElbowAngle = calculateAngle2D(
    landmarks[PUSHUP_LANDMARKS.rightShoulder],
    landmarks[PUSHUP_LANDMARKS.rightElbow],
    landmarks[PUSHUP_LANDMARKS.rightWrist]
  );
  const avgElbowAngle = (leftElbowAngle + rightElbowAngle) / 2;
  
  // æœ€å°ãƒ»æœ€å¤§è§’åº¦ã‚’æ›´æ–°
  state.minElbowAngle = Math.min(state.minElbowAngle, avgElbowAngle);
  state.maxElbowAngle = Math.max(state.maxElbowAngle, avgElbowAngle);
  
  const now = Date.now();
  const timeSincePhaseStart = now - state.phaseStartTime;
  
  // çŠ¶æ…‹é·ç§»ã®åˆ¤å®š
  switch (state.currentPhase) {
    case RepPhase.READY:
      // é–‹å§‹ä½ç½®ï¼ˆè‚˜ãŒä¼¸ã³ã¦ã„ã‚‹çŠ¶æ…‹ï¼‰
      if (avgElbowAngle < 160 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // ä¸‹é™é–‹å§‹
        state.currentPhase = RepPhase.DESCENDING;
        state.phaseStartTime = now;
        state.minElbowAngle = 180;
      }
      break;
      
    case RepPhase.DESCENDING:
      // ä¸‹é™ä¸­
      if (avgElbowAngle <= 110 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // æœ€ä¸‹ç‚¹åˆ°é”
        state.currentPhase = RepPhase.BOTTOM;
        state.phaseStartTime = now;
      }
      break;
      
    case RepPhase.BOTTOM:
      // æœ€ä¸‹ç‚¹
      if (avgElbowAngle > 110 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // ä¸Šæ˜‡é–‹å§‹
        state.currentPhase = RepPhase.ASCENDING;
        state.phaseStartTime = now;
        state.maxElbowAngle = 0;
      }
      break;
      
    case RepPhase.ASCENDING:
      // ä¸Šæ˜‡ä¸­
      if (avgElbowAngle >= 160 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // æœ€ä¸Šç‚¹åˆ°é”ï¼ˆ1å›å®Œäº†ï¼‰
        state.currentPhase = RepPhase.TOP;
        state.phaseStartTime = now;
        state.repCount++;
        
        // æ¬¡ã®repã®æº–å‚™
        setTimeout(() => {
          state.currentPhase = RepPhase.READY;
          state.phaseStartTime = Date.now();
        }, 100);
      }
      break;
  }
  
  return state;
}
```

### 5.6 éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹

```typescript
/**
 * ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—ã®éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹
 */
const PUSHUP_VOICE_GUIDANCE = {
  // é–‹å§‹æ™‚
  start: 'ã‚¹ã‚¿ãƒ¼ãƒˆï¼',
  
  // ãƒ•ã‚©ãƒ¼ãƒ æ”¹å–„
  elbowAngleTooShallow: 'è‚˜ã‚’ã‚‚ã†å°‘ã—æ·±ãæ›²ã’ã¾ã—ã‚‡ã†',
  elbowAngleTooDeep: 'è‚˜ã‚’ã‚‚ã†å°‘ã—æµ…ãæ›²ã’ã¾ã—ã‚‡ã†',
  bodyNotStraight: 'ä½“ã‚’ä¸€ç›´ç·šã«ä¿ã¡ã¾ã—ã‚‡ã†',
  hipTooLow: 'è…°ã‚’ä¸Šã’ã¾ã—ã‚‡ã†',
  elbowTooWide: 'è‚˜ã‚’å°‘ã—é–‰ã˜ã¾ã—ã‚‡ã†',
  elbowTooNarrow: 'è‚˜ã‚’å°‘ã—é–‹ãã¾ã—ã‚‡ã†',
  
  // ã‚«ã‚¦ãƒ³ãƒˆ
  repCount: (count: number) => `${count}å›`,
  
  // ã‚»ãƒƒãƒˆå®Œäº†
  setComplete: 'ã‚»ãƒƒãƒˆå®Œäº†ï¼ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼',
  
  // ä¼‘æ†©
  restRemaining: (seconds: number) => `æ¬¡ã®ã‚»ãƒƒãƒˆã¾ã§ã‚ã¨${seconds}ç§’`,
};
```

### 5.7 ç·åˆå‚è€ƒã‚¹ã‚³ã‚¢ç®—å‡º

```typescript
/**
 * ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—ã®ç·åˆå‚è€ƒã‚¹ã‚³ã‚¢ã‚’ç®—å‡º
 */
function calculatePushupOverallScore(
  landmarks: MediaPipeLandmark[]
): {
  overallScore: number;
  checkpoints: Array<{
    name: string;
    score: number;
    message: string;
  }>;
} {
  // å„ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã®ã‚¹ã‚³ã‚¢ã‚’ç®—å‡º
  const elbowAngleLeft = checkElbowAngle(landmarks, 'left');
  const elbowAngleRight = checkElbowAngle(landmarks, 'right');
  const bodyAlignment = checkBodyAlignment(landmarks);
  const elbowFlareLeft = checkElbowFlare(landmarks, 'left');
  const elbowFlareRight = checkElbowFlare(landmarks, 'right');
  
  // å·¦å³ã®å¹³å‡ã‚’å–ã‚‹
  const avgElbowAngleScore = (elbowAngleLeft.score + elbowAngleRight.score) / 2;
  const avgElbowFlareScore = (elbowFlareLeft.score + elbowFlareRight.score) / 2;
  
  // ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆé…åˆ—
  const checkpoints = [
    {
      name: 'è‚˜ã®è§’åº¦',
      score: Math.round(avgElbowAngleScore),
      message: elbowAngleLeft.score < elbowAngleRight.score ? 
        elbowAngleLeft.message : elbowAngleRight.message,
    },
    {
      name: 'ä½“ã®ä¸€ç›´ç·š',
      score: bodyAlignment.score,
      message: bodyAlignment.message,
    },
    {
      name: 'è‚˜ã®é–‹ã',
      score: Math.round(avgElbowFlareScore),
      message: elbowFlareLeft.score < elbowFlareRight.score ? 
        elbowFlareLeft.message : elbowFlareRight.message,
    },
  ];
  
  // ç·åˆã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const overallScore = calculateOverallScore(
    checkpoints.map(cp => cp.score)
  );
  
  return {
    overallScore,
    checkpoints,
  };
}
```

---

**ãƒ•ã‚¡ã‚¤ãƒ«ãŒé•·ããªã£ãŸãŸã‚ã€ã“ã“ã§ä¸€åº¦åŒºåˆ‡ã‚Šã¾ã™ã€‚**

**æ¬¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ç¶šãã‚’ä½œæˆã—ã¾ã™:**
- ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«ï¼ˆè©³ç´°ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
- ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹ï¼ˆè©³ç´°ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
- ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆï¼ˆè©³ç´°ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
- å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
- ãƒ†ã‚¹ãƒˆä»•æ§˜
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶
# 5ç¨®ç›®ãƒ•ã‚©ãƒ¼ãƒ ç¢ºèªãƒ­ã‚¸ãƒƒã‚¯è©³ç´° v3.1 (Part 2)

**ç¶šã: ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«ã€ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹ã€ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆã€å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³**

---

## 6. ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«

### 6.1 ç¨®ç›®æ¦‚è¦

| é …ç›® | å†…å®¹ |
|-----|------|
| **ç¨®ç›®å** | ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«ï¼ˆDumbbell Curlï¼‰ |
| **ã‚«ãƒ†ã‚´ãƒªãƒ¼** | ãƒ€ãƒ³ãƒ™ãƒ«ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° |
| **é›ãˆã‚‹éƒ¨ä½** | è…•ï¼ˆä¸Šè…•äºŒé ­ç­‹ï¼‰ |
| **é›£æ˜“åº¦** | åˆç´š |
| **æ¨å¥¨ã‚«ãƒ¡ãƒ©å‘ã** | æ­£é¢ã¾ãŸã¯æ¨ªå‘ã |
| **ã‚«ã‚¦ãƒ³ãƒˆæ–¹å¼** | å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ |

### 6.2 ãƒ•ã‚©ãƒ¼ãƒ ã®åŸºæº–

#### 6.2.1 é–‹å§‹å§¿å‹¢ï¼ˆReady Positionï¼‰

| ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ | ç†æƒ³çš„ãªçŠ¶æ…‹ |
|---------------|------------|
| **è¶³å¹…** | è‚©å¹…ç¨‹åº¦ |
| **è‚˜ã®ä½ç½®** | ä½“ã®æ¨ªã«å›ºå®š |
| **è‚˜ã®è§’åº¦** | ã»ã¼ç›´ç«‹ï¼ˆ170-180åº¦ï¼‰ |
| **å§¿å‹¢** | èƒŒç­‹ã‚’ä¼¸ã°ã™ |
| **è¦–ç·š** | æ­£é¢ |

#### 6.2.2 ä¸Šæ˜‡æ™‚ï¼ˆConcentric Phaseï¼‰

| ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ | ç†æƒ³çš„ãªçŠ¶æ…‹ | è¨±å®¹ç¯„å›² |
|---------------|------------|---------|
| **è‚˜ã®è§’åº¦** | 40åº¦ | 30-50åº¦ |
| **è‚˜ã®ä½ç½®** | ä½“ã®æ¨ªã«å›ºå®šï¼ˆå‹•ã‹ã•ãªã„ï¼‰ | - |
| **è‚©ã®å‹•ã** | å‹•ã‹ã•ãªã„ | - |
| **èƒŒä¸­** | ã¾ã£ã™ãã‚’ç¶­æŒ | - |

#### 6.2.3 ä¸‹é™æ™‚ï¼ˆEccentric Phaseï¼‰

| ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ | ç†æƒ³çš„ãªçŠ¶æ…‹ |
|---------------|------------|
| **è‚˜ã®ä¼¸å±•** | ã‚†ã£ãã‚Šä¸‹ã‚ã™ |
| **è‚˜ã®ä½ç½®** | ä½“ã®æ¨ªã«å›ºå®š |
| **è‚©ã®å‹•ã** | å‹•ã‹ã•ãªã„ |

### 6.3 MediaPipeä½¿ç”¨ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯

```typescript
/**
 * ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«ã§ä½¿ç”¨ã™ã‚‹ä¸»è¦ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
 */
const DUMBBELL_CURL_LANDMARKS = {
  // ä¸ŠåŠèº«
  leftShoulder: PoseLandmark.LEFT_SHOULDER,  // 11
  rightShoulder: PoseLandmark.RIGHT_SHOULDER, // 12
  leftElbow: PoseLandmark.LEFT_ELBOW,        // 13
  rightElbow: PoseLandmark.RIGHT_ELBOW,      // 14
  leftWrist: PoseLandmark.LEFT_WRIST,        // 15
  rightWrist: PoseLandmark.RIGHT_WRIST,      // 16
  
  // ä½“å¹¹ï¼ˆå§¿å‹¢ç¢ºèªç”¨ï¼‰
  leftHip: PoseLandmark.LEFT_HIP,            // 23
  rightHip: PoseLandmark.RIGHT_HIP,          // 24
} as const;

/**
 * å¿…é ˆãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
 */
const DUMBBELL_CURL_REQUIRED_LANDMARKS = [
  DUMBBELL_CURL_LANDMARKS.leftShoulder,
  DUMBBELL_CURL_LANDMARKS.rightShoulder,
  DUMBBELL_CURL_LANDMARKS.leftElbow,
  DUMBBELL_CURL_LANDMARKS.rightElbow,
  DUMBBELL_CURL_LANDMARKS.leftWrist,
  DUMBBELL_CURL_LANDMARKS.rightWrist,
];
```

### 6.4 ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã¨å‚è€ƒã‚¹ã‚³ã‚¢ç®—å‡º

#### 6.4.1 è‚˜ã®è§’åº¦

```typescript
/**
 * è‚˜ã®è§’åº¦ã‚’ãƒã‚§ãƒƒã‚¯
 */
function checkCurlElbowAngle(
  landmarks: MediaPipeLandmark[],
  side: 'left' | 'right'
): { score: number; angle: number; message: string } {
  const shoulder = side === 'left' ? 
    landmarks[DUMBBELL_CURL_LANDMARKS.leftShoulder] : 
    landmarks[DUMBBELL_CURL_LANDMARKS.rightShoulder];
  const elbow = side === 'left' ? 
    landmarks[DUMBBELL_CURL_LANDMARKS.leftElbow] : 
    landmarks[DUMBBELL_CURL_LANDMARKS.rightElbow];
  const wrist = side === 'left' ? 
    landmarks[DUMBBELL_CURL_LANDMARKS.leftWrist] : 
    landmarks[DUMBBELL_CURL_LANDMARKS.rightWrist];
  
  // è‚˜ã®è§’åº¦ã‚’è¨ˆç®—ï¼ˆè‚©-è‚˜-æ‰‹é¦–ï¼‰
  const angle = calculateAngle2D(shoulder, elbow, wrist);
  
  // ç†æƒ³çš„ãªè§’åº¦: 40åº¦ï¼ˆä¸Šæ˜‡æ™‚ï¼‰
  const idealAngle = 40;
  const tolerance = 10; // Â±10åº¦ã®è¨±å®¹ç¯„å›²
  
  // å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const score = calculateReferenceScore(idealAngle, angle, tolerance);
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  let message = '';
  if (score >= 90) {
    message = 'å„ªè‰¯ã§ã™';
  } else if (angle < 30) {
    message = 'è‚˜ã‚’ã‚‚ã†å°‘ã—ä¼¸ã°ã—ã¾ã—ã‚‡ã†';
  } else if (angle > 50) {
    message = 'è‚˜ã‚’ã‚‚ã†å°‘ã—æ›²ã’ã¾ã—ã‚‡ã†';
  } else {
    message = 'è‰¯å¥½ã§ã™';
  }
  
  return { score, angle, message };
}
```

#### 6.4.2 è‚˜ã®ä½ç½®å›ºå®šãƒã‚§ãƒƒã‚¯

```typescript
/**
 * è‚˜ã®ä½ç½®ãŒå‹•ã„ã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯
 */
function checkElbowPosition(
  landmarks: MediaPipeLandmark[],
  side: 'left' | 'right',
  initialElbowPosition?: { x: number; y: number }
): { score: number; deviation: number; message: string } {
  const elbow = side === 'left' ? 
    landmarks[DUMBBELL_CURL_LANDMARKS.leftElbow] : 
    landmarks[DUMBBELL_CURL_LANDMARKS.rightElbow];
  
  // åˆæœŸä½ç½®ãŒæœªè¨­å®šã®å ´åˆã¯ç¾åœ¨ä½ç½®ã‚’è¿”ã™
  if (!initialElbowPosition) {
    return {
      score: 100,
      deviation: 0,
      message: 'å„ªè‰¯ã§ã™',
    };
  }
  
  // è‚˜ã®ä½ç½®ã®å¤‰åŒ–ã‚’è¨ˆç®—
  const deviation = calculateDistance2D(
    elbow,
    initialElbowPosition
  );
  
  // ç†æƒ³çš„ãªå¤‰åŒ–: 0ï¼ˆå‹•ã‹ãªã„ï¼‰
  const idealDeviation = 0;
  const tolerance = 0.05; // æ­£è¦åŒ–åº§æ¨™ã§ã®è¨±å®¹ç¯„å›²
  
  // å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const score = calculateReferenceScore(idealDeviation, deviation, tolerance);
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  let message = '';
  if (score >= 90) {
    message = 'å„ªè‰¯ã§ã™';
  } else if (deviation > tolerance) {
    message = 'è‚˜ã‚’ä½“ã®æ¨ªã«å›ºå®šã—ã¾ã—ã‚‡ã†';
  } else {
    message = 'è‰¯å¥½ã§ã™';
  }
  
  return { score, deviation, message };
}
```

#### 6.4.3 èƒŒä¸­ã®å§¿å‹¢ãƒã‚§ãƒƒã‚¯

```typescript
/**
 * èƒŒä¸­ã®å§¿å‹¢ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆåã‚Šè¿”ã£ã¦ã„ãªã„ã‹ï¼‰
 */
function checkCurlBackPosture(
  landmarks: MediaPipeLandmark[]
): { score: number; angle: number; message: string } {
  const shoulder = landmarks[DUMBBELL_CURL_LANDMARKS.leftShoulder];
  const hip = landmarks[DUMBBELL_CURL_LANDMARKS.leftHip];
  
  // è‚©ã¨è…°ã®Yåº§æ¨™ã®å·®ã‹ã‚‰å§¿å‹¢ã‚’è©•ä¾¡
  // å‚ç›´ã«è¿‘ã„ã»ã©è‰¯ã„å§¿å‹¢
  const shoulderHipDistance = calculateDistance2D(shoulder, hip);
  const verticalDistance = Math.abs(shoulder.y - hip.y);
  
  // å‚ç›´åº¦ã‚’è¨ˆç®—ï¼ˆ1.0ãŒå®Œå…¨ã«å‚ç›´ï¼‰
  const verticalRatio = verticalDistance / shoulderHipDistance;
  
  // ç†æƒ³çš„ãªå‚ç›´åº¦: 0.95ï¼ˆã»ã¼å‚ç›´ï¼‰
  const idealRatio = 0.95;
  const tolerance = 0.1;
  
  // å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const score = calculateReferenceScore(idealRatio, verticalRatio, tolerance);
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  let message = '';
  if (score >= 90) {
    message = 'å„ªè‰¯ã§ã™';
  } else if (verticalRatio < 0.85) {
    message = 'èƒŒä¸­ã‚’ã¾ã£ã™ãã«ä¿ã¡ã¾ã—ã‚‡ã†';
  } else {
    message = 'è‰¯å¥½ã§ã™';
  }
  
  return { score, angle: verticalRatio * 90, message };
}
```

### 6.5 å›æ•°ã‚«ã‚¦ãƒ³ãƒˆãƒ­ã‚¸ãƒƒã‚¯

```typescript
/**
 * ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«ã®å›æ•°ã‚«ã‚¦ãƒ³ãƒˆçŠ¶æ…‹
 */
interface DumbbellCurlRepState extends RepCountState {
  minElbowAngle: number;
  maxElbowAngle: number;
  initialElbowPosition?: { x: number; y: number };
}

/**
 * ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«ã®å›æ•°ã‚«ã‚¦ãƒ³ãƒˆåˆ¤å®š
 */
function countDumbbellCurlRep(
  landmarks: MediaPipeLandmark[],
  state: DumbbellCurlRepState,
  side: 'left' | 'right' = 'left'
): DumbbellCurlRepState {
  // è‚˜ã®è§’åº¦ã‚’è¨ˆç®—
  const shoulder = side === 'left' ? 
    landmarks[DUMBBELL_CURL_LANDMARKS.leftShoulder] : 
    landmarks[DUMBBELL_CURL_LANDMARKS.rightShoulder];
  const elbow = side === 'left' ? 
    landmarks[DUMBBELL_CURL_LANDMARKS.leftElbow] : 
    landmarks[DUMBBELL_CURL_LANDMARKS.rightElbow];
  const wrist = side === 'left' ? 
    landmarks[DUMBBELL_CURL_LANDMARKS.leftWrist] : 
    landmarks[DUMBBELL_CURL_LANDMARKS.rightWrist];
  
  const elbowAngle = calculateAngle2D(shoulder, elbow, wrist);
  
  // åˆå›ã®ã¿è‚˜ã®åˆæœŸä½ç½®ã‚’è¨˜éŒ²
  if (!state.initialElbowPosition) {
    state.initialElbowPosition = { x: elbow.x, y: elbow.y };
  }
  
  // æœ€å°ãƒ»æœ€å¤§è§’åº¦ã‚’æ›´æ–°
  state.minElbowAngle = Math.min(state.minElbowAngle, elbowAngle);
  state.maxElbowAngle = Math.max(state.maxElbowAngle, elbowAngle);
  
  const now = Date.now();
  const timeSincePhaseStart = now - state.phaseStartTime;
  
  // çŠ¶æ…‹é·ç§»ã®åˆ¤å®š
  switch (state.currentPhase) {
    case RepPhase.READY:
      // é–‹å§‹ä½ç½®ï¼ˆè‚˜ãŒä¼¸ã³ã¦ã„ã‚‹çŠ¶æ…‹ï¼‰
      if (elbowAngle < 160 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // ä¸Šæ˜‡é–‹å§‹
        state.currentPhase = RepPhase.ASCENDING;
        state.phaseStartTime = now;
        state.minElbowAngle = 180;
      }
      break;
      
    case RepPhase.ASCENDING:
      // ä¸Šæ˜‡ä¸­
      if (elbowAngle <= 50 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // æœ€ä¸Šç‚¹åˆ°é”
        state.currentPhase = RepPhase.TOP;
        state.phaseStartTime = now;
      }
      break;
      
    case RepPhase.TOP:
      // æœ€ä¸Šç‚¹
      if (elbowAngle > 50 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // ä¸‹é™é–‹å§‹
        state.currentPhase = RepPhase.DESCENDING;
        state.phaseStartTime = now;
        state.maxElbowAngle = 0;
      }
      break;
      
    case RepPhase.DESCENDING:
      // ä¸‹é™ä¸­
      if (elbowAngle >= 160 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // æœ€ä¸‹ç‚¹åˆ°é”ï¼ˆ1å›å®Œäº†ï¼‰
        state.currentPhase = RepPhase.BOTTOM;
        state.phaseStartTime = now;
        state.repCount++;
        
        // æ¬¡ã®repã®æº–å‚™
        setTimeout(() => {
          state.currentPhase = RepPhase.READY;
          state.phaseStartTime = Date.now();
        }, 100);
      }
      break;
  }
  
  return state;
}
```

### 6.6 éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹

```typescript
/**
 * ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«ã®éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹
 */
const DUMBBELL_CURL_VOICE_GUIDANCE = {
  // é–‹å§‹æ™‚
  start: 'ã‚¹ã‚¿ãƒ¼ãƒˆï¼',
  
  // ãƒ•ã‚©ãƒ¼ãƒ æ”¹å–„
  elbowNotFixed: 'è‚˜ã‚’ä½“ã®æ¨ªã«å›ºå®šã—ã¾ã—ã‚‡ã†',
  backNotStraight: 'èƒŒä¸­ã‚’ã¾ã£ã™ãã«ä¿ã¡ã¾ã—ã‚‡ã†',
  tooFast: 'ã‚‚ã†å°‘ã—ã‚†ã£ãã‚Šå‹•ã‹ã—ã¾ã—ã‚‡ã†',
  notFullRange: 'ã—ã£ã‹ã‚Šæ›²ã’ä¼¸ã°ã—ã—ã¾ã—ã‚‡ã†',
  
  // ã‚«ã‚¦ãƒ³ãƒˆ
  repCount: (count: number) => `${count}å›`,
  
  // ã‚»ãƒƒãƒˆå®Œäº†
  setComplete: 'ã‚»ãƒƒãƒˆå®Œäº†ï¼ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼',
  
  // ä¼‘æ†©
  restRemaining: (seconds: number) => `æ¬¡ã®ã‚»ãƒƒãƒˆã¾ã§ã‚ã¨${seconds}ç§’`,
};
```

### 6.7 ç·åˆå‚è€ƒã‚¹ã‚³ã‚¢ç®—å‡º

```typescript
/**
 * ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«ã®ç·åˆå‚è€ƒã‚¹ã‚³ã‚¢ã‚’ç®—å‡º
 */
function calculateDumbbellCurlOverallScore(
  landmarks: MediaPipeLandmark[],
  initialElbowPosition?: { x: number; y: number }
): {
  overallScore: number;
  checkpoints: Array<{
    name: string;
    score: number;
    message: string;
  }>;
} {
  // å·¦è…•ã®ãƒã‚§ãƒƒã‚¯ï¼ˆç‰‡è…•ãšã¤å®Ÿæ–½ã‚’æƒ³å®šï¼‰
  const elbowAngle = checkCurlElbowAngle(landmarks, 'left');
  const elbowPosition = checkElbowPosition(landmarks, 'left', initialElbowPosition);
  const backPosture = checkCurlBackPosture(landmarks);
  
  // ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆé…åˆ—
  const checkpoints = [
    {
      name: 'è‚˜ã®è§’åº¦',
      score: elbowAngle.score,
      message: elbowAngle.message,
    },
    {
      name: 'è‚˜ã®ä½ç½®',
      score: elbowPosition.score,
      message: elbowPosition.message,
    },
    {
      name: 'èƒŒä¸­ã®å§¿å‹¢',
      score: backPosture.score,
      message: backPosture.message,
    },
  ];
  
  // ç·åˆã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const overallScore = calculateOverallScore(
    checkpoints.map(cp => cp.score)
  );
  
  return {
    overallScore,
    checkpoints,
  };
}
```

---

## 7. ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹

### 7.1 ç¨®ç›®æ¦‚è¦

| é …ç›® | å†…å®¹ |
|-----|------|
| **ç¨®ç›®å** | ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹ï¼ˆShoulder Pressï¼‰ |
| **ã‚«ãƒ†ã‚´ãƒªãƒ¼** | ãƒ€ãƒ³ãƒ™ãƒ«ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° |
| **é›ãˆã‚‹éƒ¨ä½** | è‚©ï¼ˆä¸‰è§’ç­‹ï¼‰ã€è…•ï¼ˆä¸Šè…•ä¸‰é ­ç­‹ï¼‰ |
| **é›£æ˜“åº¦** | ä¸­ç´š |
| **æ¨å¥¨ã‚«ãƒ¡ãƒ©å‘ã** | æ­£é¢ |
| **ã‚«ã‚¦ãƒ³ãƒˆæ–¹å¼** | å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ |

### 7.2 ãƒ•ã‚©ãƒ¼ãƒ ã®åŸºæº–

#### 7.2.1 é–‹å§‹å§¿å‹¢ï¼ˆReady Positionï¼‰

| ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ | ç†æƒ³çš„ãªçŠ¶æ…‹ |
|---------------|------------|
| **è¶³å¹…** | è‚©å¹…ç¨‹åº¦ |
| **è‚˜ã®è§’åº¦** | 90åº¦ï¼ˆè‚©ã®é«˜ã•ï¼‰ |
| **æ‰‹é¦–ã®ä½ç½®** | è‚©ã‚ˆã‚Šå°‘ã—é«˜ã„ |
| **å§¿å‹¢** | èƒŒç­‹ã‚’ä¼¸ã°ã™ |
| **è¦–ç·š** | æ­£é¢ |

#### 7.2.2 ä¸Šæ˜‡æ™‚ï¼ˆConcentric Phaseï¼‰

| ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ | ç†æƒ³çš„ãªçŠ¶æ…‹ | è¨±å®¹ç¯„å›² |
|---------------|------------|---------|
| **è‚˜ã®è§’åº¦** | ã»ã¼ç›´ç«‹ï¼ˆ170-180åº¦ï¼‰ | 160-180åº¦ |
| **è‚˜ã®é–‹ã** | å‚ç›´æ–¹å‘ã«ä¸Šæ˜‡ | - |
| **è‚©ã®å®‰å®š** | å‹•ã‹ã•ãªã„ | - |
| **èƒŒä¸­** | ã¾ã£ã™ãã‚’ç¶­æŒ | - |

#### 7.2.3 ä¸‹é™æ™‚ï¼ˆEccentric Phaseï¼‰

| ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ | ç†æƒ³çš„ãªçŠ¶æ…‹ |
|---------------|------------|
| **è‚˜ã®è§’åº¦** | 90åº¦ã¾ã§ä¸‹ã‚ã™ |
| **è‚˜ã®é–‹ã** | å‚ç›´æ–¹å‘ã«ä¸‹é™ |
| **ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«** | ã‚†ã£ãã‚Šä¸‹ã‚ã™ |

### 7.3 MediaPipeä½¿ç”¨ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯

```typescript
/**
 * ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹ã§ä½¿ç”¨ã™ã‚‹ä¸»è¦ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
 */
const SHOULDER_PRESS_LANDMARKS = {
  // ä¸ŠåŠèº«
  leftShoulder: PoseLandmark.LEFT_SHOULDER,  // 11
  rightShoulder: PoseLandmark.RIGHT_SHOULDER, // 12
  leftElbow: PoseLandmark.LEFT_ELBOW,        // 13
  rightElbow: PoseLandmark.RIGHT_ELBOW,      // 14
  leftWrist: PoseLandmark.LEFT_WRIST,        // 15
  rightWrist: PoseLandmark.RIGHT_WRIST,      // 16
  
  // ä½“å¹¹ï¼ˆå§¿å‹¢ç¢ºèªç”¨ï¼‰
  leftHip: PoseLandmark.LEFT_HIP,            // 23
  rightHip: PoseLandmark.RIGHT_HIP,          // 24
  
  // é ­ï¼ˆæŠ¼ã—ä¸Šã’ã®é«˜ã•ç¢ºèªç”¨ï¼‰
  nose: PoseLandmark.NOSE,                   // 0
} as const;

/**
 * å¿…é ˆãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
 */
const SHOULDER_PRESS_REQUIRED_LANDMARKS = [
  SHOULDER_PRESS_LANDMARKS.leftShoulder,
  SHOULDER_PRESS_LANDMARKS.rightShoulder,
  SHOULDER_PRESS_LANDMARKS.leftElbow,
  SHOULDER_PRESS_LANDMARKS.rightElbow,
  SHOULDER_PRESS_LANDMARKS.leftWrist,
  SHOULDER_PRESS_LANDMARKS.rightWrist,
];
```

### 7.4 ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã¨å‚è€ƒã‚¹ã‚³ã‚¢ç®—å‡º

#### 7.4.1 è‚˜ã®è§’åº¦

```typescript
/**
 * è‚˜ã®è§’åº¦ã‚’ãƒã‚§ãƒƒã‚¯
 */
function checkShoulderPressElbowAngle(
  landmarks: MediaPipeLandmark[],
  side: 'left' | 'right'
): { score: number; angle: number; message: string } {
  const shoulder = side === 'left' ? 
    landmarks[SHOULDER_PRESS_LANDMARKS.leftShoulder] : 
    landmarks[SHOULDER_PRESS_LANDMARKS.rightShoulder];
  const elbow = side === 'left' ? 
    landmarks[SHOULDER_PRESS_LANDMARKS.leftElbow] : 
    landmarks[SHOULDER_PRESS_LANDMARKS.rightElbow];
  const wrist = side === 'left' ? 
    landmarks[SHOULDER_PRESS_LANDMARKS.leftWrist] : 
    landmarks[SHOULDER_PRESS_LANDMARKS.rightWrist];
  
  // è‚˜ã®è§’åº¦ã‚’è¨ˆç®—ï¼ˆè‚©-è‚˜-æ‰‹é¦–ï¼‰
  const angle = calculateAngle2D(shoulder, elbow, wrist);
  
  // ç†æƒ³çš„ãªè§’åº¦: 175åº¦ï¼ˆä¸Šæ˜‡æ™‚ã€ã»ã¼ç›´ç«‹ï¼‰
  const idealAngle = 175;
  const tolerance = 10; // Â±10åº¦ã®è¨±å®¹ç¯„å›²
  
  // å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const score = calculateReferenceScore(idealAngle, angle, tolerance);
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  let message = '';
  if (score >= 90) {
    message = 'å„ªè‰¯ã§ã™';
  } else if (angle < 165) {
    message = 'è‚˜ã‚’ã‚‚ã†å°‘ã—ä¼¸ã°ã—ã¾ã—ã‚‡ã†';
  } else {
    message = 'è‰¯å¥½ã§ã™';
  }
  
  return { score, angle, message };
}
```

#### 7.4.2 è‚˜ã®é–‹ãï¼ˆå·¦å³å¯¾ç§°æ€§ï¼‰ãƒã‚§ãƒƒã‚¯

```typescript
/**
 * å·¦å³ã®è‚˜ãŒå¯¾ç§°çš„ã«é–‹ã„ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
 */
function checkShoulderPressSymmetry(
  landmarks: MediaPipeLandmark[]
): { score: number; deviation: number; message: string } {
  const leftShoulder = landmarks[SHOULDER_PRESS_LANDMARKS.leftShoulder];
  const rightShoulder = landmarks[SHOULDER_PRESS_LANDMARKS.rightShoulder];
  const leftElbow = landmarks[SHOULDER_PRESS_LANDMARKS.leftElbow];
  const rightElbow = landmarks[SHOULDER_PRESS_LANDMARKS.rightElbow];
  
  // å·¦å³ã®è‚˜ã®é«˜ã•ï¼ˆYåº§æ¨™ï¼‰ã‚’æ¯”è¼ƒ
  const leftElbowHeight = leftElbow.y;
  const rightElbowHeight = rightElbow.y;
  const heightDiff = Math.abs(leftElbowHeight - rightElbowHeight);
  
  // ç†æƒ³çš„ãªå·®: 0ï¼ˆåŒã˜é«˜ã•ï¼‰
  const idealDiff = 0;
  const tolerance = 0.03; // æ­£è¦åŒ–åº§æ¨™ã§ã®è¨±å®¹ç¯„å›²
  
  // å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const score = calculateReferenceScore(idealDiff, heightDiff, tolerance);
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  let message = '';
  if (score >= 90) {
    message = 'å„ªè‰¯ã§ã™';
  } else if (heightDiff > tolerance) {
    message = 'å·¦å³ã®é«˜ã•ã‚’æƒãˆã¾ã—ã‚‡ã†';
  } else {
    message = 'è‰¯å¥½ã§ã™';
  }
  
  return { score, deviation: heightDiff, message };
}
```

#### 7.4.3 æŠ¼ã—ä¸Šã’ã®é«˜ã•ãƒã‚§ãƒƒã‚¯

```typescript
/**
 * æ‰‹é¦–ãŒé ­ã‚ˆã‚Šé«˜ãä¸ŠãŒã£ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
 */
function checkPressHeight(
  landmarks: MediaPipeLandmark[]
): { score: number; heightDiff: number; message: string } {
  const nose = landmarks[SHOULDER_PRESS_LANDMARKS.nose];
  const leftWrist = landmarks[SHOULDER_PRESS_LANDMARKS.leftWrist];
  const rightWrist = landmarks[SHOULDER_PRESS_LANDMARKS.rightWrist];
  
  // å·¦å³ã®æ‰‹é¦–ã®å¹³å‡é«˜ã•ã‚’è¨ˆç®—
  const avgWristHeight = (leftWrist.y + rightWrist.y) / 2;
  
  // é ­ï¼ˆé¼»ï¼‰ã¨ã®é«˜ã•ã®å·®ã‚’è¨ˆç®—
  // æ­£ã®å€¤: æ‰‹é¦–ãŒé ­ã‚ˆã‚Šä½ã„ã€è² ã®å€¤: æ‰‹é¦–ãŒé ­ã‚ˆã‚Šé«˜ã„
  const heightDiff = avgWristHeight - nose.y;
  
  // ç†æƒ³çš„ãªå·®: -0.1ï¼ˆé ­ã‚ˆã‚Š10%é«˜ã„ï¼‰
  const idealDiff = -0.1;
  const tolerance = 0.05;
  
  // å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const score = calculateReferenceScore(idealDiff, heightDiff, tolerance);
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  let message = '';
  if (score >= 90) {
    message = 'å„ªè‰¯ã§ã™';
  } else if (heightDiff > 0) {
    message = 'ã‚‚ã†å°‘ã—é«˜ãæŠ¼ã—ä¸Šã’ã¾ã—ã‚‡ã†';
  } else {
    message = 'è‰¯å¥½ã§ã™';
  }
  
  return { score, heightDiff, message };
}
```

### 7.5 å›æ•°ã‚«ã‚¦ãƒ³ãƒˆãƒ­ã‚¸ãƒƒã‚¯

```typescript
/**
 * ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹ã®å›æ•°ã‚«ã‚¦ãƒ³ãƒˆçŠ¶æ…‹
 */
interface ShoulderPressRepState extends RepCountState {
  minElbowAngle: number;
  maxElbowAngle: number;
}

/**
 * ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹ã®å›æ•°ã‚«ã‚¦ãƒ³ãƒˆåˆ¤å®š
 */
function countShoulderPressRep(
  landmarks: MediaPipeLandmark[],
  state: ShoulderPressRepState
): ShoulderPressRepState {
  // è‚˜ã®è§’åº¦ã‚’è¨ˆç®—ï¼ˆå·¦å³ã®å¹³å‡ï¼‰
  const leftElbowAngle = calculateAngle2D(
    landmarks[SHOULDER_PRESS_LANDMARKS.leftShoulder],
    landmarks[SHOULDER_PRESS_LANDMARKS.leftElbow],
    landmarks[SHOULDER_PRESS_LANDMARKS.leftWrist]
  );
  const rightElbowAngle = calculateAngle2D(
    landmarks[SHOULDER_PRESS_LANDMARKS.rightShoulder],
    landmarks[SHOULDER_PRESS_LANDMARKS.rightElbow],
    landmarks[SHOULDER_PRESS_LANDMARKS.rightWrist]
  );
  const avgElbowAngle = (leftElbowAngle + rightElbowAngle) / 2;
  
  // æœ€å°ãƒ»æœ€å¤§è§’åº¦ã‚’æ›´æ–°
  state.minElbowAngle = Math.min(state.minElbowAngle, avgElbowAngle);
  state.maxElbowAngle = Math.max(state.maxElbowAngle, avgElbowAngle);
  
  const now = Date.now();
  const timeSincePhaseStart = now - state.phaseStartTime;
  
  // çŠ¶æ…‹é·ç§»ã®åˆ¤å®š
  switch (state.currentPhase) {
    case RepPhase.READY:
      // é–‹å§‹ä½ç½®ï¼ˆè‚˜ãŒ90åº¦ï¼‰
      if (avgElbowAngle > 100 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // ä¸Šæ˜‡é–‹å§‹
        state.currentPhase = RepPhase.ASCENDING;
        state.phaseStartTime = now;
        state.maxElbowAngle = 0;
      }
      break;
      
    case RepPhase.ASCENDING:
      // ä¸Šæ˜‡ä¸­
      if (avgElbowAngle >= 165 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // æœ€ä¸Šç‚¹åˆ°é”
        state.currentPhase = RepPhase.TOP;
        state.phaseStartTime = now;
      }
      break;
      
    case RepPhase.TOP:
      // æœ€ä¸Šç‚¹
      if (avgElbowAngle < 165 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // ä¸‹é™é–‹å§‹
        state.currentPhase = RepPhase.DESCENDING;
        state.phaseStartTime = now;
        state.minElbowAngle = 180;
      }
      break;
      
    case RepPhase.DESCENDING:
      // ä¸‹é™ä¸­
      if (avgElbowAngle <= 100 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // æœ€ä¸‹ç‚¹åˆ°é”ï¼ˆ1å›å®Œäº†ï¼‰
        state.currentPhase = RepPhase.BOTTOM;
        state.phaseStartTime = now;
        state.repCount++;
        
        // æ¬¡ã®repã®æº–å‚™
        setTimeout(() => {
          state.currentPhase = RepPhase.READY;
          state.phaseStartTime = Date.now();
        }, 100);
      }
      break;
  }
  
  return state;
}
```

### 7.6 éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹

```typescript
/**
 * ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹ã®éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹
 */
const SHOULDER_PRESS_VOICE_GUIDANCE = {
  // é–‹å§‹æ™‚
  start: 'ã‚¹ã‚¿ãƒ¼ãƒˆï¼',
  
  // ãƒ•ã‚©ãƒ¼ãƒ æ”¹å–„
  notFullExtension: 'è‚˜ã‚’ã—ã£ã‹ã‚Šä¼¸ã°ã—ã¾ã—ã‚‡ã†',
  asymmetric: 'å·¦å³ã®é«˜ã•ã‚’æƒãˆã¾ã—ã‚‡ã†',
  notHighEnough: 'ã‚‚ã†å°‘ã—é«˜ãæŠ¼ã—ä¸Šã’ã¾ã—ã‚‡ã†',
  tooFast: 'ã‚‚ã†å°‘ã—ã‚†ã£ãã‚Šå‹•ã‹ã—ã¾ã—ã‚‡ã†',
  
  // ã‚«ã‚¦ãƒ³ãƒˆ
  repCount: (count: number) => `${count}å›`,
  
  // ã‚»ãƒƒãƒˆå®Œäº†
  setComplete: 'ã‚»ãƒƒãƒˆå®Œäº†ï¼ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼',
  
  // ä¼‘æ†©
  restRemaining: (seconds: number) => `æ¬¡ã®ã‚»ãƒƒãƒˆã¾ã§ã‚ã¨${seconds}ç§’`,
};
```

### 7.7 ç·åˆå‚è€ƒã‚¹ã‚³ã‚¢ç®—å‡º

```typescript
/**
 * ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹ã®ç·åˆå‚è€ƒã‚¹ã‚³ã‚¢ã‚’ç®—å‡º
 */
function calculateShoulderPressOverallScore(
  landmarks: MediaPipeLandmark[]
): {
  overallScore: number;
  checkpoints: Array<{
    name: string;
    score: number;
    message: string;
  }>;
} {
  // å„ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã®ã‚¹ã‚³ã‚¢ã‚’ç®—å‡º
  const elbowAngleLeft = checkShoulderPressElbowAngle(landmarks, 'left');
  const elbowAngleRight = checkShoulderPressElbowAngle(landmarks, 'right');
  const symmetry = checkShoulderPressSymmetry(landmarks);
  const pressHeight = checkPressHeight(landmarks);
  
  // å·¦å³ã®å¹³å‡ã‚’å–ã‚‹
  const avgElbowAngleScore = (elbowAngleLeft.score + elbowAngleRight.score) / 2;
  
  // ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆé…åˆ—
  const checkpoints = [
    {
      name: 'è‚˜ã®ä¼¸å±•',
      score: Math.round(avgElbowAngleScore),
      message: elbowAngleLeft.score < elbowAngleRight.score ? 
        elbowAngleLeft.message : elbowAngleRight.message,
    },
    {
      name: 'å·¦å³å¯¾ç§°æ€§',
      score: symmetry.score,
      message: symmetry.message,
    },
    {
      name: 'æŠ¼ã—ä¸Šã’ã®é«˜ã•',
      score: pressHeight.score,
      message: pressHeight.message,
    },
  ];
  
  // ç·åˆã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const overallScore = calculateOverallScore(
    checkpoints.map(cp => cp.score)
  );
  
  return {
    overallScore,
    checkpoints,
  };
}
```

---

## 8. ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ

### 8.1 ç¨®ç›®æ¦‚è¦

| é …ç›® | å†…å®¹ |
|-----|------|
| **ç¨®ç›®å** | ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆï¼ˆDeadliftï¼‰ |
| **ã‚«ãƒ†ã‚´ãƒªãƒ¼** | ãƒ€ãƒ³ãƒ™ãƒ«ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° |
| **é›ãˆã‚‹éƒ¨ä½** | èƒŒä¸­ï¼ˆåºƒèƒŒç­‹ã€è„ŠæŸ±èµ·ç«‹ç­‹ï¼‰ã€ä¸‹åŠèº«ï¼ˆå¤§è‡€ç­‹ã€ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°ã‚¹ï¼‰ |
| **é›£æ˜“åº¦** | ä¸­ç´š |
| **æ¨å¥¨ã‚«ãƒ¡ãƒ©å‘ã** | æ¨ªå‘ãï¼ˆå´é¢ã‹ã‚‰æ’®å½±ï¼‰ |
| **ã‚«ã‚¦ãƒ³ãƒˆæ–¹å¼** | å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ |

### 8.2 ãƒ•ã‚©ãƒ¼ãƒ ã®åŸºæº–

#### 8.2.1 é–‹å§‹å§¿å‹¢ï¼ˆReady Positionï¼‰

| ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ | ç†æƒ³çš„ãªçŠ¶æ…‹ |
|---------------|------------|
| **è¶³å¹…** | è…°å¹…ç¨‹åº¦ |
| **è†ã®è§’åº¦** | è»½ãæ›²ã’ã‚‹ï¼ˆ150-160åº¦ï¼‰ |
| **è…°ã®ä½ç½®** | é«˜ã„ä½ç½®ï¼ˆãŠå°»ã‚’çªãå‡ºã™ï¼‰ |
| **èƒŒä¸­** | ã¾ã£ã™ãï¼ˆã‚¢ãƒ¼ãƒã‚’ä¿ã¤ï¼‰ |
| **è¦–ç·š** | æ–œã‚å‰æ–¹ |

#### 8.2.2 ä¸Šæ˜‡æ™‚ï¼ˆConcentric Phaseï¼‰

| ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ | ç†æƒ³çš„ãªçŠ¶æ…‹ | è¨±å®¹ç¯„å›² |
|---------------|------------|---------|
| **è†ã®ä¼¸å±•** | ã»ã¼ç›´ç«‹ï¼ˆ170-180åº¦ï¼‰ | 160-180åº¦ |
| **è…°ã®ä¸Šæ˜‡** | èƒŒä¸­ã‚’ã¾ã£ã™ãä¿ã¡ãªãŒã‚‰ | - |
| **èƒŒä¸­** | ã‚¢ãƒ¼ãƒã‚’ç¶­æŒ | - |
| **è‚©ã®ä½ç½®** | ã‚„ã‚„å¾Œã‚ã«å¼•ã | - |

#### 8.2.3 ä¸‹é™æ™‚ï¼ˆEccentric Phaseï¼‰

| ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ | ç†æƒ³çš„ãªçŠ¶æ…‹ |
|---------------|------------|
| **è†ã®å±ˆæ›²** | è»½ãæ›²ã’ã‚‹ |
| **ãŠå°»ã®å‹•ã** | å¾Œã‚ã«çªãå‡ºã™ |
| **èƒŒä¸­** | ã‚¢ãƒ¼ãƒã‚’ç¶­æŒ |
| **ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«** | ã‚†ã£ãã‚Šä¸‹ã‚ã™ |

### 8.3 MediaPipeä½¿ç”¨ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯

```typescript
/**
 * ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆã§ä½¿ç”¨ã™ã‚‹ä¸»è¦ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
 */
const DEADLIFT_LANDMARKS = {
  // ä¸ŠåŠèº«
  leftShoulder: PoseLandmark.LEFT_SHOULDER,  // 11
  rightShoulder: PoseLandmark.RIGHT_SHOULDER, // 12
  leftElbow: PoseLandmark.LEFT_ELBOW,        // 13
  rightElbow: PoseLandmark.RIGHT_ELBOW,      // 14
  
  // ä½“å¹¹
  leftHip: PoseLandmark.LEFT_HIP,            // 23
  rightHip: PoseLandmark.RIGHT_HIP,          // 24
  
  // ä¸‹åŠèº«
  leftKnee: PoseLandmark.LEFT_KNEE,          // 25
  rightKnee: PoseLandmark.RIGHT_KNEE,        // 26
  leftAnkle: PoseLandmark.LEFT_ANKLE,        // 27
  rightAnkle: PoseLandmark.RIGHT_ANKLE,      // 28
} as const;

/**
 * å¿…é ˆãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
 */
const DEADLIFT_REQUIRED_LANDMARKS = [
  DEADLIFT_LANDMARKS.leftShoulder,
  DEADLIFT_LANDMARKS.rightShoulder,
  DEADLIFT_LANDMARKS.leftHip,
  DEADLIFT_LANDMARKS.rightHip,
  DEADLIFT_LANDMARKS.leftKnee,
  DEADLIFT_LANDMARKS.rightKnee,
  DEADLIFT_LANDMARKS.leftAnkle,
  DEADLIFT_LANDMARKS.rightAnkle,
];
```

### 8.4 ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã¨å‚è€ƒã‚¹ã‚³ã‚¢ç®—å‡º

#### 8.4.1 èƒŒä¸­ã®å§¿å‹¢ãƒã‚§ãƒƒã‚¯ï¼ˆæœ€é‡è¦ï¼‰

```typescript
/**
 * èƒŒä¸­ã®å§¿å‹¢ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆä¸¸ã¾ã£ã¦ã„ãªã„ã‹ï¼‰
 */
function checkDeadliftBackPosture(
  landmarks: MediaPipeLandmark[]
): { score: number; angle: number; message: string } {
  const shoulder = landmarks[DEADLIFT_LANDMARKS.leftShoulder];
  const hip = landmarks[DEADLIFT_LANDMARKS.leftHip];
  const knee = landmarks[DEADLIFT_LANDMARKS.leftKnee];
  
  // èƒŒä¸­ã®è§’åº¦ã‚’è¨ˆç®—ï¼ˆè‚©-è…°-è†ï¼‰
  const angle = calculateAngle2D(shoulder, hip, knee);
  
  // ç†æƒ³çš„ãªè§’åº¦: 150åº¦ï¼ˆã‚„ã‚„å‰å‚¾ã€ã‚¢ãƒ¼ãƒã‚’ä¿ã¤ï¼‰
  const idealAngle = 150;
  const tolerance = 15; // Â±15åº¦ã®è¨±å®¹ç¯„å›²
  
  // å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const score = calculateReferenceScore(idealAngle, angle, tolerance);
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆï¼ˆå®‰å…¨æ€§ã«é–¢ã‚ã‚‹ãŸã‚å„ªå…ˆåº¦é«˜ï¼‰
  let message = '';
  if (score >= 90) {
    message = 'å„ªè‰¯ã§ã™';
  } else if (angle < 135) {
    message = 'âš ï¸ èƒŒä¸­ãŒä¸¸ã¾ã£ã¦ã„ã¾ã™ã€‚ã¾ã£ã™ãã«ä¿ã¡ã¾ã—ã‚‡ã†';
  } else if (angle > 165) {
    message = 'ã‚‚ã†å°‘ã—å‰å‚¾ã—ã¾ã—ã‚‡ã†';
  } else {
    message = 'è‰¯å¥½ã§ã™';
  }
  
  return { score, angle, message };
}
```

#### 8.4.2 è†ã®è§’åº¦ãƒã‚§ãƒƒã‚¯

```typescript
/**
 * è†ã®è§’åº¦ã‚’ãƒã‚§ãƒƒã‚¯
 */
function checkDeadliftKneeAngle(
  landmarks: MediaPipeLandmark[],
  side: 'left' | 'right'
): { score: number; angle: number; message: string } {
  const hip = side === 'left' ? 
    landmarks[DEADLIFT_LANDMARKS.leftHip] : 
    landmarks[DEADLIFT_LANDMARKS.rightHip];
  const knee = side === 'left' ? 
    landmarks[DEADLIFT_LANDMARKS.leftKnee] : 
    landmarks[DEADLIFT_LANDMARKS.rightKnee];
  const ankle = side === 'left' ? 
    landmarks[DEADLIFT_LANDMARKS.leftAnkle] : 
    landmarks[DEADLIFT_LANDMARKS.rightAnkle];
  
  // è†ã®è§’åº¦ã‚’è¨ˆç®—ï¼ˆè…°-è†-è¶³é¦–ï¼‰
  const angle = calculateAngle2D(hip, knee, ankle);
  
  // ç†æƒ³çš„ãªè§’åº¦: 155åº¦ï¼ˆè»½ãæ›²ã’ãŸçŠ¶æ…‹ï¼‰
  const idealAngle = 155;
  const tolerance = 10; // Â±10åº¦ã®è¨±å®¹ç¯„å›²
  
  // å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const score = calculateReferenceScore(idealAngle, angle, tolerance);
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  let message = '';
  if (score >= 90) {
    message = 'å„ªè‰¯ã§ã™';
  } else if (angle < 145) {
    message = 'è†ã‚’å°‘ã—ä¼¸ã°ã—ã¾ã—ã‚‡ã†';
  } else if (angle > 165) {
    message = 'è†ã‚’è»½ãæ›²ã’ã¾ã—ã‚‡ã†';
  } else {
    message = 'è‰¯å¥½ã§ã™';
  }
  
  return { score, angle, message };
}
```

#### 8.4.3 è…°ã®é«˜ã•ãƒã‚§ãƒƒã‚¯

```typescript
/**
 * è…°ã®é«˜ã•ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆãŠå°»ã‚’çªãå‡ºã—ã¦ã„ã‚‹ã‹ï¼‰
 */
function checkDeadliftHipPosition(
  landmarks: MediaPipeLandmark[]
): { score: number; height: number; message: string } {
  const hip = landmarks[DEADLIFT_LANDMARKS.leftHip];
  const knee = landmarks[DEADLIFT_LANDMARKS.leftKnee];
  
  // è…°ã¨è†ã®Yåº§æ¨™ã®å·®ã‚’è¨ˆç®—
  // æ­£ã®å€¤: è…°ãŒé«˜ã„ï¼ˆè‰¯ã„ï¼‰ã€è² ã®å€¤: è…°ãŒä½ã„
  const heightDiff = hip.y - knee.y;
  
  // ç†æƒ³çš„ãªé«˜ã•: è†ã‚ˆã‚Šé«˜ã„ä½ç½®
  // ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆã§ã¯è…°ã‚’é«˜ãä¿ã¤ã“ã¨ãŒé‡è¦
  const idealDiff = -0.1; // è…°ãŒè†ã‚ˆã‚Š10%é«˜ã„
  const tolerance = 0.05;
  
  // å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
  const score = calculateReferenceScore(idealDiff, heightDiff, tolerance);
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  let message = '';
  if (score >= 90) {
    message = 'å„ªè‰¯ã§ã™';
  } else if (heightDiff > 0) {
    message = 'ãŠå°»ã‚’å¾Œã‚ã«çªãå‡ºã—ã¾ã—ã‚‡ã†';
  } else {
    message = 'è‰¯å¥½ã§ã™';
  }
  
  return { score, height: heightDiff, message };
}
```

### 8.5 å›æ•°ã‚«ã‚¦ãƒ³ãƒˆãƒ­ã‚¸ãƒƒã‚¯

```typescript
/**
 * ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆã®å›æ•°ã‚«ã‚¦ãƒ³ãƒˆçŠ¶æ…‹
 */
interface DeadliftRepState extends RepCountState {
  minKneeAngle: number;
  maxKneeAngle: number;
}

/**
 * ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆã®å›æ•°ã‚«ã‚¦ãƒ³ãƒˆåˆ¤å®š
 */
function countDeadliftRep(
  landmarks: MediaPipeLandmark[],
  state: DeadliftRepState
): DeadliftRepState {
  // è†ã®è§’åº¦ã‚’è¨ˆç®—ï¼ˆå·¦å³ã®å¹³å‡ï¼‰
  const leftKneeAngle = calculateAngle2D(
    landmarks[DEADLIFT_LANDMARKS.leftHip],
    landmarks[DEADLIFT_LANDMARKS.leftKnee],
    landmarks[DEADLIFT_LANDMARKS.leftAnkle]
  );
  const rightKneeAngle = calculateAngle2D(
    landmarks[DEADLIFT_LANDMARKS.rightHip],
    landmarks[DEADLIFT_LANDMARKS.rightKnee],
    landmarks[DEADLIFT_LANDMARKS.rightAnkle]
  );
  const avgKneeAngle = (leftKneeAngle + rightKneeAngle) / 2;
  
  // æœ€å°ãƒ»æœ€å¤§è§’åº¦ã‚’æ›´æ–°
  state.minKneeAngle = Math.min(state.minKneeAngle, avgKneeAngle);
  state.maxKneeAngle = Math.max(state.maxKneeAngle, avgKneeAngle);
  
  const now = Date.now();
  const timeSincePhaseStart = now - state.phaseStartTime;
  
  // çŠ¶æ…‹é·ç§»ã®åˆ¤å®š
  switch (state.currentPhase) {
    case RepPhase.READY:
      // é–‹å§‹ä½ç½®ï¼ˆå‰å‚¾å§¿å‹¢ï¼‰
      if (avgKneeAngle > 160 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // ä¸Šæ˜‡é–‹å§‹
        state.currentPhase = RepPhase.ASCENDING;
        state.phaseStartTime = now;
        state.maxKneeAngle = 0;
      }
      break;
      
    case RepPhase.ASCENDING:
      // ä¸Šæ˜‡ä¸­
      if (avgKneeAngle >= 170 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // æœ€ä¸Šç‚¹åˆ°é”
        state.currentPhase = RepPhase.TOP;
        state.phaseStartTime = now;
      }
      break;
      
    case RepPhase.TOP:
      // æœ€ä¸Šç‚¹
      if (avgKneeAngle < 170 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // ä¸‹é™é–‹å§‹
        state.currentPhase = RepPhase.DESCENDING;
        state.phaseStartTime = now;
        state.minKneeAngle = 180;
      }
      break;
      
    case RepPhase.DESCENDING:
      // ä¸‹é™ä¸­
      if (avgKneeAngle <= 160 && timeSincePhaseStart >= MIN_PHASE_DURATION) {
        // æœ€ä¸‹ç‚¹åˆ°é”ï¼ˆ1å›å®Œäº†ï¼‰
        state.currentPhase = RepPhase.BOTTOM;
        state.phaseStartTime = now;
        state.repCount++;
        
        // æ¬¡ã®repã®æº–å‚™
        setTimeout(() => {
          state.currentPhase = RepPhase.READY;
          state.phaseStartTime = Date.now();
        }, 100);
      }
      break;
  }
  
  return state;
}
```

### 8.6 éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹

```typescript
/**
 * ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆã®éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹
 */
const DEADLIFT_VOICE_GUIDANCE = {
  // é–‹å§‹æ™‚
  start: 'ã‚¹ã‚¿ãƒ¼ãƒˆï¼',
  
  // ãƒ•ã‚©ãƒ¼ãƒ æ”¹å–„ï¼ˆå®‰å…¨æ€§é‡è¦–ï¼‰
  backRounded: 'âš ï¸ èƒŒä¸­ãŒä¸¸ã¾ã£ã¦ã„ã¾ã™ã€‚ã¾ã£ã™ãã«ä¿ã¡ã¾ã—ã‚‡ã†',
  backTooStraight: 'ã‚‚ã†å°‘ã—å‰å‚¾ã—ã¾ã—ã‚‡ã†',
  kneeTooStraight: 'è†ã‚’è»½ãæ›²ã’ã¾ã—ã‚‡ã†',
  kneeTooFlexed: 'è†ã‚’å°‘ã—ä¼¸ã°ã—ã¾ã—ã‚‡ã†',
  hipTooLow: 'ãŠå°»ã‚’å¾Œã‚ã«çªãå‡ºã—ã¾ã—ã‚‡ã†',
  
  // ã‚«ã‚¦ãƒ³ãƒˆ
  repCount: (count: number) => `${count}å›`,
  
  // ã‚»ãƒƒãƒˆå®Œäº†
  setComplete: 'ã‚»ãƒƒãƒˆå®Œäº†ï¼ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼',
  
  // ä¼‘æ†©
  restRemaining: (seconds: number) => `æ¬¡ã®ã‚»ãƒƒãƒˆã¾ã§ã‚ã¨${seconds}ç§’`,
};
```

### 8.7 ç·åˆå‚è€ƒã‚¹ã‚³ã‚¢ç®—å‡º

```typescript
/**
 * ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆã®ç·åˆå‚è€ƒã‚¹ã‚³ã‚¢ã‚’ç®—å‡º
 */
function calculateDeadliftOverallScore(
  landmarks: MediaPipeLandmark[]
): {
  overallScore: number;
  checkpoints: Array<{
    name: string;
    score: number;
    message: string;
  }>;
} {
  // å„ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã®ã‚¹ã‚³ã‚¢ã‚’ç®—å‡º
  const backPosture = checkDeadliftBackPosture(landmarks);
  const kneeAngleLeft = checkDeadliftKneeAngle(landmarks, 'left');
  const kneeAngleRight = checkDeadliftKneeAngle(landmarks, 'right');
  const hipPosition = checkDeadliftHipPosition(landmarks);
  
  // å·¦å³ã®å¹³å‡ã‚’å–ã‚‹
  const avgKneeAngleScore = (kneeAngleLeft.score + kneeAngleRight.score) / 2;
  
  // ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆé…åˆ—
  // ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆã§ã¯èƒŒä¸­ã®å§¿å‹¢ãŒæœ€ã‚‚é‡è¦ãªã®ã§ã€ã‚¦ã‚§ã‚¤ãƒˆã‚’å¤§ããã™ã‚‹
  const checkpoints = [
    {
      name: 'èƒŒä¸­ã®å§¿å‹¢',
      score: backPosture.score,
      message: backPosture.message,
      weight: 2.0, // 2å€ã®é‡ã¿
    },
    {
      name: 'è†ã®è§’åº¦',
      score: Math.round(avgKneeAngleScore),
      message: kneeAngleLeft.score < kneeAngleRight.score ? 
        kneeAngleLeft.message : kneeAngleRight.message,
      weight: 1.0,
    },
    {
      name: 'è…°ã®ä½ç½®',
      score: hipPosition.score,
      message: hipPosition.message,
      weight: 1.0,
    },
  ];
  
  // ç·åˆã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—ï¼ˆåŠ é‡å¹³å‡ï¼‰
  const totalWeight = checkpoints.reduce((sum, cp) => sum + cp.weight, 0);
  const weightedSum = checkpoints.reduce((sum, cp) => sum + cp.score * cp.weight, 0);
  const overallScore = Math.round(weightedSum / totalWeight);
  
  return {
    overallScore,
    checkpoints: checkpoints.map(({ weight, ...cp }) => cp),
  };
}
```

---

## 9. å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### 9.1 ã‚³ãƒ¼ãƒ‰æ§‹æˆ

æ¨å¥¨ã•ã‚Œã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ :

```
src/
â”œâ”€â”€ features/
â”‚   â””â”€â”€ training/
â”‚       â”œâ”€â”€ hooks/
â”‚       â”‚   â”œâ”€â”€ usePoseDetection.ts       # MediaPipe Poseæ¤œå‡º
â”‚       â”‚   â”œâ”€â”€ useRepCounter.ts          # å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ
â”‚       â”‚   â”œâ”€â”€ useFormChecker.ts         # ãƒ•ã‚©ãƒ¼ãƒ ç¢ºèª
â”‚       â”‚   â””â”€â”€ useVoiceGuidance.ts       # éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹
â”‚       â”œâ”€â”€ utils/
â”‚       â”‚   â”œâ”€â”€ angleCalculator.ts        # è§’åº¦è¨ˆç®—
â”‚       â”‚   â”œâ”€â”€ distanceCalculator.ts     # è·é›¢è¨ˆç®—
â”‚       â”‚   â”œâ”€â”€ scoreCalculator.ts        # å‚è€ƒã‚¹ã‚³ã‚¢è¨ˆç®—
â”‚       â”‚   â””â”€â”€ landmarkValidator.ts      # ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯æ¤œè¨¼
â”‚       â”œâ”€â”€ types/
â”‚       â”‚   â”œâ”€â”€ exercise.types.ts         # ç¨®ç›®ã®å‹å®šç¾©
â”‚       â”‚   â”œâ”€â”€ pose.types.ts            # Poseã®å‹å®šç¾©
â”‚       â”‚   â””â”€â”€ score.types.ts           # ã‚¹ã‚³ã‚¢ã®å‹å®šç¾©
â”‚       â””â”€â”€ exercises/
â”‚           â”œâ”€â”€ squat/
â”‚           â”‚   â”œâ”€â”€ SquatFormChecker.ts
â”‚           â”‚   â””â”€â”€ SquatRepCounter.ts
â”‚           â”œâ”€â”€ pushup/
â”‚           â”‚   â”œâ”€â”€ PushupFormChecker.ts
â”‚           â”‚   â””â”€â”€ PushupRepCounter.ts
â”‚           â”œâ”€â”€ dumbbellCurl/
â”‚           â”‚   â”œâ”€â”€ DumbbellCurlFormChecker.ts
â”‚           â”‚   â””â”€â”€ DumbbellCurlRepCounter.ts
â”‚           â”œâ”€â”€ shoulderPress/
â”‚           â”‚   â”œâ”€â”€ ShoulderPressFormChecker.ts
â”‚           â”‚   â””â”€â”€ ShoulderPressRepCounter.ts
â”‚           â””â”€â”€ deadlift/
â”‚               â”œâ”€â”€ DeadliftFormChecker.ts
â”‚               â””â”€â”€ DeadliftRepCounter.ts
```

### 9.2 å…±é€šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

ã™ã¹ã¦ã®ç¨®ç›®ã§å…±é€šã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½¿ç”¨:

```typescript
/**
 * ãƒ•ã‚©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚«ãƒ¼ã®å…±é€šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
 */
interface IFormChecker {
  /**
   * ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦å‚è€ƒã‚¹ã‚³ã‚¢ã‚’è¿”ã™
   */
  checkForm(landmarks: MediaPipeLandmark[]): FormCheckResult;
  
  /**
   * å¿…é ˆãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ãŒæ¤œå‡ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   */
  validateLandmarks(landmarks: MediaPipeLandmark[]): boolean;
  
  /**
   * éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ãŒå¿…è¦ã‹åˆ¤å®š
   */
  needsVoiceGuidance(result: FormCheckResult): VoiceGuidance | null;
}

/**
 * å›æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®å…±é€šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
 */
interface IRepCounter {
  /**
   * å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
   */
  countRep(landmarks: MediaPipeLandmark[]): RepCountResult;
  
  /**
   * ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
   */
  reset(): void;
  
  /**
   * ç¾åœ¨ã®ã‚«ã‚¦ãƒ³ãƒˆæ•°ã‚’å–å¾—
   */
  getCurrentCount(): number;
}

/**
 * ãƒ•ã‚©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯çµæœ
 */
interface FormCheckResult {
  overallScore: number;
  checkpoints: Array<{
    name: string;
    score: number;
    message: string;
  }>;
  timestamp: number;
}

/**
 * å›æ•°ã‚«ã‚¦ãƒ³ãƒˆçµæœ
 */
interface RepCountResult {
  currentPhase: RepPhase;
  repCount: number;
  isRepCompleted: boolean;
  timestamp: number;
}

/**
 * éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹
 */
interface VoiceGuidance {
  content: string;
  priority: VoiceGuidancePriority;
}
```

### 9.3 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

#### 9.3.1 ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆã®æœ€é©åŒ–

```typescript
/**
 * MediaPipe Poseã®å‡¦ç†é »åº¦ã‚’åˆ¶å¾¡
 * 30fpsã®ã‚«ãƒ¡ãƒ©ã§15fpså‡¦ç†ï¼ˆ1ãƒ•ãƒ¬ãƒ¼ãƒ é£›ã°ã—ï¼‰
 */
const PROCESS_EVERY_N_FRAMES = 2;

let frameCount = 0;

function shouldProcessFrame(): boolean {
  frameCount++;
  return frameCount % PROCESS_EVERY_N_FRAMES === 0;
}
```

#### 9.3.2 è¨ˆç®—çµæœã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥

```typescript
/**
 * è§’åº¦è¨ˆç®—çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
 * åŒã˜ãƒ•ãƒ¬ãƒ¼ãƒ å†…ã§è¤‡æ•°å›è¨ˆç®—ã—ãªã„ã‚ˆã†ã«ã™ã‚‹
 */
interface AngleCache {
  [key: string]: number;
}

function getCachedAngle(
  key: string,
  landmarks: MediaPipeLandmark[],
  pointA: number,
  pointB: number,
  pointC: number,
  cache: AngleCache
): number {
  if (cache[key] !== undefined) {
    return cache[key];
  }
  
  const angle = calculateAngle2D(
    landmarks[pointA],
    landmarks[pointB],
    landmarks[pointC]
  );
  
  cache[key] = angle;
  return angle;
}
```

### 9.4 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
/**
 * å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
 * ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚å‡¦ç†ã‚’ç¶™ç¶š
 */
function safeCheckForm(
  formChecker: IFormChecker,
  landmarks: MediaPipeLandmark[]
): FormCheckResult | null {
  try {
    // ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯æ¤œè¨¼
    if (!formChecker.validateLandmarks(landmarks)) {
      console.warn('Required landmarks not detected');
      return null;
    }
    
    // ãƒ•ã‚©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
    return formChecker.checkForm(landmarks);
  } catch (error) {
    console.error('Error in form checking:', error);
    return null;
  }
}
```

---

## 10. ãƒ†ã‚¹ãƒˆä»•æ§˜

### 10.1 ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

#### 10.1.1 è§’åº¦è¨ˆç®—ã®ãƒ†ã‚¹ãƒˆ

```typescript
describe('calculateAngle2D', () => {
  it('should calculate 90 degree angle correctly', () => {
    const pointA = { x: 0, y: 0 };
    const pointB = { x: 0, y: 1 };
    const pointC = { x: 1, y: 1 };
    
    const angle = calculateAngle2D(pointA, pointB, pointC);
    
    expect(angle).toBeCloseTo(90, 1);
  });
  
  it('should calculate 180 degree angle correctly', () => {
    const pointA = { x: 0, y: 0 };
    const pointB = { x: 1, y: 0 };
    const pointC = { x: 2, y: 0 };
    
    const angle = calculateAngle2D(pointA, pointB, pointC);
    
    expect(angle).toBeCloseTo(180, 1);
  });
});
```

#### 10.1.2 å‚è€ƒã‚¹ã‚³ã‚¢è¨ˆç®—ã®ãƒ†ã‚¹ãƒˆ

```typescript
describe('calculateReferenceScore', () => {
  it('should return 100 for ideal value', () => {
    const score = calculateReferenceScore(90, 90, 10);
    expect(score).toBe(100);
  });
  
  it('should return 100 for value within tolerance', () => {
    const score = calculateReferenceScore(90, 95, 10);
    expect(score).toBe(100);
  });
  
  it('should decrease score for value outside tolerance', () => {
    const score = calculateReferenceScore(90, 110, 10);
    expect(score).toBeLessThan(100);
    expect(score).toBeGreaterThan(0);
  });
});
```

### 10.2 çµ±åˆãƒ†ã‚¹ãƒˆ

#### 10.2.1 ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆã®ãƒ•ã‚©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯

```typescript
describe('SquatFormChecker', () => {
  let formChecker: SquatFormChecker;
  let mockLandmarks: MediaPipeLandmark[];
  
  beforeEach(() => {
    formChecker = new SquatFormChecker();
    mockLandmarks = createMockLandmarks(); // ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
  });
  
  it('should detect perfect squat form', () => {
    // å®Œç’§ãªã‚¹ã‚¯ãƒ¯ãƒƒãƒˆã®ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã‚’è¨­å®š
    const perfectSquatLandmarks = createPerfectSquatLandmarks();
    
    const result = formChecker.checkForm(perfectSquatLandmarks);
    
    expect(result.overallScore).toBeGreaterThan(90);
  });
  
  it('should detect knee over toes issue', () => {
    // è†ãŒã¤ã¾å…ˆã‚ˆã‚Šå‰ã«å‡ºã¦ã„ã‚‹ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã‚’è¨­å®š
    const badKneeLandmarks = createKneeOverToesLandmarks();
    
    const result = formChecker.checkForm(badKneeLandmarks);
    
    const kneeCheckpoint = result.checkpoints.find(cp => cp.name === 'è†ã®ä½ç½®');
    expect(kneeCheckpoint.score).toBeLessThan(90);
  });
});
```

### 10.3 E2Eãƒ†ã‚¹ãƒˆ

#### 10.3.1 ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚»ãƒƒã‚·ãƒ§ãƒ³å…¨ä½“ã®ãƒ†ã‚¹ãƒˆ

```typescript
describe('Training Session E2E', () => {
  it('should complete a full squat set', async () => {
    // ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•
    await startCamera();
    
    // ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆã‚’é¸æŠ
    await selectExercise('squat');
    
    // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é–‹å§‹
    await startTraining();
    
    // 10å›ã®ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
    for (let i = 0; i < 10; i++) {
      await performSquatRep();
    }
    
    // ã‚»ãƒƒãƒˆå®Œäº†ã‚’ç¢ºèª
    const result = await getSessionResult();
    expect(result.repCount).toBe(10);
    expect(result.overallScore).toBeGreaterThan(0);
  });
});
```

---

## 11. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶

### 11.1 å‡¦ç†é€Ÿåº¦

| é …ç›® | è¦ä»¶ | å‚™è€ƒ |
|-----|------|------|
| **MediaPipe Poseæ¤œå‡º** | 15fpsä»¥ä¸Š | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ç¢ºä¿ |
| **ãƒ•ã‚©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯** | 10msä»¥å†… | æ¤œå‡ºå¾Œã®å‡¦ç† |
| **å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ** | 5msä»¥å†… | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ç¢ºä¿ |
| **éŸ³å£°ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹** | å³åº§ã«å†ç”Ÿ | é…å»¶ãªã— |

### 11.2 ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡

| é …ç›® | è¦ä»¶ | å‚™è€ƒ |
|-----|------|------|
| **ã‚¢ãƒ—ãƒªå…¨ä½“** | 200MBä»¥ä¸‹ | ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å«ã‚€ |
| **MediaPipe Pose** | 50MBä»¥ä¸‹ | ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿æ™‚ |
| **ã‚«ãƒ¡ãƒ©ãƒãƒƒãƒ•ã‚¡** | 30MBä»¥ä¸‹ | ãƒ•ãƒ¬ãƒ¼ãƒ ãƒãƒƒãƒ•ã‚¡ |

### 11.3 ãƒãƒƒãƒ†ãƒªãƒ¼æ¶ˆè²»

| é …ç›® | è¦ä»¶ | å‚™è€ƒ |
|-----|------|------|
| **30åˆ†ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°** | 15%ä»¥ä¸‹ | æ¨™æº–çš„ãªä½¿ç”¨ |
| **1æ™‚é–“ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°** | 25%ä»¥ä¸‹ | é•·æ™‚é–“ä½¿ç”¨ |

---

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆçµ‚äº†**

ä»¥ä¸Šã§ã€5ç¨®ç›®ã®ãƒ•ã‚©ãƒ¼ãƒ ç¢ºèªãƒ­ã‚¸ãƒƒã‚¯è©³ç´° v3.1ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚
