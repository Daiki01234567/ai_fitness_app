# 仕様書 統合分析レポート v1.0

**作成日**: 2025年12月9日
**作成者**: ビジネスアナリスト
**目的**: Expo版とFlutter版の仕様書を比較分析し、矛盾点を特定、統合計画を策定する

---

## 1. 矛盾点リスト

### 1.1 重要な矛盾点（要確認）

| No | 項目 | Expo版 | Flutter版 | 矛盾の内容 | 推奨 | 影響度 |
|----|------|--------|-----------|-----------|------|--------|
| 1 | **5種目の定義** | スクワット、プッシュアップ、**アームカール**、**サイドレイズ**、ショルダープレス | スクワット、プッシュアップ、**プランク**、**ランジ**、**バーピー**（要件定義書）/ **デッドリフト**（利用規約・画面遷移図） | 3種目が異なる。Flutter版内でも利用規約と要件定義書で不一致あり | **Expo版を採用**（ダンベル種目含む差別化戦略に合致） | 高 |
| 2 | **Phase構成** | Phase 1-5（Phase 3で課金、Phase 4で管理機能、Phase 5でML） | Phase 1-4（Phase 2で課金、Phase 3で拡張） | Phase番号と内容が異なる | **Expo版を採用**（課金をPhase 3に移動しMVP期間を無料で運用） | 高 |
| 3 | **課金仕様** | **Stripe（メイン）**、RevenueCat（代替）、**Phase 3で実装** | **RevenueCat（メイン）**、**Phase 2で実装** | 課金サービスと実装タイミングが異なる | **Expo版を採用**（Stripeの柔軟性、Web版との統一） | 高 |
| 4 | **Apple認証** | **Phase 3**で課金と同時実装 | **Phase 1**で実装 | 実装タイミングが異なる | **Expo版を採用**（App Store審査要件に沿って課金と同時実装） | 中 |
| 5 | **技術スタック** | Expo (React Native)、Zustand、Expo Router、React Native Paper | Flutter (Dart)、Riverpod、GoRouter、Flutter Widgets | フレームワーク全体が異なる | プラットフォームごとに分離管理 | 情報 |
| 6 | **プロジェクト期間** | Phase 1-3で8ヶ月+ | Phase 1-2で7ヶ月 | MVPまでの期間が異なる | **Expo版を採用**（課金機能追加で期間延長） | 中 |

### 1.2 Flutter版内部の矛盾（修正が必要）

| No | ファイル1 | ファイル2 | 矛盾の内容 | 推奨対応 |
|----|----------|----------|-----------|---------|
| 1 | `00_要件定義書_v3_3.md` (5種目: スクワット、プッシュアップ、プランク、ランジ、バーピー) | `利用規約_v3_2.md` (5種目: スクワット、プッシュアップ、プランク、ランジ、デッドリフト) | バーピー vs デッドリフト | **Expo版の定義に統一**（アームカール、サイドレイズ、ショルダープレスを採用） |
| 2 | `00_要件定義書_v3_3.md` | `05_画面遷移図_ワイヤーフレーム_v3_3.md` | 画面遷移図内の履歴画面でアームカールが表示されているが、要件定義では定義されていない | Expo版の5種目に統一 |
| 3 | `08_README_form_validation_logic_v3_3.md` | `00_要件定義書_v3_3.md` | フォーム評価ロジックはスクワット、アームカール、サイドレイズ、ショルダープレス、プッシュアップの5種目（Expo版と一致） | フォーム評価ロジックの定義を正とする |

### 1.3 整合している項目

| 項目 | Expo版 | Flutter版 | 状況 |
|------|--------|-----------|------|
| 画面数 | 15画面 | 15画面 | 一致 |
| 月額料金 | 500円 | 500円 | 一致 |
| 無料トライアル | 1週間 | 1週間 | 一致 |
| GDPR準拠 | 対応 | 対応 | 一致 |
| 薬機法対応 | 医療機器ではない旨を明記 | 医療機器ではない旨を明記 | 一致 |
| MediaPipe | オンデバイス処理 | オンデバイス処理 | 一致 |
| Firebase | Firestore + Cloud Functions + Auth | Firestore + Cloud Functions + Auth | 一致 |
| BigQuery | 分析用データウェアハウス | 分析用データウェアハウス | 一致 |
| 目標FPS | 30fps | 30fps | 一致 |
| データ保存期間 | 2年 | 2年 | 一致 |

---

## 2. 5種目の定義（最終確定版）

### 推奨：Expo版の定義を採用

| No | 種目名（日本語） | 種目名（英語） | ダンベル | 難易度 | 主に鍛える部位 | 推奨カメラ向き |
|----|------------------|----------------|----------|--------|----------------|----------------|
| 1 | スクワット | squat | なし | 初級 | 太もも、お尻 | 横向き |
| 2 | プッシュアップ | pushup | なし | 中級 | 胸、腕 | 横向き |
| 3 | アームカール | armcurl | あり | 初級 | 腕（上腕二頭筋） | 正面 |
| 4 | サイドレイズ | sideraise | あり | 初級 | 肩 | 正面 |
| 5 | ショルダープレス | shoulderpress | あり | 中級 | 肩、腕 | 正面 |

### 採用理由

1. **差別化戦略**: ダンベル種目を含むことで、他のフィットネスアプリとの差別化が可能
2. **MediaPipe適合性**: フォーム評価ロジック（`08_README_form_validation_logic_v3_3.md`）で詳細な評価基準が定義済み
3. **ユーザーニーズ**: 自重+ダンベルの組み合わせで幅広いニーズに対応
4. **競合との差別化**: Expo版の競合分析で明示されている通り、「5種目特化で高精度」がセールスポイント

### Flutter版からの変更点

| 変更前（Flutter版要件定義書） | 変更後（Expo版） |
|------------------------------|------------------|
| プランク | アームカール |
| ランジ | サイドレイズ |
| バーピー | ショルダープレス |

---

## 3. Phase構成（最終確定版）

### 推奨：Expo版のPhase構成を採用

| Phase | 期間 | 内容 | 主な機能 |
|-------|------|------|----------|
| **Phase 1** | 0-2ヶ月 | 基盤構築 | Firebase認証（メール、Google）、プロフィール、ホーム画面、Firestoreセキュリティルール、GDPR基盤 |
| **Phase 2** | 2-7ヶ月 | コア機能 | MediaPipe統合、5種目のフォーム確認補助、トレーニング記録、履歴・カレンダー・グラフ、BigQueryパイプライン |
| **Phase 3** | 8ヶ月目以降 | Apple認証・課金機能 | Apple認証、Stripe課金（RevenueCat代替）、サブスクリプション管理 |
| **Phase 4** | 将来 | 管理・運用・多言語 | 管理者ダッシュボード、運用監視、多言語対応（英語） |
| **Phase 5** | 将来 | 高度な機能 | カスタムMLモデル、AIコーチング、ソーシャル機能 |

### 採用理由

1. **MVPの早期リリース**: Phase 2までを無料で提供し、ユーザー獲得を優先
2. **App Store審査対応**: Apple認証と課金を同時実装することで、審査要件を効率的に満たす
3. **リスク分散**: 課金機能を後回しにすることで、技術的リスクを分散
4. **収益化の準備期間**: ユーザーベースを構築してから課金機能を導入

### Flutter版からの変更点

| 項目 | Flutter版 | Expo版（採用） |
|------|-----------|---------------|
| 課金実装 | Phase 2 | Phase 3 |
| Apple認証 | Phase 1 | Phase 3 |
| 管理機能 | Phase 3 | Phase 4 |
| ML移行 | Phase 4 | Phase 5 |

---

## 4. 課金仕様（最終確定版）

### 推奨：Expo版の仕様を採用

| 項目 | 仕様 |
|------|------|
| **メイン決済** | Stripe |
| **代替決済** | RevenueCat（Stripe導入に問題が生じた場合のバックアップ） |
| **実装Phase** | Phase 3（8ヶ月目以降） |
| **月額料金** | 500円（税込） |
| **無料トライアル** | 1週間 |
| **無料プラン制限** | 1日3回まで（Phase 2では無制限） |

### 採用理由

1. **Web版との統一**: 将来的なWeb版展開時にStripeなら統一した決済基盤が使える
2. **柔軟な価格設定**: Stripeは複雑な価格モデルにも対応可能
3. **日本での実績**: Stripeは日本市場での実績が豊富
4. **RevenueCat併用**: App Store/Google Play連携が必要な場合の保険として活用

---

## 5. 統合ファイル構成案

### 5.1 推奨ディレクトリ構造

```
docs/
├── common/                          # 共通ドキュメント（バックエンド・法務）
│   ├── specs/
│   │   ├── 02_Firestoreデータベース設計書_v3_3.md
│   │   ├── 03_API設計書_Firebase_Functions_v3_3.md
│   │   ├── 04_BigQuery設計書_v3_3.md
│   │   ├── 06_データ処理記録_ROPA_v1_0.md
│   │   ├── 07_セキュリティポリシー_v1_0.md
│   │   ├── 08_フォーム評価ロジック_v1_0.md  ← 5種目共通
│   │   ├── 利用規約_v3_3.md                  ← 5種目定義を更新
│   │   └── プライバシーポリシー_v3_2.md      ← 必要に応じて更新
│   └── README.md
│
├── expo/                            # Expo版固有ドキュメント
│   ├── specs/
│   │   ├── 01_要件定義書_Expo版_v1_Part1.md
│   │   ├── 02_要件定義書_Expo版_v1_Part2.md
│   │   ├── 03_要件定義書_Expo版_v1_Part3.md
│   │   ├── 04_要件定義書_Expo版_v1_Part4.md
│   │   ├── 05_要件定義書_Expo版_v1_Part5.md
│   │   ├── 06_要件定義書_Expo版_v1_Part6.md
│   │   └── 07_画面遷移図_ワイヤーフレーム_v1_0.md
│   ├── tickets/                     # Expo版開発チケット
│   └── README.md
│
└── flutter/                         # Flutter版固有ドキュメント（アーカイブ）
    ├── specs/
    │   ├── 00_要件定義書_v3_3.md            ← アーカイブ
    │   ├── 01_システムアーキテクチャ設計書_v3_2.md
    │   ├── 05_画面遷移図_ワイヤーフレーム_v3_3.md
    │   └── 09_開発タスク詳細_スケジュール_v3_3.md
    └── README.md                    # 「Expo版が最新」と明記
```

### 5.2 ファイル移動・統合計画

| 移動元 | 移動先 | 理由 |
|--------|--------|------|
| `flutter/specs/02_Firestoreデータベース設計書_v3_3.md` | `common/specs/02_Firestoreデータベース設計書_v3_3.md` | バックエンド共通 |
| `flutter/specs/03_API設計書_Firebase_Functions_v3_3.md` | `common/specs/03_API設計書_Firebase_Functions_v3_3.md` | バックエンド共通 |
| `flutter/specs/04_BigQuery設計書_v3_3.md` | `common/specs/04_BigQuery設計書_v3_3.md` | バックエンド共通 |
| `flutter/specs/06_データ処理記録_ROPA_v1_0.md` | `common/specs/06_データ処理記録_ROPA_v1_0.md` | 法務共通 |
| `flutter/specs/07_セキュリティポリシー_v1_0.md` | `common/specs/07_セキュリティポリシー_v1_0.md` | 法務共通 |
| `flutter/specs/08_README_form_validation_logic_v3_3.md` + 関連Part | `common/specs/08_フォーム評価ロジック_v1_0.md` | 5種目共通ロジック |
| `flutter/specs/利用規約_v3_2.md` | `common/specs/利用規約_v3_3.md` | **5種目定義を更新して移動** |
| `flutter/specs/プライバシーポリシー_v3.1.md` | `common/specs/プライバシーポリシー_v3_2.md` | 法務共通 |

### 5.3 更新が必要なファイル

| ファイル | 更新内容 | 優先度 |
|----------|----------|--------|
| `利用規約_v3_2.md` | 5種目の定義を「スクワット、プッシュアップ、アームカール、サイドレイズ、ショルダープレス」に変更 | 高 |
| `02_Firestoreデータベース設計書_v3_3.md` | exerciseTypeのenum値を更新 | 高 |
| `03_API設計書_Firebase_Functions_v3_3.md` | 種目関連APIのパラメータを更新 | 中 |

---

## 6. 確認が必要な質問

### 6.1 ビジネス判断が必要な項目

1. **5種目の最終確定**
   Expo版の定義（スクワット、プッシュアップ、アームカール、サイドレイズ、ショルダープレス）を正式に採用してよいですか？
   - Flutter版の要件定義書（プランク、ランジ、バーピー）
   - Flutter版の利用規約（プランク、ランジ、デッドリフト）
   - Expo版・フォーム評価ロジック（アームカール、サイドレイズ、ショルダープレス）

   **推奨**: Expo版を採用（ダンベル種目で差別化）

2. **課金タイミングの確定**
   課金機能をPhase 3（8ヶ月目以降）に延期してよいですか？
   - Flutter版: Phase 2で実装
   - Expo版: Phase 3で実装

   **推奨**: Expo版を採用（MVPを無料で早期リリース）

3. **決済サービスの確定**
   Stripeをメインにしてよいですか？
   - Flutter版: RevenueCatをメイン
   - Expo版: Stripeをメイン（RevenueCatは代替）

   **推奨**: Expo版を採用（Web版との統一性）

### 6.2 技術的確認が必要な項目

4. **Flutter版の位置づけ**
   Flutter版はアーカイブとして保持しますか？それとも完全に削除しますか？
   - 現在: 両方のコードベースが存在
   - Expo版が正式版として進行中

   **推奨**: アーカイブとして保持（万が一の代替案として）

5. **共通ドキュメントの管理**
   バックエンド設計書（Firestore、API、BigQuery）をExpo版とFlutter版で共通化してよいですか？

   **推奨**: 共通化する（バックエンドはフロントエンドに依存しない）

6. **利用規約・プライバシーポリシーのバージョンアップ**
   5種目の変更に伴い、利用規約をv3.3に更新してよいですか？

   **推奨**: 更新する（法的文書の正確性を担保）

---

## 7. 推奨アクションプラン

### 7.1 即時対応（今週中）

| No | アクション | 担当 | 優先度 |
|----|----------|------|--------|
| 1 | 5種目定義の最終承認を取得 | PM/ステークホルダー | 高 |
| 2 | Phase構成の最終承認を取得 | PM/ステークホルダー | 高 |
| 3 | 課金サービス（Stripe）の最終承認を取得 | PM/ステークホルダー | 高 |

### 7.2 短期対応（2週間以内）

| No | アクション | 担当 | 優先度 |
|----|----------|------|--------|
| 4 | 利用規約v3.3への更新（5種目定義変更） | 法務/PM | 高 |
| 5 | common/ディレクトリ作成とファイル移動 | 開発チーム | 中 |
| 6 | CLAUDE.mdの更新（ディレクトリ構造変更） | 開発チーム | 中 |

### 7.3 中期対応（1ヶ月以内）

| No | アクション | 担当 | 優先度 |
|----|----------|------|--------|
| 7 | Flutter版ドキュメントのアーカイブ化 | 開発チーム | 低 |
| 8 | 統合後の整合性レビュー | QA | 中 |
| 9 | チケットの更新（Phase構成変更反映） | PM | 中 |

---

## 8. まとめ

### 8.1 主要な決定事項（推奨）

| 項目 | 決定内容 |
|------|----------|
| **正式版** | Expo版 |
| **5種目** | スクワット、プッシュアップ、アームカール、サイドレイズ、ショルダープレス |
| **課金Phase** | Phase 3（8ヶ月目以降） |
| **決済サービス** | Stripe（メイン）、RevenueCat（代替） |
| **Apple認証** | Phase 3で課金と同時実装 |

### 8.2 整合性の評価

| カテゴリ | 整合性 | コメント |
|----------|--------|----------|
| バックエンド設計 | 高 | Firestore、API、BigQueryは共通利用可能 |
| 法務文書 | 中 | 5種目定義の更新が必要 |
| 画面設計 | 高 | 15画面構成は両版で一致 |
| Phase構成 | 低 | Expo版への統一が必要 |
| 5種目定義 | 低 | Expo版への統一が必要 |

### 8.3 リスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| 5種目変更に伴う利用規約の法的リスク | 中 | 法務レビューを実施 |
| 課金延期による収益化遅延 | 中 | ユーザー獲得優先の戦略として許容 |
| Flutter版コードの保守コスト | 低 | アーカイブ化で最小限に |

---

## 変更履歴

| バージョン | 日付 | 変更内容 | 担当者 |
|-----------|------|---------|--------|
| v1.0 | 2025-12-09 | 初版作成 | ビジネスアナリスト |

---

**以上**
