# Firebase セットアップガイド・統合版

**プロジェクト名**: AIフィットネスアプリ
**対象Firebase プロジェクト**: `tokyo-list-478804-e5`
**作成日**: 2025年11月29日
**ステータス**: ドキュメント統合完了

---

## ドキュメント構成図

本プロジェクトの Firebase セットアップに関する 3 つのドキュメントの構成と関連性を図解します。

```
┌─────────────────────────────────────────────────────────────────┐
│ Firebase セットアップガイド・統合版 (このドキュメント)         │
│ - 全体構成の把握                                                 │
│ - ドキュメント選択ガイド                                         │
│ - アーキテクチャ概要                                             │
└─────────────────────────────────────────────────────────────────┘
         │
         ├─────────────────────┬──────────────────────┬─────────────────────┐
         │                     │                      │                     │
         ▼                     ▼                      ▼                     ▼
┌──────────────────────┐  ┌────────────────────┐ ┌──────────────────────┐
│ セットアップ手順書   │  │ トラブルシューティング │ クイックリファレンス   │
│ (初回セットアップ)   │  │ 詳細版                │ (日々の開発)          │
│                      │  │ (問題発生時)          │                      │
│ 13の段階的な手順     │  │                      │ よく使用するコマンド   │
│ - Firebase Core 有効化 │  │ 10章のトラブル事例  │ - Firebase CLI        │
│ - Firestore 作成    │  │ - 症状・原因・対処法 │ - Flutter/Dart CLI   │
│ - Authentication有効化 │  │ - コード例付き       │ - テンプレート        │
│ - アプリ登録        │  │ - ネットワーク問題  │ - npm スクリプト      │
│ - Flutter 設定再生成  │  │ - 本番環境対応      │ - ポート一覧          │
│ - Functions 設定    │  │ - チェックリスト    │ - よくある作業フロー   │
│ - Emulator セットアップ │ │                      │                      │
│ - セキュリティルール  │  │ 対象: DevOps,        │ 対象: 全開発チーム    │
│ - 本番環境設定      │  │     開発者           │                      │
│ - CI/CD パイプライン  │  │                      │ 予想使用頻度: 毎日   │
│ - チェックリスト    │  │ 予想使用頻度: 月1-2回 │                      │
│                      │  │                      │                      │
│ 対象: 初回セットアップ │ │                      │                      │
│ 予想時間: 4-6時間   │  │                      │                      │
└──────────────────────┘  └────────────────────┘ └──────────────────────┘
```

---

## ドキュメント選択ガイド

### どのドキュメントを参照するべきか

#### 1. 初めて Firebase をセットアップする場合

**「Firebase セットアップ手順書」を最初に読んでください。**

手順通りに実行することで：
- Firebase プロジェクト `tokyo-list-478804-e5` が完全に設定される
- Flutter アプリが正しいプロジェクトを参照するようになる
- ローカル開発環境（エミュレータ）が完全に動作する

**所要時間**: 4-6 時間（初回）

---

#### 2. エラーや問題が発生した場合

**「Firebase トラブルシューティング詳細版」を参照してください。**

以下の手順で問題を解決できます：

1. **症状から該当セクションを探す**
   - 例: "firebase_options.dart が古いプロジェクトを参照している" → セクション 3.1
   - 例: "エミュレータのポートが既に使用されている" → セクション 4.1

2. **原因を理解する**
   - なぜその問題が発生しているのか

3. **対処法を実行する**
   - ステップバイステップで問題を解決

4. **コード例を参考にする**
   - 実装が必要な場合は、提供されているコード例を使用

**所要時間**: 30 分～2 時間（問題による）

---

#### 3. よく使用するコマンドを素早く確認したい場合

**「Firebase クイックリファレンス」を参照してください。**

以下の情報を素早く参照できます：

- Firebase CLI コマンド（デプロイ、ログ、エミュレータ）
- Flutter/Dart コマンド（テスト、実行、ビルド）
- テンプレート（セキュリティルール、Cloud Functions）
- ポート一覧（エミュレータ）
- よくある作業フロー

**所要時間**: 1-5 分（各確認）

---

## セットアップフロー図

```
開発を開始した時点の状況
│
├─ [ ] Firebase プロジェクトが設定されていない？
│        → 「Firebase セットアップ手順書」 (手順1-13)
│        → 所要時間: 4-6 時間
│
├─ [ ] エラーが発生した？
│        → 問題の症状を確認
│        → 「Firebase トラブルシューティング詳細版」で解決
│        → 所要時間: 30 分～2 時間
│
└─ [ ] 開発中に Firebase CLI コマンドを忘れた？
         → 「Firebase クイックリファレンス」で確認
         → 所要時間: 1-5 分
```

---

## 各ドキュメントの詳細

### 1. Firebase セットアップ手順書

**対象ユーザー**: 開発チーム、初期セットアップ担当者

**主な内容**:

| セクション | 内容 | 時間 |
|-----------|------|------|
| 手順1-2 | Firebase コンソール へのアクセス・Core 有効化 | 15 分 |
| 手順3 | Firestore データベースの作成 | 10 分 |
| 手順4 | Firebase Authentication の有効化 | 10 分 |
| 手順5 | Firebase アプリの登録（iOS/Android/Web） | 30 分 |
| 手順6 | Flutter アプリの Firebase 設定を再生成 | 20 分 |
| 手順7 | Cloud Functions の設定 | 15 分 |
| 手順8 | Firebase Emulator Suite のセットアップ | 20 分 |
| 手順9 | Flutter アプリの起動テスト | 30 分 |
| 手順10 | CI/CD パイプラインの更新 | 20 分 |
| 手順11 | セキュリティルールのデプロイ | 15 分 |
| 手順12 | BigQuery 初期セットアップ（オプション） | 15 分 |
| 手順13 | Cloud Logging・Monitoring セットアップ | 10 分 |

**チェックリスト付き**: セットアップ完了時に確認すべき項目（全 20 項目）

**トラブルシューティング**: 各手順で起こりやすい問題とその対処法

---

### 2. Firebase トラブルシューティング詳細版

**対象ユーザー**: 開発チーム、DevOps エンジニア

**10 章構成**:

| 章 | タイトル | 項目数 | 対象の問題 |
|----|---------|--------|----------|
| 1 | 環境セットアップの問題 | 3 | Firebase CLI、FlutterFire CLI、Java のインストール失敗 |
| 2 | Firebase プロジェクト関連の問題 | 3 | プロジェクト初期化、Firestore モード、課金 |
| 3 | Flutter Firebase 統合の問題 | 4 | firebase_options.dart、plist、json ファイル |
| 4 | Firebase Emulator の問題 | 3 | ポート競合、接続失敗、UI アクセス不可 |
| 5 | Firestore セキュリティルール関連の問題 | 3 | 構文エラー、権限拒否、認証状態 |
| 6 | Cloud Functions のデプロイ問題 | 3 | デプロイ失敗、メモリ不足、ログ未出力 |
| 7 | 認証・セキュリティ関連の問題 | 2 | Google Sign-In、カスタムクレーム |
| 8 | ネットワーク・ファイアウォール関連の問題 | 2 | オンプレミス環境、Docker 環境 |
| 9 | 本番環境固有の問題 | 2 | セキュリティエラー、BigQuery 同期失敗 |
| 10 | パフォーマンス・リソース関連の問題 | 2 | 読み取り費用、コールドスタート |

各問題には以下の構成：
- **症状**: エラーメッセージ / 実際の現象
- **原因**: なぜその問題が発生するのか
- **対処法**: ステップバイステップの解決手順
- **コード例**: 必要に応じてコード修正例を記載

**チェックリスト付き**: 問題診断の流れ（5 段階）

---

### 3. Firebase クイックリファレンス

**対象ユーザー**: 全開発チーム（日々の開発時）

**参照内容**:

| セクション | 項目数 | 内容 |
|-----------|--------|------|
| Firebase CLI コマンド | 25+ | デプロイ、ログ、エミュレータ、バックアップ |
| Flutter/Dart コマンド | 30+ | テスト、実行、コード生成、分析 |
| FlutterFire CLI | 8+ | Firebase 設定の再生成 |
| Firestore ルール テンプレート | 3 | 基本、ヘルパー関数、フィールド制御 |
| Cloud Functions テンプレート | 3 | Callable、Firestore トリガー、Auth トリガー |
| npm スクリプト | 11 | Functions 開発用スクリプト |
| 確認ポイント | 2 | firebase_options.dart、ポート一覧 |
| よくある作業フロー | 4 | ローカル開発、Functions開発、ルール更新、テスト |

**コピー&ペースト可能**: すべてのコマンドとテンプレートはそのまま実行できるように設計

---

## アーキテクチャ概要

Firebase セットアップ後のプロジェクト構成：

```
┌──────────────────────────────────────────────────────────┐
│ Firebase Project: tokyo-list-478804-e5                   │
├──────────────────────────────────────────────────────────┤
│                                                            │
│  ┌─────────────────┐        ┌──────────────────────┐    │
│  │ Firebase Auth   │        │ Cloud Firestore      │    │
│  │ - Email/Password│        │ - Users collection   │    │
│  │ - Google Sign-In│        │ - Sessions collection│    │
│  │ - Custom Claims │        │ - asia-northeast1    │    │
│  └─────────────────┘        └──────────────────────┘    │
│           │                           │                   │
│           └─────────────┬─────────────┘                   │
│                         │                                  │
│                    ┌────▼─────┐                            │
│                    │ Cloud    │                            │
│                    │ Functions│                            │
│                    │ (Node 20)│                            │
│                    └────┬─────┘                            │
│                         │                                  │
│           ┌─────────────┼──────────────┐                  │
│           │             │              │                  │
│      ┌────▼────┐   ┌────▼────┐   ┌───▼──────┐           │
│      │ BigQuery│   │ Cloud   │   │Firebase  │           │
│      │(asia-ne)│   │ Logging │   │ Storage  │           │
│      └─────────┘   └─────────┘   └──────────┘           │
│                                                            │
└──────────────────────────────────────────────────────────┘
         │                          │
         │ ストリーミング INSERT      │ Storage API
         │                          │
┌────────▼──────────────────────────▼────────┐
│ クライアント (Flutter アプリ)              │
│ - Firebase SDK                              │
│ - Emulator との接続設定                     │
│ - セキュリティルール に準拠                 │
└─────────────────────────────────────────────┘
```

---

## セットアップ状態の確認

### 初期状態（セットアップ前）

```
✗ Firebase Core - 未有効
✗ Firestore - 未作成
✗ Authentication - 未有効
✗ Firebase アプリ登録 - 未完了
✗ Flutter firebase_options.dart - 異なるプロジェクト参照中（ai-fitness-c38f0）
✗ Cloud Functions - 未初期化
✗ Firebase Emulator - 未セットアップ
✗ セキュリティルール - 本番モードに設定されていない
✗ CI/CD パイプライン - 古いプロジェクト参照
```

### 完了状態（セットアップ後）

```
✓ Firebase Core - 有効化済み
✓ Firestore - 本番モード（asia-northeast1）で実行中
✓ Authentication - 有効化済み（メール/パスワード、Google Sign-In）
✓ Firebase アプリ登録 - iOS/Android/Web 登録済み
✓ Flutter firebase_options.dart - tokyo-list-478804-e5 を参照
✓ Cloud Functions - グローバル設定完了
✓ Firebase Emulator - 全サービス（Auth, Firestore, Functions, Storage）起動可能
✓ セキュリティルール - 本番モード・詳細ルール設定済み
✓ CI/CD パイプライン - tokyo-list-478804-e5 にデプロイ設定済み
```

---

## 仕様書との関連付け

本ドキュメント群は、以下の仕様書に基づいており、実装の詳細を記述しています：

| 仕様書 | セクション | Firebase ドキュメント |
|-------|-----------|---------------------|
| システムアーキテクチャ設計書 v3.2 | 4.2 Firebase/GCP | セットアップ手順書 全体 |
| システムアーキテクチャ設計書 v3.2 | 4.1.3 Firebase連携 | セットアップ手順書 手順6 |
| Firestore設計書 v3.3 | 1-2 概要 | セットアップ手順書 手順3-11 |
| Firestore設計書 v3.3 | 12 セキュリティルール | トラブルシューティング 章5、クイックリファレンス |
| API設計書 v3.3 | 4 Functions実装 | トラブルシューティング 章6、クイックリファレンス |
| 要件定義書 v3.3 | 4 非機能要件 | トラブルシューティング 各章 |

---

## よくある質問（FAQ）

### Q1. どのドキュメントから始めるべき？

**A.** 初めてセットアップする場合は、「Firebase セットアップ手順書」を上から順に実行してください。

問題が発生した場合は、その都度「Firebase トラブルシューティング詳細版」を参照してください。

---

### Q2. セットアップ後、毎日参照するドキュメントは？

**A.** 「Firebase クイックリファレンス」を参照することが多いです。

Firebase CLI、Flutter コマンド、テンプレートなど、日々の開発で頻繁に使用する情報がまとめられています。

---

### Q3. 本番環境へのデプロイ手順は？

**A.** 「Firebase セットアップ手順書」の手順10-11 を参照してください。

CI/CD パイプライン（GitHub Actions）の設定とセキュリティルールのデプロイ方法を説明しています。

---

### Q4. エミュレータで開発中、本番環境と接続してしまった。どうする？

**A.** 「Firebase トラブルシューティング詳細版」の章4 を参照してください。

エミュレータへの接続設定を確認し、firebase_options.dart で接続先を分離する方法を説明しています。

---

### Q5. Firestore セキュリティルールの仕様を確認したい。

**A.** 「Firestore データベース設計書 v3.3」 の章12 を参照してください。

本ドキュメント群は実装・セットアップ向けです。仕様の詳細は設計書を参照してください。

---

## ドキュメント保守方針

### 更新対象

以下の場合、ドキュメントを更新します：

1. Firebase SDK メジャーバージョン更新時
2. Flutter 大型バージョン更新時（3.X → 4.X など）
3. GCP/Firebase サービス仕様変更時
4. 新しい問題パターン発見時

### 更新手順

1. 該当ドキュメントの「最終更新日」を更新
2. 「更新履歴」セクションに変更内容を記載
3. Git コミット（コミットメッセージに仕様書・ドキュメント参照）

---

## 次のステップ

セットアップが完了した後：

### Phase 1（0-2 ヶ月）

- 「Firebase セットアップ手順書」に従ってセットアップ完了
- 「Firebase クイックリファレンス」で日々の開発効率を上げる
- 問題発生時は「トラブルシューティング詳細版」で対処

### Phase 2（2-7 ヶ月）

- Cloud Functions で API エンドポイント実装
- BigQuery で分析機能実装
- Firestore セキュリティルールの詳細化
- 本番環境への段階的なデプロイ

### Phase 3+（将来）

- 多言語対応
- ソーシャル機能
- カスタムML モデル統合

---

## ドキュメント一覧

本プロジェクトの Firebase セットアップに関するドキュメント：

| ドキュメント | ファイル | 対象ユーザー | 用途 | 作成日 |
|-------------|---------|-----------|------|-------|
| Firebase セットアップ手順書 | Firebase_セットアップ手順書.md | 初期セットアップ担当者 | 初回セットアップ | 2025-11-29 |
| Firebase トラブルシューティング詳細版 | Firebase_トラブルシューティング_詳細版.md | DevOps、開発者 | 問題解決 | 2025-11-29 |
| Firebase クイックリファレンス | Firebase_クイックリファレンス.md | 全開発チーム | 日々の参照 | 2025-11-29 |
| Firebase セットアップガイド・統合版 | Firebase_セットアップガイド_統合版.md | 全開発チーム | ドキュメント整理 | 2025-11-29 |

---

## 関連仕様書

| 仕様書 | バージョン | 主な参照セクション |
|--------|-----------|-----------------|
| システムアーキテクチャ設計書 | v3.2 | 4.2 Firebase/GCP、4.1.3 Firebase連携 |
| Firestoreデータベース設計書 | v3.3 | 全章（データ構造・ルール・バックアップ） |
| API設計書 Firebase Functions | v3.3 | 4 Functions実装、5 エラーハンドリング |
| 要件定義書 | v3.3 | 4 非機能要件（NFR-001～037） |
| セキュリティポリシー | v1.0 | 全章（セキュリティ要件） |

---

## ドキュメント管理

| 項目 | 値 |
|------|-----|
| **作成者** | Cloud Architect |
| **作成日** | 2025年11月29日 |
| **最終更新日** | 2025年11月29日 |
| **ステータス** | 統合版完了 |
| **対象バージョン** | Firebase SDK 最新版、Flutter 3.10+、Firebase CLI 13.0+ |

**更新履歴**:
- 2025年11月29日: 統合版作成、3つのドキュメント関連性整理

---

## 参考資料

### 公式ドキュメント
- Firebase Console: https://console.firebase.google.com
- Firebase Documentation: https://firebase.google.com/docs
- FlutterFire Documentation: https://firebase.flutter.dev
- GCP Console: https://console.cloud.google.com

### コミュニティ資料
- Firebase GitHub: https://github.com/firebase
- Flutter GitHub: https://github.com/flutter/flutter
- Firebase Community Slack

### 本プロジェクトの仕様書
- `docs/specs/00_要件定義書_v3_3.md`
- `docs/specs/01_システムアーキテクチャ設計書_v3_2.md`
- `docs/specs/02_Firestoreデータベース設計書_v3_3.md`
- `docs/specs/03_API設計書_Firebase_Functions_v3_3.md`

---

## サポート・問い合わせ

セットアップやトラブルシューティングに関して質問がある場合：

1. **「Firebase トラブルシューティング詳細版」で同様の問題がないか確認**
2. **「Firebase クイックリファレンス」でコマンド構文を確認**
3. **公式ドキュメント（リンク参照）で最新情報を確認**
4. **プロジェクトチームに相談**（必要に応じて）

---

