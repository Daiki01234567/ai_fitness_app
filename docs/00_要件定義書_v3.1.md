# 要件定義書 v3.1 (Part 1/2)

**プロジェクト名**: AIフィットネスアプリ(仮称)
**バージョン**: 3.1 (MVP)
**作成日**: 2025年11月
**最終更新日**: 2025年11月21日
**対象期間**: Phase 1-2 (0-4ヶ月)

---

## 📝 v3.1での主な変更点

### 利用規約・プライバシーポリシーとの整合性確保

✅ **表現の統一**:
- 利用規約v3.1、プライバシーポリシーv3.1で使用される表現に完全準拠
- 「フォーム確認補助機能」「参考情報」「参考スコア」等の用語を統一
- 医療機器でない旨の記載を強化

✅ **法的根拠の明確化**:
- GDPR第6条各項の具体的な適用根拠を明示
- 「正当な利益」の詳細な説明追加
- 利益衡量テスト(Balancing Test)の結果を明記

✅ **技術的保護措置の詳細化**:
- Firebase Security Rulesの具体的な実装内容
- Cloud IAMによるアクセス制御の詳細
- 暗号化方式の明示(TLS 1.3、AES-256)

✅ **データフローの透明性向上**:
- データフロー図の追加
- 処理の各段階での保護措置を明示
- 仮名化(pseudonymization)の具体的手法

✅ **ユーザー権利行使方法の詳細化**:
- 各権利の行使手順を具体的に記載
- 対応期限の明示(GDPR準拠)
- 技術的実装方法の説明

---

## 目次

### Part 1: プロジェクト概要〜機能要件
1. [プロジェクト概要](#1-プロジェクト概要)
2. [プロジェクト体制](#2-プロジェクト体制)
3. [機能要件](#3-機能要件)

### Part 2: 非機能要件〜成果物
4. [非機能要件](#4-非機能要件)
5. [制約条件](#5-制約条件)
6. [前提条件](#6-前提条件)
7. [リスク管理](#7-リスク管理)
8. [成果物](#8-成果物)
9. [Firebase + GCP ハイブリッド構成](#9-firebase--gcp-ハイブリッド構成)
10. [まとめ](#10-まとめ)

---

## 1. プロジェクト概要

### 1.1 プロジェクト背景

近年、自宅でのトレーニング需要が増加している一方で、正しいフォームでトレーニングを行えず、怪我をしたり効果が得られなかったりするユーザーが多い。専用のトレーニングデバイスやパーソナルトレーナーは高額であり、誰もが気軽に利用できるものではない。

本プロジェクトは、スマートフォンのカメラとAI技術を活用し、低コストでリアルタイムにフォーム確認を補助できるフィットネスアプリを開発することで、この課題を解決する。

### 1.2 プロジェクト目的と位置づけ

#### 1.2.1 本サービスの目的

1. **誰でも使える**: 専用デバイス不要、スマートフォンのみで利用可能
2. **リアルタイム参考情報**: AIによる即座のフォーム確認補助と音声による参考情報提供
3. **低価格**: 月額500円で利用可能(1週間無料トライアル付き)
4. **成長の可視化**: トレーニング履歴をグラフで表示し、モチベーション維持
5. **プライバシー保護**: GDPR/EDPB Guidelines完全準拠、カメラ映像は端末上でのみ処理

#### 1.2.2 重要な制限事項 ⚠️

本サービスは以下のものではありません:

| 本サービスではないもの | 理由 |
|---------------------|------|
| ❌ 医療機器 | 薬機法上の医療機器の承認を受けていません |
| ❌ 診断・治療・予防を目的とするもの | 医学的な判断は提供しません |
| ❌ 怪我の防止を保証するもの | あくまで参考情報です |
| ❌ 健康効果を保証するもの | 効果・効能は保証しません |
| ❌ 医療専門家による診断や指導の代替 | 専門家への相談を推奨します |
| ❌ リハビリテーション支援 | 医療行為は行いません |

**重要**: この制限事項は、利用規約v3.1第3.3条およびプライバシーポリシーv3.1第2.3条と完全に一致しています。

#### 1.2.3 本サービスの位置づけ

- ✅ **トレーニングフォームの確認を補助する参考情報提供ツール**
- ✅ **参考情報として利用者に情報を表示するサービス**
- ✅ **最終的な判断は利用者自身の責任において行うもの**

この位置づけは、利用規約v3.1第3.4条と完全に一致しています。

#### 1.2.4 年齢制限

| 地域 | 年齢制限 | 備考 | 法的根拠 |
|-----|---------|------|---------|
| **日本** | 13歳以上 | 個人情報保護法対応 | 利用規約v3.1第4.1条 |
| **EEA** | 16歳以上 | GDPR第8条準拠 | プライバシーポリシーv3.1第11.1条 |
| **全地域** | 未成年者は親権者の同意が必要 | 利用規約で明記 | 利用規約v3.1第4.2条 |

### 1.3 主要な価値提案

#### 提供する機能

- ✅ リアルタイムフォーム確認補助(MediaPipe Pose → 将来ML化)
- ✅ 音声による参考情報の提供(ハンズフリー)
- ✅ トレーニング記録の管理
- ✅ 進捗の可視化
- ✅ プライバシー保護(GDPR/EDPB Guidelines完全準拠)

#### 提供しないもの

- ❌ 医学的アドバイス・診断
- ❌ パーソナルトレーニング指導
- ❌ 健康診断・健康管理・健康増進の保証
- ❌ リハビリテーション支援
- ❌ 怪我の治療・予防の保証
- ❌ 運動効果の保証

### 1.4 薬機法対応:表現の統一(v3.1完全版)

#### 1.4.1 背景

本サービスは薬機法上の「医療機器」に該当しないが、効能効果を標ぼうする表現は医療機器と誤認されるリスクがある。すべてのUI、ドキュメント、マーケティング資料において統一した表現を使用する。

この表現統一は、利用規約v3.1第1.2条およびプライバシーポリシーv3.1第2.3条の定義に基づいています。

#### 1.4.2 NG表現とOK表現

| 場面 | ❌ NG表現 | ✅ OK表現(v3.1) | 参照 |
|-----|---------|-----------------|------|
| **サービス概要** | フォーム判定 | フォーム確認補助 | 利用規約第1.2条 |
| **機能説明** | 改善アドバイス | 参考情報の提供 | 利用規約第1.2条 |
| **音声フィードバック** | 改善してください | 参考:確認してみてください | - |
| **スコア表示** | 正しいフォーム | 参考スコア | 利用規約第1.2条 |
| **効果訴求** | 怪我を防ぐ | フォーム確認の機会を提供 | 利用規約第3.3.3条 |
| **目的** | 安全なトレーニング | トレーニングフォームの確認補助 | 利用規約第3.1条 |
| **AI機能** | AI判定 | AI確認補助 | プライバシーポリシー第4.1条 |
| **精度表示** | 判定精度 | 確認補助の精度 | - |
| **フィードバック** | フィードバック | 参考情報 | 利用規約第1.2条 |
| **分析** | フォーム分析 | フォーム確認の参考情報 | - |

#### 1.4.3 マーケティングにおける表現ガイドライン

| 要素 | ❌ NG | ✅ OK |
|-----|------|------|
| **キャッチコピー** | AIが正しいフォームを判定 | AIがフォーム確認をサポート |
| **機能紹介** | 怪我を防ぐ安全なトレーニング | フォーム確認の参考情報を提供 |
| **効果訴求** | 効果的なトレーニングを実現 | トレーニング記録の管理をサポート |
| **ユーザー体験** | 正確な判定でトレーニング向上 | 参考情報でトレーニング管理を支援 |

**重要**: すべてのUI、ドキュメント、マーケティング資料で統一すること

#### 1.4.4 実装における注意点

| 実装箇所 | 注意事項 | 参照 |
|---------|---------|------|
| **音声TTS** | 「参考:」を必ず前置する | FR-005 |
| **画面表示** | 「参考スコア」「参考情報」等の表記を使用 | FR-006 |
| **通知** | 「確認してみてください」等の推奨表現 | FR-018 |
| **レポート** | 「記録」「参考データ」等の客観的表現 | FR-007 |
| **エラー** | 「確認できませんでした」等の中立的表現 | NFR-021 |

### 1.5 ターゲットユーザー

| 属性 | 内容 |
|-----|------|
| **年齢層** | 20-40代 |
| **性別** | 男女問わず |
| **トレーニング経験** | 初級〜中級者 |
| **利用シーン** | 自宅でのトレーニング |
| **課題** | 正しいフォームがわからない、継続できない |
| **ITリテラシー** | スマートフォンの基本操作ができる |
| **健康状態** | 医師から運動制限を受けていない方(利用規約第4.3条) |

### 1.6 技術的アプローチの進化

#### 1.6.1 段階的な技術進化ロードマップ

```
Phase 1-2: MVP(0-4ヶ月)← 本要件定義書の対象範囲
├─ MediaPipe Pose でフォーム確認補助(ルールベース)
├─ 骨格座標データの収集開始(BigQuery保存)
├─ 基本的な参考情報提供
└─ Firebase + BigQuery データ基盤構築

Phase 3: データ蓄積期(4-12ヶ月)
├─ 10,000セッション以上のデータ蓄積
├─ データ品質管理・クリーニング
├─ ラベル付きデータセットの構築
└─ ML移行の準備

Phase 4: ML移行期(12-18ヶ月)
├─ TensorFlow Lite モデルの開発
├─ 骨格座標 → フォーム確認補助をML化
├─ A/Bテストで精度検証
└─ 段階的にML確認補助へ切り替え

Phase 5: 高度化期(18ヶ月〜)
├─ 個人差を考慮した確認補助
├─ リアルタイム参考情報の高度化
├─ 新種目への自動対応
└─ 継続的な学習・改善
```

#### 1.6.2 なぜML移行が必要か

| 項目 | MediaPipe(ルールベース) | 機械学習モデル |
|-----|------------------------|--------------|
| **柔軟性** | 低(ルール変更が必要) | 高(データから学習) |
| **個人差対応** | 困難(固定閾値) | 可能(学習で対応) |
| **精度向上** | 限界あり | 継続的に改善 |
| **新種目追加** | 手動実装が必要 | データで対応可能 |
| **開発初期** | 早い(即座に実装可能) | 時間がかかる |
| **長期運用** | 限界に達する | スケールする |
| **データ要件** | 不要 | 大量のデータが必要 |
| **保守性** | ルール管理が複雑化 | モデル更新で対応 |

**結論**: MVPはMediaPipeで迅速に開発し、データを蓄積しながら段階的にML化する戦略が最適。

#### 1.6.3 データ収集戦略(MVP期間)

| データ種類 | 収集方法 | 保存先 | 用途 | 法的根拠 |
|-----------|---------|--------|------|---------|
| **骨格座標** | MediaPipe Pose出力 | BigQuery | ML学習用 | プライバシーポリシー第5.1条 |
| **フォームスコア** | ルールベース算出 | BigQuery | ラベリング参考 | プライバシーポリシー第5.1条 |
| **レップ数** | アプリ内カウント | Firestore + BigQuery | 統計分析 | プライバシーポリシー第5.1条 |
| **セッション時間** | アプリ内計測 | Firestore + BigQuery | 利用分析 | プライバシーポリシー第5.2条 |
| **ユーザー属性** | プロフィール情報 | Firestore | 匿名化後分析 | プライバシーポリシー第4.3条 |

**プライバシー保護**(プライバシーポリシーv3.1第8条準拠):
- カメラ映像は端末上でのみ処理、サーバーに送信しない(オンデバイス処理)
- 骨格座標のみをBigQueryに保存(個人識別不可)
- ユーザーIDは仮名化(pseudonymization - プライバシーポリシー第8.3条)
- GDPR/EDPB Guidelines完全準拠
- 技術的保護措置:TLS 1.3、AES-256暗号化(プライバシーポリシー第8.4条)

### 1.7 プロジェクトスコープ(MVP: Phase 1-2)

#### 1.7.1 MVPに含まれる機能 ✅

| カテゴリ | 機能 | 優先度 | Phase | 法的要件 |
|---------|------|--------|-------|---------|
| **認証** | メール/電話/Google/Apple認証 | 必須 | Phase 1 | 利用規約第5条 |
| **トレーニング** | 5種目のフォーム確認補助(MediaPipe) | 必須 | Phase 1 | 利用規約第3.2条 |
| **検索・フィルタ** | 種目名、カテゴリ、難易度で検索 | 必須 | Phase 1 | - |
| **記録管理** | トレーニング履歴の保存・可視化 | 必須 | Phase 1 | プライバシーポリシー第4.1条 |
| **課金** | 月額500円のサブスクリプション | 必須 | Phase 2 | 利用規約第6条 |
| **通知** | リマインダー通知 | 必須 | Phase 2 | プライバシーポリシー第4.1条 |
| **データ基盤** | Firebase + BigQuery統合 | 必須 | Phase 1 | プライバシーポリシー第7.2条 |
| **骨格データ収集** | ML準備のためのデータ蓄積 | 必須 | Phase 1 | プライバシーポリシー第5.1条 |
| **分析ダッシュボード** | Looker Studio | 必須 | Phase 2 | - |
| **GDPR対応** | 同意管理、データ削除、エクスポート | 必須 | Phase 1 | プライバシーポリシー第9条 |
| **セキュリティ監視** | Cloud Logging、Security Command Center | 必須 | Phase 1 | プライバシーポリシー第8.5条 |

#### 1.7.2 MVPに含まれない機能 ❌(将来対応)

| カテゴリ | 機能 | 対応予定 |
|---------|------|---------|
| **AI/ML** | 機械学習モデルによる確認補助 | Phase 4以降 |
| **トレーニング** | 追加種目(6種目目以降) | Phase 3以降 |
| **ソーシャル** | フレンド機能、ランキング | Phase 5以降 |
| **プログラム** | トレーニングプログラム提供 | Phase 5以降 |
| **レコメンド** | パーソナライズ推奨 | Phase 4以降 |
| **連携** | ウェアラブルデバイス連携 | Phase 6以降 |
| **動画** | 動画保存機能 | 対応予定なし(プライバシー) |

### 1.8 プロジェクトゴール(MVP期間: 0-4ヶ月)

#### 1.8.1 定量的目標

| 指標 | 目標値 | 測定方法 |
|-----|--------|---------|
| **ユーザー登録数** | 1,000人 | Firebase Authentication |
| **有料会員数** | 100人(コンバージョン率10%) | Firestore + RevenueCat |
| **DAU(Daily Active Users)** | 200人 | Firebase Analytics |
| **継続率(30日)** | 30% | Firebase Analytics |
| **平均セッション時間** | 10分以上 | Firebase Analytics |
| **アプリストア評価** | 4.0以上 | App Store / Google Play |
| **収集データ数** | 10,000セッション以上 | BigQuery |

#### 1.8.2 定性的目標

- ✅ ユーザーがフォーム確認の参考情報を得られる
- ✅ トレーニングの習慣化をサポートできる
- ✅ 低コストで誰でも利用できる
- ✅ プライバシーが保護されている安心感を提供
- ✅ 将来のML化に向けたデータ基盤を構築

#### 1.8.3 データ収集目標

| データ種類 | 目標数 | 品質要件 | 法的根拠 |
|-----------|--------|---------|---------|
| **骨格座標セット** | 10,000セッション | 欠損率5%以下 | プライバシーポリシー第5.1条 |
| **ラベル付きデータ** | 1,000セッション | 専門家レビュー済み | プライバシーポリシー第5.1条 |
| **多様性** | 100人以上の異なるユーザー | 年齢・性別・体型の多様性 | GDPR第5条1項(c) |

---

## 2. プロジェクト体制

### 2.1 チーム構成

| 役割 | 人数 | 主な責任 |
|-----|------|---------|
| **プロジェクトマネージャー(PM)** | 1名 | プロジェクト全体の管理、進捗管理、リスク管理、ステークホルダー調整、法務対応 |
| **フロントエンドエンジニア** | 1名 | Flutterアプリ開発、UI実装、MediaPipe統合、状態管理、データ収集実装 |
| **バックエンドエンジニア** | 1名 | Firebase Functions開発、API設計、Firestore設計、BigQuery統合、GCP設定 |
| **UI/UXデザイナー** | 1名 | 画面設計、ワイヤーフレーム作成、デザインシステム構築、ユーザビリティテスト |
| **QAエンジニア** | 1名 | テスト計画作成、テスト実行、バグ管理、品質保証、セキュリティテスト |

**合計**: 5名

### 2.2 役割と責任(RACI)

| タスク | PM | FE | BE | デザイナー | QA |
|-------|----|----|----|-----------|----|
| **要件定義** | A/R | C | C | C | I |
| **技術選定** | A | R | R | I | I |
| **薬機法対応** | A/R | C | C | C | I |
| **GDPR対応** | A/R | C | R | I | C |
| **画面設計** | A | C | I | R | C |
| **DB設計** | A | I | R | I | C |
| **API設計** | A | C | R | I | C |
| **データ基盤構築** | A | I | R | I | C |
| **フロント実装** | A | R | I | C | I |
| **バックエンド実装** | A | I | R | I | I |
| **データ収集実装** | A | R | R | I | C |
| **テスト** | A | C | C | C | R |
| **セキュリティ監査** | A | C | C | I | R |
| **デプロイ** | A | R | R | I | C |
| **法務書類作成** | A/R | I | I | I | C |
| **ドキュメント作成** | A | C | C | C | R |

**凡例**:
- R: 実行責任者(Responsible)
- A: 説明責任者(Accountable)
- C: 相談先(Consulted)
- I: 報告先(Informed)

### 2.3 外部協力者

| 役割 | 必要性 | タイミング | 備考 |
|-----|--------|-----------|------|
| **法務アドバイザー** | 必須 | Phase 1 Week 1-4 | 薬機法、GDPR、個人情報保護法の確認 |
| **セキュリティ専門家** | 必須 | Phase 2 Week 15 | 脆弱性診断、ペネトレーションテスト |
| **トレーニング専門家** | 推奨 | Phase 1 Week 4 | 5種目のフォーム基準確認 |
| **翻訳者** | 将来 | Phase 3以降 | 英語版ドキュメント作成(EEA対応) |
| **DPO(データ保護責任者)** | 推奨 | Phase 1開始時 | GDPR第37条対応(EEA展開時は必須) |

### 2.4 コミュニケーション

| 会議 | 頻度 | 参加者 | 目的 |
|-----|------|--------|------|
| **デイリースタンドアップ** | 毎日 | 全メンバー | 進捗共有、課題共有 |
| **週次進捗会議** | 毎週月曜 | 全メンバー | 週次目標設定、振り返り |
| **スプリント計画** | 2週間ごと | 全メンバー | スプリント目標設定、タスク分解 |
| **スプリントレビュー** | 2週間ごと | 全メンバー | デモ、フィードバック |
| **月次報告** | 毎月末 | PM、ステークホルダー | 月次KPI報告、リスク報告 |

---

## 3. 機能要件

### 3.1 機能要件一覧(全31機能)

以下の機能要件は、利用規約v3.1およびプライバシーポリシーv3.1に完全準拠しています。

| ID | カテゴリ | 機能名 | 優先度 | Phase | 法的要件 |
|----|---------|--------|--------|-------|---------|
| FR-001 | 認証 | ユーザー登録・ログイン | 必須 | Phase 1 | 利用規約第5条 |
| FR-002 | 認証 | OAuth認証(Google/Apple) | 必須 | Phase 1 | 利用規約第5.4条 |
| FR-003 | 認証 | パスワードリセット | 必須 | Phase 1 | - |
| FR-004 | トレーニング | リアルタイムフォーム確認補助(MediaPipe) | 必須 | Phase 1 | 利用規約第3.2条 |
| FR-005 | トレーニング | 音声による参考情報提供 | 必須 | Phase 1 | 利用規約第3.2条 |
| FR-006 | トレーニング | 参考スコア表示 | 必須 | Phase 1 | 利用規約第1.2条 |
| FR-007 | トレーニング | レップカウント | 必須 | Phase 1 | - |
| FR-008 | トレーニング | セット管理 | 必須 | Phase 1 | - |
| FR-009 | 記録 | トレーニング履歴の保存 | 必須 | Phase 1 | プライバシーポリシー第4.1条 |
| FR-010 | 記録 | 履歴の表示・検索 | 必須 | Phase 1 | - |
| FR-011 | 記録 | 進捗グラフ表示 | 必須 | Phase 1 | - |
| FR-012 | 記録 | データエクスポート | 必須 | Phase 1 | プライバシーポリシー第9.5条 |
| FR-013 | 検索 | 種目検索(名前) | 必須 | Phase 1 | - |
| FR-014 | 検索 | フィルタ(カテゴリ、難易度、部位) | 必須 | Phase 1 | - |
| FR-015 | 設定 | プロフィール編集 | 必須 | Phase 1 | プライバシーポリシー第9.2条 |
| FR-016 | 設定 | 通知設定 | 必須 | Phase 1 | プライバシーポリシー第9.4条 |
| FR-017 | 設定 | プライバシー設定 | 必須 | Phase 1 | プライバシーポリシー第9条 |
| FR-018 | 通知 | リマインダー通知 | 必須 | Phase 2 | プライバシーポリシー第4.1条 |
| FR-019 | 通知 | お知らせ通知 | 必須 | Phase 2 | - |
| FR-020 | 課金 | サブスクリプション登録 | 必須 | Phase 2 | 利用規約第6条 |
| FR-021 | 課金 | 無料トライアル(1週間) | 必須 | Phase 2 | 利用規約第6.2条 |
| FR-022 | 課金 | サブスクリプション管理 | 必須 | Phase 2 | 利用規約第6.5条 |
| FR-023 | 課金 | 決済履歴表示 | 必須 | Phase 2 | - |
| FR-024 | GDPR | 同意管理 | 必須 | Phase 1 | プライバシーポリシー第9.1条 |
| FR-025 | GDPR | データ削除(忘れられる権利) | 必須 | Phase 1 | プライバシーポリシー第9.6条 |
| FR-026 | GDPR | データ訂正 | 必須 | Phase 1 | プライバシーポリシー第9.2条 |
| FR-027 | GDPR | データアクセス | 必須 | Phase 1 | プライバシーポリシー第9.3条 |
| FR-028 | データ収集 | 骨格座標データ収集 | 必須 | Phase 1 | プライバシーポリシー第5.1条 |
| FR-029 | データ収集 | セッションメタデータ収集 | 必須 | Phase 1 | プライバシーポリシー第5.2条 |
| FR-030 | ヘルプ | FAQ表示 | 必須 | Phase 2 | - |
| FR-031 | ヘルプ | お問い合わせフォーム | 必須 | Phase 2 | - |

### 3.2 主要機能の詳細

#### 3.2.1 FR-001〜003: 認証機能

**法的根拠**: 利用規約v3.1第5条、プライバシーポリシーv3.1第4.2条、GDPR第6条1項(b)契約の履行

##### FR-001: ユーザー登録・ログイン

**目的**: ユーザーアカウントの作成とログインを提供

**詳細**:
- メールアドレス + パスワード による登録
- 電話番号 + SMS認証 による登録
- 年齢確認(日本:13歳以上、EEA:16歳以上) - 利用規約第4.1条
- 未成年者の場合、親権者の同意確認 - 利用規約第4.2条
- 利用規約・プライバシーポリシーへの同意取得 - 利用規約第2.1条
- Firebase Authenticationを使用
- パスワード強度チェック(8文字以上、英数字記号含む)

**入力**:
- メールアドレスまたは電話番号
- パスワード
- 生年月日(年齢確認用)
- 親権者の同意(未成年者の場合)
- 利用規約・プライバシーポリシーへの同意

**出力**:
- ユーザーID(仮名化 - プライバシーポリシー第8.3条)
- JWT認証トークン
- 登録完了通知

**エラー処理**:
- メールアドレス重複
- パスワード強度不足
- 年齢制限未満
- 同意未取得

**プライバシー保護**:
- パスワードはbcryptでハッシュ化(プライバシーポリシー第8.4条)
- 生年月日は暗号化保存(AES-256 - プライバシーポリシー第8.4条)
- 通信はTLS 1.3で暗号化(プライバシーポリシー第8.4条)

##### FR-002: OAuth認証(Google/Apple)

**法的根拠**: 利用規約v3.1第5.4条、プライバシーポリシーv3.1第2.2条

**目的**: ソーシャルログインによる簡単な登録・ログイン

**詳細**:
- Google Sign-In
- Apple Sign-In
- Firebase Authenticationを使用
- 最小限のスコープ要求(email, profile)
- 年齢確認は別途実施
- 第三者サービスの利用について明示(プライバシーポリシー第2.2条)

**入力**:
- OAuth認証フロー
- 生年月日(年齢確認用)
- 利用規約・プライバシーポリシーへの同意

**出力**:
- ユーザーID(仮名化)
- JWT認証トークン
- プロフィール情報(名前、メールアドレス)

**プライバシー保護**:
- OAuth tokenは端末上でのみ保持
- サーバーにはユーザーIDのみ送信
- 第三者サービスのプライバシーポリシーを明示

##### FR-003: パスワードリセット

**目的**: パスワードを忘れたユーザーのアカウント復旧

**詳細**:
- メールアドレスによるパスワードリセット
- Firebase Authentication標準機能を使用
- リセットリンクの有効期限:1時間

**入力**:
- メールアドレス

**出力**:
- パスワードリセットメール
- リセット完了通知

#### 3.2.2 FR-004〜008: トレーニング機能

**法的根拠**: 利用規約v3.1第3条、プライバシーポリシーv3.1第4.1条、GDPR第6条1項(b)契約の履行

##### FR-004: リアルタイムフォーム確認補助(MediaPipe)

**重要**: この機能は「確認補助」であり、「判定」ではありません(利用規約第3.3条、プライバシーポリシー第2.3条)

**目的**: カメラを使用してトレーニングフォームの確認を補助する参考情報を提供

**詳細**:
- MediaPipe Pose (Google)を使用した骨格検出
- 33個のランドマークを検出
- リアルタイム処理(30fps)
- **オンデバイス処理**(カメラ映像はサーバーに送信しない - プライバシーポリシー第8.1条)
- ルールベースで参考スコア算出
- 対応種目:5種目(スクワット、プッシュアップ、ダンベルカール、ショルダープレス、デッドリフト)

**入力**:
- カメラ映像(端末上でのみ処理)
- 選択した種目

**出力**:
- 骨格座標(33ランドマーク)
- 参考スコア(0-100) - 利用規約第1.2条「参考スコア」
- 音声による参考情報
- 視覚的なフィードバック(骨格描画)

**プライバシー保護**(プライバシーポリシーv3.1第8.1条):
- カメラ映像は端末上でのみ処理
- サーバーには骨格座標のみ送信
- 骨格座標は個人識別不可
- 映像は保存しない

**データ収集**(プライバシーポリシーv3.1第5.1条、FR-028):
- 骨格座標をBigQueryに保存(将来のML学習用)
- ユーザーIDは仮名化
- GDPR第6条1項(f)正当な利益

**参考情報の例**:
- ✅ 「参考:膝の角度を確認してみてください」
- ✅ 「参考:背中の姿勢を確認してみてください」
- ❌ 「膝の角度を修正してください」(医療機器と誤認)
- ❌ 「正しいフォームです」(保証と誤認)

##### FR-005: 音声による参考情報提供

**法的根拠**: 利用規約v3.1第3.2条、プライバシーポリシーv3.1第4.1条

**目的**: ハンズフリーで参考情報を音声で確認できる

**詳細**:
- Text-to-Speech(TTS)を使用
- **必ず「参考:」を前置**(薬機法対応 - 利用規約第1.4.4条)
- リアルタイムフィードバック
- 音量調整可能
- 言語:日本語(将来:英語)

**入力**:
- フォーム確認結果(FR-004)

**出力**:
- 音声メッセージ(TTS)

**参考情報の例**:
- ✅ 「参考:膝の角度を確認してみてください」
- ✅ 「参考:背中をまっすぐに保つことを意識してみてください」
- ✅ 「参考:良い姿勢を保っています」

**禁止表現**(利用規約第1.4.2条):
- ❌ 「膝の角度を修正してください」
- ❌ 「正しいフォームです」
- ❌ 「これで怪我を防げます」

##### FR-006: 参考スコア表示

**法的根拠**: 利用規約v3.1第1.2条「参考スコア」、第3.3.4条

**目的**: トレーニングフォームの参考情報を数値で表示

**詳細**:
- 0-100の数値で表示
- **「参考スコア」と明記**(利用規約第1.4.2条)
- リアルタイム更新
- 過去のスコアと比較表示
- グラフで推移を表示

**計算方法**(ルールベース)**:
1. 各ランドマークの角度計算
2. 理想的な角度範囲と比較
3. 偏差に基づきスコア算出
4. 加重平均で総合スコア算出

**注意事項**(利用規約第3.3.4条):
- 参考スコアは絶対的な評価ではありません
- あくまで参考情報です
- 最終的な判断は利用者自身が行ってください

**表示例**:
```
参考スコア: 85/100
膝の角度: 良好
背中の姿勢: 確認してみてください
```

##### FR-007: レップカウント

**目的**: トレーニングの回数を自動カウント

**詳細**:
- 動作の完了を検知して自動カウント
- 音声フィードバック
- 画面表示
- 目標回数設定

**入力**:
- 骨格座標(FR-004)
- 目標回数

**出力**:
- 現在の回数
- 目標達成率
- 音声カウント

**カウントロジック**:
1. 開始位置の検出
2. 最下点/最上点の検出
3. 開始位置への復帰検出
4. カウント+1

##### FR-008: セット管理

**目的**: トレーニングのセット数を管理

**詳細**:
- セット数の設定(1-10セット)
- セット間の休憩時間(30秒、60秒、90秒、カスタム)
- タイマー表示
- 次セット準備通知

**入力**:
- 目標セット数
- セット間休憩時間

**出力**:
- 現在のセット数
- 残りセット数
- 休憩タイマー
- 次セット開始通知

#### 3.2.3 FR-024〜027: GDPR対応機能

**法的根拠**: プライバシーポリシーv3.1第9条、GDPR第12-22条

これらの機能は、GDPR/EDPB Guidelinesに完全準拠しています。

##### FR-024: 同意管理

**法的根拠**: プライバシーポリシーv3.1第9.1条、GDPR第7条、EDPB Guidelines 05/2020 on consent

**目的**: ユーザーの明示的な同意を取得・管理

**詳細**:
- 利用規約・プライバシーポリシーへの同意
- トレーニングデータ収集への同意
- 分析データ利用への同意(任意)
- マーケティング利用への同意(任意)
- 将来のML学習への同意(任意、Phase 4以降)
- 同意の記録(日時、内容、方法) - GDPR第7条2項
- 同意の撤回機能 - GDPR第7条3項

**同意の要件**(EDPB Guidelines 05/2020):
1. **自由に与えられること**(Freely given)
2. **具体的であること**(Specific)
3. **情報に基づくこと**(Informed)
4. **明確な意思表示であること**(Unambiguous)

**実装**:
- チェックボックス(事前選択なし)
- 平易な言語での説明
- 同意項目ごとに個別の選択肢
- 撤回は同意と同じくらい簡単に

**同意記録**:
- 同意取得日時
- 同意内容(バージョン)
- 同意方法(チェックボックス、ボタンクリック等)
- IPアドレス(仮名化)

**対応期限**: 即座

##### FR-025: データ削除(忘れられる権利)

**法的根拠**: プライバシーポリシーv3.1第9.6条、GDPR第17条、利用規約v3.1第14.3条

**目的**: ユーザーの個人データを完全に削除

**詳細**:
- アカウント削除機能
- 全個人データの削除
- 法定保存期間のデータを除く
- 削除確認プロセス
- 削除完了通知
- 30日間の猶予期間(誤操作対策)

**削除対象**:
1. ユーザープロフィール
2. トレーニング履歴
3. 骨格座標データ
4. セッションメタデータ
5. 通知設定
6. 同意記録

**削除除外**(法定保存義務):
- 課金履歴(7年間 - 会計法)
- 監査ログ(1年間 - セキュリティ)

**実装手順**:
1. ユーザーが削除リクエスト送信
2. 本人確認(再認証)
3. 削除内容の説明と確認
4. 30日間の猶予期間
5. Firestore、BigQuery、Cloud Storage から削除
6. 削除完了メール送信

**対応期限**: 30日以内(GDPR第12条3項)

##### FR-026: データ訂正

**法的根拠**: プライバシーポリシーv3.1第9.2条、GDPR第16条

**目的**: ユーザーが自身のデータを訂正できる

**詳細**:
- プロフィール編集
- トレーニング履歴の編集
- 誤ったデータの訂正
- 訂正履歴の記録

**訂正可能なデータ**:
1. 名前
2. メールアドレス
3. 電話番号
4. 生年月日
5. 目標設定
6. トレーニング記録(レップ数、重量等)

**訂正不可なデータ**:
- ユーザーID
- 登録日時
- 骨格座標データ(自動収集のため)
- 課金履歴

**実装**:
- 設定画面からの編集
- 変更内容の確認
- 監査ログへの記録

**対応期限**: 即座(編集機能提供)

##### FR-027: データアクセス

**法的根拠**: プライバシーポリシーv3.1第9.3条、GDPR第15条

**目的**: ユーザーが自身のデータを閲覧・ダウンロードできる

**詳細**:
- 保存されている全データの表示
- データのエクスポート(JSON、CSV)
- データの種類ごとの分類
- ダウンロード履歴の記録

**エクスポート可能なデータ**:
1. プロフィール情報
2. トレーニング履歴
3. セッションメタデータ
4. 通知設定
5. 同意記録
6. 課金履歴

**エクスポート形式**:
- JSON(機械可読)
- CSV(人間可読)
- 構造化されたフォーマット

**実装手順**:
1. ユーザーがエクスポートリクエスト
2. バックグラウンドでデータ収集
3. ZIPファイル作成
4. ダウンロードリンク通知(有効期限7日間)

**対応期限**: 30日以内(GDPR第12条3項)

**セキュリティ**:
- ダウンロードリンクは暗号化
- ダウンロード後、ファイルは自動削除
- ダウンロード履歴を記録

#### 3.2.4 FR-028〜029: データ収集機能

**法的根拠**: プライバシーポリシーv3.1第5条、GDPR第6条1項(f)正当な利益

##### FR-028: 骨格座標データ収集

**法的根拠**: プライバシーポリシーv3.1第5.1条、GDPR第6条1項(f)正当な利益

**目的**: 将来のML学習用データ収集

**詳細**:
- MediaPipe Poseの出力(33ランドマーク)を収集
- BigQueryに保存
- ユーザーIDは仮名化(プライバシーポリシー第8.3条)
- 個人識別不可
- 利益衡量テスト実施済み(プライバシーポリシー付録B.1)

**収集データ**:
```json
{
  "session_id": "uuid",
  "user_id": "pseudonymized_id",
  "exercise_id": "squat",
  "timestamp": "2025-11-21T10:00:00Z",
  "frame_number": 123,
  "landmarks": [
    {"x": 0.5, "y": 0.3, "z": 0.1, "visibility": 0.9},
    // ... 33 landmarks
  ]
}
```

**プライバシー保護**:
- カメラ映像は保存しない
- 骨格座標のみ保存(個人識別不可)
- ユーザーIDは仮名化(SHA-256)
- データは暗号化保存(AES-256)
- アクセス制御(Cloud IAM)

**データ品質管理**:
- 欠損データの除外
- 異常値の検出と除外
- データクリーニング

**法的対応**:
- 同意取得(プライバシーポリシー第9.1条)
- データ削除権の保証(プライバシーポリシー第9.6条)
- データアクセス権の保証(プライバシーポリシー第9.3条)

##### FR-029: セッションメタデータ収集

**法的根拠**: プライバシーポリシーv3.1第5.2条、GDPR第6条1項(f)正当な利益

**目的**: サービス改善のための統計データ収集

**詳細**:
- トレーニングセッションの統計情報を収集
- BigQueryに保存
- ユーザーIDは仮名化
- 個人識別不可

**収集データ**:
```json
{
  "session_id": "uuid",
  "user_id": "pseudonymized_id",
  "exercise_id": "squat",
  "rep_count": 10,
  "set_count": 3,
  "duration": 600,
  "average_score": 85.5,
  "created_at": "2025-11-21T10:00:00Z",
  "device_info": {
    "os": "iOS",
    "version": "16.0",
    "model": "iPhone 13"
  }
}
```

**利用目的**:
1. サービス改善
2. 機能開発の優先順位付け
3. パフォーマンス最適化
4. 統計分析

**プライバシー保護**:
- ユーザーIDは仮名化
- 個人を特定できる情報は含まない
- 集計データのみ使用
- アクセス制御

---

**Part 1 完了**

Part 1には以下が含まれています:
- プロジェクト概要(背景、目的、位置づけ、薬機法対応、ターゲットユーザー、技術的アプローチ、スコープ、ゴール)
- プロジェクト体制(チーム構成、RACI、外部協力者、コミュニケーション)
- 機能要件(FR-001〜FR-031の一覧および主要機能の詳細)

Part 2には以下を含めます:
- 非機能要件(NFR-001〜NFR-032)
- 制約条件
- 前提条件
- リスク管理
- 成果物
- Firebase + GCP ハイブリッド構成
- まとめ

---

**Document Version**: v3.1 (Part 1/2)
**Last Updated**: 2025年11月21日
**Author**: Project Team
**Status**: Draft
**Next**: Part 2作成

---
# 要件定義書 v3.1 (Part 2/2)

**プロジェクト名**: AIフィットネスアプリ(仮称)
**バージョン**: 3.1 (MVP)
**作成日**: 2025年11月
**最終更新日**: 2025年11月21日
**対象期間**: Phase 1-2 (0-4ヶ月)

---

## 4. 非機能要件

### 4.1 非機能要件一覧(全32要件)

以下の非機能要件は、プライバシーポリシーv3.1第8条(情報の保護)に完全準拠しています。

| ID | カテゴリ | 要件 | 優先度 | 目標値 | 法的根拠 |
|----|---------|------|--------|--------|---------|
| NFR-001 | パフォーマンス | アプリ起動時間 | 必須 | 3秒以内 | - |
| NFR-002 | パフォーマンス | MediaPipeフレームレート | 必須 | 30fps以上 | - |
| NFR-003 | パフォーマンス | APIレスポンス時間 | 必須 | 200ms以内 | - |
| NFR-004 | パフォーマンス | データベースクエリ | 必須 | 100ms以内 | - |
| NFR-005 | 可用性 | アップタイム | 必須 | 99.5%以上 | - |
| NFR-006 | 可用性 | メンテナンス時間 | 必須 | 月4時間以内 | - |
| NFR-007 | スケーラビリティ | 同時接続数 | 必須 | 1,000ユーザー | - |
| NFR-008 | スケーラビリティ | データ増加対応 | 必須 | 自動スケール | - |
| NFR-009 | セキュリティ | 通信暗号化 | 必須 | TLS 1.3 | プライバシーポリシー第8.4条 |
| NFR-010 | セキュリティ | データ暗号化 | 必須 | AES-256 | プライバシーポリシー第8.4条 |
| NFR-011 | セキュリティ | 認証 | 必須 | JWT, OAuth 2.0 | プライバシーポリシー第8.2条 |
| NFR-012 | セキュリティ | アクセス制御 | 必須 | Cloud IAM | プライバシーポリシー第8.2条 |
| NFR-013 | セキュリティ | 脆弱性診断 | 必須 | リリース前 | プライバシーポリシー第8.5条 |
| NFR-014 | セキュリティ | ペネトレーションテスト | 推奨 | リリース前 | プライバシーポリシー第8.5条 |
| NFR-015 | プライバシー | オンデバイス処理 | 必須 | カメラ映像 | プライバシーポリシー第8.1条 |
| NFR-016 | プライバシー | 仮名化 | 必須 | ユーザーID | プライバシーポリシー第8.3条 |
| NFR-017 | プライバシー | データ削除 | 必須 | 30日以内 | プライバシーポリシー第9.6条 |
| NFR-018 | プライバシー | データエクスポート | 必須 | 30日以内 | プライバシーポリシー第9.5条 |
| NFR-019 | GDPR対応 | 同意管理 | 必須 | 記録保持 | プライバシーポリシー第9.1条 |
| NFR-020 | GDPR対応 | データ侵害通知 | 必須 | 72時間以内 | プライバシーポリシー第13条 |
| NFR-021 | ユーザビリティ | 操作性 | 必須 | 3タップ以内 | - |
| NFR-022 | ユーザビリティ | エラーメッセージ | 必須 | 平易な言語 | - |
| NFR-023 | ユーザビリティ | アクセシビリティ | 推奨 | WCAG 2.1 AA | - |
| NFR-024 | 互換性 | iOS | 必須 | iOS 15.0以上 | 利用規約第4.4.1条 |
| NFR-025 | 互換性 | Android | 必須 | Android 8.0以上 | 利用規約第4.4.1条 |
| NFR-026 | 保守性 | コードカバレッジ | 必須 | 80%以上 | - |
| NFR-027 | 保守性 | ドキュメント | 必須 | 全機能 | - |
| NFR-028 | 監視 | ログ収集 | 必須 | Cloud Logging | プライバシーポリシー第8.5条 |
| NFR-029 | 監視 | エラー監視 | 必須 | Firebase Crashlytics | - |
| NFR-030 | 監視 | パフォーマンス監視 | 必須 | Firebase Performance | - |
| NFR-031 | バックアップ | データバックアップ | 必須 | 日次 | - |
| NFR-032 | バックアップ | 復旧時間目標(RTO) | 必須 | 24時間以内 | - |

### 4.2 主要非機能要件の詳細

#### 4.2.1 セキュリティ要件(NFR-009〜014)

**法的根拠**: プライバシーポリシーv3.1第8条(情報の保護)、GDPR第32条(処理の安全性)

##### NFR-009: 通信暗号化

**目的**: すべての通信を暗号化し、盗聴を防ぐ

**詳細**:
- **TLS 1.3**を使用(プライバシーポリシー第8.4条)
- TLS 1.2以下は使用しない
- Perfect Forward Secrecy(PFS)対応
- 証明書の定期更新

**対象**:
- Flutter App ↔ Firebase
- Flutter App ↔ Google Cloud Platform
- Firebase ↔ Google Cloud Platform

**検証方法**:
- SSL Labs テスト(A+評価)
- 定期的な脆弱性スキャン

##### NFR-010: データ暗号化

**目的**: 保存データを暗号化し、不正アクセスを防ぐ

**詳細**:
- **AES-256暗号化**を使用(プライバシーポリシー第8.4条)
- 鍵管理:Google Cloud KMS
- 鍵のローテーション:90日ごと

**暗号化対象**:
1. **Firestoreデータ**:自動暗号化(Google管理)
2. **BigQueryデータ**:自動暗号化(Google管理)
3. **Cloud Storageデータ**:自動暗号化(Google管理)
4. **バックアップデータ**:AES-256

**暗号化除外**:
- 公開情報(種目マスターデータ等)

##### NFR-011: 認証

**目的**: ユーザーの本人確認と認可

**詳細**:
- **JWT(JSON Web Token)**
- **OAuth 2.0**(Google、Apple)
- トークン有効期限:1時間
- リフレッシュトークン有効期限:30日
- セッション管理:Firebase Authentication

**認証フロー**:
1. ユーザーログイン
2. Firebase AuthenticationがJWT発行
3. アプリがJWTを保持
4. API呼び出し時にJWT送信
5. Firebase FunctionsがJWT検証

**セキュリティ対策**:
- JWTは端末の安全な領域に保存(Keychain/Keystore)
- XSS、CSRF対策
- ブルートフォース攻撃対策(レート制限)

##### NFR-012: アクセス制御

**法的根拠**: プライバシーポリシーv3.1第8.2条

**目的**: 適切な権限管理によるデータ保護

**詳細**:
- **Cloud IAM**(Identity and Access Management)
- **Firestore Security Rules**
- 最小権限の原則(Principle of Least Privilege)
- ロールベースアクセス制御(RBAC)

**Firestore Security Rules**(プライバシーポリシー第8.2条):
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ユーザーは自分のデータのみアクセス可能
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // トレーニング履歴は自分のもののみ
    match /sessions/{sessionId} {
      allow read, write: if request.auth != null &&
                            resource.data.userId == request.auth.uid;
    }

    // 種目マスターデータは全員が読み取り可能
    match /exercises/{exerciseId} {
      allow read: if true;
      allow write: if false; // 管理者のみ(Firebase Console)
    }
  }
}
```

**Cloud IAMロール**:
| ロール | 権限 | 対象 |
|-------|------|------|
| **Owner** | 全権限 | PM、BE |
| **Editor** | 読み取り、書き込み | FE、QA |
| **Viewer** | 読み取りのみ | デザイナー |
| **Custom: Data Analyst** | BigQuery読み取り | PM、BE |

##### NFR-013: 脆弱性診断

**法的根拠**: プライバシーポリシーv3.1第8.5条

**目的**: セキュリティ脆弱性の発見と修正

**詳細**:
- リリース前に実施
- 自動スキャン:OWASP ZAP、Snyk
- 手動診断:外部セキュリティ専門家

**診断項目**:
1. **OWASP Top 10**
2. **SQLインジェクション**
3. **XSS(クロスサイトスクリプティング)**
4. **CSRF(クロスサイトリクエストフォージェリ)**
5. **認証・認可の脆弱性**
6. **機密データの露出**
7. **XML外部エンティティ(XXE)**
8. **アクセス制御の不備**
9. **セキュリティ設定の誤り**
10. **既知の脆弱性のあるコンポーネント使用**

**診断頻度**:
- リリース前:必須
- 四半期ごと:推奨

##### NFR-014: ペネトレーションテスト

**法的根拠**: プライバシーポリシーv3.1第8.5条

**目的**: 実際の攻撃を模倣して脆弱性を発見

**詳細**:
- リリース前に実施(推奨)
- 外部セキュリティ専門家による実施
- ホワイトボックステスト、ブラックボックステスト

**テスト項目**:
1. 認証・認可の回避
2. データベースへの不正アクセス
3. サービス妨害攻撃(DoS)
4. ソーシャルエンジニアリング
5. 物理的セキュリティ

#### 4.2.2 プライバシー要件(NFR-015〜018)

**法的根拠**: プライバシーポリシーv3.1第8条、GDPR第25条(データ保護バイデザイン)

##### NFR-015: オンデバイス処理

**法的根拠**: プライバシーポリシーv3.1第8.1条

**目的**: カメラ映像の完全なプライバシー保護

**詳細**:
- カメラ映像は端末上でのみ処理
- サーバーには骨格座標のみ送信
- 映像は保存しない
- 映像はメモリ上でのみ処理

**技術的実装**:
- MediaPipe Poseは端末上で実行
- 入力:カメラ映像(端末のみ)
- 出力:骨格座標(33ランドマーク)
- サーバー送信:骨格座標のみ

**プライバシー保護の検証**:
- ネットワークトラフィックの監視
- 映像データが送信されていないことを確認

##### NFR-016: 仮名化

**法的根拠**: プライバシーポリシーv3.1第8.3条、GDPR第4条5項

**目的**: ユーザーIDの仮名化により個人識別を困難にする

**詳細**:
- Firebase AuthenticationのUIDをSHA-256でハッシュ化
- ハッシュ化されたIDをBigQueryに保存
- 元のUIDとの紐付けはFirebaseのみで保持

**仮名化の実装**:
```javascript
// Firebase Functions
const crypto = require('crypto');

function pseudonymizeUserId(uid) {
  const salt = process.env.PSEUDONYMIZATION_SALT; // 環境変数
  return crypto.createHash('sha256')
    .update(uid + salt)
    .digest('hex');
}
```

**仮名化の対象**:
- BigQueryに保存するユーザーID
- ログファイルのユーザーID
- エラーレポートのユーザーID

**仮名化の除外**:
- Firestoreのユーザーデータ(Firebase AuthenticationのUIDを使用)

##### NFR-017: データ削除

**法的根拠**: プライバシーポリシーv3.1第9.6条、GDPR第17条

**目的**: 忘れられる権利の実現

**詳細**:
- ユーザーリクエストから30日以内に削除(GDPR第12条3項)
- Firestore、BigQuery、Cloud Storageから削除
- バックアップからも削除
- 削除完了を通知

**削除プロセス**:
1. ユーザーがアカウント削除リクエスト
2. 30日間の猶予期間(誤操作対策)
3. 削除処理開始
4. Firestoreから削除
5. BigQueryから削除(パーティション削除)
6. Cloud Storageから削除
7. 削除完了メール送信

**削除除外**(法定保存義務):
- 課金履歴(7年間)
- 監査ログ(1年間)

##### NFR-018: データエクスポート

**法的根拠**: プライバシーポリシーv3.1第9.5条、GDPR第20条

**目的**: データポータビリティの実現

**詳細**:
- ユーザーリクエストから30日以内にエクスポート(GDPR第12条3項)
- JSON、CSV形式
- 構造化されたフォーマット
- 機械可読

**エクスポートプロセス**:
1. ユーザーがエクスポートリクエスト
2. バックグラウンドでデータ収集
3. ZIPファイル作成
4. Cloud Storageに一時保存
5. ダウンロードリンク通知(有効期限7日間)
6. ダウンロード後、ファイル削除

**エクスポート形式**:
```json
{
  "user": {
    "id": "user_id",
    "email": "user@example.com",
    "created_at": "2025-01-01T00:00:00Z"
  },
  "sessions": [
    {
      "session_id": "session_id",
      "exercise_id": "squat",
      "rep_count": 10,
      "created_at": "2025-11-21T10:00:00Z"
    }
  ],
  "landmarks": [
    // 骨格座標データ
  ]
}
```

#### 4.2.3 GDPR対応要件(NFR-019〜020)

##### NFR-019: 同意管理

**法的根拠**: プライバシーポリシーv3.1第9.1条、GDPR第7条、EDPB Guidelines 05/2020

**目的**: ユーザーの同意を適切に管理

**詳細**:
- 同意の記録(日時、内容、方法)
- 同意の撤回機能
- 同意内容の表示
- 同意の更新

**記録内容**:
```json
{
  "user_id": "user_id",
  "consent_type": "data_collection",
  "consent_given": true,
  "consent_date": "2025-11-21T10:00:00Z",
  "consent_method": "checkbox",
  "consent_version": "v3.1",
  "ip_address": "pseudonymized_ip"
}
```

**同意の撤回**:
- 設定画面から撤回可能
- 撤回は同意と同じくらい簡単
- 撤回後も過去の記録は保持(監査用)

##### NFR-020: データ侵害通知

**法的根拠**: プライバシーポリシーv3.1第13条、GDPR第33条、第34条

**目的**: データ侵害時の迅速な対応

**詳細**:
- 侵害発覚から72時間以内に監督機関に通知(GDPR第33条)
- 高リスクの場合、ユーザーにも通知(GDPR第34条)
- インシデント対応計画の策定

**通知内容**:
1. 侵害の性質
2. データ保護責任者の連絡先
3. 侵害の影響
4. 講じた対策

**インシデント対応フロー**:
1. 侵害の検知(Cloud Logging、Security Command Center)
2. 影響範囲の特定
3. 侵害の封じ込め
4. 監督機関への通知(72時間以内)
5. ユーザーへの通知(高リスクの場合)
6. 原因分析と再発防止

#### 4.2.4 パフォーマンス要件(NFR-001〜004)

##### NFR-001: アプリ起動時間

**目的**: ユーザー体験の向上

**詳細**:
- 目標:3秒以内
- 測定:Firebase Performance Monitoring
- 最適化:遅延読み込み、キャッシュ

**最適化手法**:
1. スプラッシュ画面の最小化
2. 初期データの遅延読み込み
3. 画像の最適化
4. コードの圧縮

##### NFR-002: MediaPipeフレームレート

**目的**: リアルタイムフォーム確認補助

**詳細**:
- 目標:30fps以上
- 測定:アプリ内計測
- 最適化:モデルの軽量化、並列処理

**最適化手法**:
1. MediaPipe Poseのliteモデル使用
2. カメラ解像度の最適化(720p)
3. GPUアクセラレーション

##### NFR-003: APIレスポンス時間

**目的**: スムーズなユーザー体験

**詳細**:
- 目標:200ms以内
- 測定:Firebase Performance Monitoring
- 最適化:キャッシュ、インデックス

**最適化手法**:
1. Firestoreインデックス
2. Firebase Functions のコールドスタート対策
3. CDN活用

##### NFR-004: データベースクエリ

**目的**: 高速なデータ取得

**詳細**:
- 目標:100ms以内
- 測定:Cloud Monitoring
- 最適化:インデックス、クエリ最適化

**最適化手法**:
1. 複合インデックス
2. クエリのバッチ化
3. ページネーション

#### 4.2.5 可用性要件(NFR-005〜006)

##### NFR-005: アップタイム

**目的**: サービスの安定提供

**詳細**:
- 目標:99.5%以上(月間ダウンタイム3.6時間以内)
- 測定:Cloud Monitoring
- 対策:冗長化、自動フェイルオーバー

**可用性向上策**:
1. Firebaseの自動スケーリング
2. Cloud Functions の自動再起動
3. 定期的なヘルスチェック

##### NFR-006: メンテナンス時間

**目的**: 計画的メンテナンスの最小化

**詳細**:
- 目標:月4時間以内
- タイミング:深夜(2:00-6:00)
- 通知:1週間前

#### 4.2.6 監視要件(NFR-028〜030)

##### NFR-028: ログ収集

**法的根拠**: プライバシーポリシーv3.1第8.5条

**目的**: システムの健全性監視とトラブルシューティング

**詳細**:
- Cloud Logging
- ログレベル:ERROR、WARN、INFO、DEBUG
- ログ保存期間:30日間
- 個人識別情報は含まない

**ログ項目**:
1. リクエストログ
2. エラーログ
3. セキュリティログ
4. パフォーマンスログ

**プライバシー保護**:
- ユーザーIDは仮名化
- 個人識別情報はログに含めない
- アクセス制御(Cloud IAM)

##### NFR-029: エラー監視

**目的**: アプリのクラッシュやエラーの迅速な検知

**詳細**:
- Firebase Crashlytics
- リアルタイムアラート
- エラーレポートの自動送信

**監視項目**:
1. クラッシュレート
2. ANR(Application Not Responding)レート
3. エラー発生頻度

##### NFR-030: パフォーマンス監視

**目的**: アプリのパフォーマンス最適化

**詳細**:
- Firebase Performance Monitoring
- カスタムトレース
- ネットワークリクエストの監視

**監視項目**:
1. 起動時間
2. フレームレート
3. APIレスポンス時間
4. メモリ使用量

---

## 5. 制約条件

### 5.1 技術的制約

| 項目 | 制約 | 理由 |
|-----|------|------|
| **カメラ** | フロントカメラのみ対応 | MediaPipeの精度向上 |
| **デバイス** | iOS 15.0以上、Android 8.0以上 | MediaPipe、Flutterの動作要件 |
| **ネットワーク** | 3Mbps以上 | リアルタイム同期のため |
| **ストレージ** | 200MB以上 | アプリサイズ、キャッシュ |
| **RAM** | 2GB以上 | MediaPipeの動作要件 |

### 5.2 法的制約

| 項目 | 制約 | 根拠 |
|-----|------|------|
| **年齢制限** | 日本:13歳以上、EEA:16歳以上 | 個人情報保護法、GDPR第8条 |
| **医療機器** | 医療機器ではない旨の明記 | 薬機法 |
| **効能効果** | 効能効果の標ぼう禁止 | 薬機法 |
| **データ保護** | GDPR/EDPB Guidelines準拠 | GDPR |
| **プライバシー** | プライバシーバイデザイン | GDPR第25条 |

### 5.3 ビジネス制約

| 項目 | 制約 | 理由 |
|-----|------|------|
| **開発期間** | 4ヶ月(MVP) | リソース、予算 |
| **チームサイズ** | 5名 | 予算 |
| **対応種目** | 5種目 | 開発期間 |
| **言語** | 日本語のみ | リソース |
| **価格** | 月額500円 | 競合調査、ターゲット |

### 5.4 データ制約

| 項目 | 制約 | 理由 |
|-----|------|------|
| **ML学習** | Phase 4以降 | データ不足 |
| **データ量** | 10,000セッション(MVP) | ML学習の最低要件 |
| **保存期間** | アカウント削除まで(最大) | GDPR対応 |
| **バックアップ** | 30日間 | 復旧要件 |

---

## 6. 前提条件

### 6.1 技術的前提

| 項目 | 前提 |
|-----|------|
| **開発環境** | Flutter 3.x、Dart 3.x |
| **バックエンド** | Firebase、Google Cloud Platform |
| **認証** | Firebase Authentication |
| **データベース** | Firestore、BigQuery |
| **ストレージ** | Cloud Storage |
| **課金** | RevenueCat、App Store、Google Play |
| **AI** | MediaPipe Pose (Google) |
| **監視** | Cloud Logging、Firebase Crashlytics |

### 6.2 外部サービス

| サービス | 前提 | 契約状況 |
|---------|------|---------|
| **Google Cloud Platform** | 利用可能 | 要契約 |
| **Firebase** | 利用可能 | GCP契約に含まれる |
| **RevenueCat** | 利用可能 | 要契約 |
| **App Store** | 審査通過 | 要Apple Developer登録 |
| **Google Play** | 審査通過 | 要Google Play登録 |

### 6.3 法務対応

| 項目 | 前提 |
|-----|------|
| **利用規約** | 作成完了(v3.1) |
| **プライバシーポリシー** | 作成完了(v3.1) |
| **法務レビュー** | Phase 1 Week 4までに実施 |
| **薬機法対応** | 表現統一完了 |
| **GDPR対応** | 全機能準拠 |

### 6.4 リソース

| 項目 | 前提 |
|-----|------|
| **チーム** | 5名確保済み |
| **予算** | MVP開発に十分 |
| **期間** | 4ヶ月確保 |
| **外部協力者** | 必要に応じて確保 |

---

## 7. リスク管理

### 7.1 リスク一覧

| ID | リスク | 影響度 | 発生確率 | 対策 | 責任者 |
|----|-------|--------|---------|------|--------|
| R-001 | MediaPipeの精度不足 | 高 | 中 | 複数モデルのテスト、閾値調整 | FE |
| R-002 | パフォーマンス問題 | 高 | 中 | 早期テスト、最適化 | FE, BE |
| R-003 | GDPR違反 | 高 | 低 | 法務レビュー、専門家相談 | PM |
| R-004 | 薬機法違反 | 高 | 低 | 表現統一、法務レビュー | PM |
| R-005 | セキュリティ脆弱性 | 高 | 中 | 脆弱性診断、ペネトレーションテスト | QA, BE |
| R-006 | データ侵害 | 高 | 低 | 暗号化、アクセス制御、監視 | BE |
| R-007 | App Store審査不合格 | 中 | 中 | ガイドライン遵守、事前確認 | PM, FE |
| R-008 | 開発遅延 | 中 | 中 | 進捗管理、リスクバッファ | PM |
| R-009 | ユーザー獲得不足 | 中 | 中 | マーケティング計画、ベータテスト | PM |
| R-010 | データ品質問題 | 中 | 中 | データクリーニング、品質管理 | BE |
| R-011 | 第三者サービス障害 | 中 | 低 | 複数サービス検討、SLA確認 | BE |
| R-012 | チームメンバー離脱 | 低 | 低 | ドキュメント整備、ペアプログラミング | PM |

### 7.2 主要リスクの詳細

#### R-001: MediaPipeの精度不足

**影響度**: 高
**発生確率**: 中
**影響**: ユーザー体験の低下、信頼性の低下

**対策**:
1. 複数のMediaPipeモデル(heavy、full、lite)をテスト
2. 閾値の調整
3. 照明条件の最適化
4. 背景の最適化
5. ユーザーフィードバックの収集
6. Phase 4でML移行

**モニタリング**:
- 参考スコアの精度測定
- ユーザーフィードバックの収集
- エラー率の監視

**責任者**: FE

#### R-003: GDPR違反

**影響度**: 高
**発生確率**: 低
**影響**: 法的措置、罰金(最大2,000万ユーロまたは全世界年間売上高の4%)、信頼性の低下

**対策**:
1. **法務レビュー**(Phase 1 Week 4):弁護士による利用規約・プライバシーポリシーのレビュー
2. **GDPR対応チェックリスト**:付録C(プライバシーポリシーv3.1)の全項目確認
3. **DPO(データ保護責任者)の任命**(EEA展開時は必須)
4. **データ処理記録(ROPA)**の作成と維持
5. **データ保護影響評価(DPIA)**の実施(Phase 3)
6. **定期的な監査**(四半期ごと)

**モニタリング**:
- GDPR準拠状況の定期確認
- データ侵害の監視
- ユーザー権利行使の記録

**責任者**: PM

#### R-004: 薬機法違反

**影響度**: 高
**発生確率**: 低
**影響**: 法的措置、罰金、サービス停止命令、信頼性の低下

**対策**:
1. **表現統一**(v3.1完全版):すべてのUI、ドキュメント、マーケティング資料で統一
2. **法務レビュー**(Phase 1 Week 4):弁護士による表現チェック
3. **医療機器でない旨の明記**:アプリ内、Webサイト、広告すべてで明記
4. **効能効果の標ぼう禁止**:すべての媒体で徹底
5. **定期的な確認**:新機能追加時、マーケティング資料作成時

**モニタリング**:
- すべての公開資料の定期確認
- ユーザーフィードバックの監視
- 競合他社の動向確認

**責任者**: PM

#### R-005: セキュリティ脆弱性

**影響度**: 高
**発生確率**: 中
**影響**: データ侵害、信頼性の低下、法的措置

**対策**:
1. **脆弱性診断**(Phase 2 Week 15):OWASP ZAP、Snyk
2. **ペネトレーションテスト**(Phase 2 Week 15):外部専門家
3. **コードレビュー**:全コードをレビュー
4. **セキュアコーディング**:OWASP Top 10対策
5. **定期的な依存関係更新**:脆弱性のあるライブラリの更新
6. **セキュリティ監視**(Cloud Logging、Security Command Center)

**モニタリング**:
- Cloud Logging でセキュリティログ監視
- Security Command Center でセキュリティ状態確認
- 定期的な脆弱性スキャン

**責任者**: QA、BE

#### R-006: データ侵害

**影響度**: 高
**発生確率**: 低
**影響**: GDPR違反、法的措置、信頼性の低下、ユーザー離脱

**対策**:
1. **暗号化**:TLS 1.3、AES-256
2. **アクセス制御**:Cloud IAM、Firestore Security Rules
3. **監視**:Cloud Logging、Security Command Center
4. **インシデント対応計画**:データ侵害時の対応フロー策定
5. **定期的な監査**:四半期ごと
6. **セキュリティ教育**:チーム全員

**インシデント対応フロー**:
1. 侵害の検知
2. 影響範囲の特定
3. 侵害の封じ込め
4. 監督機関への通知(72時間以内)
5. ユーザーへの通知(高リスクの場合)
6. 原因分析と再発防止

**モニタリング**:
- Cloud Logging で不正アクセスの監視
- Security Command Center でセキュリティ状態確認
- アラート設定(異常なアクセスパターン)

**責任者**: BE

### 7.3 リスク管理プロセス

| 活動 | 頻度 | 責任者 |
|-----|------|--------|
| **リスクレビュー** | 週次 | PM |
| **リスクレジスター更新** | 月次 | PM |
| **リスク評価** | 四半期 | 全メンバー |
| **法務・セキュリティ監査** | 四半期 | PM, QA |

---

## 8. 成果物

### 8.1 設計書

| ドキュメント名 | 責任者 | 期限 | 内容 | 状態 |
|--------------|--------|------|------|------|
| **要件定義書 v3.1** | PM | Phase 1 Week 1 | 本ドキュメント | ✅ 完成 |
| **システムアーキテクチャ設計書 v3.1** | BE, FE | Phase 1 Week 2 | Firebase + GCP構成、データフロー | 🔄 作成予定 |
| **Firestoreデータベース設計書 v3.1** | BE | Phase 1 Week 2 | コレクション設計、インデックス、Security Rules | 🔄 作成予定 |
| **BigQuery設計書 v3.1** | BE | Phase 1 Week 3 | テーブル設計、パーティション、クエリ最適化 | 🔄 作成予定 |
| **API設計書(Firebase Functions) v3.1** | BE | Phase 1 Week 3 | エンドポイント、リクエスト/レスポンス、エラーハンドリング | 🔄 作成予定 |
| **画面遷移図 + ワイヤーフレーム v3.1** | デザイナー | Phase 1 Week 3 | Figmaでの画面設計、遷移図 | 🔄 作成予定 |
| **5種目のフォーム確認ロジック詳細 v3.1** | FE | Phase 1 Week 4 | MediaPipe Poseロジック、閾値、参考情報 | 🔄 作成予定 |
| **利用規約 v3.1** | PM | Phase 1 Week 4 | 薬機法・GDPR準拠 | ✅ 完成 |
| **プライバシーポリシー v3.1** | PM | Phase 1 Week 4 | GDPR・EDPB Guidelines準拠 | ✅ 完成 |
| **データ処理記録(ROPA) v1.0** | PM | Phase 1 Week 4 | GDPR第30条準拠 | 🔄 作成予定 |
| **セキュリティポリシー v1.0** | BE, QA | Phase 1 Week 4 | アクセス制御、暗号化、監査 | 🔄 作成予定 |

### 8.2 実装成果物

| 成果物 | 責任者 | 期限 | 内容 | 状態 |
|-------|--------|------|------|------|
| **Flutterアプリ(iOS/Android)** | FE | Phase 2 Week 16 | 全機能実装、テスト済み | 🔄 作成予定 |
| **Firebase Functions** | BE | Phase 2 Week 14 | API、Cloud Functions、Cron Jobs | 🔄 作成予定 |
| **Firestore初期データ** | BE | Phase 1 Week 4 | 5種目のマスターデータ | 🔄 作成予定 |
| **BigQueryテーブル** | BE | Phase 1 Week 4 | データスキーマ、パーティション設定 | 🔄 作成予定 |
| **デザインシステム(Figma)** | デザイナー | Phase 1 Week 4 | コンポーネント、カラー、タイポグラフィ | 🔄 作成予定 |
| **テストケース** | QA | Phase 2 Week 14 | 単体、統合、E2Eテスト | 🔄 作成予定 |
| **CI/CD設定** | FE, BE | Phase 2 Week 8 | GitHub Actions | 🔄 作成予定 |

### 8.3 テスト成果物

| 成果物 | 責任者 | 期限 | 内容 | 状態 |
|-------|--------|------|------|------|
| **テスト計画書** | QA | Phase 2 Week 8 | テスト戦略、スコープ、スケジュール | 🔄 作成予定 |
| **テストケース一覧** | QA | Phase 2 Week 10 | 機能テスト、非機能テスト | 🔄 作成予定 |
| **バグレポート** | QA | 随時 | Jiraで管理 | 🔄 作成予定 |
| **テスト結果レポート** | QA | Phase 2 Week 16 | カバレッジ、不具合サマリー | 🔄 作成予定 |
| **性能テストレポート** | QA | Phase 2 Week 15 | レスポンス時間、メモリ使用量 | 🔄 作成予定 |
| **セキュリティ監査レポート** | QA | Phase 2 Week 15 | 脆弱性診断結果 | 🔄 作成予定 |

### 8.4 リリース成果物

| 成果物 | 責任者 | 期限 | 内容 | 状態 |
|-------|--------|------|------|------|
| **App Store申請資料** | PM, デザイナー | Phase 2 Week 15 | スクリーンショット、説明文、プロモーション画像 | 🔄 作成予定 |
| **Google Play申請資料** | PM, デザイナー | Phase 2 Week 15 | ストアリスティング | 🔄 作成予定 |
| **リリースノート** | PM | Phase 2 Week 16 | 新機能、改善点、既知の問題 | 🔄 作成予定 |
| **ユーザーマニュアル** | PM | Phase 2 Week 16 | 基本操作、FAQ | 🔄 作成予定 |
| **公式Webサイト** | デザイナー, FE | Phase 2 Week 16 | サービス紹介、利用規約、プライバシーポリシー | 🔄 作成予定 |
| **プレスリリース** | PM | Phase 2 Week 16 | リリース告知 | 🔄 作成予定 |

### 8.5 運用成果物

| 成果物 | 責任者 | 期限 | 内容 | 状態 |
|-------|--------|------|------|------|
| **運用マニュアル** | BE | Phase 2 Week 16 | デプロイ手順、監視、トラブルシューティング | 🔄 作成予定 |
| **Looker Studioダッシュボード** | BE | Phase 2 Week 12 | DAU、セッション数、データ品質指標 | 🔄 作成予定 |
| **アラート設定** | BE | Phase 2 Week 10 | Cloud Monitoring、Slack通知 | 🔄 作成予定 |
| **バックアップ・リストア手順** | BE | Phase 2 Week 10 | Firestore、BigQueryの復旧手順 | 🔄 作成予定 |

---

## 9. Firebase + GCP ハイブリッド構成

### 9.1 アーキテクチャ概要

```
┌─────────────────────────────────────────────────────────────────┐
│                          Flutter App                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ MediaPipe    │  │ Firestore    │  │ Firebase     │          │
│  │ Pose         │  │ Client SDK   │  │ Auth         │          │
│  │ (On-Device)  │  │              │  │              │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                          Firebase                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ Authentication│ │ Firestore     │  │ Cloud        │          │
│  │ (JWT)        │  │ (NoSQL DB)    │  │ Functions    │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ Cloud        │  │ FCM          │  │ Cloud        │          │
│  │ Storage      │  │ (Push Notify)│  │ Scheduler    │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼ (BigQuery Export)
┌─────────────────────────────────────────────────────────────────┐
│                      Google Cloud Platform                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ BigQuery     │  │ Cloud        │  │ Looker       │          │
│  │ (DWH)        │  │ Logging      │  │ Studio       │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ Cloud        │  │ Security     │  │ Cloud        │          │
│  │ Monitoring   │  │ Command Ctr  │  │ IAM          │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
```

### 9.2 データフロー

#### リアルタイムデータフロー(Firestore)

```
Flutter App → Firestore Client SDK → Firestore
         ↑                                ↓
         └────── リアルタイム更新 ──────────┘
```

**用途**: ユーザープロフィール、トレーニング履歴、設定、リアルタイム同期

**法的根拠**: GDPR第6条1項(b)契約の履行

#### 分析データフロー(BigQuery)

```
Flutter App → Cloud Functions → BigQuery
         ↑                         ↓
         └── Looker Studio ←───────┘
```

**用途**: 骨格座標データ、セッション統計、ML学習用データ

**法的根拠**: GDPR第6条1項(f)正当な利益(プライバシーポリシーv3.1第5条)

### 9.3 BigQuery連携

#### 9.3.1 Firestore to BigQuery Export

| 項目 | 内容 | 法的根拠 |
|-----|------|---------|
| **Export方法** | Firebase Extensions: Export Collections to BigQuery | - |
| **Export頻度** | リアルタイム(変更検知) | - |
| **Export対象** | sessions, users(プロフィール変更のみ) | プライバシーポリシー第5.2条 |
| **特記事項** | 個人識別情報は除外、ユーザーIDは仮名化 | プライバシーポリシー第8.3条 |

#### 9.3.2 Cloud Functions to BigQuery

| 項目 | 内容 | 法的根拠 |
|-----|------|---------|
| **Export方法** | Cloud Functions から BigQuery Client Library使用 | - |
| **Export頻度** | セッション完了時 | - |
| **Export対象** | 骨格座標データ、セッションメタデータ | プライバシーポリシー第5.1条 |
| **特記事項** | バッチ処理で効率化、ユーザーIDは仮名化 | プライバシーポリシー第8.3条 |

#### 9.3.3 BigQueryテーブル設計

```sql
-- セッションテーブル
CREATE TABLE `project.dataset.sessions` (
  session_id STRING,
  user_id STRING,  -- 仮名化(SHA-256)
  exercise_id STRING,
  rep_count INT64,
  duration INT64,
  score FLOAT64,
  created_at TIMESTAMP,
  metadata JSON
)
PARTITION BY DATE(created_at)
CLUSTER BY user_id, exercise_id;

-- 骨格座標テーブル
CREATE TABLE `project.dataset.pose_landmarks` (
  session_id STRING,
  timestamp TIMESTAMP,
  frame_number INT64,
  landmarks ARRAY<STRUCT<x FLOAT64, y FLOAT64, z FLOAT64, visibility FLOAT64>>,
  metadata JSON
)
PARTITION BY DATE(timestamp)
CLUSTER BY session_id;
```

**プライバシー保護**(プライバシーポリシーv3.1第8条):
- ユーザーIDは仮名化(SHA-256)
- 個人識別情報は含まない
- アクセス制御(Cloud IAM)
- 暗号化保存(AES-256)

### 9.4 コスト管理

#### MVP期間中の想定コスト

| サービス | 無料枠 | 想定使用量 | 想定コスト |
|---------|--------|-----------|-----------|
| **Firestore** | 読み取り50,000/日 | 30,000/日 | $0 |
| **Cloud Functions** | 125,000/月 | 100,000/月 | $0 |
| **BigQuery Storage** | 10GB | 5GB | $0 |
| **BigQuery Query** | 1TB/月 | 100GB/月 | $0 |
| **Cloud Logging** | 50GB/月 | 10GB/月 | $0 |
| **合計** | - | - | **$0/月** |

**Phase 3以降の想定コスト**: 月額$50-100

---

## 10. まとめ

### 10.1 v3.1での主な変更点

✅ **利用規約・プライバシーポリシーとの整合性確保**:
- すべての用語、表現を利用規約v3.1、プライバシーポリシーv3.1に完全準拠
- 法的根拠を各機能要件に明記
- GDPRの具体的な条項を参照

✅ **薬機法対応の強化**:
- 表現統一ガイドライン(v3.1完全版)
- すべてのUIで「参考」「確認補助」等の表現に統一
- 医療機器でない旨を明確化
- 利用規約第3.3条と完全一致

✅ **GDPR/EDPB Guidelines完全準拠**:
- 同意管理(EDPB Guidelines 05/2020準拠)
- データポータビリティ(GDPR第20条)
- 忘れられる権利(GDPR第17条)
- データ処理記録(ROPA - GDPR第30条)
- プライバシーバイデザイン(GDPR第25条)
- プライバシーポリシー第9条と完全一致

✅ **技術的保護措置の詳細化**:
- TLS 1.3、AES-256暗号化(プライバシーポリシー第8.4条)
- Firebase Security Rulesの具体的な実装
- Cloud IAMによるアクセス制御(プライバシーポリシー第8.2条)
- オンデバイス処理(プライバシーポリシー第8.1条)
- 仮名化(プライバシーポリシー第8.3条)

✅ **Firebase + GCP ハイブリッド構成**:
- Firestoreでリアルタイムデータ管理
- BigQueryでデータ分析・ML準備
- Looker Studioでダッシュボード
- プライバシーポリシー第7.2条準拠

✅ **ML移行戦略の明確化**:
- Phase 1-2: MediaPipe Pose(ルールベース)
- Phase 3: データ蓄積期(10,000セッション)
- Phase 4: ML移行期(TensorFlow Lite)
- Phase 5: 高度化期(個人差対応)

✅ **データ収集機能の追加**:
- 骨格座標データ収集(FR-028、プライバシーポリシー第5.1条)
- セッションメタデータ収集(FR-029、プライバシーポリシー第5.2条)
- データ品質管理

✅ **リスク管理の強化**:
- 12個のリスクを特定
- 各リスクに対する具体的な対応計画
- リスク監視プロセスの定義
- 法的リスク(GDPR、薬機法)の詳細な対策

---

### 10.2 この要件定義書により実現できること

✅ **明確なスコープ**: MVP(Phase 1-2)で提供する機能を明確化
✅ **チーム体制**: 5名のチーム構成と役割分担を定義
✅ **機能要件**: 31個の機能要件を詳細に定義
✅ **非機能要件**: パフォーマンス、セキュリティ、法令遵守を明確化
✅ **法的対応**: 利用規約v3.1、プライバシーポリシーv3.1との完全な整合性
✅ **GDPR準拠**: すべての機能がGDPR/EDPB Guidelinesに準拠
✅ **薬機法対応**: 表現統一により医療機器と誤認されるリスクを排除
✅ **リスク管理**: 12個の主要リスクと対策を定義
✅ **成果物**: 設計書、実装、テスト、リリースの成果物を明確化
✅ **技術戦略**: Firebase + GCP + ML移行戦略を明確化

---

### 10.3 次のステップ

この要件定義書v3.1に基づき、以下のドキュメントを作成します:

1. **システムアーキテクチャ設計書 v3.1**
2. **Firestoreデータベース設計書 v3.1**
3. **BigQuery設計書 v3.1**
4. **API設計書(Firebase Functions) v3.1**
5. **画面遷移図 + ワイヤーフレーム v3.1**
6. **5種目のフォーム確認ロジック詳細 v3.1**
7. **データ処理記録(ROPA) v1.0**
8. **セキュリティポリシー v1.0**
9. **開発タスク詳細 + スケジュール v3.1**

---

**完成したドキュメント(v3.1)**:
- ✅ 要件定義書 v3.1(本ドキュメント)
- ✅ 利用規約 v3.1
- ✅ プライバシーポリシー v3.1

**残りのドキュメント(Phase 1で作成)**:
- 🔄 システムアーキテクチャ設計書 v3.1
- 🔄 Firestoreデータベース設計書 v3.1
- 🔄 BigQuery設計書 v3.1
- 🔄 API設計書(Firebase Functions) v3.1
- 🔄 画面遷移図 + ワイヤーフレーム v3.1
- 🔄 5種目のフォーム確認ロジック詳細 v3.1
- 🔄 データ処理記録(ROPA) v1.0
- 🔄 セキュリティポリシー v1.0
- 🔄 開発タスク詳細 + スケジュール v3.1

---

**レビューポイント**:
1. 薬機法対応の表現は適切か? → 利用規約v3.1第1.4条と完全一致
2. GDPR/EDPB Guidelines準拠は十分か? → プライバシーポリシーv3.1と完全一致
3. Firebase + GCP構成は実現可能か? → 技術的に問題なし
4. リスク対応計画は具体的か? → 12個のリスクに詳細な対策
5. MVP期間(0-4ヶ月)で実現可能なスコープか? → 31機能要件、32非機能要件

---

**Document Version**: v3.1 (Part 2/2)
**Last Updated**: 2025年11月21日
**Author**: Project Team
**Approved by**: (承認待ち)

---

## 付録: 主要な参照ドキュメント

### A. 利用規約v3.1との対応表

| 要件定義書の箇所 | 利用規約v3.1の参照 |
|-----------------|-------------------|
| 1.2.2 重要な制限事項 | 第3.3条 |
| 1.2.3 本サービスの位置づけ | 第3.4条 |
| 1.2.4 年齢制限 | 第4.1条、第4.2条 |
| 1.4 薬機法対応 | 第1.2条、第1.4条 |
| FR-001 認証 | 第5条 |
| FR-004 フォーム確認補助 | 第3.2条 |
| FR-020 課金 | 第6条 |

### B. プライバシーポリシーv3.1との対応表

| 要件定義書の箇所 | プライバシーポリシーv3.1の参照 |
|-----------------|---------------------------|
| 1.6.3 データ収集戦略 | 第4条、第5条 |
| NFR-009 通信暗号化 | 第8.4条 |
| NFR-010 データ暗号化 | 第8.4条 |
| NFR-011 認証 | 第8.2条 |
| NFR-012 アクセス制御 | 第8.2条 |
| NFR-015 オンデバイス処理 | 第8.1条 |
| NFR-016 仮名化 | 第8.3条 |
| FR-024 同意管理 | 第9.1条 |
| FR-025 データ削除 | 第9.6条 |
| FR-026 データ訂正 | 第9.2条 |
| FR-027 データアクセス | 第9.3条、第9.5条 |
| FR-028 骨格座標データ収集 | 第5.1条 |
| FR-029 セッションメタデータ収集 | 第5.2条 |

### C. GDPRとの対応表

| 要件定義書の箇所 | GDPR条項 |
|-----------------|---------|
| NFR-019 同意管理 | 第7条 |
| NFR-020 データ侵害通知 | 第33条、第34条 |
| FR-024 同意管理 | 第7条 |
| FR-025 データ削除 | 第17条 |
| FR-026 データ訂正 | 第16条 |
| FR-027 データアクセス | 第15条、第20条 |
| NFR-015 オンデバイス処理 | 第25条(データ保護バイデザイン) |
| NFR-016 仮名化 | 第4条5項、第32条 |

---

**以上**
