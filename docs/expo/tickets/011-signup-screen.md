# 011 新規登録画面実装

## 概要

新規ユーザーがアカウントを作成するための画面を実装します。2ステップ構成で、最初にメール/パスワードを入力し、次にプロフィール情報を入力する流れです。

## Phase

Phase 1（基盤構築）

## 依存チケット

- 004: Firebase Authentication設定
- 007: スプラッシュ画面実装
- 010: ログイン画面実装

## 要件

### ステップ1: 認証情報入力

- メールアドレス入力フィールド
- パスワード入力フィールド（8文字以上128文字以下、英字と数字を含む）
- パスワード確認入力フィールド
- 名前（ニックネーム）入力フィールド（1〜20文字）
- 「Googleで登録」ボタン
- 「次へ」ボタン

### ステップ2: 身体情報入力

- 生年月日入力（必須、13歳以上）
- 性別選択（任意、男性/女性/その他/回答しない）
- 身長入力（任意、100〜250cm）
- 体重入力（任意、30〜200kg）
- 運動経験選択（任意、初心者/中級者/上級者）
- 目標選択（任意、ダイエット/筋力アップ/健康維持/体力向上/その他）
- 「登録完了」ボタン

### パスワード要件の表示

- パスワード入力時に要件を視覚的に表示する
  - 8文字以上128文字以下
  - 英字を含む
  - 数字を含む
- 満たした要件にはチェックマークを表示

### バリデーション

| フィールド | 検証内容 | 必須 |
|----------|---------|------|
| メールアドレス | 形式チェック、重複チェック | はい |
| パスワード | 8〜128文字、英数字を含む | はい |
| パスワード確認 | パスワードと一致 | はい |
| 名前 | 1〜20文字 | はい |
| 生年月日 | 13歳以上（EEAユーザーは16歳以上） | はい |
| 性別 | 選択肢から選択 | いいえ |
| 身長 | 100〜250cm | いいえ |
| 体重 | 30〜200kg | いいえ |
| 運動経験 | 選択肢から選択 | いいえ |
| 目標 | 選択肢から選択 | いいえ |

### 画面遷移

- ステップ1完了 → ステップ2へ
- ステップ2完了（登録成功後） → 利用規約同意画面へ
- 「戻る」ボタン → 前のステップまたはログイン画面へ

### エラーハンドリング

- メールアドレス重複エラーの表示
- パスワード要件不足エラーの表示
- ネットワークエラー時の再試行オプション

## 受け入れ条件

- [ ] ステップ1でメールアドレス、パスワード、名前を入力できる
- [ ] パスワード要件がリアルタイムで確認できる
- [ ] パスワード確認が一致しない場合にエラーが表示される
- [ ] Googleアカウントで登録できる
- [ ] ステップ2で生年月日（必須）と任意項目を入力できる
- [ ] 13歳未満のユーザーは登録できない
- [ ] 登録完了後、Firebase Authにアカウントが作成される
- [ ] 登録完了後、Firestoreにユーザードキュメントが作成される
- [ ] ユーザードキュメントの`tosAccepted`と`ppAccepted`が初期値`false`で作成される
- [ ] 登録完了後、利用規約同意画面に自動遷移する
- [ ] エラーメッセージが日本語で表示される
- [ ] ローディング状態が適切に表示される

## 参照ドキュメント

- [要件定義書 Part 1](../specs/01_要件定義書_Expo版_v1_Part1.md) - FR-001, FR-002
- [要件定義書 Part 5](../specs/05_要件定義書_Expo版_v1_Part5.md) - データベース設計
- [画面遷移図・ワイヤーフレーム](../specs/07_画面遷移図_ワイヤーフレーム_v1_0.md) - セクション3.4

## 技術詳細

### Expo Router パス

`/auth/register`

### 使用ライブラリ

- `react-native-paper`: TextInput, Button, HelperText
- `firebase/auth`: createUserWithEmailAndPassword, signInWithCredential
- `firebase/firestore`: setDoc

### Zustand Store連携

```typescript
// 登録完了後に認証ストアを更新
useAuthStore.getState().setUser(newUser);
```

### Firestoreドキュメント作成

```typescript
// /users/{userId} に作成するドキュメント
{
  userId: string,
  email: string,
  displayName: string,
  birthday: Date,
  gender?: 'male' | 'female' | 'other' | 'prefer_not_to_say',
  height?: number,
  weight?: number,
  fitnessLevel?: 'beginner' | 'intermediate' | 'advanced',
  goals?: string,
  tosAccepted: false,
  ppAccepted: false,
  subscriptionStatus: 'free',
  createdAt: serverTimestamp(),
  updatedAt: serverTimestamp(),
  deletionScheduled: false
}
```

## 注意事項

- パスワードは画面上でマスク表示すること
- パスワードの「表示/非表示」切り替えボタンを設けること
- 入力中のデータは画面遷移時に保持すること（ステップ間）
- Google登録を選択した場合はステップ1の入力をスキップ
- 確認メールは送信されるが、メール認証は任意（未確認でもアプリ利用可能）

## 見積もり

- 想定工数: 2〜3日

## 進捗

- [ ] 未着手
