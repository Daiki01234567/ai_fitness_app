# 014 プロフィール画面実装

## 概要

ユーザーのプロフィール情報を表示・編集するための画面を実装します。基本情報の確認・変更、統計情報の表示、同意状況の確認、データ管理機能へのアクセスを提供します。

## Phase

Phase 1（基盤構築）

## 依存チケット

- 007: スプラッシュ画面実装
- 015: ボトムナビゲーション実装

## 要件

### 画面構成

#### プロフィールヘッダー
- プロフィール画像（アバター）
- ユーザー名（ニックネーム）
- 編集アイコンボタン

#### 基本情報セクション
以下の項目を表示・編集可能:
- ニックネーム（1〜20文字）
- メールアドレス（表示のみ、変更は別途認証が必要）
- 身長（cm）
- 体重（kg）
- 生年月日（表示のみ）
- 性別
- 運動経験レベル
- 目標

#### 統計情報セクション（読み取り専用）
- 総セッション数
- 総トレーニング時間
- 平均スコア

#### 同意状況セクション
- 利用規約の同意状態（チェックマーク付き）
- プライバシーポリシーの同意状態（チェックマーク付き）
- 同意解除リンク

#### データ管理セクション
- 「データをエクスポート」ボタン（Phase 2で実装）
- 「アカウントを削除」ボタン（Phase 2で実装）

#### 設定へのリンク
- 「設定」ボタン → 設定画面へ

### 編集機能

- 各フィールドをタップすると編集モードに切り替わる
- 編集中は保存・キャンセルボタンを表示
- バリデーションエラーは即座に表示
- 保存成功時はトースト通知

### 同意解除機能

- 「同意を解除」をタップすると確認ダイアログを表示
- ダイアログ内容:
  - 「同意を解除しますか?」
  - 「同意を解除すると、サービスを利用できなくなります。」
  - 「この操作を行うと、自動的にログアウトされます。」
- キャンセル → 画面に戻る
- 確認 → 同意解除処理 → ログアウト → ログイン画面へ

## 受け入れ条件

- [ ] プロフィール画像が表示される（デフォルトアバターも含む）
- [ ] ユーザー名が表示される
- [ ] 基本情報（身長、体重、性別、運動経験、目標）が表示される
- [ ] 各フィールドの編集ができる
- [ ] 編集内容がFirestoreに保存される
- [ ] 統計情報が表示される（Phase 1ではモックまたは0表示）
- [ ] 同意状況が表示される
- [ ] 同意解除をタップすると確認ダイアログが表示される
- [ ] 同意解除後、ログアウトされログイン画面に遷移する
- [ ] データ管理ボタンが表示される（Phase 2で機能実装）
- [ ] 設定画面へのリンクが動作する
- [ ] ボトムナビゲーションでプロフィールタブがアクティブ
- [ ] ローディング状態が適切に表示される
- [ ] エラーメッセージが日本語で表示される

## 参照ドキュメント

- [要件定義書 Part 1](../specs/01_要件定義書_Expo版_v1_Part1.md) - FR-002, FR-002-1, FR-014
- [要件定義書 Part 5](../specs/05_要件定義書_Expo版_v1_Part5.md) - usersコレクション
- [画面遷移図・ワイヤーフレーム](../specs/07_画面遷移図_ワイヤーフレーム_v1_0.md) - セクション3.12

## 技術詳細

### Expo Router パス

`/(tabs)/profile`

### 使用ライブラリ

- `react-native-paper`: Avatar, Card, List, TextInput, Button, Portal, Dialog
- `firebase/firestore`: getDoc, updateDoc
- `firebase/auth`: signOut

### 編集可能フィールドのバリデーション

| フィールド | バリデーション |
|----------|--------------|
| ニックネーム | 1〜20文字 |
| 身長 | 100〜250cm、数値 |
| 体重 | 30〜200kg、数値 |
| 性別 | male/female/other/prefer_not_to_say |
| 運動経験 | beginner/intermediate/advanced |
| 目標 | 最大100文字 |

### Firestore更新

```typescript
// プロフィール更新
await updateDoc(doc(db, 'users', userId), {
  displayName: newName,
  height: newHeight,
  weight: newWeight,
  // ...
  updatedAt: serverTimestamp()
});
```

### 同意解除処理

```typescript
// 同意解除
await updateDoc(doc(db, 'users', userId), {
  tosAccepted: false,
  ppAccepted: false,
  updatedAt: serverTimestamp()
});

// ログアウト
await signOut(auth);

// ログイン画面へ遷移
router.replace('/auth/login');
```

## 注意事項

- 削除予約中（`deletionScheduled: true`）のユーザーは編集不可
- メールアドレスの変更は別途メール認証が必要なため、この画面では表示のみ
- 統計情報はPhase 2でトレーニング機能実装後に正確な値が表示される
- データエクスポート・アカウント削除はPhase 2で実装（ボタンのみ先に配置）
- プロフィール画像のアップロード機能は将来対応（デフォルトアバターを使用）

## 見積もり

- 想定工数: 2〜3日

## 進捗

- [ ] 未着手
