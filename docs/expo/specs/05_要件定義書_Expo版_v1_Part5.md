# 要件定義書（Expo版）v1.0 - Part 5: データベース・API・セキュリティ設計

**プロジェクト名**: AIフィットネスアプリ（Expo版）
**バージョン**: 1.0.4
**最終更新日**: 2025年12月9日
**対象フェーズ**: Phase 1-2（MVP）

---

## 目次

1. [データベース設計](#1-データベース設計)
2. [API設計](#2-api設計)
3. [セキュリティ対策](#3-セキュリティ対策)
4. [GDPR対応](#4-gdpr対応)
5. [薬機法対応](#5-薬機法対応)

---

## 1. データベース設計

### 1.1 データベースの概要

本アプリでは、Cloud Firestore（クラウド・ファイアストア）というNoSQLデータベースを使用します。

**NoSQLデータベースとは？**
- データを「ドキュメント」という単位で保存する方式
- 表計算ソフトのような行と列ではなく、JSONという形式でデータを整理
- 柔軟にデータ構造を変更でき、高速な読み書きが可能

### 1.2 コレクション一覧

「コレクション」とは、似たようなデータをまとめて入れる「フォルダ」のようなものです。

| コレクション名 | 説明 | 誰がアクセスできるか |
|--------------|------|-------------------|
| **users** | ユーザーの基本情報 | 本人のみ |
| **sessions** | トレーニングの記録 | 本人のみ |
| **frames** | 1フレームごとの骨格データ | 本人のみ（読み取りのみ） |
| **consents** | 利用規約への同意履歴 | 本人のみ（読み取りのみ） |
| **dataDeletionRequests** | アカウント削除リクエスト | 本人のみ（読み取りのみ） |
| **bigquerySyncFailures** | データ同期の失敗ログ | 管理者のみ |
| **securityIncidents** | セキュリティに関する問題の記録 | 管理者のみ |

### 1.3 主要コレクションの詳細

#### 1.3.1 users コレクション

ユーザーの基本的な情報を保存するコレクションです。

**保存場所**: `/users/{userId}`

| フィールド名 | 説明 | 必須 | 例 |
|------------|------|-----|---|
| userId | ユーザーを識別するID | はい | "abc123xyz" |
| email | メールアドレス | はい | "user@example.com" |
| displayName | 表示名（ニックネーム） | いいえ | "山田太郎" |
| photoURL | プロフィール画像のURL | いいえ | "https://..." |
| height | 身長（cm） | いいえ | 170 |
| weight | 体重（kg） | いいえ | 65 |
| birthday | 生年月日 | いいえ | 1990-01-15 |
| gender | 性別 | いいえ | "male" / "female" / "other" |
| fitnessLevel | 運動レベル | いいえ | "beginner" / "intermediate" / "advanced" |
| tosAccepted | 利用規約に同意したか | はい | true |
| ppAccepted | プライバシーポリシーに同意したか | はい | true |
| subscriptionStatus | 課金状態 | はい | "free" / "premium" / "trial" |
| createdAt | アカウント作成日時 | はい | 2025-01-01 10:00:00 |
| updatedAt | 最終更新日時 | はい | 2025-01-15 15:30:00 |
| deletionScheduled | 削除予約されているか | はい | false |

**重要なポイント**:
- 利用規約とプライバシーポリシーへの同意がないとアカウントを使えません
- 身長・体重などの身体情報は任意入力です
- 削除予約がされると、30日後にアカウントが完全に削除されます

#### 1.3.2 sessions コレクション

トレーニングの記録を保存するコレクションです。

**保存場所**: `/users/{userId}/sessions/{sessionId}`

| フィールド名 | 説明 | 必須 | 例 |
|------------|------|-----|---|
| sessionId | セッションを識別するID | はい | "session_abc123" |
| exerciseType | 運動の種類 | はい | "squat" / "pushup" / "armcurl" |
| repCount | 回数（レップ数） | はい | 15 |
| setCount | セット数 | はい | 3 |
| averageScore | 平均スコア（0-100点） | はい | 85 |
| duration | 運動時間（秒） | はい | 180 |
| calories | 消費カロリー（推定） | いいえ | 50 |
| startedAt | 開始日時 | はい | 2025-01-15 10:00:00 |
| endedAt | 終了日時 | はい | 2025-01-15 10:03:00 |
| deviceInfo | デバイス情報 | はい | { model: "iPhone 14", os: "iOS 17" } |

**運動の種類（exerciseType）**:
- `squat`: スクワット
- `pushup`: プッシュアップ（腕立て伏せ）
- `armcurl`: アームカール（力こぶを作る運動）
- `sideraise`: サイドレイズ（腕を横に上げる運動）
- `shoulderpress`: ショルダープレス（腕を上に押し上げる運動）

#### 1.3.3 frames コレクション

カメラで撮影した各フレーム（1秒間に30回程度）の骨格データを保存します。

**保存場所**: `/users/{userId}/sessions/{sessionId}/frames/{frameId}`

| フィールド名 | 説明 | 必須 | 例 |
|------------|------|-----|---|
| frameId | フレームを識別するID | はい | "frame_001" |
| frameNumber | フレーム番号 | はい | 1 |
| timestamp | 撮影時刻 | はい | 2025-01-15 10:00:01.500 |
| landmarks | 33個の関節位置データ | はい | [{ x: 0.5, y: 0.3, z: 0.1, visibility: 0.95 }, ...] |
| score | このフレームのスコア | はい | 90 |

**landmarksの説明**:
- MediaPipeが検出する33個の身体の関節点（ランドマーク）の位置情報
- 各関節には x座標、y座標、z座標（奥行き）、visibility（見えやすさ）が含まれます
- これらのデータはスマートフォン内で処理され、映像自体はサーバーに送られません

#### 1.3.4 consents コレクション

利用規約やプライバシーポリシーへの同意履歴を記録します。

**保存場所**: `/consents/{consentId}`

| フィールド名 | 説明 | 必須 | 例 |
|------------|------|-----|---|
| userId | ユーザーID | はい | "abc123xyz" |
| consentType | 同意の種類 | はい | "tos" / "privacy_policy" |
| version | 同意したバージョン | はい | "v3.2" |
| accepted | 同意したかどうか | はい | true |
| consentedAt | 同意した日時 | はい | 2025-01-01 10:00:00 |
| ipAddress | 同意時のIPアドレス（ハッシュ化） | はい | "a1b2c3..." |
| userAgent | ブラウザ・アプリ情報 | はい | "AIFitness App/1.0.0" |

**なぜ同意履歴を残すのか？**:
- GDPR（ヨーロッパのプライバシー法）で、同意の記録を保持することが義務付けられています
- いつ、どのバージョンに同意したかを証明できるようにするためです

#### 1.3.5 dataDeletionRequests コレクション

アカウント削除リクエストを管理します。

**保存場所**: `/dataDeletionRequests/{requestId}`

| フィールド名 | 説明 | 必須 | 例 |
|------------|------|-----|---|
| userId | ユーザーID | はい | "abc123xyz" |
| status | 削除リクエストの状態 | はい | "pending" / "completed" / "cancelled" |
| requestedAt | リクエスト日時 | はい | 2025-01-01 10:00:00 |
| scheduledDeletionDate | 削除予定日 | はい | 2025-01-31 10:00:00 |
| completedAt | 削除完了日時 | いいえ | 2025-01-31 10:00:05 |

**30日間の猶予期間について**:
- 削除リクエスト後、30日間はアカウントを復活できます
- この期間中もデータをエクスポート（取り出し）できます
- 30日後に全てのデータが完全に削除されます

#### 1.3.6 bigquerySyncFailures コレクション

分析用データベース（BigQuery）へのデータ送信が失敗した場合の記録です。

**保存場所**: `/bigquerySyncFailures/{failureId}`

| フィールド名 | 説明 | 必須 | 例 |
|------------|------|-----|---|
| originalData | 元のデータ | はい | { ... } |
| errorMessage | エラーメッセージ | はい | "Connection timeout" |
| retryCount | 再試行した回数 | はい | 3 |
| maxRetries | 最大再試行回数 | はい | 10 |
| failedAt | 失敗日時 | はい | 2025-01-15 10:00:00 |
| resolvedAt | 解決日時 | いいえ | 2025-01-15 10:05:00 |

#### 1.3.7 securityIncidents コレクション

セキュリティに関する問題が発生した場合の記録です。

**保存場所**: `/securityIncidents/{incidentId}`

| フィールド名 | 説明 | 必須 | 例 |
|------------|------|-----|---|
| incidentType | インシデントの種類 | はい | "unauthorized_access" / "data_breach" |
| severity | 重大度 | はい | "low" / "medium" / "high" / "critical" |
| description | 詳細説明 | はい | "不正なログイン試行を検出" |
| affectedUsers | 影響を受けたユーザー数 | はい | 0 |
| detectedAt | 検出日時 | はい | 2025-01-15 10:00:00 |
| resolvedAt | 解決日時 | いいえ | 2025-01-15 12:00:00 |
| notificationStatus | 通知状態 | はい | "notified" / "pending" |

### 1.4 データ構造の図

```
users/
  └── {userId}/                    ... ユーザー情報
        ├── sessions/              ... トレーニング記録
        │     └── {sessionId}/
        │           └── frames/    ... 骨格データ
        │                 └── {frameId}/
        ├── settings/              ... ユーザー設定
        └── subscriptions/         ... 課金情報

consents/                          ... 同意履歴
  └── {consentId}/

dataDeletionRequests/              ... 削除リクエスト
  └── {requestId}/

bigquerySyncFailures/              ... 同期失敗ログ
  └── {failureId}/

securityIncidents/                 ... セキュリティ記録
  └── {incidentId}/
```

---

## 2. API設計

### 2.1 APIとは

API（Application Programming Interface）とは、アプリとサーバーが「会話」するための仕組みです。例えるなら、レストランで客（アプリ）がウェイター（API）に注文し、キッチン（サーバー）から料理を受け取るようなものです。

本アプリでは、Firebase Cloud Functionsを使ってAPIを提供します。

### 2.2 API一覧

#### 2.2.1 認証関連API

| API名 | 説明 | 認証 |
|------|------|------|
| **auth_signUp** | 新しいアカウントを作成する | 不要 |
| **auth_onSignIn** | ログイン時の処理を行う | 必要 |

**auth_signUp の詳細**:
- メールアドレスとパスワードを受け取り、新しいアカウントを作成
- パスワードは8文字以上128文字以下、英字と数字を含む必要がある（記号は不要）
- 利用規約とプライバシーポリシーへの同意が必須
- アカウント作成と同時にユーザー情報をデータベースに保存
- 確認メールは送信されるが、メール認証は任意（未確認でもアプリ利用可能）

**auth_onSignIn の詳細**:
- ログイン成功時に呼び出される
- 最終ログイン日時を更新
- 削除予約中のユーザーかどうかを確認

#### 2.2.2 ユーザー管理API

| API名 | 説明 | 認証 |
|------|------|------|
| **user_getProfile** | プロフィール情報を取得する | 必要 |
| **user_updateProfile** | プロフィール情報を更新する | 必要 |
| **user_updateConsent** | 利用規約への同意状態を更新する | 必要 |
| **user_revokeConsent** | 同意を撤回する（アプリ利用停止） | 必要 |

**user_getProfile の詳細**:
- 自分のプロフィール情報を取得
- 他人の情報は取得できない（自分のデータのみ）

**user_updateProfile の詳細**:
- ニックネーム、身長、体重などを更新可能
- メールアドレスの変更は別途認証が必要
- 削除予約中のユーザーは更新できない

**user_revokeConsent の詳細**:
- 同意を撤回すると即座にログアウトされる
- 30日間の猶予期間後にデータが削除される

#### 2.2.3 トレーニング関連API

| API名 | 説明 | 認証 |
|------|------|------|
| **training_createSession** | 新しいトレーニングセッションを記録する | 必要 |
| **training_getSessions** | トレーニング履歴を取得する | 必要 |
| **training_getStatistics** | 統計データを取得する | 必要 |

**training_createSession の詳細**:
- トレーニング終了後に呼び出す
- 運動の種類、回数、スコア、骨格データを保存
- 無料プランの場合、1日の利用回数制限をチェック

**training_getSessions の詳細**:
- 過去のトレーニング記録を日付順に取得
- ページネーション対応（大量データを少しずつ取得）

**training_getStatistics の詳細**:
- 期間を指定して統計データを取得
- 合計回数、平均スコア、継続日数などを計算

#### 2.2.4 GDPR対応API

| API名 | 説明 | 認証 |
|------|------|------|
| **gdpr_requestDataExport** | 自分のデータをエクスポート（取り出し）する | 必要 |
| **gdpr_requestAccountDeletion** | アカウント削除をリクエストする | 必要 |

**gdpr_requestDataExport の詳細**:
- 自分のすべてのデータをJSON形式で取得
- 1ヶ月に3回までリクエスト可能
- 処理に時間がかかる場合はメールで通知

**gdpr_requestAccountDeletion の詳細**:
- 削除リクエストを送信
- 30日間の猶予期間が設定される
- 猶予期間中はキャンセル可能

#### 2.2.5 課金関連API

**実装予定Phase**: **Phase 3**

| API名 | 説明 | 認証 |
|------|------|------|
| **subscription_getStatus** | 課金状態を確認する | 必要 |
| **subscription_createCheckout** | Stripe決済セッションを作成する | 必要 |
| **subscription_cancel** | サブスクリプションをキャンセルする | 必要 |

**subscription_getStatus の詳細**:
- 現在のプラン（無料/有料）を確認
- 有料プランの有効期限を確認
- Stripeと連携して最新の状態を取得（RevenueCatは代替）

**決済サービスの方針**:
| サービス | 役割 | 説明 |
|---------|------|------|
| **Stripe（メイン）** | 主要な決済手段 | Web版との統一、柔軟な価格設定 |
| **RevenueCat（代替）** | バックアップ | Stripe導入に問題が生じた場合の代替手段 |

**注意**: 課金関連APIはPhase 3で、Apple認証と同時に実装予定です。Phase 1-2ではすべての機能が無料で利用可能ですが、課金導線を見越した設計（UI枠の確保、ロジック準備）を行います。

#### 2.2.6 内部・管理用API

| API名 | 説明 | 認証 |
|------|------|------|
| **internal_syncToBigQuery** | データをBigQueryに同期する | 内部専用 |
| **admin_checkDLQ** | 失敗したタスクを確認する | 管理者のみ |

これらのAPIは内部処理用であり、一般ユーザーは直接呼び出しません。

### 2.3 APIの呼び出し方

```typescript
// 例: プロフィールを更新する
const result = await firebase.functions()
  .httpsCallable('user_updateProfile')({
    nickname: '山田太郎',
    height: 170,
    weight: 65
  });

if (result.data.success) {
  console.log('更新成功！');
} else {
  console.log('エラー:', result.data.error.message);
}
```

### 2.4 エラーの種類

APIでエラーが発生した場合、以下のコードが返されます:

| エラーコード | 意味 | 対処方法 |
|------------|------|---------|
| UNAUTHENTICATED | ログインが必要 | ログイン画面へ移動 |
| PERMISSION_DENIED | 権限がない | 自分のデータのみアクセス可能 |
| INVALID_ARGUMENT | 入力値が不正 | 入力内容を確認 |
| NOT_FOUND | データが見つからない | 正しいIDを確認 |
| RESOURCE_EXHAUSTED | 利用制限に達した | しばらく待ってから再試行 |
| INTERNAL | サーバーエラー | 時間をおいて再試行 |

### 2.5 レート制限（利用回数の制限）

不正利用やサーバー負荷を防ぐため、APIには利用回数の制限があります。

| API | 制限 | 期間 |
|-----|------|------|
| auth_signUp | 10回 | 1時間/IP |
| user_getProfile | 100回 | 1分/ユーザー |
| user_updateProfile | 50回 | 1時間/ユーザー |
| training_createSession | 100回 | 1日/ユーザー |
| gdpr_requestDataExport | 3回 | 1ヶ月/ユーザー |
| gdpr_requestAccountDeletion | 3回 | 1ヶ月/ユーザー |

制限を超えた場合は`RESOURCE_EXHAUSTED`エラーが返されます。

---

## 3. セキュリティ対策

### 3.1 通信の暗号化（TLS 1.3）

**TLS（Transport Layer Security）とは？**
- インターネット上でデータを送受信する際に、データを「暗号化」する技術
- 郵便物を鍵付きの箱に入れて送るようなイメージ

**本アプリでの実装**:
- すべての通信はHTTPS（TLS 1.3）で暗号化
- 古い暗号化方式（TLS 1.0, 1.1）は使用禁止
- 証明書ピンニングにより、偽サーバーへの接続を防止

### 3.2 データの暗号化（AES-256）

**AES-256とは？**
- データを保存する際に使う暗号化の方式
- 256ビットの鍵を使用し、現在最も安全とされる暗号化方式の一つ

**本アプリでの実装**:
- Firestoreに保存されるデータは自動的に暗号化（Google管理）
- バックアップデータも暗号化して保存
- 暗号鍵はGoogleのセキュアなシステムで管理

### 3.3 認証（Firebase Authentication）

**Firebase Authenticationの特徴**:
- Googleが提供する安全な認証システム
- パスワードは安全にハッシュ化（元に戻せない形に変換）して保存
- 複数の認証方法をサポート

**対応している認証方法**:
1. **メール/パスワード認証**: 最も基本的な方法
2. **Googleアカウント認証**: Googleアカウントでログイン
3. **Appleアカウント認証**: Apple IDでログイン

**セキュリティ機能**:
- ブルートフォース攻撃（総当たり攻撃）対策：5回失敗で30分ロック
- セッション管理：ログイン状態を安全に管理
- トークンの自動更新：1時間ごとに新しいトークンを発行

### 3.4 アクセス制御（Firestoreセキュリティルール）

**セキュリティルールとは？**
- 「誰が」「どのデータに」「何ができるか」を定義するルール
- データベースへの不正アクセスを防止

**基本原則**:
1. **デフォルト拒否**: 明示的に許可されていないアクセスはすべて拒否
2. **本人のみアクセス可能**: 他のユーザーのデータは見れない
3. **読み取り専用フィールド**: 同意情報など重要なフィールドはユーザーが直接変更できない

**実装例（わかりやすく説明）**:
```
ルール: ユーザーデータ
- 読み取り: 本人のみ許可
- 書き込み: 本人のみ許可（ただし削除予約中は禁止）
- 同意フィールド: ユーザーは変更不可（システムのみ変更可能）
```

### 3.5 レート制限（不正利用防止）

**レート制限とは？**
- 短時間に大量のリクエストを送ることを制限する仕組み
- サーバー攻撃や不正利用を防止

**制限の種類**:
1. **ユーザー単位**: 1人のユーザーが送れるリクエスト数を制限
2. **IP単位**: 1つのIPアドレスから送れるリクエスト数を制限
3. **グローバル**: システム全体のリクエスト数を制限

### 3.6 入力値の検証（バリデーション）

**バリデーションとは？**
- ユーザーからの入力が正しい形式かどうかをチェックする処理
- 不正なデータや攻撃を防止

**チェック項目の例**:
| 項目 | ルール |
|-----|-------|
| メールアドレス | 正しいメール形式か |
| パスワード | 8文字以上128文字以下、英字と数字を含むか（記号は不要） |
| ニックネーム | 1〜50文字以内か |
| 身長 | 100〜250cmの範囲内か |
| 体重 | 30〜300kgの範囲内か |
| 生年月日 | 13歳以上か |

### 3.7 セキュリティ対策一覧表

| 対策 | 説明 | 防ぐ脅威 |
|-----|------|---------|
| TLS 1.3 | 通信の暗号化 | 盗聴、中間者攻撃 |
| AES-256 | データの暗号化 | 情報漏洩 |
| Firebase Auth | 安全な認証 | なりすまし、不正ログイン |
| セキュリティルール | アクセス制御 | 不正アクセス |
| レート制限 | 利用回数制限 | DoS攻撃、総当たり攻撃 |
| 入力検証 | 入力値チェック | インジェクション攻撃 |

---

## 4. GDPR対応

### 4.1 GDPRとは

GDPR（General Data Protection Regulation）は、EU（ヨーロッパ連合）の個人情報保護法です。世界で最も厳しいプライバシー法の一つとされています。

**なぜ日本のアプリでもGDPR対応が必要？**
- EUに住んでいるユーザーがアプリを使う可能性がある
- GDPR違反には最大で年間売上の4%または2000万ユーロの罰金

### 4.2 ユーザーの権利

GDPRでは、ユーザーに以下の権利が保証されています:

| 権利 | 説明 | 本アプリでの対応 |
|-----|------|----------------|
| **アクセス権** | 自分のデータを見る権利 | gdpr_requestDataExport APIで対応 |
| **訂正権** | 間違ったデータを直す権利 | user_updateProfile APIで対応 |
| **削除権（忘れられる権利）** | データを削除してもらう権利 | gdpr_requestAccountDeletion APIで対応 |
| **データポータビリティ権** | データを持ち出す権利 | JSON形式でエクスポート可能 |
| **同意撤回権** | 同意をいつでも取り消せる権利 | user_revokeConsent APIで対応 |

### 4.3 同意の取得と管理

**同意取得のルール**:
1. **明確な同意**: チェックボックスで明示的に同意を取得
2. **事前の説明**: 何にデータを使うか説明してから同意を取得
3. **同意の記録**: いつ、誰が、どのバージョンに同意したか記録
4. **撤回の自由**: いつでも同意を撤回できる手段を提供

**同意が必要な項目**:
- 利用規約への同意（必須）
- プライバシーポリシーへの同意（必須）
- プッシュ通知の許可（任意）
- マーケティングメールの受信（任意）

### 4.4 データ削除の30日間猶予

**なぜ30日間の猶予があるのか？**
1. **誤操作防止**: うっかり削除ボタンを押してしまった場合に復活できる
2. **データエクスポート**: 削除前に自分のデータを取得する時間を確保
3. **法的要件**: GDPRでは「不当に遅滞なく」削除することが求められるが、合理的な猶予期間は認められる

**猶予期間中にできること**:
- データのエクスポート（取り出し）
- 削除のキャンセル
- 読み取り専用でアプリを利用（新規データ作成は不可）

### 4.5 データ侵害時の対応

**データ侵害（データブリーチ）とは？**
- 個人情報が流出したり、不正にアクセスされたりすること

**GDPRの義務**:
1. **72時間以内に当局へ通知**: 重大な侵害は監督機関に報告
2. **ユーザーへの通知**: 高リスクの場合は影響を受けたユーザーに通知
3. **記録の保持**: 侵害の内容と対応を記録

**本アプリでの対応**:
- securityIncidentsコレクションで全インシデントを記録
- 自動アラートで管理者に即時通知
- 対応手順書（ランブック）を準備

### 4.6 プライバシー・バイ・デザイン

**プライバシー・バイ・デザインとは？**
- システムを設計する段階からプライバシー保護を組み込む考え方

**本アプリでの実践**:
1. **データ最小化**: 必要最小限のデータのみ収集
2. **オンデバイス処理**: カメラ映像はサーバーに送信しない
3. **仮名化**: 分析用データは個人を特定できないよう変換
4. **デフォルトでプライバシー保護**: 初期設定で最もプライバシーが保護される状態

---

## 5. 薬機法対応

### 5.1 薬機法とは

薬機法（医薬品、医療機器等の品質、有効性及び安全性の確保等に関する法律）は、医薬品や医療機器を規制する日本の法律です。

**本アプリは医療機器ではありません**。そのため、薬機法の規制対象外ですが、誤解を防ぐため以下のルールを守ります。

### 5.2 使用禁止用語

**絶対に使ってはいけない言葉**:

| 禁止用語 | 理由 | 代替表現 |
|---------|------|---------|
| 治療 | 医療行為を暗示 | サポート、補助 |
| 診断 | 医療行為を暗示 | 確認、チェック |
| 治す | 医療行為を暗示 | 改善する、向上する |
| 医療 | 医療機器と誤解される | フィットネス、健康 |
| 処方 | 医療行為を暗示 | 提案、おすすめ |
| 予防 | 医療効果を暗示 | 習慣づくり |
| 病気 | 医療分野を暗示 | 体調、状態 |
| 症状 | 医療分野を暗示 | 違和感、状態 |

### 5.3 使用可能な表現

**安全に使える言葉**:
- フィットネス
- 運動
- トレーニング
- エクササイズ
- 健康維持
- 体力向上
- 姿勢改善
- フォーム確認
- 運動習慣

### 5.4 注意書きの記載

**アプリ内で表示する注意書き**:

```
【重要なお知らせ】
本アプリはフィットネス目的のアプリであり、医療機器ではありません。
診断、治療、病気の予防を目的としたものではありません。
健康上の問題がある場合は、医師にご相談ください。
```

**表示場所**:
- アプリ起動時（利用規約と一緒に）
- 設定画面
- トレーニング開始前

### 5.5 フォーム評価の表現

**避けるべき表現**:
- 「姿勢が正しいです」
- 「フォームが完璧です」
- 「これで怪我を防げます」

**推奨される表現**:
- 「良いフォームで運動できています」
- 「参考スコアは85点です」
- 「このポイントに注意するとより良くなるかもしれません」

### 5.6 免責事項

**利用規約に記載する免責事項**:

1. 本アプリのスコアや評価は参考情報であり、専門家の指導に代わるものではありません
2. 運動を行う際は、自己の責任において安全に注意してください
3. 体調が優れない場合は、運動を控えてください
4. 怪我や体調不良が発生しても、当社は責任を負いません
5. 健康上の不安がある場合は、医師に相談してから運動してください

---

## まとめ

本ドキュメントでは、AIフィットネスアプリ（Expo版）のデータベース設計、API設計、セキュリティ対策について説明しました。

**データベース設計のポイント**:
- 7つのコレクションでデータを管理
- ユーザーのプライバシーを最優先に設計
- 30日間の削除猶予期間でユーザーの権利を保護

**API設計のポイント**:
- 認証、ユーザー管理、トレーニング、GDPR対応、課金の5カテゴリ
- すべてのAPIで認証を必須化（一部除く）
- レート制限で不正利用を防止

**セキュリティ対策のポイント**:
- 多層防御（通信暗号化、データ暗号化、認証、アクセス制御）
- GDPR完全準拠
- 薬機法に配慮した表現ルール

---

**関連ドキュメント**:
- Part 1: プロジェクト概要
- Part 2: 機能要件
- Part 3: 非機能要件
- Part 4: UI/UX設計
- Part 6: 開発スケジュール（予定）

---

**変更履歴**:

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| 1.0 | 2025-12-08 | 初版作成 |
| 1.0.1 | 2025-12-08 | FR-001に基づき、パスワード要件（128文字以下、記号不要）とメール認証任意を追記 |
| 1.0.2 | 2025-12-09 | Phase構成変更に伴い、課金関連APIをPhase 4で実装と明記 |
| 1.0.3 | 2025-12-09 | リスク対応に基づく変更: (1) 課金関連APIをPhase 3に移動 (2) Stripe仕様統一、RevenueCat代替化を明記 (3) 課金API追加（subscription_createCheckout, subscription_cancel） |
| 1.0.4 | 2025-12-09 | 5種目の定義をPart1/Part4に統一（プランク、ランジ、デッドリフト→アームカール、サイドレイズ、ショルダープレス） |
