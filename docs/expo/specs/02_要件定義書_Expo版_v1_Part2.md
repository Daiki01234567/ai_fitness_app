# 要件定義書（Expo版）Part 2 v1.0

**プロジェクト名**: AIフィットネスアプリ（Expo版）
**バージョン**: 1.0.6
**最終更新日**: 2025年12月9日
**対象**: MVP Phase 1-2

---

## 目次

- [3. 機能要件一覧（続き）](#3-機能要件一覧続き)
- [4. 非機能要件一覧](#4-非機能要件一覧)

---

## 3. 機能要件一覧（続き）

### 3.1 通知機能（FR-017）

トレーニングの継続をサポートするための通知機能です。

| ID | 機能名 | 説明 | 実装状況 | Phase |
|----|--------|------|----------|-------|
| FR-017 | リマインダー通知 | 設定した時刻にトレーニングのリマインダーをプッシュ通知で送る機能です。「トレーニングの時間です！」のようなメッセージが届きます。 | 未実装 | Phase 2 |

---

### 3.2 ヘルプ機能（FR-023）

アプリの使い方を学ぶための機能です。

| ID | 機能名 | 説明 | 実装状況 | Phase |
|----|--------|------|----------|-------|
| FR-023 | チュートリアル | 初めてアプリを使う人向けの「使い方ガイド」です。画面をスワイプしながら、トレーニングの始め方やカメラの設置方法など、基本的な操作を学べます。 | 未実装 | Phase 2 |

---

### 3.3 GDPR対応機能（FR-024〜FR-027）

GDPR（ジーディーピーアール）は、ヨーロッパの個人情報保護ルールです。日本のユーザーも含めて、全員の大切な情報を守るために、これらの機能を用意しています。

| ID | 機能名 | 説明 | 実装状況 | Phase |
|----|--------|------|----------|-------|
| FR-024 | 同意管理 | アプリを使う前に「利用規約」と「プライバシーポリシー」を読んで、同意（「はい、わかりました」と承諾すること）する機能です。いつ同意したかも記録されます。 | 一部実装 | Phase 1 |
| FR-024-1 | ログイン時同意確認機能 | ログインした時に、利用規約などに同意しているかチェックします。もし同意していなければ、同意画面が表示され、同意しないとアプリを使えません。 | 一部実装 | Phase 1 |
| FR-025 | データ削除権 | 自分のアカウントと、これまで記録したすべてのデータを削除できる機能です。削除をお願いすると、30日間の猶予期間（「やっぱりやめたい」と思った時のための待ち時間）の後、完全に消去されます。 | 一部実装 | Phase 1 |
| FR-025-1 | 削除猶予期間のアクセス制御 | 削除をお願いした後の30日間は、データを見ることはできますが、新しいトレーニングの記録や変更はできなくなります。これは間違って削除した場合に備えるためです。 | 一部実装 | Phase 1 |
| FR-026 | データ訂正権 | 自分の情報（名前や身長など）が間違っていたら、いつでも直せる機能です。プロフィール画面から編集できます。 | 一部実装 | Phase 1 |
| FR-027 | データアクセス権 | 自分のデータ（トレーニング記録など）をダウンロードできる機能です。ユーザー向けにはPDF形式（スマホで見やすい形式）で、管理者向けにはJSON形式やCSV形式（コンピュータが読みやすい形式）で保存できます。なお、データダウンロードにはメールアドレスの確認が必要です。 | 未実装 | Phase 1 |

**30日間の猶予期間とは？**

削除をお願いしてからすぐには消えません。これは「やっぱり消したくない！」と思った時に、元に戻せるようにするためです。30日以内なら、削除をキャンセルできます。

---

### 3.4 データ収集機能（FR-028〜FR-029）

アプリをより良くするために、いくつかのデータを集めています。カメラの映像自体は保存されず、スマホの中だけで処理されます。

| ID | 機能名 | 説明 | 実装状況 | Phase |
|----|--------|------|----------|-------|
| FR-028 | 骨格座標データ収集 | カメラで検出した33箇所の関節の位置データ（骨格座標）を保存します。これは数字の羅列で、映像ではありません。フォーム確認の精度を上げるために使います。 | 未実装 | Phase 2 |
| FR-028-1 | ML移行準備データ収集 | 将来、より賢いAI（機械学習モデル）を作るために、トレーニングの品質や環境の情報を集めます。これは任意（スキップ可能）で、同意した人だけが対象です。 | 未実装 | Phase 2 |
| FR-029 | セッションメタデータ収集 | 種目、回数、時間、スコア、使っているスマホの種類などの統計データを集めます。個人を特定できないようにユーザーIDは匿名化（誰のデータかわからなくすること）されます。 | 未実装 | Phase 2 |

**プライバシーについて**:
- カメラで撮った映像は、スマホの外に出ることはありません
- 保存されるのは「関節の位置を表す数字」だけです
- 誰のデータかわからないように処理しています

---

### 3.5 サポート機能（FR-030〜FR-031）

困った時に助けを求められる機能です。

| ID | 機能名 | 説明 | 実装状況 | Phase |
|----|--------|------|----------|-------|
| FR-030 | ヘルプセンター | よくある質問（FAQ）や使い方の説明を見られるページです。「支払い方法を変えたい」「トレーニングが記録されない」などの疑問に対する答えが載っています。 | 未実装 | Phase 2 |
| FR-031 | お問い合わせフォーム | ヘルプセンターを見ても解決しない場合に、運営チームに直接質問できるフォームです。名前、メールアドレス、質問内容を入力して送信します。 | 未実装 | Phase 2 |

---

### 3.6 管理者兼運用者要件（FR-ADM-001〜FR-ADM-009）【Phase 4】

アプリの運営者・管理者がサービスを管理するための機能です。これらの機能は管理者専用の画面（管理コンソール）で使います。

| ID | 機能名 | 説明 | 実装状況 | Phase |
|----|--------|------|----------|-------|
| FR-ADM-001 | ユーザーアカウント管理 | ユーザーアカウントの一覧を確認し、必要に応じてアカウントの有効／停止などの状態を変更できる機能です。不正利用の対応や、問い合わせ対応で使います。 | 未実装 | Phase 4 |
| FR-ADM-002 | 利用状況集計 | 期間やトレーニング種目ごとに利用状況（ユーザー数、トレーニング回数、継続日数など）を集計し、サービス改善やコンテンツ見直しの判断材料として活用できる機能です。 | 未実装 | Phase 4 |
| FR-ADM-003 | コンテンツ管理 | トレーニングメニューや3Dモデル・動画アセットを登録・更新・削除し、ユーザーへ提供するメニューの品質を管理できる機能です。 | 未実装 | Phase 4 |
| FR-ADM-004 | データエクスポート | 利用状況や姿勢解析データをCSV／JSON形式で出力し、個人を特定できないように匿名化したうえで分析や監査に利用できる機能です。 | 未実装 | Phase 4 |
| FR-ADM-005 | 通知管理 | 通知履歴を参照し、条件に応じて再送を指示できる機能です。通知の送信処理自体はクラウドの通知サービスを用いて行います。 | 未実装 | Phase 4 |
| FR-ADM-006 | マスタデータ管理 | 各種マスタデータ（カテゴリーや難易度など）の登録・参照・更新・論理削除ができる機能です。トレーニング種目の追加や難易度の変更などに使います。 | 未実装 | Phase 4 |
| FR-ADM-007 | 監査ログ検索 | 監査ログを期間や条件で検索し、不正操作の有無を確認できる機能です。セキュリティインシデントの調査などに使います。 | 未実装 | Phase 4 |
| FR-ADM-008 | 端末情報管理 | 利用状況や姿勢解析データ、監査ログとあわせて、ユーザーが利用する端末情報も確認できる機能です。端末情報は、新規登録時およびセッション開始時に取得・更新します。 | 未実装 | Phase 4 |
| FR-ADM-009 | セキュリティ監視 | 監査ログを確認し、不正アクセスや情報漏えいにつながる異常なアクセスパターンを検知する機能です。Firebaseなどクラウドの監視機能を活用します。 | 未実装 | Phase 4 |

**管理者機能について**:
- これらの機能は一般ユーザーは使えません
- 管理者としてログインした人だけがアクセスできます
- 個人情報を扱うため、厳しいアクセス制限がかけられています

---

### 3.7 課金機能（FR-019〜FR-022-1）【Phase 3】

アプリを使い続けるための料金に関する機能です。**決済にはStripe（ストライプ）を使用し、RevenueCatは代替手段として位置づけます。**

**課金機能の設計方針**:
Phase 1から課金導線を見越して設計を行い、Phase 3で実装します。

| 設計段階 | 内容 |
|---------|------|
| Phase 1 | UIで「Premium」バッジ表示エリアを確保 |
| Phase 2 | 無料トライアル期間の管理ロジック準備 |
| Phase 3 | Stripe決済の実装・テスト・リリース |

| ID | 機能名 | 説明 | 実装状況 | Phase |
|----|--------|------|----------|-------|
| FR-019 | 無料トライアル（1週間） | アプリに新しく登録した人は、最初の7日間は無料ですべての機能を使えます。トライアル終了の3日前に「あと3日で無料期間が終わります」という通知が届くので、続けるかどうか決められます。 | 未実装 | Phase 3 |
| FR-020 | 月額課金（500円） | 月額500円（税込）の定額プランに加入できます。毎月同じ日に自動で支払いが行われるサブスクリプション（定額課金）の仕組みです。 | 未実装 | Phase 3 |
| FR-021 | サブスクリプション管理 | 自分が今どんなプランに入っているか、次にいつ課金されるか確認できます。また、いつでもキャンセル（解約）することができます。 | 未実装 | Phase 3 |
| FR-022 | 決済（Stripe） | Stripeを通じて安全に支払いができます。クレジットカードやデビットカードなど、普段使っている方法で払えます。 | 未実装 | Phase 3 |
| FR-022-1 | 課金エラーハンドリング | 支払いがうまくいかなかった時（カードの残高不足、ネットワークエラーなど）に、何が起きたかわかりやすく表示し、どうすればいいか案内する機能です。 | 未実装 | Phase 3 |

**課金エラーの種類と対処法**:

| エラーの種類 | 何が起きたか | どうすればいいか |
|-------------|-------------|-----------------|
| カード残高不足 | 支払いに使うカードにお金が足りない | 別のカードを登録するか、残高をチャージする |
| カード期限切れ | 使っているカードの有効期限が切れている | 新しいカードを登録する |
| ネットワークエラー | インターネット接続が不安定 | 電波の良い場所でもう一度試す |
| サーバーエラー | システム側の問題 | しばらく待ってから再試行するか、お問い合わせする |

**課金前の確認事項**:
- 有料プランへの加入には、メールアドレスの確認が必要です
- メールが未確認の場合は、確認メールを再送信する案内が表示されます
- これはセキュリティと本人確認のために必要な手順です

**Stripeについて**:
- Stripe（ストライプ）は世界中で使われている安全な決済サービスです
- クレジットカード情報はStripeが安全に管理するので、アプリには保存されません
- PCI DSS（カード情報のセキュリティ基準）に準拠しています

**決済サービスの選定理由**:
| サービス | 役割 | 理由 |
|---------|------|------|
| **Stripe（メイン）** | 主要な決済手段 | Web版との統一、柔軟な価格設定、日本での豊富な実績 |
| **RevenueCat（代替）** | バックアップ | Stripe導入に問題が生じた場合の代替手段として準備 |

---

## 4. 非機能要件一覧

非機能要件とは、「何ができるか」ではなく「どれくらい速いか」「どれくらい安全か」など、アプリの品質に関する要件です。

### 4.1 パフォーマンス要件（NFR-001〜NFR-004）

アプリがどれくらい速く動くかに関する要件です。

| ID | カテゴリ | 要件 | 目標値 | 説明 | 実装状況 | Phase |
|----|---------|------|--------|------|----------|-------|
| NFR-001 | パフォーマンス | アプリ起動時間 | 3秒以内 | アプリのアイコンをタップしてから、使える状態になるまでの時間です。 | 未実装 | Phase 1 |
| NFR-002 | パフォーマンス | MediaPipeフレームレート | 30fps以上 | 1秒間に30回以上、骨格を検出できることを目指します。これにより、なめらかなリアルタイム確認ができます。Phase 2開始前に技術検証（PoC）を実施し、目標達成可能かを確認します。 | 未実装 | Phase 2 |
| NFR-003 | パフォーマンス | APIレスポンス時間 | 200ms以内 | サーバーとのやり取り（データの保存や読み込み）が0.2秒以内に完了することを目指します。 | 未実装 | Phase 1 |
| NFR-004 | パフォーマンス | データベースクエリ | 100ms以内 | データベースからデータを取り出す時間が0.1秒以内であることを目指します。 | 未実装 | Phase 1 |

**fpsとは？**

fps（フレーム・パー・セカンド）は「1秒間に何枚の画像を処理できるか」を表します。30fpsなら、1秒間に30枚の画像を分析して、骨格の位置を特定できます。数字が大きいほど、なめらかに動いて見えます。

---

### 4.2 可用性要件（NFR-005〜NFR-006）

アプリがいつでも使えるかに関する要件です。

| ID | カテゴリ | 要件 | 目標値 | 説明 | 実装状況 | Phase |
|----|---------|------|--------|------|----------|-------|
| NFR-005 | 可用性 | アップタイム | 99.5%以上 | 1年のうち99.5%の時間（約363.2日）は、アプリが正常に使える状態であることを目指します。 | 未実装 | Phase 1 |
| NFR-006 | 可用性 | メンテナンス時間 | 月4時間以内 | システムの更新や修理のために使えなくなる時間は、1ヶ月に4時間以内に抑えます。 | 未実装 | Phase 1 |

**99.5%の稼働率とは？**

1年間（8,760時間）のうち、使えない時間が約43.8時間以内ということです。つまり、ほとんどいつでも使える状態を保ちます。

---

### 4.3 スケーラビリティ要件（NFR-007〜NFR-008）

ユーザーが増えても大丈夫かに関する要件です。

| ID | カテゴリ | 要件 | 目標値 | 説明 | 実装状況 | Phase |
|----|---------|------|--------|------|----------|-------|
| NFR-007 | スケーラビリティ | 同時接続数 | 1,000ユーザー | 同じ時間に1,000人が使っても、問題なく動くことを目指します。 | 未実装 | Phase 2 |
| NFR-008 | スケーラビリティ | データ増加対応 | 自動スケール | データが増えても、自動的にサーバーの容量が増えて対応できます。 | 未実装 | Phase 2 |

---

### 4.4 セキュリティ要件（NFR-009〜NFR-014）

データを守るための安全対策に関する要件です。

| ID | カテゴリ | 要件 | 目標値 | 説明 | 実装状況 | Phase |
|----|---------|------|--------|------|----------|-------|
| NFR-009 | セキュリティ | 通信暗号化 | TLS 1.3 | スマホとサーバー間の通信を暗号化（他の人に読めないようにすること）します。TLS 1.3は最新の暗号化技術です。 | 未実装 | Phase 1 |
| NFR-010 | セキュリティ | データ暗号化 | AES-256 | 保存されているデータも暗号化します。AES-256は、とても強力な暗号化方式で、解読はほぼ不可能です。 | 未実装 | Phase 1 |
| NFR-011 | セキュリティ | 認証 | JWT, OAuth 2.0 | ログインした人が本人かどうかを確認する仕組みです。JWTという「電子的な身分証明書」を使います。 | 一部実装 | Phase 1 |
| NFR-012 | セキュリティ | アクセス制御 | Cloud IAM | 誰がどのデータにアクセスできるかを細かく管理します。自分のデータは自分だけが見られます。 | 一部実装 | Phase 1 |
| NFR-013 | セキュリティ | 脆弱性診断 | リリース前に実施 | アプリを公開する前に、セキュリティの穴（弱い部分）がないかチェックします。 | 未実装 | Phase 2 |
| NFR-014 | セキュリティ | ペネトレーションテスト | リリース前に実施 | 専門家が「悪い人」の立場でアプリを攻撃してみて、本当に安全か確かめます。 | 未実装 | Phase 2 |

**暗号化とは？**

データを他の人に読めないようにする技術です。例えば「こんにちは」を「%#@&!」のように変換します。正しい鍵（パスワードのようなもの）がないと、元に戻せません。

---

### 4.5 プライバシー要件（NFR-015〜NFR-018）

個人情報を守るための要件です。

| ID | カテゴリ | 要件 | 目標値 | 説明 | 実装状況 | Phase |
|----|---------|------|--------|------|----------|-------|
| NFR-015 | プライバシー | オンデバイス処理 | カメラ映像 | カメラで撮った映像は、スマホの中だけで処理します。インターネットに送られることはありません。 | 未実装 | Phase 2 |
| NFR-016 | プライバシー | 仮名化 | ユーザーID | 統計データを分析する時は、誰のデータかわからないように「仮の名前」に置き換えます。 | 未実装 | Phase 1 |
| NFR-017 | プライバシー | データ削除と猶予期間制御 | 30日以内 | 削除をお願いしたら、30日以内に完全に消去します。その間、データは読み取り専用になります。 | 一部実装 | Phase 1 |
| NFR-018 | プライバシー | データエクスポート | 30日以内 | 自分のデータをダウンロードしたいとお願いしたら、30日以内に用意します。 | 未実装 | Phase 1 |

**オンデバイス処理とは？**

データをインターネットに送らず、スマホの中だけで処理することです。これにより、カメラ映像が外部に漏れることを防ぎます。

---

### 4.6 GDPR対応要件（NFR-019〜NFR-020）

ヨーロッパの個人情報保護法（GDPR）に従うための要件です。

| ID | カテゴリ | 要件 | 目標値 | 説明 | 実装状況 | Phase |
|----|---------|------|--------|------|----------|-------|
| NFR-019 | GDPR対応 | 同意管理 | 記録保持 | 「いつ」「何に」同意したかを、きちんと記録して保管します。 | 一部実装 | Phase 1 |
| NFR-020 | GDPR対応 | データ侵害通知 | 72時間以内 | もし万が一、データが流出するようなことがあった場合、72時間（3日）以内に関係機関とユーザーに通知します。 | 未実装 | Phase 1 |

---

### 4.7 ユーザビリティ要件（NFR-021〜NFR-023）

使いやすさに関する要件です。

| ID | カテゴリ | 要件 | 目標値 | 説明 | 実装状況 | Phase |
|----|---------|------|--------|------|----------|-------|
| NFR-021 | ユーザビリティ | 操作性 | 3タップ以内 | 主な機能（トレーニング開始など）に、3回以内のタップでたどり着けるようにします。 | 未実装 | Phase 1 |
| NFR-022 | ユーザビリティ | エラーメッセージ | 平易な言語 | エラーが起きた時のメッセージは、専門用語を使わず、誰でもわかる言葉で表示します。 | 未実装 | Phase 1 |
| NFR-023 | ユーザビリティ | アクセシビリティ | WCAG 2.1 AA | 目が見えにくい人や、耳が聞こえにくい人も使えるように配慮します（音声読み上げ対応など）。 | 未実装 | Phase 4 |

**WCAGとは？**

Web Content Accessibility Guidelines（ウェブコンテンツ・アクセシビリティ・ガイドライン）の略で、障害のある人もウェブやアプリを使いやすくするための国際的な基準です。

---

### 4.8 互換性要件（NFR-024〜NFR-025）

どんなスマホで使えるかに関する要件です。

| ID | カテゴリ | 要件 | 目標値 | 説明 | 実装状況 | Phase |
|----|---------|------|--------|------|----------|-------|
| NFR-024 | 互換性 | iOS最低要件 | iOS 15.0以上、RAM 2GB以上 | iPhoneを使う場合、iOS 15.0以上で、メモリ（RAM）が2GB以上必要です。iPhone 6s以降が対象です。 | 未実装 | Phase 1 |
| NFR-025 | 互換性 | Android最低要件 | Android 8.0以上、RAM 3GB以上 | Androidスマホの場合、Android 8.0（Oreo）以上で、メモリが3GB以上必要です。 | 未実装 | Phase 1 |

**なぜRAM（メモリ）が必要？**

AIでカメラ映像を分析するには、たくさんの計算が必要です。メモリが少ないスマホだと、動作が遅くなったり、アプリが落ちたりする可能性があります。

---

### 4.9 保守性要件（NFR-026〜NFR-027）

アプリを長く維持・改善していくための要件です。

| ID | カテゴリ | 要件 | 目標値 | 説明 | 実装状況 | Phase |
|----|---------|------|--------|------|----------|-------|
| NFR-026 | 保守性 | コードカバレッジ | 80%以上 | プログラムのテスト（動作確認）が、コード全体の80%以上をカバーしていること。バグを早く見つけられます。 | 一部実装 | Phase 1 |
| NFR-027 | 保守性 | ドキュメント | 全機能 | すべての機能について、説明書（ドキュメント）を用意します。開発者が引き継ぎやすくなります。 | 一部実装 | Phase 1 |

---

### 4.10 監視要件（NFR-028〜NFR-030）

アプリが正常に動いているか監視するための要件です。

| ID | カテゴリ | 要件 | 目標値 | 説明 | 実装状況 | Phase |
|----|---------|------|--------|------|----------|-------|
| NFR-028 | 監視 | ログ収集 | Cloud Logging | アプリの動作記録（ログ）をクラウドに保存します。問題が起きた時に原因を調べられます。 | 一部実装 | Phase 1 |
| NFR-029 | 監視 | エラー監視 | Firebase Crashlytics | アプリがクラッシュ（突然終了）した時に、自動で報告されます。すぐに修正に取りかかれます。 | 未実装 | Phase 1 |
| NFR-030 | 監視 | パフォーマンス監視 | Firebase Performance | アプリの速度や応答時間を監視します。遅くなっていたら、改善に取り組めます。 | 未実装 | Phase 1 |

---

### 4.11 バックアップ要件（NFR-031〜NFR-032）

データを失わないための要件です。

| ID | カテゴリ | 要件 | 目標値 | 説明 | 実装状況 | Phase |
|----|---------|------|--------|------|----------|-------|
| NFR-031 | バックアップ | データバックアップ | 日次 | 毎日1回、すべてのデータのコピーを作ります。もしデータが壊れても、前日の状態に戻せます。 | 未実装 | Phase 1 |
| NFR-032 | バックアップ | 復旧時間目標（RTO） | 24時間以内 | 大きな障害が起きても、24時間以内にサービスを復旧させることを目指します。 | 未実装 | Phase 1 |

**RTOとは？**

Recovery Time Objective（リカバリータイム・オブジェクティブ）の略で、「復旧までにかかる最大時間の目標」のことです。

---

### 4.12 UI/UX要件（NFR-033）

画面のデザインと操作性に関する要件です。

| ID | カテゴリ | 要件 | 目標値 | 説明 | 実装状況 | Phase |
|----|---------|------|--------|------|----------|-------|
| NFR-033 | UI/UX | ナビゲーションバー | 全画面 | 画面下部に常に表示されるナビゲーションバー（タブバー）を設置します。「ホーム」「トレーニング」「履歴」「プロフィール」の4つのタブがあります。 | 一部実装 | Phase 1 |

**ナビゲーションバーのタブ構成**:

| タブ名 | アイコン | 説明 |
|--------|---------|------|
| ホーム | 家のマーク | トップ画面に戻ります |
| トレーニング | ダンベルのマーク | トレーニングを始める画面に行きます |
| 履歴 | グラフのマーク | 過去のトレーニング記録を見られます |
| プロフィール | 人のマーク | 自分の情報や設定を変更できます |

---

### 4.13 追加のセキュリティ・パフォーマンス要件（NFR-034〜NFR-037）

v3.3で追加された、より詳細な要件です。

| ID | カテゴリ | 要件 | 目標値 | 説明 | 実装状況 | Phase |
|----|---------|------|--------|------|----------|-------|
| NFR-034 | セキュリティ | Firestoreセキュリティルール詳細 | 完全実装 | データベースへのアクセス権限を細かく設定します。他の人のデータは絶対に見られないようにします。 | 一部実装 | Phase 1 |
| NFR-035 | パフォーマンス | MediaPipeフレームレート監視・フォールバック | 20fps以上維持 | 骨格検出の速度を監視し、遅くなったら自動で軽量モードに切り替えます（フォールバック）。 | 未実装 | Phase 2 |
| NFR-036 | 可用性 | BigQueryリトライ処理・DLQ | 99.9%成功率 | データの分析システムへの送信が失敗しても、自動で再送します。99.9%の成功率を目指します。 | 未実装 | Phase 2 |
| NFR-037 | パフォーマンス | Functionsコールドスタート対策 | 500ms未満 | サーバーが「眠っている」状態から起きる時間（コールドスタート）を0.5秒未満に抑えます。 | 未実装 | Phase 2 |

**コールドスタートとは？**

サーバーは、使われていない時は「眠っている」状態になります（コスト削減のため）。リクエストが来ると「起きる」のですが、その起動に時間がかかることを「コールドスタート」と言います。

**フォールバックとは？**

メインの機能が使えない時に、代わりの方法で動くことです。例えば、30fpsで動かなければ、画質を下げて20fpsで動かす、という感じです。

---

### 4.14 管理者機能向け非機能要件（NFR-038〜NFR-042）【Phase 4】

管理者機能を安全に運用するための要件です。

| ID | カテゴリ | 要件 | 目標値 | 説明 | 実装状況 | Phase |
|----|---------|------|--------|------|----------|-------|
| NFR-038 | セキュリティ | 管理者認証 | 多要素認証必須 | 管理者としてログインする際は、パスワードに加えてスマホの認証アプリなど、2つ以上の認証が必要です。 | 未実装 | Phase 4 |
| NFR-039 | 監査 | 監査ログ保存期間 | 2年以上 | 管理者の操作履歴は2年以上保存し、不正があった場合に調査できるようにします。 | 未実装 | Phase 4 |
| NFR-040 | セキュリティ | IPアドレス制限 | 許可リスト方式 | 管理画面には、あらかじめ許可されたIPアドレスからのみアクセスできます。 | 未実装 | Phase 4 |
| NFR-041 | 監視 | 異常検知アラート | リアルタイム | 不正なアクセスパターンを検知したら、すぐに管理者にアラートを送信します。 | 未実装 | Phase 4 |
| NFR-042 | パフォーマンス | 管理画面レスポンス | 3秒以内 | 管理画面の各操作は3秒以内に完了することを目指します。 | 未実装 | Phase 4 |

---

### 4.15 技術検証（PoC）要件（NFR-043）【Phase 2開始前】

MediaPipe統合の技術検証に関する要件です。

| ID | カテゴリ | 要件 | 目標値 | 説明 | 実装状況 | Phase |
|----|---------|------|--------|------|----------|-------|
| NFR-043 | 技術検証 | MediaPipe PoC | Phase 2開始前に完了 | Expo/React Native環境でMediaPipeが30fps以上で動作することを確認します。iOS/Android両方で検証し、問題がある場合はTensorFlow.jsを代替案として検討します。 | 未実装 | Phase 2開始前 |

**技術検証で確認すること**:
- Development Buildでの動作確認
- iOS/Androidそれぞれでのフレームレート測定
- メモリ使用量の確認
- 代替手段（TensorFlow.js）の動作確認

**検証期間の目安**: 2〜3週間

---

## 5. 非機能要件サマリー

### 5.1 カテゴリ別要件数

| カテゴリ | 要件数 | Phase 1 | Phase 2 | Phase 3 | Phase 4 |
|---------|--------|---------|---------|---------|---------|
| パフォーマンス | 7件 | 2件 | 4件 | 0件 | 1件 |
| 可用性 | 3件 | 2件 | 1件 | 0件 | 0件 |
| スケーラビリティ | 2件 | 0件 | 2件 | 0件 | 0件 |
| セキュリティ | 9件 | 4件 | 3件 | 0件 | 2件 |
| プライバシー | 4件 | 3件 | 1件 | 0件 | 0件 |
| GDPR対応 | 2件 | 2件 | 0件 | 0件 | 0件 |
| ユーザビリティ | 3件 | 2件 | 0件 | 0件 | 1件 |
| 互換性 | 2件 | 2件 | 0件 | 0件 | 0件 |
| 保守性 | 2件 | 2件 | 0件 | 0件 | 0件 |
| 監視 | 4件 | 3件 | 0件 | 0件 | 1件 |
| バックアップ | 2件 | 2件 | 0件 | 0件 | 0件 |
| UI/UX | 1件 | 1件 | 0件 | 0件 | 0件 |
| 監査 | 1件 | 0件 | 0件 | 0件 | 1件 |
| 技術検証 | 1件 | 0件 | 1件 | 0件 | 0件 |
| **合計** | **43件** | **25件** | **12件** | **0件** | **6件** |

**Phase変更の注記**: Phase 3は「Apple認証・課金機能」として再編され、非機能要件は主にPhase 4（管理者・運用者機能）で扱われます。

### 5.2 優先度別分類

| 優先度 | 件数 | 説明 |
|--------|------|------|
| 必須 | 36件 | 必ず実装しなければならない要件 |
| 推奨 | 6件 | 実装が望ましい要件（NFR-014, NFR-023, NFR-035, NFR-037, NFR-040, NFR-042） |

---

## 6. 用語集

中高生でもわかるように、このドキュメントで使われている専門用語を説明します。

| 用語 | 説明 |
|------|------|
| **API** | アプリケーション・プログラミング・インターフェースの略。アプリとサーバーがデータをやり取りする窓口のこと。 |
| **AES-256** | データを暗号化する方法の一つ。256は「とても長い鍵」を意味し、解読がほぼ不可能。 |
| **BigQuery** | Googleが提供する、大量のデータを分析するためのサービス。 |
| **Cloud Functions** | サーバーを用意しなくても、プログラムを動かせるサービス。 |
| **Crashlytics** | アプリがクラッシュ（強制終了）した時に、自動で報告してくれるサービス。 |
| **CSV** | Comma-Separated Values（カンマ区切り値）の略。表計算ソフトで開けるデータ形式。 |
| **DLQ** | Dead Letter Queue（デッドレター・キュー）の略。送信に失敗したデータを一時的に保管する場所。 |
| **Firestore** | Googleが提供するデータベース。アプリのデータを保存する場所。 |
| **fps** | Frames Per Second（フレーム・パー・セカンド）の略。1秒間に処理できる画像の枚数。 |
| **GDPR** | General Data Protection Regulation（一般データ保護規則）の略。EUの個人情報保護法。 |
| **IAM** | Identity and Access Management（アイデンティティ・アンド・アクセス・マネジメント）の略。誰が何にアクセスできるかを管理する仕組み。 |
| **JSON** | JavaScript Object Notation（ジェイソン・オブジェクト・ノーテーション）の略。データを整理して書くための形式。 |
| **JWT** | JSON Web Token（ジェイソン・ウェブ・トークン）の略。ログイン情報を安全にやり取りするための「電子的な身分証明書」。 |
| **MediaPipe** | Googleが開発した、カメラ映像から人の骨格などを検出するAI技術。 |
| **OAuth 2.0** | 他のサービス（GoogleやAppleなど）のアカウントでログインできるようにする仕組み。 |
| **PDF** | Portable Document Format（ポータブル・ドキュメント・フォーマット）の略。どんな環境でも同じように表示できる文書形式。 |
| **RTO** | Recovery Time Objective（リカバリータイム・オブジェクティブ）の略。障害が起きてから復旧するまでの目標時間。 |
| **Stripe** | 世界中で使われている安全なオンライン決済サービス。クレジットカード決済などを処理する。 |
| **TLS** | Transport Layer Security（トランスポート・レイヤー・セキュリティ）の略。インターネット通信を暗号化する技術。 |
| **WCAG** | Web Content Accessibility Guidelines（ウェブコンテンツ・アクセシビリティ・ガイドライン）の略。障害のある人も使いやすくするための基準。 |
| **サブスクリプション** | 定額制で毎月（または毎年）お金を払って使い続けるサービス形態。NetflixやSpotifyと同じ仕組み。 |
| **仮名化** | 個人を特定できないように、名前やIDを別のものに置き換えること。 |
| **暗号化** | データを他の人に読めないように変換すること。正しい鍵がないと元に戻せない。 |
| **監査ログ** | 誰が、いつ、何をしたかを記録したもの。不正がないか後から調べるために使う。 |
| **多要素認証** | パスワードだけでなく、スマホの認証アプリや指紋など、複数の方法で本人確認すること。より安全。 |
| **マスタデータ** | システム全体で共通して使う基本的なデータ。例：トレーニング種目の一覧、難易度の定義など。 |

---

## 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|----------|
| 1.0 | 2025年12月8日 | 初版作成（Expo版要件定義書Part 2） |
| 1.0.1 | 2025年12月8日 | FR-018（達成通知）を削除、課金機能をPhase 3に移動（Stripe使用）、管理者要件（FR-ADM-001〜FR-ADM-009）をPhase 3として追加、FR-027にPDF/CSV形式を追加、NFR-023をPhase 4に移動、管理者向けNFR（NFR-038〜NFR-042）を追加 |
| 1.0.2 | 2025年12月8日 | FR-001関連: メール認証任意の明記（Part 1と整合性確認）、Part 1の変更に伴う整合性確認完了 |
| 1.0.3 | 2025年12月8日 | NFR-002: 技術検証（PoC）の言及追加。FR-027: データダウンロード時のメール確認必須を追加。課金機能: メール確認必須を追加。NFR-043: MediaPipe技術検証要件を新規追加 |
| 1.0.4 | 2025年12月9日 | Phase構成変更: Phase 3を「管理者・運用者機能」に、Phase 4を「Apple認証・課金機能・多言語対応」に変更。課金機能（FR-019〜FR-022-1）をPhase 4に移動。Part 1との整合性確認完了 |
| 1.0.5 | 2025年12月9日 | リスク対応に基づく変更: (1) Phase構成再変更 - Phase 3を「Apple認証・課金機能」、Phase 4を「管理者・運用者・多言語」に変更 (2) 課金機能をPhase 3に移動 (3) Stripe仕様統一、RevenueCat代替化を明記 (4) 課金機能の設計方針（Phase 1からの課金導線準備）を追加 (5) 管理者向けNFR（NFR-038〜NFR-042）をPhase 4に移動 |
| 1.0.6 | 2025年12月9日 | 管理者機能のPhase表記をPhase 4に統一 |

---

## 参照ドキュメント

- 00_要件定義書_v3_3.md
- 利用規約_v3_2.md
- プライバシーポリシー_v3.1.md
- 07_セキュリティポリシー_v1_0.md
