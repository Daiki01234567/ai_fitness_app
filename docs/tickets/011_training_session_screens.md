# Ticket #011: トレーニングセッション画面実装

**Phase**: Phase 2 (機能実装)
**期間**: Week 6-7
**優先度**: 最高
**関連仕様書**:
- `docs/specs/05_画面遷移図_ワイヤーフレーム_v3_3.md`
- `docs/specs/00_要件定義書_v3_3.md` (FR-019～FR-023)

## 概要
トレーニングセッションの開始、実行、結果表示までの一連の画面を実装する。

## Todo リスト

### セッション準備画面

#### ExerciseSelectionScreen (`screens/session/exercise_selection_screen.dart`)
- [ ] 種目選択UI
  - [ ] 5種目カード表示
  - [ ] 種目説明テキスト
  - [ ] 推奨レベル表示
  - [ ] プレビュー動画/画像
- [ ] カスタムワークアウト
  - [ ] 複数種目選択
  - [ ] 順序変更
  - [ ] セット数設定
  - [ ] レスト時間設定
- [ ] プリセットワークアウト
  - [ ] 初心者向け
  - [ ] 中級者向け
  - [ ] 上級者向け
  - [ ] 時短メニュー

#### PreSessionScreen (`screens/session/pre_session_screen.dart`)
- [ ] 準備確認
  - [ ] カメラ位置ガイド
  - [ ] 明るさチェック
  - [ ] 服装確認
  - [ ] 安全スペース確認
- [ ] キャリブレーション
  - [ ] Tポーズ取得
  - [ ] 身長推定
  - [ ] カメラ距離調整
- [ ] 目標設定
  - [ ] レップ数入力
  - [ ] セット数入力
  - [ ] 目標フォームスコア

### トレーニング実行画面

#### ActiveSessionScreen (`screens/session/active_session_screen.dart`)
- [ ] カメラビュー
  - [ ] リアルタイム映像表示
  - [ ] ミラーリング対応
  - [ ] ズーム調整
  - [ ] 明るさ自動調整
- [ ] スケルトンオーバーレイ
  - [ ] 33ランドマーク描画
  - [ ] 信頼度による透明度
  - [ ] カラーコーディング
  - [ ] 問題箇所ハイライト
- [ ] リアルタイム情報表示
  - [ ] 現在のレップ数
  - [ ] 現在のセット数
  - [ ] フォームスコア
  - [ ] タイマー（経過/残り）
  - [ ] 心拍数（オプション）

#### SessionControlPanel (`widgets/session_control_panel.dart`)
- [ ] セッションコントロール
  - [ ] 一時停止/再開
  - [ ] 停止（確認ダイアログ付き）
  - [ ] スキップ（次の種目へ）
  - [ ] 音声ON/OFF
  - [ ] フィードバックレベル調整
- [ ] 緊急停止
  - [ ] 即座停止ボタン
  - [ ] データ保存確認

#### RestScreen (`screens/session/rest_screen.dart`)
- [ ] レスト時間表示
  - [ ] カウントダウンタイマー
  - [ ] プログレスバー
  - [ ] スキップオプション
- [ ] 前セット結果表示
  - [ ] レップ数
  - [ ] フォームスコア
  - [ ] 改善ポイント
- [ ] 次セット準備
  - [ ] 目標調整オプション
  - [ ] モチベーションメッセージ

### フィードバック表示

#### RealTimeFeedbackOverlay (`widgets/feedback_overlay.dart`)
- [ ] 視覚的フィードバック
  - [ ] 改善矢印
  - [ ] 角度表示
  - [ ] 速度インジケーター
  - [ ] 深さゲージ
- [ ] テキストフィードバック
  - [ ] 現在の問題点
  - [ ] 改善方法
  - [ ] 励ましメッセージ
- [ ] 音声フィードバック制御
  - [ ] 音量調整
  - [ ] 頻度設定
  - [ ] 言語選択

#### FormScoreWidget (`widgets/form_score_widget.dart`)
- [ ] スコア表示
  - [ ] 円グラフ/ゲージ
  - [ ] 数値表示（0-100）
  - [ ] 色分け（緑/黄/赤）
  - [ ] トレンド矢印
- [ ] 詳細スコア
  - [ ] 各評価項目
  - [ ] レーダーチャート
  - [ ] 時系列グラフ

### 結果画面

#### SessionResultScreen (`screens/session/session_result_screen.dart`)
- [ ] セッションサマリ
  - [ ] 総運動時間
  - [ ] 総レップ数
  - [ ] 平均フォームスコア
  - [ ] 消費カロリー（推定）
  - [ ] 達成率
- [ ] 詳細結果
  - [ ] 種目別結果
  - [ ] セット別結果
  - [ ] ベストレップ
  - [ ] 要改善ポイント
- [ ] 進捗トラッキング
  - [ ] 前回との比較
  - [ ] 週間目標達成度
  - [ ] パーソナルベスト更新
- [ ] シェア機能
  - [ ] 結果画像生成
  - [ ] SNSシェア
  - [ ] 友達に送信

#### ImprovementSuggestions (`widgets/improvement_suggestions.dart`)
- [ ] AI分析結果
  - [ ] 主な改善点（Top3）
  - [ ] 具体的なアドバイス
  - [ ] 参考動画リンク
- [ ] 次回推奨メニュー
  - [ ] 難易度調整
  - [ ] 重点改善種目
  - [ ] 補助エクササイズ

### データ管理

#### SessionStateManager (Riverpod)
- [ ] セッション状態管理
  - [ ] 開始/実行中/休憩/終了
  - [ ] 現在の種目/セット/レップ
  - [ ] 累計データ
- [ ] リアルタイムデータ同期
  - [ ] MediaPipeデータ受信
  - [ ] フォーム評価結果
  - [ ] フィードバック履歴
- [ ] セッションリカバリ
  - [ ] 中断時の自動保存
  - [ ] 復帰オプション

### アニメーション

#### TransitionAnimations
- [ ] 画面遷移アニメーション
- [ ] カウントダウンアニメーション
- [ ] 達成アニメーション
- [ ] フィードバックアニメーション

### アクセシビリティ

#### AccessibilityFeatures
- [ ] VoiceOver/TalkBack対応
- [ ] 大きなタップ領域（48dp以上）
- [ ] 高コントラストモード
- [ ] フォントサイズ調整

### テスト実装

#### Widget テスト
- [ ] 各画面のレンダリング
- [ ] ユーザーインタラクション
- [ ] 状態遷移

#### 統合テスト
- [ ] セッション完全フロー
- [ ] エラーリカバリー
- [ ] データ永続化

#### パフォーマンステスト
- [ ] 60fps維持確認
- [ ] メモリリーク検出
- [ ] バッテリー消費測定

## 受け入れ条件
- [ ] スムーズな画面遷移（60fps）
- [ ] リアルタイムフィードバックが表示される
- [ ] セッション中断・再開が可能
- [ ] 結果が正しく集計・表示される
- [ ] すべての種目で動作する

## 注意事項
- カメラ使用時のバッテリー消費に配慮
- プライバシー保護（録画オプションは明示的同意）
- ネットワーク切断時もローカルで動作継続
- 画面回転ロック推奨

## 参考リンク
- [Flutter Camera Best Practices](https://flutter.dev/docs/cookbook/plugins/picture-using-camera)
- [Material Design Motion](https://material.io/design/motion)
- [Accessibility Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)