# データ処理記録(ROPA) v1.0

**Record of Processing Activities**

**バージョン**: 1.0
**最終更新日**: 2025年12月9日
**対象**: AIフィットネスアプリ（共通仕様）
**基準**: Expo版要件定義書 v1.0
**法的根拠**: GDPR第30条

---

## 目次

1. [データ管理者情報](#1-データ管理者情報)
2. [処理活動の概要](#2-処理活動の概要)
3. [データ処理の法的根拠](#3-データ処理の法的根拠)
4. [主要な処理活動](#4-主要な処理活動)
5. [第三者へのデータ移転](#5-第三者へのデータ移転)
6. [技術的セキュリティ対策](#6-技術的セキュリティ対策)
7. [データ主体の権利](#7-データ主体の権利)
8. [データ保存期間と削除](#8-データ保存期間と削除)

---

## 1. データ管理者情報

### 1.1 基本情報

| 項目 | 内容 |
|-----|------|
| **組織名** | [事業者名] |
| **代表者氏名** | [代表者名] |
| **登録住所** | [住所] |
| **連絡先メールアドレス** | contact@example.com |
| **Webサイト** | https://example.com |

### 1.2 事業内容

AIフィットネスアプリの開発・運営

**サービス概要**:
- スマートフォンアプリによるトレーニングフォーム確認補助
- MediaPipe Poseを用いた骨格検出による参考情報提供
- トレーニング記録の管理と可視化

**重要**: 本サービスは医療機器ではなく、診断・治療・予防を目的とするものではありません。

---

## 2. 処理活動の概要

### 2.1 処理活動一覧

| ID | 処理活動名 | データカテゴリー | 法的根拠 | データ主体 |
|----|-----------|----------------|---------|----------|
| **PA-01** | ユーザー認証とアカウント管理 | メールアドレス、UID | 契約履行（第6条1項(b)） | 利用者 |
| **PA-02** | プロフィール情報管理 | 氏名、生年月日、性別（任意） | 契約履行（第6条1項(b)） | 利用者 |
| **PA-03** | 同意管理 | 同意状態、同意日時 | 法的義務（第6条1項(c)） | 利用者 |
| **PA-04** | トレーニングセッション記録 | 種目、回数、スコア | 契約履行（第6条1項(b)） | 利用者 |
| **PA-05** | 骨格座標データ収集 | 33個の関節位置 | 同意（第6条1項(a)） | 利用者 |
| **PA-06** | セッションメタデータ収集 | セッションID、種目、回数 | 正当な利益（第6条1項(f)） | 利用者 |
| **PA-07** | 課金・決済情報処理 | サブスクリプションステータス | 契約履行（第6条1項(b)） | 利用者 |
| **PA-08** | デバイス情報収集 | OS種別、デバイスモデル | 正当な利益（第6条1項(f)） | 利用者 |
| **PA-09** | メール通知 | メールアドレス、通知内容 | 契約履行（第6条1項(b)） | 利用者 |
| **PA-10** | データ分析（BigQuery） | 仮名化されたトレーニングデータ | 正当な利益（第6条1項(f)） | 利用者 |

### 2.2 データフロー概要

```
データ主体（利用者）
    ↓
Firebase Authentication（認証）
    ↓
Cloud Firestore（データ保存）
    ↓
BigQuery（仮名化データ分析）
```

### 2.3 対象トレーニング種目

**Expo版（本仕様）**:
- スクワット（squat）
- プッシュアップ（pushup）
- アームカール（armcurl）
- サイドレイズ（sidelateral）
- ショルダープレス（shoulderpress）

**Flutter版**:
- スクワット、プッシュアップ、プランク、ランジ、ブリッジ

---

## 3. データ処理の法的根拠

### 3.1 GDPR第6条1項の法的根拠

#### 3.1.1 同意（第6条1項(a)）

**適用処理活動**:
- PA-05: 骨格座標データ収集
- PA-09: メール通知（マーケティング目的）

**同意の取得方法**:
- アプリ初回起動時に明示的な同意を取得
- チェックボックスによる能動的な同意
- 同意撤回の方法を明記

#### 3.1.2 契約履行（第6条1項(b)）

**適用処理活動**:
- PA-01: ユーザー認証とアカウント管理
- PA-02: プロフィール情報管理
- PA-04: トレーニングセッション記録
- PA-07: 課金・決済情報処理
- PA-09: メール通知（サービス関連）

**根拠**: これらの処理は、本サービスの提供に不可欠であり、契約履行のために必要

#### 3.1.3 法的義務（第6条1項(c)）

**適用処理活動**:
- PA-03: 同意管理（GDPR第7条3項の記録義務）
- PA-07: 課金履歴の保存（税法上の保存義務）

#### 3.1.4 正当な利益（第6条1項(f)）

**適用処理活動**:
- PA-06: セッションメタデータ収集
- PA-08: デバイス情報収集
- PA-10: データ分析（BigQuery）

**当社の正当な利益**:
1. サービスの安定提供
2. 不正利用の防止
3. サービス改善

**利用者の利益**:
1. 安定したサービス体験
2. 快適な動作速度

### 3.2 特別カテゴリーの個人データ（GDPR第9条）

**本サービスの方針**: 特別カテゴリーの個人データ（健康データ等）は**収集しません**。

**理由**:
1. 本サービスは医療機器ではない
2. 診断・治療・予防を目的としない
3. 骨格座標データは健康データに該当しない

---

## 4. 主要な処理活動

### 4.1 PA-01: ユーザー認証とアカウント管理

**収集する個人データ**:

| データ項目 | データ型 | 必須/任意 | 目的 | 保存場所 |
|----------|---------|----------|------|---------|
| メールアドレス | String | 必須 | ユーザー識別、ログイン、連絡 | Firebase Authentication |
| パスワード | String（ハッシュ化） | 必須 | 認証 | Firebase Authentication |
| UID | String（自動生成） | 自動 | 内部的なユーザー識別子 | Firebase Authentication、Firestore |

**セキュリティ対策**:
- パスワードはFirebase Authenticationによりbcryptでハッシュ化
- 平文パスワードは保存されない

### 4.2 PA-04: トレーニングセッション記録

**収集する個人データ**:

| データ項目 | データ型 | 目的 | 保存場所 |
|----------|---------|------|---------|
| セッションID | String | セッション識別 | Firestore |
| 種目名 | String | トレーニング種目（5種類） | Firestore |
| 回数 | Number | レップカウント | Firestore |
| スコア | Number | フォーム評価（0-100） | Firestore |
| タイムスタンプ | Timestamp | 実施日時 | Firestore |

**5種目**:
1. スクワット（squat）
2. プッシュアップ（pushup）
3. アームカール（armcurl）
4. サイドレイズ（sidelateral）
5. ショルダープレス（shoulderpress）

### 4.3 PA-05: 骨格座標データ収集

**収集する個人データ**:

| データ項目 | データ型 | 目的 | 保存場所 |
|----------|---------|------|---------|
| 関節位置（33個） | Array<x,y,z,visibility> | フォーム評価 | Firestore |
| 信頼度スコア | Number（0-1） | 精度管理 | Firestore |

**重要**:
- カメラ映像はサーバーに送信しない（オンデバイス処理）
- 骨格座標データのみを送信

### 4.4 PA-07: 課金・決済情報処理

**Expo版**: Stripe直接連携
**Flutter版**: RevenueCat連携

**収集する個人データ**:

| データ項目 | データ型 | 目的 | 保存場所 |
|----------|---------|------|---------|
| Stripe Customer ID | String | Stripe顧客識別 | Firestore（Expo版） |
| Stripe Subscription ID | String | サブスクリプション識別 | Firestore（Expo版） |
| RevenueCat User ID | String | RevenueCat顧客識別 | Firestore（Flutter版） |
| サブスクリプションステータス | String | 課金状態 | Firestore |

**重要**: 決済情報（クレジットカード番号等）は当社では保存しません。StripeまたはApple/Googleが管理します。

### 4.5 PA-10: データ分析（BigQuery）

**仮名化処理**:
- ユーザーIDをSHA-256ハッシュ化
- メールアドレスを削除
- カメラ映像は送信しない

**保存期間**: 2年間（GDPR準拠）

---

## 5. 第三者へのデータ移転

### 5.1 データ処理者

| 処理者名 | 所在国 | 役割 | データカテゴリー | 契約 |
|---------|--------|------|----------------|------|
| **Google LLC** | 米国 | Firebase/BigQuery提供 | すべての個人データ | Firebase Terms of Service |
| **Stripe Inc.** | 米国 | 決済処理（Expo版） | サブスクリプション情報 | Stripe Services Agreement |
| **RevenueCat Inc.** | 米国 | サブスクリプション管理（Flutter版） | 課金情報 | RevenueCat Terms |
| **Apple Inc.** | 米国 | App Store決済 | 決済情報 | Apple Developer Agreement |
| **Google LLC** | 米国 | Google Play決済 | 決済情報 | Google Play Developer Agreement |

### 5.2 データ移転の保護措置

**EU標準契約条項（SCCs）**:
- Googleのデータ処理規約（Data Processing Amendment）
- Stripeのデータ処理契約（Data Processing Agreement）

---

## 6. 技術的セキュリティ対策

### 6.1 暗号化

| 対策 | 実装内容 |
|-----|---------|
| **通信暗号化** | TLS 1.3による全通信の暗号化 |
| **保存時暗号化** | Google管理鍵によるFirestore/BigQueryの暗号化 |
| **パスワード** | bcryptによるハッシュ化 |

### 6.2 アクセス制御

| 対策 | 実装内容 |
|-----|---------|
| **Firestoreセキュリティルール** | フィールドレベルのアクセス制御 |
| **最小権限の原則** | 必要最小限の権限のみ付与 |
| **削除予定ユーザー** | 読み取り専用モードに制限 |

### 6.3 監査ログ

| 対策 | 実装内容 |
|-----|---------|
| **Cloud Logging** | すべてのAPI呼び出しを記録 |
| **Cloud Monitoring** | パフォーマンスメトリクスを監視 |
| **アラート** | 異常検知時の自動通知 |

---

## 7. データ主体の権利

### 7.1 GDPR準拠の権利

| 権利 | GDPR条文 | 実装方法 | 対応期限 |
|-----|---------|---------|---------|
| **アクセス権** | 第15条 | プロフィール画面で閲覧可能 | 即時 |
| **訂正権** | 第16条 | プロフィール画面で編集可能 | 即時 |
| **削除権** | 第17条 | アカウント削除機能 | 30日以内に完全削除 |
| **ポータビリティ権** | 第20条 | JSONエクスポート機能 | 1ヶ月以内 |
| **処理の制限権** | 第18条 | privacy@example.comへ連絡 | 1ヶ月以内 |
| **異議権** | 第21条 | privacy@example.comへ連絡 | 1ヶ月以内 |
| **同意撤回権** | 第7条3項 | アプリ内設定で撤回可能 | 即時 |

---

## 8. データ保存期間と削除

### 8.1 保存期間

| データ種別 | 保存期間 | 削除方法 |
|-----------|---------|---------|
| **ユーザープロフィール** | 最終ログインから3年 | Cloud Functions自動削除 |
| **トレーニングセッション** | 作成から3年 | Cloud Functions自動削除 |
| **仮名化データ（BigQuery）** | 2年 | BigQueryパーティショニング自動削除 |
| **同意履歴** | 削除不可 | GDPR監査証跡として保存 |
| **削除リクエスト** | 完了後1年 | Cloud Functions自動削除 |

### 8.2 削除手順

#### ステップ1: 削除リクエスト

アカウント削除をリクエストすると、以下が実行されます：
1. `deletionScheduled`フラグがtrueに設定
2. `scheduledDeletionDate`が30日後に設定
3. 新規データ作成・更新が禁止される
4. データエクスポートのみ可能

#### ステップ2: 30日猶予期間

猶予期間中は以下が可能です：
- データの閲覧
- データエクスポート
- 削除のキャンセル

#### ステップ3: 完全削除

30日後、以下が自動実行されます：
1. Firestoreからユーザーデータを完全削除
2. Firebase Authenticationからアカウント削除
3. BigQueryの仮名化データを削除
4. Stripe/RevenueCat顧客情報を削除

---

## 変更履歴

| バージョン | 日付 | 主な変更内容 |
|-----------|------|-------------|
| **v1.0** | 2025年12月9日 | 初版作成。Flutter版を基に、Expo版の5種目（squat, pushup, armcurl, sidelateral, shoulderpress）に対応。Stripe決済連携を追加。 |

---

**このドキュメントは、Expo版とFlutter版の両方で共通利用可能です。**

**作成者**: Claude (Documentation Engineer)
**最終確認日**: 2025年12月9日
