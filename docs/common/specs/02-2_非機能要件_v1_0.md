# 非機能要件 v1.0

**バージョン**: 1.0
**最終更新日**: 2025年12月9日
**対象**: AIフィットネスアプリ（共通仕様）
**基準**: Expo版要件定義書 v1.0

---

## 目次

1. [非機能要件概要](#1-非機能要件概要)
2. [パフォーマンス要件](#2-パフォーマンス要件)
3. [可用性要件](#3-可用性要件)
4. [スケーラビリティ要件](#4-スケーラビリティ要件)
5. [セキュリティ要件](#5-セキュリティ要件)
6. [プライバシー要件](#6-プライバシー要件)
7. [GDPR対応要件](#7-gdpr対応要件)
8. [ユーザビリティ要件](#8-ユーザビリティ要件)
9. [互換性要件](#9-互換性要件)
10. [保守性要件](#10-保守性要件)
11. [監視要件](#11-監視要件)
12. [バックアップ要件](#12-バックアップ要件)
13. [UI/UX要件](#13-uiux要件)
14. [追加要件](#14-追加要件)
15. [管理者機能向け要件](#15-管理者機能向け要件)
16. [技術検証要件](#16-技術検証要件)

---

## 1. 非機能要件概要

### 1.1 非機能要件とは

非機能要件とは、「何ができるか」ではなく「どれくらい速いか」「どれくらい安全か」など、アプリの品質に関する要件です。

### 1.2 非機能要件の重要性

機能要件がアプリの「機能」を定義するのに対し、非機能要件はアプリの「品質」を定義します。これにより、以下が保証されます：

- ユーザーが快適に使える速度
- データが安全に保護される
- サービスが安定して提供される
- 法律や規制に準拠する

---

## 2. パフォーマンス要件

アプリがどれくらい速く動くかに関する要件です。

### NFR-001: アプリ起動時間

| ID | NFR-001 |
|----|---------|
| **カテゴリ** | パフォーマンス |
| **要件** | アプリ起動時間 |
| **目標値** | 3秒以内 |
| **説明** | アプリのアイコンをタップしてから、使える状態になるまでの時間です。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

---

### NFR-002: MediaPipeフレームレート

| ID | NFR-002 |
|----|---------|
| **カテゴリ** | パフォーマンス |
| **要件** | MediaPipeフレームレート |
| **目標値** | 30fps以上 |
| **説明** | 1秒間に30回以上、骨格を検出できることを目指します。これにより、なめらかなリアルタイム確認ができます。Phase 2開始前に技術検証（PoC）を実施し、目標達成可能かを確認します。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 2 |

**fpsとは？**

fps（フレーム・パー・セカンド）は「1秒間に何枚の画像を処理できるか」を表します。30fpsなら、1秒間に30枚の画像を分析して、骨格の位置を特定できます。数字が大きいほど、なめらかに動いて見えます。

---

### NFR-003: APIレスポンス時間

| ID | NFR-003 |
|----|---------|
| **カテゴリ** | パフォーマンス |
| **要件** | APIレスポンス時間 |
| **目標値** | 200ms以内 |
| **説明** | サーバーとのやり取り（データの保存や読み込み）が0.2秒以内に完了することを目指します。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

---

### NFR-004: データベースクエリ

| ID | NFR-004 |
|----|---------|
| **カテゴリ** | パフォーマンス |
| **要件** | データベースクエリ |
| **目標値** | 100ms以内 |
| **説明** | データベースからデータを取り出す時間が0.1秒以内であることを目指します。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

---

## 3. 可用性要件

アプリがいつでも使えるかに関する要件です。

### NFR-005: アップタイム

| ID | NFR-005 |
|----|---------|
| **カテゴリ** | 可用性 |
| **要件** | アップタイム |
| **目標値** | 99.5%以上 |
| **説明** | 1年のうち99.5%の時間（約363.2日）は、アプリが正常に使える状態であることを目指します。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

**99.5%の稼働率とは？**

1年間（8,760時間）のうち、使えない時間が約43.8時間以内ということです。つまり、ほとんどいつでも使える状態を保ちます。

---

### NFR-006: メンテナンス時間

| ID | NFR-006 |
|----|---------|
| **カテゴリ** | 可用性 |
| **要件** | メンテナンス時間 |
| **目標値** | 月4時間以内 |
| **説明** | システムの更新や修理のために使えなくなる時間は、1ヶ月に4時間以内に抑えます。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

---

## 4. スケーラビリティ要件

ユーザーが増えても大丈夫かに関する要件です。

### NFR-007: 同時接続数

| ID | NFR-007 |
|----|---------|
| **カテゴリ** | スケーラビリティ |
| **要件** | 同時接続数 |
| **目標値** | 1,000ユーザー |
| **説明** | 同じ時間に1,000人が使っても、問題なく動くことを目指します。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 2 |

---

### NFR-008: データ増加対応

| ID | NFR-008 |
|----|---------|
| **カテゴリ** | スケーラビリティ |
| **要件** | データ増加対応 |
| **目標値** | 自動スケール |
| **説明** | データが増えても、自動的にサーバーの容量が増えて対応できます。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 2 |

---

## 5. セキュリティ要件

データを守るための安全対策に関する要件です。

### NFR-009: 通信暗号化

| ID | NFR-009 |
|----|---------|
| **カテゴリ** | セキュリティ |
| **要件** | 通信暗号化 |
| **目標値** | TLS 1.3 |
| **説明** | スマホとサーバー間の通信を暗号化（他の人に読めないようにすること）します。TLS 1.3は最新の暗号化技術です。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

---

### NFR-010: データ暗号化

| ID | NFR-010 |
|----|---------|
| **カテゴリ** | セキュリティ |
| **要件** | データ暗号化 |
| **目標値** | AES-256 |
| **説明** | 保存されているデータも暗号化します。AES-256は、とても強力な暗号化方式で、解読はほぼ不可能です。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

**暗号化とは？**

データを他の人に読めないようにする技術です。例えば「こんにちは」を「%#@&!」のように変換します。正しい鍵（パスワードのようなもの）がないと、元に戻せません。

---

### NFR-011: 認証

| ID | NFR-011 |
|----|---------|
| **カテゴリ** | セキュリティ |
| **要件** | 認証 |
| **目標値** | JWT, OAuth 2.0 |
| **説明** | ログインした人が本人かどうかを確認する仕組みです。JWTという「電子的な身分証明書」を使います。 |
| **実装状況** | 一部実装 |
| **Phase** | Phase 1 |

---

### NFR-012: アクセス制御

| ID | NFR-012 |
|----|---------|
| **カテゴリ** | セキュリティ |
| **要件** | アクセス制御 |
| **目標値** | Cloud IAM |
| **説明** | 誰がどのデータにアクセスできるかを細かく管理します。自分のデータは自分だけが見られます。 |
| **実装状況** | 一部実装 |
| **Phase** | Phase 1 |

---

### NFR-013: 脆弱性診断

| ID | NFR-013 |
|----|---------|
| **カテゴリ** | セキュリティ |
| **要件** | 脆弱性診断 |
| **目標値** | リリース前に実施 |
| **説明** | アプリを公開する前に、セキュリティの穴（弱い部分）がないかチェックします。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 2 |

---

### NFR-014: ペネトレーションテスト

| ID | NFR-014 |
|----|---------|
| **カテゴリ** | セキュリティ |
| **要件** | ペネトレーションテスト |
| **目標値** | リリース前に実施 |
| **説明** | 専門家が「悪い人」の立場でアプリを攻撃してみて、本当に安全か確かめます。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 2 |

---

## 6. プライバシー要件

個人情報を守るための要件です。

### NFR-015: オンデバイス処理

| ID | NFR-015 |
|----|---------|
| **カテゴリ** | プライバシー |
| **要件** | オンデバイス処理 |
| **目標値** | カメラ映像 |
| **説明** | カメラで撮った映像は、スマホの中だけで処理します。インターネットに送られることはありません。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 2 |

**オンデバイス処理とは？**

データをインターネットに送らず、スマホの中だけで処理することです。これにより、カメラ映像が外部に漏れることを防ぎます。

---

### NFR-016: 仮名化

| ID | NFR-016 |
|----|---------|
| **カテゴリ** | プライバシー |
| **要件** | 仮名化 |
| **目標値** | ユーザーID |
| **説明** | 統計データを分析する時は、誰のデータかわからないように「仮の名前」に置き換えます。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

---

### NFR-017: データ削除と猶予期間制御

| ID | NFR-017 |
|----|---------|
| **カテゴリ** | プライバシー |
| **要件** | データ削除と猶予期間制御 |
| **目標値** | 30日以内 |
| **説明** | 削除をお願いしたら、30日以内に完全に消去します。その間、データは読み取り専用になります。 |
| **実装状況** | 一部実装 |
| **Phase** | Phase 1 |

---

### NFR-018: データエクスポート

| ID | NFR-018 |
|----|---------|
| **カテゴリ** | プライバシー |
| **要件** | データエクスポート |
| **目標値** | 30日以内 |
| **説明** | 自分のデータをダウンロードしたいとお願いしたら、30日以内に用意します。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

---

## 7. GDPR対応要件

ヨーロッパの個人情報保護法（GDPR）に従うための要件です。

### NFR-019: 同意管理

| ID | NFR-019 |
|----|---------|
| **カテゴリ** | GDPR対応 |
| **要件** | 同意管理 |
| **目標値** | 記録保持 |
| **説明** | 「いつ」「何に」同意したかを、きちんと記録して保管します。 |
| **実装状況** | 一部実装 |
| **Phase** | Phase 1 |

---

### NFR-020: データ侵害通知

| ID | NFR-020 |
|----|---------|
| **カテゴリ** | GDPR対応 |
| **要件** | データ侵害通知 |
| **目標値** | 72時間以内 |
| **説明** | もし万が一、データが流出するようなことがあった場合、72時間（3日）以内に関係機関とユーザーに通知します。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

---

## 8. ユーザビリティ要件

使いやすさに関する要件です。

### NFR-021: 操作性

| ID | NFR-021 |
|----|---------|
| **カテゴリ** | ユーザビリティ |
| **要件** | 操作性 |
| **目標値** | 3タップ以内 |
| **説明** | 主な機能（トレーニング開始など）に、3回以内のタップでたどり着けるようにします。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

---

### NFR-022: エラーメッセージ

| ID | NFR-022 |
|----|---------|
| **カテゴリ** | ユーザビリティ |
| **要件** | エラーメッセージ |
| **目標値** | 平易な言語 |
| **説明** | エラーが起きた時のメッセージは、専門用語を使わず、誰でもわかる言葉で表示します。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

---

### NFR-023: アクセシビリティ

| ID | NFR-023 |
|----|---------|
| **カテゴリ** | ユーザビリティ |
| **要件** | アクセシビリティ |
| **目標値** | WCAG 2.1 AA |
| **説明** | 目が見えにくい人や、耳が聞こえにくい人も使えるように配慮します（音声読み上げ対応など）。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 4 |

**WCAGとは？**

Web Content Accessibility Guidelines（ウェブコンテンツ・アクセシビリティ・ガイドライン）の略で、障害のある人もウェブやアプリを使いやすくするための国際的な基準です。

---

## 9. 互換性要件

どんなスマホで使えるかに関する要件です。

### NFR-024: iOS最低要件

| ID | NFR-024 |
|----|---------|
| **カテゴリ** | 互換性 |
| **要件** | iOS最低要件 |
| **目標値** | iOS 15.0以上、RAM 2GB以上 |
| **説明** | iPhoneを使う場合、iOS 15.0以上で、メモリ（RAM）が2GB以上必要です。iPhone 6s以降が対象です。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

---

### NFR-025: Android最低要件

| ID | NFR-025 |
|----|---------|
| **カテゴリ** | 互換性 |
| **要件** | Android最低要件 |
| **目標値** | Android 8.0以上、RAM 3GB以上 |
| **説明** | Androidスマホの場合、Android 8.0（Oreo）以上で、メモリが3GB以上必要です。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

**なぜRAM（メモリ）が必要？**

AIでカメラ映像を分析するには、たくさんの計算が必要です。メモリが少ないスマホだと、動作が遅くなったり、アプリが落ちたりする可能性があります。

---

## 10. 保守性要件

アプリを長く維持・改善していくための要件です。

### NFR-026: コードカバレッジ

| ID | NFR-026 |
|----|---------|
| **カテゴリ** | 保守性 |
| **要件** | コードカバレッジ |
| **目標値** | 80%以上 |
| **説明** | プログラムのテスト（動作確認）が、コード全体の80%以上をカバーしていること。バグを早く見つけられます。 |
| **実装状況** | 一部実装 |
| **Phase** | Phase 1 |

---

### NFR-027: ドキュメント

| ID | NFR-027 |
|----|---------|
| **カテゴリ** | 保守性 |
| **要件** | ドキュメント |
| **目標値** | 全機能 |
| **説明** | すべての機能について、説明書（ドキュメント）を用意します。開発者が引き継ぎやすくなります。 |
| **実装状況** | 一部実装 |
| **Phase** | Phase 1 |

---

## 11. 監視要件

アプリが正常に動いているか監視するための要件です。

### NFR-028: ログ収集

| ID | NFR-028 |
|----|---------|
| **カテゴリ** | 監視 |
| **要件** | ログ収集 |
| **目標値** | Cloud Logging |
| **説明** | アプリの動作記録（ログ）をクラウドに保存します。問題が起きた時に原因を調べられます。 |
| **実装状況** | 一部実装 |
| **Phase** | Phase 1 |

---

### NFR-029: エラー監視

| ID | NFR-029 |
|----|---------|
| **カテゴリ** | 監視 |
| **要件** | エラー監視 |
| **目標値** | Firebase Crashlytics |
| **説明** | アプリがクラッシュ（突然終了）した時に、自動で報告されます。すぐに修正に取りかかれます。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

---

### NFR-030: パフォーマンス監視

| ID | NFR-030 |
|----|---------|
| **カテゴリ** | 監視 |
| **要件** | パフォーマンス監視 |
| **目標値** | Firebase Performance |
| **説明** | アプリの速度や応答時間を監視します。遅くなっていたら、改善に取り組めます。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

---

## 12. バックアップ要件

データを失わないための要件です。

### NFR-031: データバックアップ

| ID | NFR-031 |
|----|---------|
| **カテゴリ** | バックアップ |
| **要件** | データバックアップ |
| **目標値** | 日次 |
| **説明** | 毎日1回、すべてのデータのコピーを作ります。もしデータが壊れても、前日の状態に戻せます。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

---

### NFR-032: 復旧時間目標（RTO）

| ID | NFR-032 |
|----|---------|
| **カテゴリ** | バックアップ |
| **要件** | 復旧時間目標（RTO） |
| **目標値** | 24時間以内 |
| **説明** | 大きな障害が起きても、24時間以内にサービスを復旧させることを目指します。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 1 |

**RTOとは？**

Recovery Time Objective（リカバリータイム・オブジェクティブ）の略で、「復旧までにかかる最大時間の目標」のことです。

---

## 13. UI/UX要件

画面のデザインと操作性に関する要件です。

### NFR-033: ナビゲーションバー

| ID | NFR-033 |
|----|---------|
| **カテゴリ** | UI/UX |
| **要件** | ナビゲーションバー |
| **目標値** | 全画面 |
| **説明** | 画面下部に常に表示されるナビゲーションバー（タブバー）を設置します。「ホーム」「トレーニング」「履歴」「プロフィール」の4つのタブがあります。 |
| **実装状況** | 一部実装 |
| **Phase** | Phase 1 |

**ナビゲーションバーのタブ構成**:

| タブ名 | アイコン | 説明 |
|--------|---------|------|
| ホーム | 家のマーク | トップ画面に戻ります |
| トレーニング | ダンベルのマーク | トレーニングを始める画面に行きます |
| 履歴 | グラフのマーク | 過去のトレーニング記録を見られます |
| プロフィール | 人のマーク | 自分の情報や設定を変更できます |

---

## 14. 追加要件

v3.3で追加された、より詳細な要件です。

### NFR-034: Firestoreセキュリティルール詳細

| ID | NFR-034 |
|----|---------|
| **カテゴリ** | セキュリティ |
| **要件** | Firestoreセキュリティルール詳細 |
| **目標値** | 完全実装 |
| **説明** | データベースへのアクセス権限を細かく設定します。他の人のデータは絶対に見られないようにします。 |
| **実装状況** | 一部実装 |
| **Phase** | Phase 1 |

---

### NFR-035: MediaPipeフレームレート監視・フォールバック

| ID | NFR-035 |
|----|---------|
| **カテゴリ** | パフォーマンス |
| **要件** | MediaPipeフレームレート監視・フォールバック |
| **目標値** | 20fps以上維持 |
| **説明** | 骨格検出の速度を監視し、遅くなったら自動で軽量モードに切り替えます（フォールバック）。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 2 |

**フォールバックとは？**

メインの機能が使えない時に、代わりの方法で動くことです。例えば、30fpsで動かなければ、画質を下げて20fpsで動かす、という感じです。

---

### NFR-036: BigQueryリトライ処理・DLQ

| ID | NFR-036 |
|----|---------|
| **カテゴリ** | 可用性 |
| **要件** | BigQueryリトライ処理・DLQ |
| **目標値** | 99.9%成功率 |
| **説明** | データの分析システムへの送信が失敗しても、自動で再送します。99.9%の成功率を目指します。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 2 |

---

### NFR-037: Functionsコールドスタート対策

| ID | NFR-037 |
|----|---------|
| **カテゴリ** | パフォーマンス |
| **要件** | Functionsコールドスタート対策 |
| **目標値** | 500ms未満 |
| **説明** | サーバーが「眠っている」状態から起きる時間（コールドスタート）を0.5秒未満に抑えます。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 2 |

**コールドスタートとは？**

サーバーは、使われていない時は「眠っている」状態になります（コスト削減のため）。リクエストが来ると「起きる」のですが、その起動に時間がかかることを「コールドスタート」と言います。

---

## 15. 管理者機能向け要件

管理者機能を安全に運用するための要件です。

### NFR-038: 管理者認証

| ID | NFR-038 |
|----|---------|
| **カテゴリ** | セキュリティ |
| **要件** | 管理者認証 |
| **目標値** | 多要素認証必須 |
| **説明** | 管理者としてログインする際は、パスワードに加えてスマホの認証アプリなど、2つ以上の認証が必要です。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 4 |

---

### NFR-039: 監査ログ保存期間

| ID | NFR-039 |
|----|---------|
| **カテゴリ** | 監査 |
| **要件** | 監査ログ保存期間 |
| **目標値** | 2年以上 |
| **説明** | 管理者の操作履歴は2年以上保存し、不正があった場合に調査できるようにします。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 4 |

---

### NFR-040: IPアドレス制限

| ID | NFR-040 |
|----|---------|
| **カテゴリ** | セキュリティ |
| **要件** | IPアドレス制限 |
| **目標値** | 許可リスト方式 |
| **説明** | 管理画面には、あらかじめ許可されたIPアドレスからのみアクセスできます。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 4 |

---

### NFR-041: 異常検知アラート

| ID | NFR-041 |
|----|---------|
| **カテゴリ** | 監視 |
| **要件** | 異常検知アラート |
| **目標値** | リアルタイム |
| **説明** | 不正なアクセスパターンを検知したら、すぐに管理者にアラートを送信します。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 4 |

---

### NFR-042: 管理画面レスポンス

| ID | NFR-042 |
|----|---------|
| **カテゴリ** | パフォーマンス |
| **要件** | 管理画面レスポンス |
| **目標値** | 3秒以内 |
| **説明** | 管理画面の各操作は3秒以内に完了することを目指します。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 4 |

---

## 16. 技術検証要件

MediaPipe統合の技術検証に関する要件です。

### NFR-043: MediaPipe PoC

| ID | NFR-043 |
|----|---------|
| **カテゴリ** | 技術検証 |
| **要件** | MediaPipe PoC |
| **目標値** | Phase 2開始前に完了 |
| **説明** | Expo/React Native環境でMediaPipeが30fps以上で動作することを確認します。iOS/Android両方で検証し、問題がある場合はTensorFlow.jsを代替案として検討します。 |
| **実装状況** | 未実装 |
| **Phase** | Phase 2開始前 |

**技術検証で確認すること**:
- Development Buildでの動作確認
- iOS/Androidそれぞれでのフレームレート測定
- メモリ使用量の確認
- 代替手段（TensorFlow.js）の動作確認

**検証期間の目安**: 2〜3週間

---

## 非機能要件サマリー

### カテゴリ別要件数

| カテゴリ | 要件数 | Phase 1 | Phase 2 | Phase 3 | Phase 4 |
|---------|--------|---------|---------|---------|---------|
| パフォーマンス | 7件 | 2件 | 4件 | 0件 | 1件 |
| 可用性 | 3件 | 2件 | 1件 | 0件 | 0件 |
| スケーラビリティ | 2件 | 0件 | 2件 | 0件 | 0件 |
| セキュリティ | 9件 | 4件 | 3件 | 0件 | 2件 |
| プライバシー | 4件 | 3件 | 1件 | 0件 | 0件 |
| GDPR対応 | 2件 | 2件 | 0件 | 0件 | 0件 |
| ユーザビリティ | 3件 | 2件 | 0件 | 0件 | 1件 |
| 互換性 | 2件 | 2件 | 0件 | 0件 | 0件 |
| 保守性 | 2件 | 2件 | 0件 | 0件 | 0件 |
| 監視 | 4件 | 3件 | 0件 | 0件 | 1件 |
| バックアップ | 2件 | 2件 | 0件 | 0件 | 0件 |
| UI/UX | 1件 | 1件 | 0件 | 0件 | 0件 |
| 監査 | 1件 | 0件 | 0件 | 0件 | 1件 |
| 技術検証 | 1件 | 0件 | 1件 | 0件 | 0件 |
| **合計** | **43件** | **25件** | **12件** | **0件** | **6件** |

### 優先度別分類

| 優先度 | 件数 | 説明 |
|--------|------|------|
| 必須 | 36件 | 必ず実装しなければならない要件 |
| 推奨 | 6件 | 実装が望ましい要件（NFR-014, NFR-023, NFR-035, NFR-037, NFR-040, NFR-042） |

---

## 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|----------|
| 1.0 | 2025年12月9日 | 初版作成（Expo版要件定義書v1.0をベースに共通仕様書として統合） |

---

**作成者**: Documentation Engineer
**最終確認日**: 2025年12月9日
