# ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã‚¬ã‚¤ãƒ‰

**å¯¾è±¡**: ä¸­å­¦ç”Ÿã€œé«˜æ ¡ç”Ÿãƒ»åˆå¿ƒè€…ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼
**æœ€çµ‚æ›´æ–°**: 2025å¹´12æœˆ10æ—¥

---

## ã“ã®ã‚¬ã‚¤ãƒ‰ã«ã¤ã„ã¦

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€é–‹ç™ºã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æœ¬ç•ªç’°å¢ƒï¼ˆå®Ÿéš›ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½¿ã†ç’°å¢ƒï¼‰ã«å…¬é–‹ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

**ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆDeployï¼‰** ã¨ã¯ã€ä½œæˆã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€å®Ÿéš›ã«ä½¿ãˆã‚‹çŠ¶æ…‹ã«ã™ã‚‹ã“ã¨ã§ã™ã€‚

---

## ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å‰ã«ç¢ºèªã™ã‚‹ã“ã¨

ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å‰ã«ã€å¿…ãšä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

### ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] å…¨ã¦ã®ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã—ã¦ã„ã‚‹
- [ ] Lintã‚¨ãƒ©ãƒ¼ãŒãªã„
- [ ] ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§å‹•ä½œç¢ºèªæ¸ˆã¿
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆç¢ºèªæ¸ˆã¿
- [ ] å¤‰æ›´å†…å®¹ã‚’Gitã«ã‚³ãƒŸãƒƒãƒˆæ¸ˆã¿

---

## ãƒ‡ãƒ—ãƒ­ã‚¤ã®ç¨®é¡

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä»¥ä¸‹ã®3ç¨®é¡ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚

| å¯¾è±¡ | å†…å®¹ | ã‚³ãƒãƒ³ãƒ‰ |
|------|------|---------|
| **Cloud Functions** | ã‚µãƒ¼ãƒãƒ¼å´ã®API | `firebase deploy --only functions` |
| **Firestore Rules** | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ | `firebase deploy --only firestore:rules` |
| **Storage Rules** | ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ | `firebase deploy --only storage:rules` |
| **Firestore Indexes** | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ | `firebase deploy --only firestore:indexes` |
| **å…¨ã¦** | ä¸Šè¨˜å…¨ã¦ | `firebase deploy` |

---

## ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®ãƒ†ã‚¹ãƒˆ

### 1.1 Cloud Functionsã®ãƒ†ã‚¹ãƒˆ

```bash
cd functions
npm run lint        # ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯
npm test            # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
npm run build       # ãƒ“ãƒ«ãƒ‰ï¼ˆTypeScript â†’ JavaScriptï¼‰
```

**å…¨ã¦æˆåŠŸã™ã‚‹ã“ã¨ã‚’ç¢ºèª**:
```
âœ“ ESLint: no errors
âœ“ Tests: XX passed, XX total
âœ“ Build: successful
```

### 1.2 Firestore Rulesã®ãƒ†ã‚¹ãƒˆ

```bash
cd ../firebase
npm test            # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆ
```

**å…¨ã¦æˆåŠŸã™ã‚‹ã“ã¨ã‚’ç¢ºèª**:
```
Test Suites: 1 passed, 1 total
Tests:       40 passed, 40 total
```

### 1.3 ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§å‹•ä½œç¢ºèª

```bash
cd ..
firebase emulators:start
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:4000 ã‚’é–‹ã„ã¦ã€ä»¥ä¸‹ã‚’ç¢ºèª:
- Functions ãŒæ­£ã—ãå‹•ä½œã™ã‚‹
- Firestore Rules ãŒæœŸå¾…é€šã‚Šã«å‹•ã
- ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒãªã„

**OK ãªã‚‰ Ctrl+C ã§ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’åœæ­¢**

---

## ã‚¹ãƒ†ãƒƒãƒ—2: Gitã«ã‚³ãƒŸãƒƒãƒˆ

ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å‰ã«ã€å¤‰æ›´ã‚’Gitã«è¨˜éŒ²ã—ã¾ã™ã€‚

### 2.1 å¤‰æ›´ã‚’ç¢ºèª

```bash
git status
```

**è¡¨ç¤ºä¾‹**:
```
Changes not staged for commit:
  modified:   functions/src/api/users/updateProfile.ts
  modified:   functions/tests/api/users/updateProfile.test.ts
```

### 2.2 ã‚¹ãƒ†ãƒ¼ã‚¸ã«è¿½åŠ 

```bash
# å…¨ã¦ã®å¤‰æ›´ã‚’è¿½åŠ 
git add .

# ã¾ãŸã¯ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘
git add functions/src/api/users/updateProfile.ts
```

### 2.3 ã‚³ãƒŸãƒƒãƒˆ

```bash
git commit -m "feat: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°APIã‚’æ”¹å–„"
```

**ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ›¸ãæ–¹**:
- `feat:` - æ–°æ©Ÿèƒ½è¿½åŠ 
- `fix:` - ãƒã‚°ä¿®æ­£
- `docs:` - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
- `test:` - ãƒ†ã‚¹ãƒˆè¿½åŠ ãƒ»ä¿®æ­£
- `refactor:` - ã‚³ãƒ¼ãƒ‰æ•´ç†

### 2.4 ãƒ—ãƒƒã‚·ãƒ¥ï¼ˆGitHub ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰

```bash
git push origin main
```

---

## ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ

### 3.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç¢ºèª

```bash
firebase use
```

**è¡¨ç¤ºä¾‹**:
```
Active Project: tokyo-list-478804-e5 (your-project-name)
```

**é–“é•ã£ã¦ã„ãŸã‚‰**:
```bash
firebase use tokyo-list-478804-e5
```

### 3.2 Cloud Functionsã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
firebase deploy --only functions
```

**å®Ÿè¡Œä¾‹**:
```
=== Deploying to 'tokyo-list-478804-e5'...

i  deploying functions
i  functions: ensuring required API cloudfunctions.googleapis.com is enabled...
i  functions: ensuring required API cloudbuild.googleapis.com is enabled...
âœ”  functions: required API cloudfunctions.googleapis.com is enabled
âœ”  functions: required API cloudbuild.googleapis.com is enabled
i  functions: preparing codebase default for deployment
i  functions: preparing functions directory for uploading...
i  functions: packaged functions (50.2 MB) for uploading
âœ”  functions: functions folder uploaded successfully
i  functions: creating Node.js 20 function updateProfile(asia-northeast1)...
âœ”  functions[updateProfile(asia-northeast1)] Successful create operation.
i  functions: creating Node.js 20 function getProfile(asia-northeast1)...
âœ”  functions[getProfile(asia-northeast1)] Successful create operation.

âœ”  Deploy complete!

Functions:
  updateProfile(asia-northeast1): https://asia-northeast1-tokyo-list-478804-e5.cloudfunctions.net/updateProfile
  getProfile(asia-northeast1): https://asia-northeast1-tokyo-list-478804-e5.cloudfunctions.net/getProfile
```

### 3.3 Firestore Rulesã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
firebase deploy --only firestore:rules
```

**å®Ÿè¡Œä¾‹**:
```
=== Deploying to 'tokyo-list-478804-e5'...

i  deploying firestore
i  firestore: checking firestore.rules for compilation errors...
âœ”  firestore: rules file firestore.rules compiled successfully
i  firestore: uploading rules firestore.rules...
âœ”  firestore: released rules firestore.rules to cloud.firestore

âœ”  Deploy complete!
```

### 3.4 å…¨ã¦ã¾ã¨ã‚ã¦ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# Cloud Functions + Firestore Rules + Storage Rules + Indexes
firebase deploy
```

**è­¦å‘Š**: å…¨ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¨æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ï¼ˆ5ã€œ10åˆ†ï¼‰ã€‚
å¤‰æ›´ã—ãŸéƒ¨åˆ†ã ã‘ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹ãŒåŠ¹ç‡çš„ã§ã™ã€‚

---

## ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèª

### 4.1 Firebase Console ã§ç¢ºèª

1. **Firebase Console** ã‚’é–‹ã
   - https://console.firebase.google.com/
   - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ `tokyo-list-478804-e5` ã‚’é¸æŠ

2. **Functions** ã‚¿ãƒ–ã‚’é–‹ã
   - ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸé–¢æ•°ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - çŠ¶æ…‹ãŒã€Œæœ‰åŠ¹ã€ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª

3. **Firestore** ã‚¿ãƒ–ã‚’é–‹ã
   - ãƒ«ãƒ¼ãƒ«ãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - ã€Œãƒ«ãƒ¼ãƒ«ã€ã‚¿ãƒ–ã§ãƒ«ãƒ¼ãƒ«ã®å†…å®¹ã‚’ç¢ºèª

### 4.2 ãƒ­ã‚°ã‚’ç¢ºèª

```bash
# æœ€æ–°ã®ãƒ­ã‚°ã‚’ç¢ºèª
firebase functions:log

# ç‰¹å®šã®é–¢æ•°ã®ãƒ­ã‚°ã‚’ç¢ºèª
firebase functions:log --only updateProfile
```

**ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª**

### 4.3 å‹•ä½œãƒ†ã‚¹ãƒˆ

**æ–¹æ³•1: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªã‹ã‚‰å‘¼ã³å‡ºã—**

Flutter ã‚¢ãƒ—ãƒªã‹ã‚‰å®Ÿéš›ã«APIã‚’å‘¼ã³å‡ºã—ã¦ã¿ã‚‹ã€‚

**æ–¹æ³•2: Cloud Console ã‹ã‚‰å‘¼ã³å‡ºã—**

1. Firebase Console â†’ Functions â†’ é–¢æ•°åã‚’ã‚¯ãƒªãƒƒã‚¯
2. ã€Œãƒ†ã‚¹ãƒˆã€ã‚¿ãƒ–
3. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦å®Ÿè¡Œ

---

## ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆå…ƒã«æˆ»ã™ï¼‰

ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«å•é¡ŒãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã€å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æˆ»ã›ã¾ã™ã€‚

### Cloud Functions ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

```bash
# é–¢æ•°ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´ã‚’ç¢ºèª
firebase functions:list

# ç‰¹å®šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
gcloud functions deploy updateProfile \
  --source <å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚½ãƒ¼ã‚¹> \
  --runtime nodejs20 \
  --region asia-northeast1 \
  --trigger-http
```

**ç°¡å˜ãªæ–¹æ³•**: å‰ã®Gitã‚³ãƒŸãƒƒãƒˆã«æˆ»ã—ã¦ã‹ã‚‰å†ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# Gitã§å‰ã®ã‚³ãƒŸãƒƒãƒˆã«æˆ»ã‚‹
git revert HEAD

# å†ãƒ‡ãƒ—ãƒ­ã‚¤
firebase deploy --only functions
```

### Firestore Rules ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

Firebase Console ã‹ã‚‰:
1. Firestore â†’ ãƒ«ãƒ¼ãƒ« â†’ ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´
2. å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸æŠ
3. ã€Œå…¬é–‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

---

## CI/CDï¼ˆè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰

GitHub ã« push ã—ãŸã‚‰è‡ªå‹•ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹è¨­å®šã§ã™ã€‚

### è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã®æµã‚Œ

```
ã‚³ãƒ¼ãƒ‰ã‚’GitHub ã«push
    â†“
GitHub Actions ãŒè‡ªå‹•å®Ÿè¡Œ
    â†“
1. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
2. Lint ãƒã‚§ãƒƒã‚¯
3. ãƒ“ãƒ«ãƒ‰
4. ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæ‰¿èªãŒå¿…è¦ãªå ´åˆã‚ã‚Šï¼‰
    â†“
æœ¬ç•ªç’°å¢ƒã«åæ˜ 
```

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä»¥ä¸‹ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™:

| ãƒ•ã‚¡ã‚¤ãƒ« | å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚° | å†…å®¹ |
|---------|-------------|------|
| `.github/workflows/functions-ci.yml` | PRä½œæˆæ™‚ãƒ»pushæ™‚ | Functions ã®ãƒ†ã‚¹ãƒˆ |
| `.github/workflows/firestore-rules-ci.yml` | PRä½œæˆæ™‚ãƒ»pushæ™‚ | Rulesã®ãƒ†ã‚¹ãƒˆ |
| `.github/workflows/deploy.yml` | mainãƒ–ãƒ©ãƒ³ãƒpushæ™‚ | æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ |

### GitHub ã§æ‰¿èªè¨­å®š

æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¯æ‰¿èªãŒå¿…è¦ã§ã™ã€‚

**è¨­å®šæ–¹æ³•**:
1. GitHub ãƒªãƒã‚¸ãƒˆãƒª â†’ Settings â†’ Environments
2. `production` ç’°å¢ƒã‚’ä½œæˆ
3. Required reviewers ã‚’è¨­å®šï¼ˆæ‰¿èªè€…ã‚’æŒ‡å®šï¼‰

**ãƒ‡ãƒ—ãƒ­ã‚¤ã®æµã‚Œ**:
```
main ãƒ–ãƒ©ãƒ³ãƒã« push
    â†“
GitHub Actions èµ·å‹•
    â†“
æ‰¿èªå¾…ã¡ï¼ˆSlackãªã©ã«é€šçŸ¥ï¼‰
    â†“
æ‰¿èªè€…ãŒ GitHub ã§ã€ŒApproveã€
    â†“
ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: `HTTP Error: 403, The caller does not have permission`

**åŸå› **: ãƒ‡ãƒ—ãƒ­ã‚¤æ¨©é™ãŒãªã„

**è§£æ±ºæ³•**:
1. Firebase Console â†’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨æ¨©é™
2. è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã€Œç·¨é›†è€…ã€ä»¥ä¸Šã®æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã‹ç¢ºèª

---

### ã‚¨ãƒ©ãƒ¼: `Function deployment failed`

**åŸå› **: ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯ãƒ¡ãƒ¢ãƒªä¸è¶³

**è§£æ±ºæ³•**:

1. **ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã®å ´åˆ**
```bash
cd functions
npm run build
# ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ä¿®æ­£
```

2. **ãƒ¡ãƒ¢ãƒªä¸è¶³ã®å ´åˆ**

`functions/src/index.ts` ã§ãƒ¡ãƒ¢ãƒªã‚’å¢—ã‚„ã™:
```typescript
import { setGlobalOptions } from "firebase-functions/v2";

setGlobalOptions({
  region: "asia-northeast1",
  memory: "512MiB",  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯256MiB
  timeoutSeconds: 60,
});
```

---

### ã‚¨ãƒ©ãƒ¼: `Deployment quota exceeded`

**åŸå› **: 1æ—¥ã®ãƒ‡ãƒ—ãƒ­ã‚¤å›æ•°åˆ¶é™ã‚’è¶…ãˆãŸ

**è§£æ±ºæ³•**:
- ãƒ‡ãƒ—ãƒ­ã‚¤å›æ•°ã‚’æ¸›ã‚‰ã™ï¼ˆã¾ã¨ã‚ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰
- æ˜æ—¥ã¾ã§å¾…ã¤
- Firebase ãƒ—ãƒ©ãƒ³ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼ˆæœ‰æ–™ãƒ—ãƒ©ãƒ³ï¼‰

---

### ãƒ‡ãƒ—ãƒ­ã‚¤ãŒé…ã„

**å¯¾ç­–**:
1. **å·®åˆ†ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ä½¿ã†**
```bash
# å¤‰æ›´ã—ãŸé–¢æ•°ã ã‘ãƒ‡ãƒ—ãƒ­ã‚¤
firebase deploy --only functions:updateProfile
```

2. **ä¸¦åˆ—ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ç„¡åŠ¹åŒ–**
```bash
# 1ã¤ãšã¤ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆå®‰å®šæ€§å„ªå…ˆï¼‰
firebase deploy --only functions --force
```

---

## ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. æ®µéšçš„ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# ã‚¹ãƒ†ãƒƒãƒ—1: Firestore Rulesã®ã¿
firebase deploy --only firestore:rules

# ã‚¹ãƒ†ãƒƒãƒ—2: 1ã¤ã®é–¢æ•°ã‚’ãƒ†ã‚¹ãƒˆ
firebase deploy --only functions:updateProfile

# ã‚¹ãƒ†ãƒƒãƒ—3: å•é¡Œãªã‘ã‚Œã°å…¨é–¢æ•°
firebase deploy --only functions
```

### 2. ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®ãƒ†ã‚¹ãƒˆ

```bash
# ãƒ†ã‚¹ãƒˆ â†’ Lint â†’ ãƒ“ãƒ«ãƒ‰ ã®é †ã«å®Ÿè¡Œ
cd functions
npm test && npm run lint && npm run build
```

**å…¨ã¦æˆåŠŸã—ãŸã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤**

### 3. ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèª

- [ ] Firebase Console ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
- [ ] ãƒ­ã‚°ã«ã‚¨ãƒ©ãƒ¼ãŒãªã„ã‹ç¢ºèª
- [ ] ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªã‹ã‚‰å‹•ä½œç¢ºèª
- [ ] æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã«å½±éŸ¿ãŒãªã„ã‹ç¢ºèª

### 4. ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æº–å‚™

ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«:
```bash
# ç¾åœ¨ã®ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ã‚’ãƒ¡ãƒ¢
git rev-parse HEAD
```

å•é¡ŒãŒã‚ã£ãŸã‚‰ã“ã®ã‚³ãƒŸãƒƒãƒˆã«æˆ»ã›ã¾ã™ã€‚

---

## ãƒ‡ãƒ—ãƒ­ã‚¤ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å‰ã«ã€ã“ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

### ãƒ‡ãƒ—ãƒ­ã‚¤å‰

- [ ] å…¨ã¦ã®ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ï¼ˆ`npm test`ï¼‰
- [ ] Lintã‚¨ãƒ©ãƒ¼ãªã—ï¼ˆ`npm run lint`ï¼‰
- [ ] ãƒ“ãƒ«ãƒ‰æˆåŠŸï¼ˆ`npm run build`ï¼‰
- [ ] ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§å‹•ä½œç¢ºèª
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆç¢ºèª
- [ ] Gitã«ã‚³ãƒŸãƒƒãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥æ¸ˆã¿
- [ ] å¤‰æ›´å†…å®¹ã‚’ãƒãƒ¼ãƒ ã«å…±æœ‰

### ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚

- [ ] æ­£ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠï¼ˆ`firebase use`ï¼‰
- [ ] ãƒ‡ãƒ—ãƒ­ã‚¤å¯¾è±¡ã‚’ç¢ºèªï¼ˆ`--only` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- [ ] ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
- [ ] ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª

### ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œ

- [ ] Firebase Console ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
- [ ] ãƒ­ã‚°ã‚’ç¢ºèªï¼ˆã‚¨ãƒ©ãƒ¼ãªã—ï¼‰
- [ ] å‹•ä½œãƒ†ã‚¹ãƒˆå®Ÿæ–½
- [ ] ãƒãƒ¼ãƒ ã«å®Œäº†ã‚’å ±å‘Š

---

## ã‚ˆãã‚ã‚‹è³ªå•

### Q: ãƒ‡ãƒ—ãƒ­ã‚¤ã¯ã©ã®ãã‚‰ã„æ™‚é–“ãŒã‹ã‹ã‚‹ï¼Ÿ

**A**:
- Cloud Functions (1é–¢æ•°): 1ã€œ2åˆ†
- Cloud Functions (å…¨é–¢æ•°): 5ã€œ10åˆ†
- Firestore Rules: 10ã€œ30ç§’
- å…¨ã¦: 10ã€œ15åˆ†

### Q: ãƒ‡ãƒ—ãƒ­ã‚¤ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚‰ï¼Ÿ

**A**:
1. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚ˆãèª­ã‚€
2. ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ `npm run build` ã§ç¢ºèª
3. æ¨©é™ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ Firebase Console ã§ç¢ºèª
4. ãã‚Œã§ã‚‚è§£æ±ºã—ãªã„å ´åˆã¯ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

### Q: æœ¬ç•ªç’°å¢ƒã§ç›´æ¥ãƒ†ã‚¹ãƒˆã—ã¦ã‚‚å¤§ä¸ˆå¤«ï¼Ÿ

**A**:
- âŒ **NG**: æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ãŸãƒ†ã‚¹ãƒˆ
- âœ… **OK**: ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã§å‹•ä½œç¢ºèª
- âœ… **æ¨å¥¨**: ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§ååˆ†ãƒ†ã‚¹ãƒˆã—ã¦ã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤

### Q: é–“é•ã£ã¦å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã—ã¾ã£ãŸã‚‰ï¼Ÿ

**A**:
1. Gitã§æœ€æ–°ã®ã‚³ãƒŸãƒƒãƒˆã«æˆ»ã‚‹: `git checkout main && git pull`
2. å†ãƒ‡ãƒ—ãƒ­ã‚¤: `firebase deploy --only functions`

---

## ç’°å¢ƒåˆ¥ã®ãƒ‡ãƒ—ãƒ­ã‚¤

### é–‹ç™ºç’°å¢ƒ (development)

```bash
firebase use development
firebase deploy
```

### æœ¬ç•ªç’°å¢ƒ (production)

```bash
firebase use production
firebase deploy
```

**é‡è¦**: æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¯æ…é‡ã«ï¼
- å¿…ãšãƒ†ã‚¹ãƒˆæ¸ˆã¿ã®ã‚³ãƒ¼ãƒ‰ã®ã¿ãƒ‡ãƒ—ãƒ­ã‚¤
- ãƒãƒ¼ãƒ ã®æ‰¿èªã‚’å¾—ã‚‹
- ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚é–“ã‚’äº‹å‰ã«é€šçŸ¥

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ãŒåˆ†ã‹ã£ãŸã‚‰:

1. **05_ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°.md** - å›°ã£ãŸã¨ãã®å¯¾å‡¦æ³•
2. **CI/CDã‚¬ã‚¤ãƒ‰** - `docs/common/cicd-guide.md`

---

## å‚è€ƒè³‡æ–™

- [Firebase Deploy ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://firebase.google.com/docs/cli#deployment)
- [GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼](https://docs.github.com/ja/actions)
- `docs/common/cicd-guide.md` - CI/CDè©³ç´°ã‚¬ã‚¤ãƒ‰

---

**ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼** ğŸ‰

ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¾ã—ãŸã€‚
ã“ã‚Œã§é–‹ç™ºã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æœ¬ç•ªç’°å¢ƒã«å…¬é–‹ã§ãã¾ã™ï¼
