# 画面実装・仕様書矛盾分析レポート v1.0

## ドキュメント情報

| 項目 | 内容 |
|------|------|
| 作成日 | 2025-12-05 |
| バージョン | 1.0 |
| 対象仕様書 | `05_画面遷移図_ワイヤーフレーム_v3_3.md` |
| 対象範囲 | セクション 3.1〜3.10（3.11 履歴画面以降は対象外）|
| 分析目的 | 画面実装と仕様書の矛盾点の洗い出し |

---

## 1. 分析サマリー

### 1.1 対象画面一覧と結果概要

| # | 画面名 | 実装ファイル | 実装状況 | 矛盾有無 |
|---|--------|-------------|----------|----------|
| 3.1 | スプラッシュ画面 | `screens/splash/splash_screen.dart` | ✅ 実装済 | ⚪ 矛盾なし |
| 3.2 | オンボーディング画面 | `screens/onboarding/onboarding_screen.dart` | ✅ 実装済 | ⚪ 矛盾なし |
| 3.3 | ログイン画面 | `screens/auth/login_screen.dart` | ✅ 実装済 | 🟡 軽微な矛盾 |
| 3.4 | 新規登録画面 | `screens/auth/register_screen.dart` | ✅ 実装済 | ⚪ 矛盾なし |
| 3.5 | 利用規約同意画面 | `screens/legal/consent_screen.dart` | ✅ 実装済 | 🟡 軽微な矛盾 |
| 3.6 | パスワードリセット画面 | `screens/auth/password_reset_screen.dart` | ✅ 実装済 | ⚪ 矛盾なし |
| 3.7 | ホーム画面 | `screens/home/home_screen.dart` | ✅ 実装済 | 🟡 軽微な矛盾 |
| 3.8 | トレーニング選択画面 | `screens/session/exercise_selection_screen.dart` | ✅ 実装済 | ⚪ 矛盾なし |
| 3.9 | カメラ設定画面 | `screens/session/pre_session_screen.dart` | ✅ 実装済 | 🟠 要確認 |
| 3.10 | トレーニング実行画面 | `screens/session/active_session_screen.dart` | ✅ 実装済 | ⚪ 矛盾なし |
| - | セッション結果画面 | `screens/session/session_result_screen.dart` | ✅ 実装済 | ⚪ 矛盾なし |

### 1.2 矛盾件数サマリー

| 重要度 | 件数 | 説明 |
|--------|------|------|
| 🔴 高重要度 | 0件 | 実装必須の重大な矛盾 |
| 🟠 中重要度 | 3件 | 仕様と実装の相違（要対応） |
| 🟡 低重要度 | 5件 | 追加実装または軽微な差異 |

---

## 2. 矛盾詳細（重要度別）

### 2.1 中重要度（🟠 要対応）

#### 2.1.1 ログイン画面 - Google/Appleログイン未実装

| 項目 | 内容 |
|------|------|
| 画面 | ログイン画面 (`login_screen.dart`) |
| 仕様書記載 | Google/Appleログインボタンを表示、タップでソーシャルログイン実行 |
| 実装内容 | TODOコメントで未実装状態（64-98行目） |
| 影響範囲 | ユーザー認証の選択肢が制限される |
| 推奨対応 | Phase 2のソーシャルログイン実装タスクとして管理 |

```dart
// 現在の実装（TODO状態）
// TODO: Implement Google Sign-In
// TODO: Implement Apple Sign-In
```

#### 2.1.2 利用規約同意画面 - 文書内容が要約版

| 項目 | 内容 |
|------|------|
| 画面 | 利用規約同意画面 (`consent_screen.dart`) |
| 仕様書記載 | ToS v3.2、PP v3.1 の全文を表示 |
| 実装内容 | 要約版テキストを静的に定義（443-505行目）、全文リンクURLが `example.com` |
| 影響範囲 | GDPR準拠・法的要件 |
| 推奨対応 | 本番デプロイ前に正式な文書URLに置き換え必須 |

#### 2.1.3 カメラ設定画面 - チェック項目の自動検出

| 項目 | 内容 |
|------|------|
| 画面 | カメラ設定画面 (`pre_session_screen.dart`) |
| 仕様書記載 | 「全身が映っている」「明るさは十分」「距離は適切」は**自動検出** |
| 実装内容 | 手動チェックの可能性あり（詳細確認必要） |
| 影響範囲 | UX・MediaPipe統合の設計 |
| 推奨対応 | MediaPipe統合時に自動検出ロジックを実装 |

---

### 2.2 低重要度（🟡 追加実装・軽微な差異）

#### 2.2.1 ログイン画面 - アカウント復元機能の追加

| 項目 | 内容 |
|------|------|
| 画面 | ログイン画面 (`login_screen.dart`:115-130行目) |
| 仕様書記載 | 記載なし |
| 実装内容 | 「削除したアカウントを復元する」リンクが追加されている |
| 影響 | GDPR削除猶予期間（30日）対応として有用な追加機能 |
| 推奨対応 | 仕様書に追記して整合性を確保 |

#### 2.2.2 利用規約同意画面 - スクロール完了必須化

| 項目 | 内容 |
|------|------|
| 画面 | 利用規約同意画面 (`consent_screen.dart`:410行目) |
| 仕様書記載 | 記載なし |
| 実装内容 | ToS/PPのスクロール完了までcheckboxが無効化 |
| 影響 | GDPR準拠の観点で望ましい実装 |
| 推奨対応 | 仕様書に追記（ベストプラクティスとして記載） |

#### 2.2.3 ホーム画面 - 警告表示の追加

| 項目 | 内容 |
|------|------|
| 画面 | ホーム画面 (`home_screen.dart`:84-93行目) |
| 仕様書記載 | 記載なし |
| 実装内容 | メール確認警告・削除予定警告バナーを追加 |
| 影響 | セキュリティ・UX向上に寄与 |
| 推奨対応 | 仕様書に追記 |

#### 2.2.4 ホーム画面 - クイックアクセスセクション

| 項目 | 内容 |
|------|------|
| 画面 | ホーム画面 (`home_screen.dart`:574-613行目) |
| 仕様書記載 | 記載なし |
| 実装内容 | クイックアクセスセクションが追加 |
| 影響 | UX向上に寄与 |
| 推奨対応 | 仕様書に追記 |

#### 2.2.5 ホーム画面 - 直近履歴の表示件数

| 項目 | 内容 |
|------|------|
| 画面 | ホーム画面 |
| 仕様書記載 | 最新2件を表示 |
| 実装内容 | 最新3件を表示の可能性 |
| 影響 | 軽微（UXの差異） |
| 推奨対応 | 仕様に合わせて2件に修正、または仕様を3件に更新 |

---

## 3. 画面別詳細分析

### 3.1 スプラッシュ画面

**実装ファイル**: `flutter_app/lib/screens/splash/splash_screen.dart`

**仕様準拠状況**: ✅ 完全準拠

| 仕様要件 | 実装状況 |
|----------|----------|
| アプリロゴ表示 | ✅ 実装済 |
| アプリ名表示 | ✅ 実装済 |
| ローディングアニメーション | ✅ 実装済 |
| 緑色背景 | ✅ 実装済 |
| 遷移ロジック（オンボーディング/ログイン/同意チェック） | ✅ 実装済 |

---

### 3.2 オンボーディング画面（3画面）

**実装ファイル**: `flutter_app/lib/screens/onboarding/onboarding_screen.dart`

**仕様準拠状況**: ✅ 完全準拠

| 仕様要件 | 実装状況 |
|----------|----------|
| 3画面構成 | ✅ 実装済 |
| スキップボタン | ✅ 実装済 |
| ページインジケーター | ✅ 実装済 |
| 「次へ」「始める」ボタン | ✅ 実装済 |
| 画面1: 医療機器免責事項 | ✅ 実装済 |
| 画面2: リアルタイムフィードバック | ✅ 実装済 |
| 画面3: 価格情報 | ✅ 実装済 |

---

### 3.3 ログイン画面

**実装ファイル**: `flutter_app/lib/screens/auth/login_screen.dart`

**仕様準拠状況**: 🟡 軽微な矛盾あり

| 仕様要件 | 実装状況 | 備考 |
|----------|----------|------|
| メールアドレス入力 | ✅ 実装済 | - |
| パスワード入力 | ✅ 実装済 | - |
| ログインボタン | ✅ 実装済 | - |
| パスワードリセットリンク | ✅ 実装済 | - |
| 新規登録リンク | ✅ 実装済 | - |
| Googleログイン | 🟠 未実装 | TODOコメント |
| Appleログイン | 🟠 未実装 | TODOコメント |
| アカウント復元リンク | 🟡 追加実装 | 仕様に記載なし |

---

### 3.4 新規登録画面（2ステップ）

**実装ファイル**: `flutter_app/lib/screens/auth/register_screen.dart`

**仕様準拠状況**: ✅ 完全準拠

| 仕様要件 | 実装状況 |
|----------|----------|
| ステップ1: 認証情報入力 | ✅ 実装済 |
| ステップ2: 身体情報入力 | ✅ 実装済 |
| メールアドレス入力 | ✅ 実装済 |
| パスワード入力 | ✅ 実装済 |
| 名前入力 | ✅ 実装済 |
| 性別選択 | ✅ 実装済 |
| 生年月日入力 | ✅ 実装済 |
| 身長・体重入力 | ✅ 実装済 |
| 運動経験選択 | ✅ 実装済 |
| 目標選択 | ✅ 実装済 |
| バリデーションロジック | ✅ 実装済 |

---

### 3.5 利用規約同意画面

**実装ファイル**: `flutter_app/lib/screens/legal/consent_screen.dart`

**仕様準拠状況**: 🟡 軽微な矛盾あり

| 仕様要件 | 実装状況 | 備考 |
|----------|----------|------|
| ToS表示 | ✅ 実装済 | 要約版 |
| PP表示 | ✅ 実装済 | 要約版 |
| 同意チェックボックス | ✅ 実装済 | - |
| 同意ボタン | ✅ 実装済 | - |
| 同意拒否ダイアログ | ✅ 実装済 | - |
| 全文表示リンク | 🟠 要修正 | URLがexample.com |
| スクロール完了必須 | 🟡 追加実装 | 仕様に記載なし |

---

### 3.6 パスワードリセット画面

**実装ファイル**: `flutter_app/lib/screens/auth/password_reset_screen.dart`

**仕様準拠状況**: ✅ 完全準拠

| 仕様要件 | 実装状況 |
|----------|----------|
| メールアドレス入力 | ✅ 実装済 |
| 送信ボタン | ✅ 実装済 |
| 成功メッセージ表示 | ✅ 実装済 |
| ログイン画面への遷移 | ✅ 実装済 |

---

### 3.7 ホーム画面

**実装ファイル**: `flutter_app/lib/screens/home/home_screen.dart`

**仕様準拠状況**: 🟡 軽微な矛盾あり

| 仕様要件 | 実装状況 | 備考 |
|----------|----------|------|
| 今日のセッション表示 | ✅ 実装済 | 「残りX回/3回」形式 |
| 週間進捗グラフ | ✅ 実装済 | - |
| 直近の履歴 | ✅ 実装済 | 件数要確認 |
| ボトムナビゲーション | ✅ 実装済 | 4タブ構成 |
| 今週の統計 | ✅ 実装済 | - |
| メール確認警告 | 🟡 追加実装 | 仕様に記載なし |
| 削除予定警告 | 🟡 追加実装 | 仕様に記載なし |
| クイックアクセス | 🟡 追加実装 | 仕様に記載なし |

---

### 3.8 トレーニング選択画面

**実装ファイル**: `flutter_app/lib/screens/session/exercise_selection_screen.dart`

**仕様準拠状況**: ✅ 完全準拠

| 仕様要件 | 実装状況 |
|----------|----------|
| 種目一覧表示 | ✅ 実装済 |
| カテゴリ分け | ✅ 実装済 |
| 検索機能 | ✅ 実装済 |
| フィルタ機能 | ✅ 実装済 |
| ボトムナビゲーション | ✅ 実装済 |

---

### 3.9 カメラ設定画面

**実装ファイル**: `flutter_app/lib/screens/session/pre_session_screen.dart`

**仕様準拠状況**: 🟠 要確認

| 仕様要件 | 実装状況 | 備考 |
|----------|----------|------|
| カメラプレビュー | ✅ 実装済 | - |
| 骨格表示 | ✅ 実装済 | - |
| カウントダウン（3秒） | ✅ 実装済 | - |
| 「すぐに開始」ボタン | ✅ 実装済 | - |
| 全身チェック（自動検出） | 🟠 要確認 | 手動の可能性 |
| 明るさチェック（自動検出） | 🟠 要確認 | 手動の可能性 |
| 距離チェック（自動検出） | 🟠 要確認 | 手動の可能性 |

---

### 3.10 トレーニング実行画面

**実装ファイル**: `flutter_app/lib/screens/session/active_session_screen.dart`

**仕様準拠状況**: ✅ 完全準拠

| 仕様要件 | 実装状況 |
|----------|----------|
| カメラプレビュー | ✅ 実装済 |
| 骨格表示 | ✅ 実装済 |
| 参考情報表示 | ✅ 実装済 |
| 音声トグル | ✅ 実装済 |
| 進捗バー | ✅ 実装済 |
| レップカウント表示 | ✅ 実装済 |

---

### セッション結果画面

**実装ファイル**: `flutter_app/lib/screens/session/session_result_screen.dart`

**仕様準拠状況**: ✅ 完全準拠

| 仕様要件 | 実装状況 |
|----------|----------|
| 「お疲れ様でした」メッセージ | ✅ 実装済 |
| 参考スコア表示 | ✅ 実装済 |
| 目標/実績回数表示 | ✅ 実装済 |
| 所要時間表示 | ✅ 実装済 |
| 「もう1セット」ボタン | ✅ 実装済 |
| 「完了」ボタン | ✅ 実装済 |

---

## 4. 推奨アクション

### 4.1 即時対応（本番デプロイ前）

| # | アクション | 対象画面 | 担当 |
|---|-----------|----------|------|
| 1 | ToS/PP全文のURLを本番URLに置き換え | 利用規約同意画面 | フロントエンド |
| 2 | ToS/PP全文コンテンツの準備 | - | 法務・コンテンツ |

### 4.2 Phase 2タスク

| # | アクション | 対象画面 | 関連チケット |
|---|-----------|----------|-------------|
| 1 | Googleログイン実装 | ログイン画面 | 要確認 |
| 2 | Appleログイン実装 | ログイン画面 | 要確認 |
| 3 | カメラチェック自動検出ロジック実装 | カメラ設定画面 | MediaPipe統合チケット |

### 4.3 ドキュメント更新

| # | アクション | 対象仕様書 |
|---|-----------|-----------|
| 1 | アカウント復元機能の追記 | 05_画面遷移図_ワイヤーフレーム |
| 2 | スクロール完了必須化の追記 | 05_画面遷移図_ワイヤーフレーム |
| 3 | ホーム画面の警告表示追記 | 05_画面遷移図_ワイヤーフレーム |
| 4 | クイックアクセスセクション追記 | 05_画面遷移図_ワイヤーフレーム |

---

## 5. 変更履歴

| バージョン | 日付 | 変更内容 | 担当者 |
|-----------|------|----------|--------|
| 1.0 | 2025-12-05 | 初版作成（3.1〜3.10画面分析） | Claude |

---

## 6. 関連ドキュメント

- `05_画面遷移図_ワイヤーフレーム_v3_3.md` - 画面仕様書
- `00_要件定義書_v3_3.md` - 機能要件定義
- `07_セキュリティポリシー_v1_0.md` - セキュリティ要件
- `利用規約_v3_2.md` - 利用規約全文
- `プライバシーポリシー_v3.1.md` - プライバシーポリシー全文
