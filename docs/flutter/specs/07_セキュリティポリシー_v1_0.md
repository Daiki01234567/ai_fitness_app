# セキュリティポリシー v1.0

**Document Version**: v1.0  
**作成日**: 2025年11月24日  
**最終更新日**: 2025年11月24日  
**ステータス**: Draft  
**承認者**: (承認待ち)

---

## 目次

### Part 1: 概要とセキュリティ体制
1. [ドキュメント概要](#1-ドキュメント概要)
2. [セキュリティ体制](#2-セキュリティ体制)
3. [リスク評価](#3-リスク評価)

### Part 2: 技術的セキュリティ対策
4. [認証・認可](#4-認証認可)
5. [暗号化](#5-暗号化)
6. [ネットワークセキュリティ](#6-ネットワークセキュリティ)
7. [アプリケーションセキュリティ](#7-アプリケーションセキュリティ)

### Part 3: データ保護とプライバシー
8. [データ保護](#8-データ保護)
9. [プライバシー保護](#9-プライバシー保護)
10. [GDPR対応](#10-gdpr対応)

### Part 4: 運用とインシデント対応
11. [セキュリティ監視](#11-セキュリティ監視)
12. [脆弱性管理](#12-脆弱性管理)
13. [インシデント対応](#13-インシデント対応)
14. [バックアップ・復旧](#14-バックアップ復旧)

### Part 5: 付録
15. [チェックリスト](#15-チェックリスト)
16. [用語集](#16-用語集)
17. [変更履歴](#17-変更履歴)

---

## 1. ドキュメント概要

### 1.1 目的

本セキュリティポリシーは、AIフィットネスアプリ(仮称)における情報セキュリティの方針、基準、手順を定めることを目的とします。本ポリシーは以下を実現します:

- **法的要件の遵守**: GDPR、個人情報保護法、その他関連法規への準拠
- **利用者保護**: ユーザーの個人情報とプライバシーの保護
- **サービス継続性**: セキュリティインシデントからの迅速な復旧
- **信頼性確保**: ステークホルダーからの信頼獲得と維持

### 1.2 適用範囲

#### 1.2.1 対象システム

本ポリシーは以下のシステムコンポーネントに適用されます:

| コンポーネント | 技術スタック | 適用範囲 |
|--------------|-------------|---------|
| **モバイルアプリ** | Swift (iOS), Kotlin (Android) | 全機能 |
| **バックエンド** | Firebase Functions (Node.js/TypeScript) | 全API |
| **データベース** | Cloud Firestore | 全コレクション |
| **データ分析** | BigQuery | 全データセット |
| **ストレージ** | Cloud Storage | 全バケット |
| **認証** | Firebase Authentication | 全認証フロー |
| **決済** | Stripe, RevenueCat | 全決済処理 |

**参照**: システムアーキテクチャ設計書 v3.2 セクション2

#### 1.2.2 対象者

本ポリシーは以下の関係者に適用されます:

| 対象者 | 役割 | 責任範囲 |
|-------|------|---------|
| **開発チーム** | アプリ開発・保守 | セキュア開発、脆弱性対応 |
| **運用チーム** | システム運用・監視 | セキュリティ監視、インシデント対応 |
| **管理者** | システム管理 | アクセス制御、権限管理 |
| **データアナリスト** | データ分析 | データ保護、プライバシー遵守 |
| **第三者ベンダー** | サービス提供 | セキュリティ基準遵守 |

#### 1.2.3 対象データ

| データ分類 | 例 | セキュリティレベル |
|-----------|----|--------------------|
| **個人識別情報(PII)** | メールアドレス、氏名、生年月日 | 最高 |
| **健康関連データ** | 身長、体重、トレーニング記録 | 高 |
| **技術データ** | ユーザーID、セッションID | 中 |
| **統計データ** | 集計データ、匿名化データ | 低 |

**法的根拠**: GDPR第4条1項、プライバシーポリシーv3.1第4条

### 1.3 参照ドキュメント

| ドキュメント名 | バージョン | 関連セクション |
|--------------|-----------|---------------|
| 要件定義書 | v3.2 | 非機能要件 NFR-009~020 |
| システムアーキテクチャ設計書 | v3.2 | セキュリティアーキテクチャ |
| API設計書(Firebase Functions) | v3.2 | セキュリティ (セクション13) |
| BigQuery設計書 | v3.2 | セキュリティ (セクション12) |
| プライバシーポリシー | v3.1 | 第8条(情報の保護) |
| 利用規約 | v3.1 | 第5条(アカウント) |
| データ処理記録(ROPA) | v1.0 | 全体 |

### 1.4 用語定義

| 用語 | 定義 |
|-----|------|
| **PII** | Personally Identifiable Information。個人を特定できる情報 |
| **仮名化** | 追加情報なしでは個人を特定できないようにデータを処理すること(GDPR第4条5項) |
| **匿名化** | 個人を特定できる情報を完全に削除すること |
| **暗号化** | データを読み取れない形式に変換すること |
| **TLS** | Transport Layer Security。通信を暗号化するプロトコル |
| **AES** | Advanced Encryption Standard。データ暗号化規格 |
| **IAM** | Identity and Access Management。アクセス制御システム |
| **MFA** | Multi-Factor Authentication。多要素認証 |
| **SIEM** | Security Information and Event Management。セキュリティ監視システム |
| **DLP** | Data Loss Prevention。データ損失防止 |

---

## 2. セキュリティ体制

### 2.1 組織体制

#### 2.1.1 役割と責任

| 役割 | 責任 | 権限 |
|-----|------|------|
| **セキュリティ責任者** | セキュリティ方針の策定と承認 | 全セキュリティ施策の決定権 |
| **セキュリティ担当者** | セキュリティ施策の実施と監視 | セキュリティ設定の変更権 |
| **開発リーダー** | セキュア開発の推進 | コードレビュー承認権 |
| **運用リーダー** | セキュリティ監視と運用 | インシデント対応の指揮権 |
| **データ保護責任者(DPO)** | GDPR遵守の監督 | データ処理活動の承認権 |

**参照**: GDPR第37条(データ保護責任者の指定)

#### 2.1.2 セキュリティ委員会

**構成**:
- セキュリティ責任者(委員長)
- 開発リーダー
- 運用リーダー
- データ保護責任者

**開催頻度**: 月1回の定例会議 + 緊急時の臨時会議

**議題**:
- セキュリティインシデントのレビュー
- 脆弱性対応状況の確認
- セキュリティポリシーの見直し
- リスク評価の更新
- セキュリティ監査結果の検討

### 2.2 セキュリティ方針

#### 2.2.1 基本方針

本サービスは以下のセキュリティ基本方針を遵守します:

1. **機密性(Confidentiality)**
   - 許可された者のみがデータにアクセスできる
   - 暗号化による保護を必須とする
   - アクセスログを記録し監視する

2. **完全性(Integrity)**
   - データの正確性と完全性を維持する
   - 不正な変更を検出し防止する
   - バックアップにより復旧可能とする

3. **可用性(Availability)**
   - サービスを継続的に提供する
   - 99.5%以上のアップタイムを目標とする
   - インシデント発生時は24時間以内に復旧する

**参照**: 要件定義書v3.2 NFR-005(可用性)、NFR-032(復旧時間目標)

#### 2.2.2 ゼロトラスト原則

本サービスはゼロトラストセキュリティモデルを採用します:

| 原則 | 実装方法 |
|-----|---------|
| **常に検証** | 全てのアクセスで認証・認可を実施 |
| **最小権限** | 必要最小限の権限のみ付与 |
| **侵害を想定** | 多層防御とログ監視を実施 |
| **明示的な許可** | デフォルトで全てを拒否し、必要なもののみ許可 |

#### 2.2.3 セキュアバイデザイン

開発プロセスの全段階でセキュリティを考慮します:

| フェーズ | セキュリティ活動 |
|---------|----------------|
| **要件定義** | セキュリティ要件の明確化 |
| **設計** | 脅威モデリング、セキュアアーキテクチャ設計 |
| **実装** | セキュアコーディング、コードレビュー |
| **テスト** | セキュリティテスト、脆弱性診断 |
| **リリース** | セキュリティチェック、承認プロセス |
| **運用** | セキュリティ監視、インシデント対応 |
| **廃棄** | データ完全削除、アカウント無効化 |

**参照**: GDPR第25条(データ保護バイデザイン)

### 2.3 コンプライアンス

#### 2.3.1 法的要件

本サービスは以下の法規制を遵守します:

| 法規制 | 適用範囲 | 対応状況 |
|-------|---------|---------|
| **GDPR** | EU域内のユーザー | 完全準拠 |
| **個人情報保護法** | 日本のユーザー | 完全準拠 |
| **電気通信事業法** | 通信サービス提供 | 遵守 |
| **不正アクセス禁止法** | システムセキュリティ | 遵守 |
| **PCI DSS** | 決済情報の取り扱い | Stripe経由で準拠 |

**法的根拠**: 
- プライバシーポリシーv3.1 全体
- 利用規約v3.1 第5条(アカウント)、第11条(準拠法)

#### 2.3.2 業界標準

以下のセキュリティ標準に準拠します:

| 標準 | 適用範囲 | 準拠レベル |
|-----|---------|-----------|
| **ISO/IEC 27001** | 情報セキュリティマネジメント | ベストプラクティス採用 |
| **NIST Cybersecurity Framework** | サイバーセキュリティ対策 | 識別・防御・検知・対応・復旧 |
| **OWASP Top 10** | Webアプリケーションセキュリティ | 全項目対策実施 |
| **CIS Controls** | セキュリティ統制 | 優先度の高い統制を実施 |

#### 2.3.3 監査

**内部監査**:
- 頻度: 四半期ごと(年4回)
- 対象: セキュリティポリシー遵守状況、アクセス制御、ログ管理
- 実施者: セキュリティ担当者
- 報告先: セキュリティ責任者

**外部監査**:
- 頻度: 年1回
- 対象: セキュリティ体制全般、脆弱性診断
- 実施者: 第三者セキュリティベンダー
- 報告先: 経営層、セキュリティ責任者

---

## 3. リスク評価

### 3.1 脅威モデリング

#### 3.1.1 資産の識別

| 資産 | 価値 | 脅威 |
|-----|------|------|
| **ユーザーの個人情報** | 最高 | 漏洩、不正アクセス |
| **認証情報** | 最高 | 盗用、クラッキング |
| **トレーニングデータ** | 高 | 漏洩、改ざん |
| **ソースコード** | 高 | 盗用、改ざん |
| **APIキー** | 高 | 漏洩、悪用 |
| **バックアップデータ** | 中 | 漏洩、損失 |

#### 3.1.2 脅威の分類

**STRIDE分類**:

| 脅威タイプ | 説明 | 対策 |
|----------|------|------|
| **S**poofing(なりすまし) | 他人のIDを使った不正アクセス | 多要素認証、セッション管理 |
| **T**ampering(改ざん) | データの不正な変更 | 完全性チェック、監査ログ |
| **R**epudiation(否認) | 行為の否認 | 監査ログ、デジタル署名 |
| **I**nformation Disclosure(情報漏洩) | 機密情報の漏洩 | 暗号化、アクセス制御 |
| **D**enial of Service(サービス妨害) | サービス利用不能 | レート制限、DDoS対策 |
| **E**levation of Privilege(権限昇格) | 不正な権限取得 | 最小権限原則、IAM |

### 3.2 リスク評価マトリクス

#### 3.2.1 リスクレベルの定義

| 影響度 | 発生確率 | リスクレベル | 対応優先度 |
|-------|---------|-------------|-----------|
| 高 | 高 | **緊急** | 即座に対応 |
| 高 | 中 | **高** | 1週間以内に対応 |
| 高 | 低 | **中** | 1ヶ月以内に対応 |
| 中 | 高 | **高** | 1週間以内に対応 |
| 中 | 中 | **中** | 1ヶ月以内に対応 |
| 中 | 低 | **低** | 3ヶ月以内に対応 |
| 低 | 高 | **中** | 1ヶ月以内に対応 |
| 低 | 中 | **低** | 3ヶ月以内に対応 |
| 低 | 低 | **最低** | 次回見直し時に検討 |

#### 3.2.2 主要リスク一覧

| リスクID | リスク | 影響度 | 発生確率 | リスクレベル | 対策 | 担当 |
|---------|--------|--------|---------|-------------|------|------|
| R-001 | ユーザー認証情報の漏洩 | 高 | 中 | **高** | MFA、パスワードハッシュ化 | セキュリティ担当 |
| R-002 | APIへの不正アクセス | 高 | 中 | **高** | Firebase Auth、レート制限 | 開発チーム |
| R-003 | データベースへの不正アクセス | 高 | 低 | **中** | Firestore Security Rules、IAM | 運用チーム |
| R-004 | 中間者攻撃(MITM) | 高 | 低 | **中** | TLS 1.3強制、証明書ピンニング | 開発チーム |
| R-005 | DDoS攻撃 | 中 | 中 | **中** | Cloud Armor、レート制限 | 運用チーム |
| R-006 | XSS攻撃 | 中 | 低 | **低** | 入力サニタイゼーション、CSP | 開発チーム |
| R-007 | SQLインジェクション | 低 | 低 | **最低** | NoSQL使用、入力検証 | 開発チーム |
| R-008 | CSRF攻撃 | 中 | 低 | **低** | CSRFトークン、SameSite Cookie | 開発チーム |
| R-009 | データ漏洩 | 高 | 低 | **中** | 暗号化、アクセス制御、DLP | セキュリティ担当 |
| R-010 | インサイダー脅威 | 中 | 低 | **低** | アクセスログ監視、最小権限 | 運用チーム |
| R-011 | 第三者ベンダーのセキュリティ侵害 | 中 | 低 | **低** | ベンダー評価、SLA | セキュリティ担当 |
| R-012 | バックアップの損失・漏洩 | 中 | 低 | **低** | 暗号化、アクセス制御、定期テスト | 運用チーム |

**参照**: 要件定義書v3.2 セクション8(リスク管理)

### 3.3 リスク対応計画

#### 3.3.1 高リスク項目の対策

**R-001: ユーザー認証情報の漏洩**

対策:
1. パスワードのbcryptハッシュ化(コストファクター12以上)
2. Firebase Authenticationによる安全な認証フロー
3. パスワード強度要件の実施(8文字以上、英数字記号含む)
4. パスワードリセット機能の実装
5. ブルートフォース攻撃対策(レート制限: 10回/時間/IP)
6. セッショントークンの有効期限(1時間)
7. 異常なログイン試行の検知とアラート

**実装状況**: Phase 1で実装完了  
**検証方法**: セキュリティテスト、ペネトレーションテスト  
**担当者**: セキュリティ担当者

**R-002: APIへの不正アクセス**

対策:
1. Firebase Authenticationによる認証必須化
2. Firebase App Checkによるクライアント検証
3. APIレート制限の実装:
   - 100リクエスト/分/ユーザー(通常API)
   - 10リクエスト/時間/IP(認証API)
   - 1000リクエスト/分/IP(グローバル)
4. Cloud Armorによるアクセス制御
5. APIキーのローテーション(90日ごと)
6. 入力値の厳密なバリデーション(Joi使用)

**実装状況**: Phase 1-2で実装  
**検証方法**: APIテスト、負荷テスト  
**担当者**: 開発チーム

**参照**: API設計書v3.2 セクション13.3(レート制限)

---
# セキュリティポリシー v1.0 - Part 2

## 4. 認証・認可

### 4.1 認証(Authentication)

#### 4.1.1 ユーザー認証

**認証方式**:

| 方式 | 実装 | 優先度 | 対応Phase |
|-----|------|--------|----------|
| **メール/パスワード** | Firebase Authentication | 必須 | Phase 1 |
| **Google OAuth 2.0** | Firebase Authentication | 推奨 | Phase 1 |
| **Apple Sign In** | Firebase Authentication | 推奨 | Phase 1 |

**パスワード要件**:
- 最小長: 8文字
- 必須要素: 英字(大文字・小文字)、数字、記号を含む
- 禁止: よくあるパスワード(辞書攻撃対策)、連続文字、同一文字の繰り返し
- ハッシュ化: bcrypt(コストファクター12以上)
- 保存: Firebase Authenticationで自動管理(平文保存禁止)

**参照**: 要件定義書v3.2 FR-001、API設計書v3.2 セクション4.2

#### 4.1.2 セッション管理

**ID Token(JWT)**:
- 発行者: Firebase Authentication
- 有効期限: 1時間
- 更新: リフレッシュトークン使用(有効期限30日)
- 検証: Firebase Admin SDKで署名検証
- 無効化: ログアウト時、パスワード変更時、アカウント削除時

**セキュリティ対策**:
- トークン盗用対策: HTTPS必須、Secure Cookie
- セッション固定攻撃対策: ログイン後にトークン再発行
- 並行セッション制限: 1ユーザー最大5デバイス
- 異常検知: 通常と異なる地域・デバイスからのアクセスを検知

**参照**: API設計書v3.2 セクション3.1(認証)

#### 4.1.3 多要素認証(MFA)

**実装計画**:
- Phase 1-2: 実装なし(MVP期)
- Phase 3以降: SMS、認証アプリによるMFA実装を検討

**優先ユーザー**:
- 管理者アカウント: 必須
- 一般ユーザー: 任意(推奨)

#### 4.1.4 ブルートフォース攻撃対策

**レート制限**:
- ログイン試行: 5回失敗で30分ロック
- パスワードリセット: 10回/時間/IP
- 新規登録: 10回/時間/IP

**検知とアラート**:
- 異常な試行パターンの検知
- 管理者への即時通知
- IPアドレスの自動ブロック(24時間)

**参照**: API設計書v3.2 セクション13.3(レート制限)

### 4.2 認可(Authorization)

#### 4.2.1 アクセス制御モデル

**RBAC(Role-Based Access Control)を採用**:

| ロール | 権限 | 対象 |
|-------|------|------|
| **User** | 自分のデータの読み書き | 全ユーザー |
| **Admin** | ユーザー管理、システム設定 | 管理者のみ |
| **Analyst** | 匿名化データの読み取り | データアナリスト |

#### 4.2.2 Firestore Security Rules

**基本原則**:
- デフォルト拒否(Deny by Default)
- 明示的な許可のみ実行
- ユーザーは自分のデータのみアクセス可能

**実装例**:
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ユーザーコレクション
    match /users/{userId} {
      // 読み書きは本人のみ
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // サブコレクション
      match /sessions/{sessionId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
      
      match /settings/{document=**} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }
    
    // 種目定義(全ユーザー読み取り可)
    match /exercises/{exerciseId} {
      allow read: if request.auth != null;
      allow write: if false;  // 管理者のみ(Firebase Functionsから)
    }
  }
}
```

**参照**: API設計書v3.2 セクション13.1.2

#### 4.2.3 Cloud IAM

**サービスアカウント**:

| サービスアカウント | ロール | 用途 |
|------------------|-------|------|
| **firebase-functions-backend** | Firestore Editor, Storage Admin | Firebase Functionsの実行 |
| **bigquery-backend** | BigQuery Data Editor | BigQueryへのデータ書き込み |
| **bigquery-analyst** | BigQuery Data Viewer | データ分析(読み取りのみ) |
| **cloud-scheduler** | Cloud Scheduler Admin | 定期ジョブの実行 |

**最小権限の原則**:
- 各サービスアカウントに必要最小限の権限のみ付与
- 定期的な権限レビュー(3ヶ月ごと)
- 未使用のサービスアカウントは無効化

**参照**: BigQuery設計書v3.2 セクション12.1(アクセス制御)

#### 4.2.4 API認可

**Firebase Functions**:
- 全てのCallable Functionで認証チェック必須
- context.authでユーザーIDを取得
- ユーザーIDとリクエストデータの整合性検証

**実装例**:
```typescript
export const user_updateProfile = functions.https.onCall(async (data, context) => {
  // 認証チェック
  if (!context.auth) {
    throw new functions.https.HttpsError('unauthenticated', '認証が必要です');
  }
  
  const uid = context.auth.uid;
  
  // 認可チェック: 本人のデータのみ更新可能
  if (data.userId !== uid) {
    throw new functions.https.HttpsError('permission-denied', '権限がありません');
  }
  
  // 処理実行
});
```

**参照**: API設計書v3.2 セクション13.1.1

---

## 5. 暗号化

### 5.1 転送時の暗号化(Encryption in Transit)

#### 5.1.1 TLS/SSL

**要件**:
- プロトコル: TLS 1.3(最低でもTLS 1.2)
- 暗号スイート: 
  - TLS_AES_256_GCM_SHA384
  - TLS_CHACHA20_POLY1305_SHA256
  - TLS_AES_128_GCM_SHA256
- 証明書: Let's Encryptまたは商用CA
- HSTS(HTTP Strict Transport Security): 有効化(max-age=31536000)

**適用範囲**:
- クライアント ⇔ Firebase(API通信)
- Firebase ⇔ BigQuery
- 全ての外部通信

**検証**:
- SSL Labs(https://www.ssllabs.com/)でA+評価を目標
- 定期的な証明書更新(自動更新)
- 証明書の有効期限監視

**参照**: 要件定義書v3.2 NFR-009、プライバシーポリシーv3.1第8.4条

#### 5.1.2 証明書ピンニング

**実装計画**:
- Phase 1-2: 実装なし(MVP期)
- Phase 3以降: モバイルアプリで実装

**目的**: 中間者攻撃(MITM)の防止

### 5.2 保存時の暗号化(Encryption at Rest)

#### 5.2.1 データベース暗号化

**Cloud Firestore**:
- 暗号化方式: AES-256-GCM
- 鍵管理: Google管理の暗号鍵(GMEK)
- 自動暗号化: 全データが自動的に暗号化
- 追加コスト: なし

**BigQuery**:
- 暗号化方式: AES-256-GCM
- 鍵管理: Google管理の暗号鍵(GMEK)
- 自動暗号化: 全データが自動的に暗号化
- CMEK(顧客管理の暗号鍵): Phase 3以降で検討

**参照**: BigQuery設計書v3.2 セクション12.2(データ暗号化)

#### 5.2.2 ストレージ暗号化

**Cloud Storage**:
- 暗号化方式: AES-256-GCM
- 鍵管理: Google管理の暗号鍵
- バケット暗号化: デフォルトで有効
- オブジェクト暗号化: 個別にも可能

**バックアップ暗号化**:
- Firestore Export: 暗号化されたまま保存
- BigQuery Export: 暗号化されたまま保存
- 暗号化鍵のバックアップ: Google Cloud KMSで管理

#### 5.2.3 アプリケーションレベル暗号化

**機密データの追加暗号化**:
- 対象: パスワード、APIキー
- 方式: bcrypt(パスワード)、AES-256(APIキー)
- 鍵管理: Firebase Remote Config、環境変数

**仮名化**:
- 対象: BigQueryエクスポート時のユーザーID
- 方式: SHA-256ハッシュ化(ソルト付き)
- 目的: 個人特定不可能にする

**実装例**:
```typescript
import * as crypto from 'crypto';

function pseudonymizeUserId(userId: string): string {
  const salt = functions.config().security.salt;
  return crypto
    .createHash('sha256')
    .update(userId + salt)
    .digest('hex');
}
```

**参照**: API設計書v3.2 セクション13.4.2、プライバシーポリシーv3.1第8.3条

### 5.3 鍵管理

#### 5.3.1 鍵の種類と管理

| 鍵の種類 | 管理方法 | ローテーション | 用途 |
|---------|---------|--------------|------|
| **データ暗号化鍵** | Google管理(GMEK) | 自動 | Firestore, BigQuery, Storage |
| **APIキー** | Firebase Console | 90日ごと | Firebase API認証 |
| **サービスアカウント鍵** | Cloud IAM | 90日ごと | サーバー間通信 |
| **アプリ署名鍵** | Google Play, App Store | 手動 | アプリ配布 |
| **仮名化ソルト** | Firebase Remote Config | 180日ごと | ユーザーID仮名化 |

#### 5.3.2 鍵のライフサイクル

1. **生成**: 十分なエントロピーを持つ乱数生成器使用
2. **保存**: Google Cloud KMS、Firebase Remote Config
3. **配布**: サービスアカウント経由、環境変数
4. **使用**: 必要最小限のアクセス権限
5. **ローテーション**: 定期的な鍵更新
6. **廃棄**: 安全な削除(上書き削除)

#### 5.3.3 鍵漏洩時の対応

**対応手順**:
1. 漏洩した鍵の即座の無効化(15分以内)
2. 新しい鍵の生成と配布
3. 影響範囲の調査
4. セキュリティ委員会への報告
5. 必要に応じてユーザーへの通知
6. 再発防止策の実施

---

## 6. ネットワークセキュリティ

### 6.1 ファイアウォール

#### 6.1.1 Cloud Armor

**目的**: DDoS攻撃、SQLインジェクション、XSS攻撃からの保護

**ポリシー設定**:

| ルール | アクション | 条件 |
|-------|-----------|------|
| **地域制限** | 許可 | 日本、EU、米国のみ |
| **レート制限** | 拒否 | 1ユーザー: 100リクエスト/分超過 |
| **グローバル制限** | 拒否 | 1IP: 1000リクエスト/分超過 |
| **XSS検出** | 拒否 | XSSパターンを含むリクエスト |
| **SQLインジェクション検出** | 拒否 | SQLパターンを含むリクエスト |
| **Bot検出** | チャレンジ | 疑わしいBot |

**優先順位**:
1. ホワイトリスト(管理者IP)
2. ブラックリスト(攻撃元IP)
3. 地域制限
4. レート制限
5. 攻撃パターン検出

**参照**: API設計書v3.2 セクション13.3.2

#### 6.1.2 VPC

**実装計画**:
- Phase 1-2: 不要(Firebase Hostingを使用)
- Phase 3以降: Cloud Runへの移行時にVPC設定を検討

### 6.2 DDoS対策

#### 6.2.1 多層防御

| レイヤー | 対策 | 実装 |
|---------|------|------|
| **L3/L4(ネットワーク)** | Google Cloud Infrastructure | 自動 |
| **L7(アプリケーション)** | Cloud Armor | 手動設定 |
| **アプリケーション** | レート制限、キャッシング | Firebase Functions |

#### 6.2.2 レート制限

**実装**:

```typescript
import { RateLimiterMemory } from 'rate-limiter-flexible';

const rateLimiter = new RateLimiterMemory({
  points: 100,  // 100リクエスト
  duration: 60,  // 60秒間
});

export const protectedFunction = functions.https.onCall(async (data, context) => {
  if (!context.auth) {
    throw new functions.https.HttpsError('unauthenticated', '認証が必要です');
  }
  
  const uid = context.auth.uid;
  
  try {
    await rateLimiter.consume(uid);
  } catch (error) {
    throw new functions.https.HttpsError(
      'resource-exhausted',
      'レート制限を超えました。しばらく待ってから再試行してください。'
    );
  }
  
  // 処理実行
});
```

**参照**: API設計書v3.2 セクション13.3、要件定義書v3.2 NFR-005

### 6.3 CDN・キャッシング

#### 6.3.1 Firebase Hosting

**キャッシュ戦略**:
- 静的コンテンツ: 長期キャッシュ(1年)
- 動的コンテンツ: 短期キャッシュ(1時間)
- API: キャッシュなし

**セキュリティヘッダー**:
```json
{
  "headers": [
    {
      "key": "Strict-Transport-Security",
      "value": "max-age=31536000; includeSubDomains; preload"
    },
    {
      "key": "X-Frame-Options",
      "value": "DENY"
    },
    {
      "key": "X-Content-Type-Options",
      "value": "nosniff"
    },
    {
      "key": "X-XSS-Protection",
      "value": "1; mode=block"
    },
    {
      "key": "Content-Security-Policy",
      "value": "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';"
    }
  ]
}
```

---

## 7. アプリケーションセキュリティ

### 7.1 入力検証

#### 7.1.1 バリデーション原則

**全ての入力を疑う**:
- クライアント側検証: UX向上のため
- サーバー側検証: セキュリティのため(必須)
- ホワイトリスト方式: 許可する値を明示的に定義

#### 7.1.2 Joi Validation

**実装**:

```typescript
import Joi from 'joi';

// プロフィール更新のスキーマ
const updateProfileSchema = Joi.object({
  nickname: Joi.string().min(1).max(50).required()
    .pattern(/^[a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FFF]+$/)
    .messages({
      'string.pattern.base': 'ニックネームには英数字、ひらがな、カタカナ、漢字のみ使用できます'
    }),
  height: Joi.number().min(100).max(250).optional(),
  weight: Joi.number().min(30).max(200).optional(),
  goal: Joi.string().max(500).optional()
    .pattern(/^[^<>]*$/)  // HTMLタグ禁止
    .messages({
      'string.pattern.base': '不正な文字が含まれています'
    })
});

export const user_updateProfile = functions.https.onCall(async (data, context) => {
  // バリデーション
  const { error, value } = updateProfileSchema.validate(data, {
    stripUnknown: true  // 未定義のフィールドを削除
  });
  
  if (error) {
    throw new functions.https.HttpsError('invalid-argument', error.message);
  }
  
  // 処理実行
});
```

**参照**: API設計書v3.2 セクション13.2

#### 7.1.3 サニタイゼーション

**HTMLサニタイゼーション**:
- ライブラリ: DOMPurify(フロントエンド)
- 対象: ユーザー入力のテキスト
- 削除: `<script>`, `<iframe>`, `onclick`等のイベントハンドラ

**SQLインジェクション対策**:
- NoSQL使用(Firestore)
- パラメータ化クエリ(必要な場合)
- 入力値の型チェック

### 7.2 OWASP Top 10対策

#### 7.2.1 A01: アクセス制御の不備

**対策**:
- Firestore Security Rulesで全てのアクセスを制御
- Firebase Authenticationによる認証必須化
- 最小権限の原則を適用

**検証**: Security Rulesのテストを実施

#### 7.2.2 A02: 暗号化の失敗

**対策**:
- TLS 1.3の強制
- AES-256によるデータ暗号化
- bcryptによるパスワードハッシュ化
- 機密データの平文保存禁止

**検証**: SSL Labs、暗号化設定の定期監査

#### 7.2.3 A03: インジェクション

**対策**:
- NoSQL使用(SQLインジェクション不可)
- Joiによる厳密な入力検証
- パラメータ化クエリ(必要な場合)
- HTMLサニタイゼーション

**検証**: 脆弱性診断、ペネトレーションテスト

#### 7.2.4 A04: 安全が確認されない不安全な設計

**対策**:
- 脅威モデリングの実施
- セキュアバイデザイン原則の適用
- セキュリティレビューの実施

**検証**: 設計レビュー、アーキテクチャレビュー

#### 7.2.5 A05: セキュリティの設定ミス

**対策**:
- デフォルト設定の変更(パスワード等)
- 不要なサービスの無効化
- セキュリティヘッダーの設定
- エラーメッセージの最小化

**検証**: 設定監査、自動スキャン

#### 7.2.6 A06: 脆弱で古くなったコンポーネント

**対策**:
- 依存関係の定期更新(週次)
- npm audit、Dependabotの使用
- 既知の脆弱性の監視
- パッチ適用プロセスの確立

**検証**: `npm audit`, Snyk

#### 7.2.7 A07: 識別と認証の失敗

**対策**:
- Firebase Authenticationの使用
- パスワード要件の実施
- セッション管理の厳密化
- ブルートフォース攻撃対策

**検証**: 認証テスト、セキュリティテスト

#### 7.2.8 A08: ソフトウェアとデータの整合性の不具合

**対策**:
- コード署名(アプリ配布時)
- 依存関係の検証(package-lock.json)
- CI/CDパイプラインのセキュリティ強化
- 完全性チェックの実施

**検証**: CI/CDログ監査、署名検証

#### 7.2.9 A09: セキュリティログとモニタリングの失敗

**対策**:
- Cloud Loggingによる全ログ記録
- Firebase Crashlyticsによるエラー監視
- Cloud Monitoringによるアラート設定
- セキュリティイベントの即時通知

**検証**: ログレビュー、アラートテスト

**参照**: セクション11(セキュリティ監視)

#### 7.2.10 A10: サーバーサイドリクエストフォージェリ(SSRF)

**対策**:
- 外部APIへのアクセス制限
- URLホワイトリストの使用
- ネットワークセグメンテーション

**検証**: ペネトレーションテスト

### 7.3 モバイルアプリセキュリティ

#### 7.3.1 コード難読化

**実装**:
- iOS: SwiftObfuscator、コンパイラ最適化
- Android: ProGuard/R8

**目的**: リバースエンジニアリングの困難化

#### 7.3.2 ルート/Jailbreak検知

**実装計画**:
- Phase 1-2: 実装なし
- Phase 3以降: 検知ライブラリの導入を検討

**対応**: 検知時に警告表示(アクセス拒否はしない)

#### 7.3.3 機密データの保護

**実装**:
- APIキー: Firebase Remote Configで管理
- ローカルストレージ: iOS Keychain、Android Keystore
- 画面キャプチャ禁止: 決済画面、個人情報画面

#### 7.3.4 通信セキュリティ

**実装**:
- HTTPS通信のみ許可
- App Transport Security(iOS)の有効化
- Network Security Config(Android)の設定

```xml
<!-- Android Network Security Config -->
<network-security-config>
  <base-config cleartextTrafficPermitted="false">
    <trust-anchors>
      <certificates src="system" />
    </trust-anchors>
  </base-config>
</network-security-config>
```

### 7.4 依存関係管理

#### 7.4.1 パッケージ管理

**方針**:
- 信頼できるソースからのみインストール(npm公式、Google)
- 依存関係の最小化
- ライセンスの確認(GPL等の制限)

#### 7.4.2 脆弱性スキャン

**ツール**:
- `npm audit`: 週次で実行
- Snyk: リアルタイム監視
- Dependabot: 自動プルリクエスト

**対応**:
- Critical: 24時間以内にパッチ適用
- High: 1週間以内にパッチ適用
- Medium: 1ヶ月以内にパッチ適用
- Low: 次回リリース時に対応

#### 7.4.3 更新プロセス

1. 脆弱性の検出(自動)
2. 影響範囲の調査
3. パッチの適用(開発環境)
4. テストの実施
5. ステージング環境へのデプロイ
6. 本番環境へのデプロイ
7. 動作確認

---
# セキュリティポリシー v1.0 - Part 3

## 8. データ保護

### 8.1 データ分類

#### 8.1.1 データカテゴリ

| カテゴリ | 例 | セキュリティレベル | 保存場所 | 保存期間 |
|---------|----|--------------------|---------|---------|
| **PII(個人識別情報)** | メールアドレス、氏名、生年月日 | 最高 | Firestore | アカウント削除まで |
| **健康関連データ** | 身長、体重、トレーニング記録 | 高 | Firestore | アカウント削除まで |
| **骨格座標データ** | MediaPipeの出力データ | 高 | Firestore → BigQuery | アカウント削除まで |
| **セッションメタデータ** | デバイス情報、セッション統計 | 中 | Firestore → BigQuery | 2年間 |
| **認証情報** | パスワードハッシュ、トークン | 最高 | Firebase Auth | アカウント削除まで |
| **決済情報** | カード情報 | 最高 | Stripe(保存しない) | - |
| **ログデータ** | アクセスログ、エラーログ | 低 | Cloud Logging | 400日 |

**参照**: データ処理記録(ROPA)v1.0、プライバシーポリシーv3.1第4条

#### 8.1.2 データのライフサイクル

```
収集 → 保存 → 利用 → 共有 → 保管 → 削除
  ↓      ↓      ↓      ↓      ↓      ↓
同意   暗号化  最小化  制限   期間   完全削除
```

**各段階の要件**:

1. **収集**: 明示的な同意、必要最小限のデータのみ
2. **保存**: AES-256暗号化、アクセス制御
3. **利用**: 収集目的の範囲内のみ
4. **共有**: 第三者への共有は最小限、契約締結
5. **保管**: 定期的なバックアップ、完全性チェック
6. **削除**: 30日以内の完全削除、復元不可能

### 8.2 データ最小化

#### 8.2.1 収集データの制限

**原則**: 必要最小限のデータのみ収集

| データ | 必須/任意 | 収集理由 | 法的根拠 |
|-------|----------|---------|---------|
| **メールアドレス** | 必須 | アカウント識別、連絡 | GDPR第6条1項(b) |
| **パスワード** | 必須 | 認証 | GDPR第6条1項(b) |
| **ニックネーム** | 必須 | 表示名 | GDPR第6条1項(b) |
| **生年月日** | 必須 | 年齢確認(13歳以上) | GDPR第6条1項(c) |
| **身長・体重** | 任意 | トレーニング最適化 | GDPR第6条1項(a) |
| **目標** | 任意 | モチベーション管理 | GDPR第6条1項(a) |
| **骨格座標データ** | 必須(同意後) | フォーム評価 | GDPR第6条1項(a) |
| **デバイス情報** | 自動 | サービス改善 | GDPR第6条1項(f) |

**収集しないデータ**:
- カメラ映像(骨格座標のみ抽出)
- 位置情報
- 連絡先
- その他の健康データ(血圧、心拍数等)

**参照**: 要件定義書v3.2 FR-028, FR-029、プライバシーポリシーv3.1第4条

#### 8.2.2 オンデバイス処理

**MediaPipe処理**:
- カメラ映像: デバイス内で処理、サーバーに送信しない
- 骨格検出: デバイス内で実行
- 送信データ: 骨格座標(x, y, z)のみ

**目的**: プライバシー保護、データ量削減

**参照**: 要件定義書v3.2 NFR-015、プライバシーポリシーv3.1第8.1条

### 8.3 データ保存期間

#### 8.3.1 保存期間ポリシー

| データ種別 | 保存期間 | 削除トリガー | 法的根拠 |
|----------|---------|------------|---------|
| **個人情報** | アカウント削除まで | ユーザー削除リクエスト | GDPR第5条1項(e) |
| **トレーニング記録** | アカウント削除まで | ユーザー削除リクエスト | GDPR第5条1項(e) |
| **骨格座標データ** | アカウント削除まで | ユーザー削除リクエスト | GDPR第5条1項(e) |
| **セッションメタデータ** | 2年間 | 自動削除スクリプト | GDPR第5条1項(e) |
| **アクセスログ** | 400日 | Cloud Logging自動削除 | - |
| **監査ログ** | 7年間 | 自動削除 | 会計法、商法 |

**参照**: プライバシーポリシーv3.1第7条、BigQuery設計書v3.2セクション2.2.2

#### 8.3.2 自動削除の実装

**Cloud Scheduler + Cloud Functions**:

```typescript
// 毎日午前3時(JST)に実行
export const cleanupOldData = functions
  .runWith({ timeoutSeconds: 540 })
  .pubsub.schedule('0 3 * * *')
  .timeZone('Asia/Tokyo')
  .onRun(async (context) => {
    // 2年以上前のセッションメタデータを削除
    const twoYearsAgo = new Date();
    twoYearsAgo.setFullYear(twoYearsAgo.getFullYear() - 2);
    
    // BigQueryから削除
    const query = `
      DELETE FROM \`fitness_analytics.training_sessions\`
      WHERE created_at < @cutoffDate
    `;
    
    await bigquery.query({
      query,
      params: { cutoffDate: twoYearsAgo.toISOString() }
    });
    
    console.log('古いデータを削除しました');
  });
```

**参照**: BigQuery設計書v3.2セクション10.3.2

### 8.4 データアクセス制御

#### 8.4.1 アクセス権限マトリクス

| データ | User | Admin | Analyst | Backend |
|-------|------|-------|---------|---------|
| **自分の個人情報** | 読み書き | 読み取り | ✗ | 読み書き |
| **他人の個人情報** | ✗ | 読み取り | ✗ | ✗ |
| **自分のトレーニング記録** | 読み書き | 読み取り | ✗ | 読み書き |
| **匿名化された統計データ** | ✗ | 読み取り | 読み取り | 読み書き |
| **システムログ** | ✗ | 読み取り | ✗ | 読み書き |

#### 8.4.2 監査ログ

**記録対象**:
- データへのアクセス(読み取り、書き込み、削除)
- 認証イベント(ログイン、ログアウト、失敗)
- 設定変更
- 権限変更
- GDPR権利行使(データアクセス、削除等)

**ログ形式**:
```json
{
  "timestamp": "2025-11-24T10:00:00Z",
  "eventType": "DATA_ACCESS",
  "userId": "user_id",
  "resourceType": "USER_PROFILE",
  "resourceId": "user_id",
  "action": "READ",
  "result": "SUCCESS",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0..."
}
```

**保存期間**: 7年間(監査要件)

**参照**: BigQuery設計書v3.2セクション12.3、プライバシーポリシーv3.1第8.5条

### 8.5 バックアップとリカバリ

#### 8.5.1 バックアップ戦略

**Firestore**:
- 方式: 自動エクスポート(Cloud Scheduler)
- 頻度: 日次(毎日午前2時)
- 保存先: Cloud Storage
- 保存期間: 30日間
- 暗号化: AES-256(自動)

**BigQuery**:
- 方式: テーブルスナップショット
- 頻度: 週次(毎週日曜日)
- 保存期間: 90日間
- 暗号化: AES-256(自動)

**実装**:
```typescript
export const backupFirestore = functions.pubsub
  .schedule('0 2 * * *')
  .timeZone('Asia/Tokyo')
  .onRun(async (context) => {
    const projectId = process.env.GCP_PROJECT;
    const timestamp = new Date().toISOString().split('T')[0];
    const outputUriPrefix = `gs://firestore-backup-bucket/${timestamp}`;
    
    await firestore.exportDocuments({
      outputUriPrefix,
      collectionIds: ['users', 'sessions', 'exercises']
    });
    
    console.log(`Firestore backup completed: ${outputUriPrefix}`);
  });
```

**参照**: 要件定義書v3.2 NFR-031(データバックアップ)

#### 8.5.2 リカバリ手順

**目標**:
- RTO(復旧時間目標): 24時間以内
- RPO(復旧ポイント目標): 24時間以内(日次バックアップ)

**手順**:
1. インシデントの検知と評価
2. 最新のバックアップの特定
3. ステージング環境でリカバリテスト
4. 本番環境へのリカバリ実施
5. データ整合性の検証
6. サービス再開
7. ユーザーへの通知

**参照**: 要件定義書v3.2 NFR-032(復旧時間目標)

---

## 9. プライバシー保護

### 9.1 プライバシーバイデザイン

#### 9.1.1 7つの基礎原則

| 原則 | 実装 |
|-----|------|
| **1. 事後的ではなく事前的** | 要件定義段階からプライバシー考慮 |
| **2. 初期設定としてのプライバシー** | オプトインを原則、最小限のデータ収集 |
| **3. 設計への組み込み** | システムアーキテクチャにプライバシー保護を統合 |
| **4. 全機能的** | セキュリティとプライバシーの両立 |
| **5. エンド・ツー・エンドのセキュリティ** | データライフサイクル全体で保護 |
| **6. 可視性と透明性** | プライバシーポリシーの明示、同意管理 |
| **7. 利用者のプライバシーの尊重** | ユーザー権利の実装 |

**参照**: GDPR第25条、プライバシーポリシーv3.1全体

#### 9.1.2 具体的な実装

**オンデバイス処理**:
- カメラ映像をデバイス内で処理
- 骨格座標のみをサーバーに送信
- 個人を特定できる情報は送信しない

**データ最小化**:
- 必要最小限のデータのみ収集
- 任意項目は明示的に同意を求める
- 未使用データは収集しない

**仮名化**:
- BigQueryエクスポート時にユーザーIDをハッシュ化
- 個人を特定できないようにする
- 分析目的でのみ使用

**参照**: プライバシーポリシーv3.1第8条

### 9.2 同意管理

#### 9.2.1 同意の取得

**タイミング**:
- 新規登録時: 利用規約とプライバシーポリシーへの同意
- データ収集開始前: 骨格座標データ収集への同意
- 機能追加時: 新しいデータ処理への同意

**同意の要件**:
- 明示的(Explicit): チェックボックス、ボタンクリック
- 具体的(Specific): 各データ処理目的ごとに同意
- 情報に基づく(Informed): 平易な言語で説明
- 自由な意思(Freely Given): 強制されない

**記録**:
```json
{
  "userId": "user_id",
  "tosAccepted": true,
  "tosAcceptedAt": "2025-11-24T10:00:00Z",
  "tosVersion": "3.1",
  "ppAccepted": true,
  "ppAcceptedAt": "2025-11-24T10:00:00Z",
  "ppVersion": "3.1",
  "skeletonDataConsent": true,
  "skeletonDataConsentAt": "2025-11-24T10:05:00Z"
}
```

**参照**: GDPR第7条、プライバシーポリシーv3.1第9.1条、要件定義書v3.2 FR-024

#### 9.2.2 同意の撤回

**実装**:
- プロフィール画面から同意状態を表示
- 「同意を解除」ボタンを提供
- 確認ダイアログを表示
- 同意解除後、強制ログアウト

**確認ダイアログ**:
```
タイトル: 同意の解除
本文: 利用規約またはプライバシーポリシーへの同意を解除すると、
      アプリを使用できなくなり、ログアウトされます。
      本当に解除しますか?
ボタン: [キャンセル] [解除する]
```

**参照**: GDPR第7条3項、要件定義書v3.2 FR-002-1

### 9.3 データ主体の権利

#### 9.3.1 アクセス権(Right of Access)

**GDPR第15条、プライバシーポリシーv3.1第9.3条**

**実装**:
- プロフィール画面から「データダウンロード」を選択
- バックグラウンドでデータ収集
- JSON/CSV形式でエクスポート
- ダウンロードリンクをメール送信(有効期限7日間)

**提供データ**:
- 個人情報(メールアドレス、ニックネーム等)
- トレーニング記録
- 設定情報
- アカウント作成日時、最終ログイン日時

**対応期間**: 30日以内(GDPR第12条3項)

**参照**: 要件定義書v3.2 FR-027

#### 9.3.2 訂正権(Right to Rectification)

**GDPR第16条、プライバシーポリシーv3.1第9.2条**

**実装**:
- プロフィール編集機能
- リアルタイムバリデーション
- 変更履歴の記録(監査用)

**対応期間**: 即座(ユーザー自身で修正可能)

**参照**: 要件定義書v3.2 FR-026

#### 9.3.3 削除権(Right to Erasure/"Right to be Forgotten")

**GDPR第17条、プライバシーポリシーv3.1第9.6条**

**実装**:
1. プロフィール画面から「アカウント削除」を選択
2. 確認ダイアログ表示
3. パスワード再入力で本人確認
4. 削除処理実行(非同期)
5. 30日以内に完全削除
6. 削除完了メール送信

**削除対象**:
- Firestoreのユーザーデータ
- トレーニング記録
- 骨格座標データ
- BigQueryのデータ
- Cloud Storageのファイル
- Firebase Authenticationのアカウント

**削除方法**: 物理削除(データの完全消去)

**例外**: 法的義務のため保持が必要なデータ(監査ログ等)

**対応期間**: 30日以内(GDPR第12条3項)

**参照**: 要件定義書v3.2 FR-025

#### 9.3.4 データポータビリティ権(Right to Data Portability)

**GDPR第20条、プライバシーポリシーv3.1第9.5条**

**実装**: アクセス権と同じ(セクション9.3.1)

**エクスポート形式**: JSON、CSV(構造化、一般的に使用される形式)

**対応期間**: 30日以内

#### 9.3.5 処理制限権(Right to Restriction of Processing)

**GDPR第18条、プライバシーポリシーv3.1第9.4条**

**実装計画**:
- Phase 1-2: 実装なし
- Phase 3以降: アカウント一時停止機能の実装を検討

#### 9.3.6 異議権(Right to Object)

**GDPR第21条**

**実装**: 同意撤回機能(セクション9.2.2)で対応

**対応期間**: 即座

### 9.4 子どものプライバシー保護

#### 9.4.1 年齢制限

**要件**:
- 最低年齢: 13歳
- 確認方法: 生年月日の入力
- 制限: 13歳未満は登録不可

**法的根拠**: 
- GDPR第8条(子どもの同意)
- COPPA(Children's Online Privacy Protection Act)
- 利用規約v3.1第4.1条、第4.2条

**実装**:
```typescript
function isEligible(birthdate: string): boolean {
  const birth = new Date(birthdate);
  const today = new Date();
  const age = today.getFullYear() - birth.getFullYear();
  const monthDiff = today.getMonth() - birth.getMonth();
  
  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
    age--;
  }
  
  return age >= 13;
}
```

**参照**: 要件定義書v3.2セクション1.2.4

#### 9.4.2 親権者の同意

**実装計画**:
- Phase 1-2: 実装なし(13歳以上のみ対象)
- Phase 3以降: 13歳未満のサポート時に実装

---

## 10. GDPR対応

### 10.1 GDPR遵守体制

#### 10.1.1 データ保護責任者(DPO)

**役割**:
- GDPR遵守の監督
- データ処理活動の監視
- データ主体の権利行使の対応
- 監督機関との連携

**連絡先**: privacy@example.com

**参照**: GDPR第37条

#### 10.1.2 データ処理記録(ROPA)

**Record of Processing Activities**:
- 文書名: データ処理記録(ROPA) v1.0
- 内容: 全てのデータ処理活動の記録
- 更新頻度: データ処理活動変更時
- 保管: セキュアなストレージ

**参照**: GDPR第30条、データ処理記録(ROPA)v1.0

### 10.2 法的根拠

#### 10.2.1 データ処理の法的根拠

| データ処理 | 法的根拠 | GDPR条項 | 参照 |
|----------|---------|---------|------|
| **アカウント管理** | 契約の履行 | 第6条1項(b) | プライバシーポリシーv3.1第4.1条 |
| **年齢確認** | 法的義務 | 第6条1項(c) | プライバシーポリシーv3.1第4.1条 |
| **骨格座標データ収集** | 同意 | 第6条1項(a) | プライバシーポリシーv3.1第5.1条 |
| **サービス改善** | 正当な利益 | 第6条1項(f) | プライバシーポリシーv3.1第5.2条 |
| **決済処理** | 契約の履行 | 第6条1項(b) | - |
| **マーケティング** | 同意 | 第6条1項(a) | Phase 3以降 |

**参照**: 要件定義書v3.2セクション1.7(正当な利益の詳細)

#### 10.2.2 正当な利益評価(LIA)

**Legitimate Interest Assessment**:

**目的**: セッションメタデータ収集(サービス改善)

**必要性**:
- サービス品質向上
- バグ修正
- 機能開発の優先順位付け

**バランステスト**:
- データ主体への影響: 低(匿名化されたデータ)
- 事業者の利益: 中(サービス改善に必要)
- 結論: 正当な利益として認められる

**保護措置**:
- ユーザーIDの仮名化
- 個人を特定できる情報の除外
- アクセス制御
- 保存期間の制限(2年間)

**参照**: GDPR第6条1項(f)、プライバシーポリシーv3.1第5.2条

### 10.3 データ侵害対応

#### 10.3.1 データ侵害の定義

**GDPR第4条12項**:
「個人データの侵害」とは、送信、保存その他の処理がされる個人データの、偶発的又は違法な、破壊、喪失、改変、無権限での開示又はアクセスをもたらす、セキュリティの侵害をいう。

#### 10.3.2 72時間ルール

**GDPR第33条**: 監督機関への通知(72時間以内)

**通知が必要な場合**:
- 個人データの漏洩
- 不正アクセスによるデータ流出
- データの改ざん・削除

**通知内容**:
1. データ侵害の性質
2. 影響を受けるデータ主体の数
3. データ保護責任者の連絡先
4. データ侵害の影響
5. 講じた又は講じる予定の措置

**参照**: プライバシーポリシーv3.1第13条、要件定義書v3.2 NFR-020

#### 10.3.3 データ主体への通知

**GDPR第34条**: データ主体への通知(必要な場合)

**通知が必要な場合**:
- 個人の権利と自由に高いリスクをもたらす可能性がある
- 例: パスワードハッシュの漏洩、機密情報の流出

**通知不要な場合**:
- 適切な保護措置を講じている(暗号化等)
- 高いリスクがない
- 過度な労力を要する(代替手段として公開通知)

**通知内容**:
1. データ侵害の性質(平易な言語)
2. データ保護責任者の連絡先
3. データ侵害の影響
4. 講じた又は講じる予定の措置
5. 推奨される対策(パスワード変更等)

**通知方法**: メール、アプリ内通知、Webサイト

**参照**: セクション13.2(インシデント通知手順)

### 10.4 国際データ転送

#### 10.4.1 転送メカニズム

**使用するメカニズム**:
- Google Cloud: 十分性認定(Adequacy Decision)に基づく転送
- Stripe: 標準契約条項(SCC)に基づく転送

**データ転送先**:
| サービス | 転送先 | 法的根拠 |
|---------|-------|---------|
| **Google Cloud** | 米国、日本 | 十分性認定、SCC |
| **Stripe** | 米国 | SCC |
| **RevenueCat** | 米国 | SCC |

**参照**: GDPR第44-50条、プライバシーポリシーv3.1第6条

#### 10.4.2 追加の保護措置

**実装**:
- TLS 1.3による転送時の暗号化
- AES-256による保存時の暗号化
- アクセス制御(IAM)
- 監査ログの記録

### 10.5 データ保護影響評価(DPIA)

#### 10.5.1 DPIA実施の判断

**GDPR第35条**: 高リスクの処理にはDPIAが必須

**高リスクの判断基準**(EDPB Guidelines):
- 大規模な処理
- センシティブデータの処理
- 新技術の使用
- プロファイリング

**本サービスの評価**:
- 骨格座標データ収集: 高リスク(健康関連データ)
- MediaPipe使用: 高リスク(新技術)
- 結論: DPIA実施が必要

#### 10.5.2 DPIA実施内容

**実施項目**:
1. 処理の体系的な記述
2. 必要性と比例性の評価
3. データ主体の権利と自由に対するリスク評価
4. リスクに対処する措置

**実施時期**:
- Phase 1開始前(MVP開発前)
- 実施済み: 2025年11月

**結論**:
- リスク: 中程度(適切な保護措置により軽減)
- 対策: オンデバイス処理、仮名化、暗号化、アクセス制御
- 承認: データ保護責任者により承認済み

**参照**: GDPR第35条、要件定義書v3.2セクション1.6.3

---
# セキュリティポリシー v1.0 - Part 4

## 11. セキュリティ監視

### 11.1 ログ管理

#### 11.1.1 ログ収集

**Cloud Logging**:

| ログタイプ | 内容 | 保存期間 | セキュリティレベル |
|----------|------|---------|-------------------|
| **アクセスログ** | API呼び出し、認証イベント | 400日 | 高 |
| **エラーログ** | エラー、例外 | 400日 | 中 |
| **監査ログ** | データアクセス、権限変更 | 7年間 | 最高 |
| **セキュリティログ** | 不正アクセス試行、脅威検知 | 400日 | 最高 |

**ログレベル**:
- ERROR: エラー発生時
- WARN: 警告(レート制限超過、無効な入力等)
- INFO: 重要な処理(API呼び出し、GDPR権利行使等)
- DEBUG: デバッグ情報(本番環境では無効)

**個人情報の取り扱い**:
- 個人情報はログに含めない
- ユーザーIDは記録可(仮名化しない、監査目的)
- メールアドレス、パスワード等は記録禁止

**参照**: API設計書v3.2セクション3.6、要件定義書v3.2 NFR-028

#### 11.1.2 ログ形式

**統一フォーマット**:
```json
{
  "timestamp": "2025-11-24T10:00:00Z",
  "level": "INFO",
  "service": "firebase-functions",
  "functionName": "user_updateProfile",
  "userId": "user_id",
  "requestId": "request_id",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0...",
  "action": "UPDATE",
  "resourceType": "USER_PROFILE",
  "result": "SUCCESS",
  "duration": 150,
  "message": "プロフィール更新成功"
}
```

#### 11.1.3 ログ分析

**ツール**:
- Cloud Logging: リアルタイム検索
- BigQuery: 高度な分析(ログシンク経由)
- Data Studio: 可視化

**分析項目**:
- 異常なアクセスパターン
- エラー率の推移
- レスポンス時間の分布
- 認証失敗の頻度

### 11.2 監視とアラート

#### 11.2.1 Cloud Monitoring

**監視メトリクス**:

| メトリクス | しきい値 | アラート方法 | 対応者 |
|----------|---------|------------|--------|
| **エラー率** | 5%以上 | Slack即時通知 | 運用チーム |
| **レスポンス時間** | 1秒以上(95%ile) | Slack即時通知 | 開発チーム |
| **認証失敗率** | 10%以上 | Slack + メール | セキュリティ担当 |
| **API呼び出し数** | 10,000/分以上 | Slack通知 | 運用チーム |
| **メモリ使用率** | 80%以上 | メール通知 | 運用チーム |
| **CPU使用率** | 80%以上 | メール通知 | 運用チーム |
| **ストレージ容量** | 80%以上 | メール通知 | 運用チーム |

**アップタイムモニタリング**:
- 監視間隔: 1分
- タイムアウト: 10秒
- 目標: 99.5%以上のアップタイム

**参照**: 要件定義書v3.2 NFR-005(可用性)、NFR-030(パフォーマンス監視)

#### 11.2.2 Firebase Crashlytics

**目的**: クラッシュレポートの収集と分析

**収集データ**:
- クラッシュスタックトレース
- デバイス情報
- OSバージョン
- アプリバージョン

**アラート設定**:
- クラッシュフリーユーザー率: 99%未満でアラート
- 新しいクラッシュ: 即時通知

**参照**: 要件定義書v3.2 NFR-029

#### 11.2.3 Firebase Performance Monitoring

**監視項目**:
- アプリ起動時間
- 画面遷移時間
- ネットワークリクエスト時間
- カスタムトレース(MediaPipe処理時間等)

**目標**:
- アプリ起動時間: 3秒以内
- MediaPipeフレームレート: 30fps以上
- APIレスポンス時間: 200ms以内

**参照**: 要件定義書v3.2 NFR-001, NFR-002, NFR-003

### 11.3 セキュリティイベント検知

#### 11.3.1 異常検知

**検知パターン**:

| パターン | 説明 | 対応 |
|---------|------|------|
| **ブルートフォース攻撃** | 短時間に多数のログイン失敗 | IPブロック、アラート |
| **異常な地域からのアクセス** | 通常と異なる国からのログイン | ユーザー通知、MFAプロンプト |
| **大量データダウンロード** | 通常より多いデータ取得 | アラート、調査 |
| **権限昇格試行** | 他人のデータへのアクセス試行 | ブロック、アラート |
| **SQLインジェクション** | SQLパターンを含むリクエスト | ブロック、アラート |

#### 11.3.2 SIEM(Security Information and Event Management)

**実装計画**:
- Phase 1-2: Cloud Loggingのログベース分析
- Phase 3以降: Chronicle(Google Cloud SIEM)の導入を検討

**機能**:
- ログの集約と正規化
- リアルタイム分析
- 脅威インテリジェンス連携
- 自動アラート

### 11.4 コンプライアンス監視

#### 11.4.1 GDPR遵守状況

**監視項目**:
- データ削除リクエストの対応状況(30日以内)
- データアクセスリクエストの対応状況(30日以内)
- 同意記録の完全性
- データ保存期間の遵守

**レポート**:
- 頻度: 月次
- 報告先: データ保護責任者、セキュリティ責任者

#### 11.4.2 セキュリティポリシー遵守

**チェック項目**:
- パスワードポリシーの遵守
- アクセス権限の最小化
- ログの適切な記録
- バックアップの実施

**監査**:
- 内部監査: 四半期ごと
- 外部監査: 年1回

---

## 12. 脆弱性管理

### 12.1 脆弱性スキャン

#### 12.1.1 自動スキャン

**ツール**:

| ツール | 対象 | 頻度 | 実行タイミング |
|-------|------|------|--------------|
| **npm audit** | Node.jsパッケージ | 毎コミット | CI/CD |
| **Snyk** | 依存関係 | 日次 | 自動 |
| **Dependabot** | GitHub依存関係 | 日次 | 自動 |
| **OWASP ZAP** | Webアプリケーション | 週次 | 手動 |
| **Google Cloud Security Scanner** | Firebase Hosting | 週次 | 自動 |

**参照**: 要件定義書v3.2 NFR-013(脆弱性診断)

#### 12.1.2 脆弱性の分類

**CVSS v3.1スコア**:

| スコア | 深刻度 | 対応期限 |
|-------|--------|---------|
| **9.0-10.0** | Critical | 24時間以内 |
| **7.0-8.9** | High | 1週間以内 |
| **4.0-6.9** | Medium | 1ヶ月以内 |
| **0.1-3.9** | Low | 次回リリース時 |

### 12.2 パッチ管理

#### 12.2.1 パッチ適用プロセス

1. **脆弱性検出**:
   - 自動スキャンツール
   - セキュリティアドバイザリ
   - CVE(Common Vulnerabilities and Exposures)

2. **影響評価**:
   - CVSS スコアの確認
   - 影響範囲の調査
   - エクスプロイト可能性の評価

3. **優先順位付け**:
   - 深刻度
   - 影響範囲
   - エクスプロイト可能性

4. **パッチ適用**:
   - 開発環境でテスト
   - ステージング環境で検証
   - 本番環境へのデプロイ

5. **検証**:
   - 脆弱性が修正されたことを確認
   - 機能が正常に動作することを確認

6. **文書化**:
   - 変更履歴への記録
   - セキュリティ委員会への報告

#### 12.2.2 緊急パッチ

**Critical脆弱性の対応**:
- 発見後24時間以内にパッチ適用
- 必要に応じて臨時メンテナンス実施
- ユーザーへの事前通知(可能な場合)
- 事後報告(セキュリティ委員会)

### 12.3 ペネトレーションテスト

#### 12.3.1 実施計画

**頻度**: 年1回(リリース前)

**対象**:
- Webアプリケーション
- モバイルアプリ
- API
- 認証システム

**実施者**: 第三者セキュリティベンダー

**参照**: 要件定義書v3.2 NFR-014

#### 12.3.2 テスト項目

**OWASP Testing Guide v4に基づく**:

| カテゴリ | テスト項目 |
|---------|-----------|
| **情報収集** | ディレクトリ構造、エラーメッセージ |
| **設定管理** | デフォルト設定、SSL/TLS設定 |
| **認証** | ブルートフォース、セッション管理 |
| **認可** | パストラバーサル、権限昇格 |
| **セッション管理** | セッション固定、トークン予測 |
| **入力検証** | XSS、SQLインジェクション |
| **エラーハンドリング** | 情報漏洩、スタックトレース |
| **暗号化** | 弱い暗号、不適切な実装 |
| **ビジネスロジック** | レート制限バイパス、ワークフロー迂回 |
| **クライアントサイド** | DOM XSS、リソース操作 |

#### 12.3.3 結果対応

1. **レポート受領**: テスト完了後2週間以内
2. **影響評価**: 発見された脆弱性の深刻度評価
3. **修正計画**: 深刻度に応じた修正スケジュール作成
4. **修正実施**: パッチ適用
5. **再テスト**: 脆弱性が修正されたことを確認
6. **最終報告**: セキュリティ委員会、経営層への報告

---

## 13. インシデント対応

### 13.1 インシデント対応体制

#### 13.1.1 CSIRT(Computer Security Incident Response Team)

**構成**:
- CSIRT リーダー: セキュリティ責任者
- メンバー: セキュリティ担当者、開発リーダー、運用リーダー
- サポート: データ保護責任者、法務担当者

**役割**:
- インシデントの検知と評価
- 初動対応の指揮
- 復旧作業の統括
- 再発防止策の策定

#### 13.1.2 エスカレーションフロー

```
レベル1: 運用チーム(軽微なインシデント)
  ↓ (15分以内に解決不可)
レベル2: セキュリティ担当者(中程度のインシデント)
  ↓ (1時間以内に解決不可、または重大インシデント)
レベル3: CSIRT(重大インシデント)
  ↓ (必要に応じて)
レベル4: 経営層、法務、広報
```

### 13.2 インシデント対応手順

#### 13.2.1 検知(Detection)

**検知方法**:
- セキュリティ監視ツールのアラート
- ユーザーからの報告
- 脆弱性スキャン
- ログ分析

**初動**:
1. アラート/報告を受領(即座)
2. インシデントの真偽を確認(15分以内)
3. 深刻度を評価(30分以内)
4. 必要に応じてエスカレーション

#### 13.2.2 封じ込め(Containment)

**短期的封じ込め**:
- 攻撃元IPのブロック
- 侵害されたアカウントの無効化
- 影響を受けるサービスの一時停止

**長期的封じ込め**:
- システムの隔離
- パッチの適用
- セキュリティ設定の強化

**目標時間**: 検知後2時間以内

#### 13.2.3 根絶(Eradication)

**実施項目**:
- マルウェアの削除
- 侵害されたアカウントの削除
- 脆弱性のパッチ適用
- 不正なアクセス権限の削除

**検証**:
- 脅威が完全に除去されたことを確認
- システムの完全性チェック

**目標時間**: 封じ込め後24時間以内

#### 13.2.4 復旧(Recovery)

**実施項目**:
1. システムの再構築(必要な場合)
2. バックアップからのデータ復旧
3. セキュリティ設定の再適用
4. サービスの段階的再開
5. 動作確認とテスト

**監視強化**:
- 復旧後24時間は集中監視
- 異常な活動の早期検知

**目標時間**: 根絶後24時間以内(RTO準拠)

**参照**: 要件定義書v3.2 NFR-032(復旧時間目標)

#### 13.2.5 事後対応(Post-Incident Activity)

**実施項目**:
1. インシデント報告書の作成
2. 根本原因分析(Root Cause Analysis)
3. 再発防止策の策定
4. セキュリティポリシーの見直し
5. 訓練・教育の実施

**報告書の内容**:
- インシデントの概要
- 発生日時、検知日時
- 影響範囲(ユーザー数、データ量)
- 根本原因
- 対応内容
- 再発防止策

**提出先**: セキュリティ責任者、経営層

**期限**: インシデント解決後1週間以内

### 13.3 インシデント通知

#### 13.3.1 内部通知

**通知対象**:
- セキュリティ委員会
- 経営層
- 関係部門

**通知タイミング**:
- レベル3以上: 検知後1時間以内
- レベル2: 検知後4時間以内
- レベル1: 日次報告

#### 13.3.2 外部通知

**監督機関への通知(GDPR第33条)**:
- 対象: 個人データ侵害
- タイミング: 認識後72時間以内
- 通知先: 各国のデータ保護監督機関
- 内容: セクション10.3.2参照

**ユーザーへの通知(GDPR第34条)**:
- 対象: 高リスクの個人データ侵害
- タイミング: 遅延なく
- 方法: メール、アプリ内通知、Webサイト
- 内容: セクション10.3.3参照

**プレスリリース**:
- 対象: 重大なインシデント(多数のユーザーに影響)
- タイミング: 監督機関通知後
- 承認: 経営層、法務、広報
- 内容: 事実関係、対応状況、再発防止策

**参照**: プライバシーポリシーv3.1第13条

### 13.4 インシデント訓練

#### 13.4.1 訓練計画

**頻度**: 年2回

**訓練シナリオ**:
1. ランサムウェア攻撃
2. DDoS攻撃
3. 個人データ漏洩
4. 内部不正

**参加者**: CSIRT全メンバー、運用チーム

**評価項目**:
- 検知時間
- 初動対応時間
- 封じ込め時間
- コミュニケーション
- 意思決定

#### 13.4.2 訓練結果の活用

- 対応手順の改善
- エスカレーションフローの見直し
- 必要なツール・リソースの特定
- 教育・訓練の強化

---

## 14. バックアップ・復旧

### 14.1 バックアップ戦略

#### 14.1.1 バックアップ対象

| データ | バックアップ方式 | 頻度 | 保存期間 | 暗号化 |
|-------|----------------|------|---------|--------|
| **Firestore** | エクスポート | 日次 | 30日 | AES-256 |
| **BigQuery** | スナップショット | 週次 | 90日 | AES-256 |
| **Cloud Storage** | レプリケーション | リアルタイム | - | AES-256 |
| **ソースコード** | Git | 随時 | 無期限 | なし(プライベートリポジトリ) |
| **設定ファイル** | Git | 随時 | 無期限 | 機密情報は暗号化 |

**参照**: セクション8.5.1

#### 14.1.2 バックアップの検証

**検証項目**:
- バックアップの完全性
- 復旧可能性
- 暗号化の有効性

**検証頻度**: 四半期ごと(年4回)

**検証方法**:
1. ステージング環境へのリストア
2. データ整合性チェック
3. アプリケーション動作確認
4. 結果の文書化

### 14.2 ディザスタリカバリ

#### 14.2.1 復旧目標

**RTO(Recovery Time Objective)**:
- 目標: 24時間以内
- Critical機能: 4時間以内

**RPO(Recovery Point Objective)**:
- 目標: 24時間以内(日次バックアップ)
- Critical データ: 1時間以内

**参照**: 要件定義書v3.2 NFR-032

#### 14.2.2 復旧手順

**フェーズ1: 評価(0-2時間)**:
1. 被害状況の評価
2. 復旧方法の決定
3. 関係者への通知

**フェーズ2: 準備(2-4時間)**:
1. バックアップデータの特定
2. ステージング環境での検証
3. 復旧計画の最終確認

**フェーズ3: 復旧(4-20時間)**:
1. データベースの復旧
2. アプリケーションの復旧
3. 設定の再適用
4. 動作確認

**フェーズ4: 検証(20-24時間)**:
1. 全機能の動作確認
2. データ整合性の確認
3. パフォーマンステスト
4. セキュリティチェック

**フェーズ5: 再開(24時間~)**:
1. サービス再開
2. ユーザーへの通知
3. 監視強化
4. 事後報告

#### 14.2.3 事業継続計画(BCP)

**代替手段**:
- Firebase: 自動フェイルオーバー(Google Cloud)
- BigQuery: リージョン内自動レプリケーション
- 開発チーム: リモートワーク体制

**コミュニケーション**:
- 社内: Slack、メール
- ユーザー: メール、アプリ内通知、Webサイト、SNS

---

## 15. チェックリスト

### 15.1 開発時チェックリスト

#### 15.1.1 コーディング

- [ ] セキュアコーディングガイドラインに準拠
- [ ] 入力値の厳密なバリデーション(Joi)
- [ ] 出力のサニタイゼーション
- [ ] パスワードのハッシュ化(bcrypt)
- [ ] APIキーのハードコーディング禁止
- [ ] エラーメッセージの情報漏洩防止
- [ ] ログに個人情報を含めない
- [ ] HTTPS通信の強制

#### 15.1.2 認証・認可

- [ ] Firebase Authenticationによる認証
- [ ] 全APIでcontext.authをチェック
- [ ] ユーザーは自分のデータのみアクセス可能
- [ ] Firestore Security Rulesの実装
- [ ] レート制限の実装
- [ ] セッショントークンの適切な管理

#### 15.1.3 データ保護

- [ ] TLS 1.3の使用
- [ ] AES-256によるデータ暗号化
- [ ] 最小限のデータのみ収集
- [ ] 同意の取得と記録
- [ ] データ保存期間の遵守
- [ ] 削除機能の実装

#### 15.1.4 コードレビュー

- [ ] セキュリティ観点でのレビュー実施
- [ ] OWASP Top 10への対策確認
- [ ] 脆弱性の有無確認
- [ ] 承認後のみマージ可能

### 15.2 デプロイ前チェックリスト

#### 15.2.1 セキュリティテスト

- [ ] ユニットテスト実行(カバレッジ80%以上)
- [ ] セキュリティテスト実行
- [ ] 脆弱性スキャン(npm audit)実行
- [ ] Firestore Security Rulesのテスト
- [ ] APIレート制限のテスト
- [ ] 認証・認可のテスト

#### 15.2.2 設定確認

- [ ] 本番環境用の環境変数設定
- [ ] APIキーのローテーション(90日以内)
- [ ] SSL/TLS証明書の有効性確認
- [ ] セキュリティヘッダーの設定
- [ ] Cloud Armorポリシーの確認
- [ ] IAMロールの最小権限確認

#### 15.2.3 監視設定

- [ ] Cloud Loggingの有効化
- [ ] Cloud Monitoringアラートの設定
- [ ] Firebase Crashlyticsの有効化
- [ ] Firebase Performanceの有効化
- [ ] アップタイムモニタリングの設定

#### 15.2.4 ドキュメント

- [ ] API仕様書の更新
- [ ] セキュリティポリシーの更新
- [ ] 変更履歴の記録
- [ ] 運用手順書の更新

### 15.3 本番運用チェックリスト

#### 15.3.1 日次

- [ ] セキュリティアラートの確認
- [ ] エラーログの確認
- [ ] パフォーマンスメトリクスの確認
- [ ] バックアップの実行確認

#### 15.3.2 週次

- [ ] 脆弱性スキャン実行
- [ ] ログ分析
- [ ] 異常なアクセスパターンの調査
- [ ] アクセス権限のレビュー

#### 15.3.3 月次

- [ ] セキュリティインシデントのレビュー
- [ ] 脆弱性対応状況の確認
- [ ] パッチ適用状況の確認
- [ ] GDPRリクエストの対応状況確認
- [ ] バックアップの検証

#### 15.3.4 四半期ごと

- [ ] 内部セキュリティ監査
- [ ] アクセス権限の包括的レビュー
- [ ] セキュリティポリシーの見直し
- [ ] インシデント対応訓練
- [ ] ディザスタリカバリ訓練

#### 15.3.5 年次

- [ ] 外部セキュリティ監査
- [ ] ペネトレーションテスト
- [ ] セキュリティ戦略の見直し
- [ ] DPIA(データ保護影響評価)の更新
- [ ] 契約の見直し(第三者ベンダー)

---

## 16. 用語集

| 用語 | 定義 |
|-----|------|
| **AES** | Advanced Encryption Standard。データ暗号化規格 |
| **bcrypt** | パスワードハッシュ化アルゴリズム |
| **BCP** | Business Continuity Plan。事業継続計画 |
| **CIA** | Confidentiality(機密性)、Integrity(完全性)、Availability(可用性) |
| **CMEK** | Customer-Managed Encryption Keys。顧客管理の暗号鍵 |
| **COPPA** | Children's Online Privacy Protection Act。子どものオンラインプライバシー保護法 |
| **CSP** | Content Security Policy。コンテンツセキュリティポリシー |
| **CSIRT** | Computer Security Incident Response Team |
| **CSRF** | Cross-Site Request Forgery。クロスサイトリクエストフォージェリ |
| **CVE** | Common Vulnerabilities and Exposures。共通脆弱性識別子 |
| **CVSS** | Common Vulnerability Scoring System。共通脆弱性評価システム |
| **DDoS** | Distributed Denial of Service。分散型サービス妨害攻撃 |
| **DLP** | Data Loss Prevention。データ損失防止 |
| **DPO** | Data Protection Officer。データ保護責任者 |
| **DPIA** | Data Protection Impact Assessment。データ保護影響評価 |
| **EDPB** | European Data Protection Board。欧州データ保護会議 |
| **GDPR** | General Data Protection Regulation。EU一般データ保護規則 |
| **GMEK** | Google-Managed Encryption Keys。Google管理の暗号鍵 |
| **HSTS** | HTTP Strict Transport Security |
| **IAM** | Identity and Access Management。アクセス制御システム |
| **JWT** | JSON Web Token |
| **LIA** | Legitimate Interest Assessment。正当な利益評価 |
| **MFA** | Multi-Factor Authentication。多要素認証 |
| **MITM** | Man-In-The-Middle。中間者攻撃 |
| **OWASP** | Open Web Application Security Project |
| **PCI DSS** | Payment Card Industry Data Security Standard |
| **PII** | Personally Identifiable Information。個人識別情報 |
| **RBAC** | Role-Based Access Control。ロールベースアクセス制御 |
| **ROPA** | Record of Processing Activities。データ処理記録 |
| **RPO** | Recovery Point Objective。復旧ポイント目標 |
| **RTO** | Recovery Time Objective。復旧時間目標 |
| **SCC** | Standard Contractual Clauses。標準契約条項 |
| **SIEM** | Security Information and Event Management |
| **SLA** | Service Level Agreement。サービスレベル合意 |
| **SQL Injection** | SQLインジェクション攻撃 |
| **SSRF** | Server-Side Request Forgery |
| **STRIDE** | 脅威モデリングフレームワーク(Spoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, Elevation of Privilege) |
| **TLS** | Transport Layer Security。通信暗号化プロトコル |
| **XSS** | Cross-Site Scripting。クロスサイトスクリプティング |
| **仮名化** | 追加情報なしでは個人を特定できないようにデータを処理すること |
| **匿名化** | 個人を特定できる情報を完全に削除すること |
| **正当な利益** | GDPR第6条1項(f)に基づくデータ処理の法的根拠 |

---

## 17. 変更履歴

| バージョン | 日付 | 変更内容 | 担当者 |
|-----------|------|---------|--------|
| v1.0 | 2025-11-24 | 初版作成 | セキュリティチーム |
| - | - | 要件定義書v3.2との整合性確保 | - |
| - | - | プライバシーポリシーv3.1との整合性確保 | - |
| - | - | 利用規約v3.1との整合性確保 | - |
| - | - | API設計書v3.2との整合性確保 | - |
| - | - | BigQuery設計書v3.2との整合性確保 | - |
| - | - | データ処理記録(ROPA)v1.0との整合性確保 | - |

---

## レビューチェックリスト

### 機能要件との整合性

- [x] NFR-009: TLS 1.3による通信暗号化
- [x] NFR-010: AES-256によるデータ暗号化
- [x] NFR-011: Firebase Authentication、JWT、OAuth 2.0
- [x] NFR-012: Cloud IAM、Firestore Security Rules
- [x] NFR-013: 脆弱性診断(リリース前)
- [x] NFR-014: ペネトレーションテスト(年1回)
- [x] NFR-015: オンデバイス処理(カメラ映像)
- [x] NFR-016: ユーザーID仮名化(BigQueryエクスポート時)
- [x] NFR-017: データ削除(30日以内)
- [x] NFR-018: データエクスポート(30日以内)
- [x] NFR-019: 同意管理と記録保持
- [x] NFR-020: データ侵害通知(72時間以内)
- [x] NFR-028: Cloud Loggingによるログ収集
- [x] NFR-031: 日次バックアップ
- [x] NFR-032: RTO 24時間以内

### 法的要件との整合性

- [x] GDPR全般: 完全準拠
- [x] プライバシーポリシーv3.1: 全条項との整合性
- [x] 利用規約v3.1: 第5条(アカウント)との整合性
- [x] データ処理記録(ROPA)v1.0: 全データ処理活動の記録

### 技術設計書との整合性

- [x] API設計書v3.2 セクション13(セキュリティ): 完全整合
- [x] BigQuery設計書v3.2 セクション12(セキュリティ): 完全整合
- [x] システムアーキテクチャ設計書v3.2: セキュリティアーキテクチャとの整合

### グレーな表現のチェック

- [x] 全ての要件に具体的な数値目標を設定
- [x] 曖昧な表現(「適切に」「必要に応じて」等)を排除
- [x] 全ての対応期限を明示
- [x] 責任者を明確に記載

---

**Document Version**: v1.0  
**Last Updated**: 2025年11月24日  
**Status**: Draft  
**Approved by**: (承認待ち)

---

## まとめ

本セキュリティポリシーv1.0は、AIフィットネスアプリ(仮称)における包括的なセキュリティ対策を定義しています。

### 主要な特徴

✅ **法的準拠**: GDPR、個人情報保護法に完全準拠  
✅ **技術的対策**: TLS 1.3、AES-256、Firebase Auth、IAM等  
✅ **プライバシー保護**: オンデバイス処理、仮名化、データ最小化  
✅ **監視体制**: Cloud Logging、Monitoring、Crashlytics  
✅ **インシデント対応**: CSIRT体制、72時間ルール対応  
✅ **継続的改善**: 定期監査、脆弱性管理、訓練  

### 次のステップ

1. セキュリティ委員会でのレビュー
2. データ保護責任者(DPO)の承認
3. 経営層の承認
4. 関係者への周知
5. Phase 1開発での実装
6. 定期的な見直しと更新

### 参照ドキュメント

本ポリシーは以下のドキュメントと完全に整合しています:
- 要件定義書 v3.2
- システムアーキテクチャ設計書 v3.2
- API設計書(Firebase Functions) v3.2
- BigQuery設計書 v3.2
- プライバシーポリシー v3.1
- 利用規約 v3.1
- データ処理記録(ROPA) v1.0
- 画面遷移図+ワイヤーフレーム v3.3
