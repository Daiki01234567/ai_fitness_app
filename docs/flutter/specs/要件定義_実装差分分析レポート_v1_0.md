# 要件定義書と実装チケットの差分分析レポート

**文書バージョン**: v1.0
**作成日**: 2025-12-05
**対象バージョン**: 要件定義書 v3.3 / チケット #001-#021
**分析者**: Claude Code (コンプライアンス監査エージェント)

---

## 1. 概要

本ドキュメントは、`docs/specs/00_要件定義書_v3_3.md`に定義された機能要件（FR-xxx）・非機能要件（NFR-xxx）と、`docs/tickets/`配下の開発チケット（#001-#021）との整合性を分析し、差分・矛盾を特定したレポートです。

### 1.1 分析目的

- 要件定義に記載されているがチケット化されていない機能の特定
- チケットで実装されているが要件定義に根拠がない機能の特定
- 要件定義とチケット間の内容矛盾・フェーズ不一致の特定

### 1.2 分析範囲

| 区分 | 件数 |
|------|------|
| 機能要件（FR） | 38件 |
| 非機能要件（NFR） | 37件 |
| 開発チケット | 21件 |

---

## 2. 要件定義にあるがチケット未対応の機能

### 2.1 High（Phase 2必須 - 即時対応必要）

| FR ID | 要件名 | Phase | 優先度 | 問題詳細 | 推奨対応 |
|-------|--------|-------|--------|----------|----------|
| **FR-019** | 無料トライアル(1週間) | 2 | 必須 | チケット#013が未着手 | #013の着手開始 |
| **FR-020** | 月額課金(500円) | 2 | 必須 | チケット#013が未着手 | #013の着手開始 |
| **FR-021** | サブスクリプション管理 | 2 | 必須 | チケット#013が未着手 | #013の着手開始 |
| **FR-022** | 決済(Stripe/RevenueCat) | 2 | 必須 | チケット#013が未着手 | #013の着手開始 |
| **FR-022-1** | 課金エラーハンドリング | 2 | 必須 | チケット#013が未着手（懸念点#7対応） | #013の着手開始 |
| **FR-016** | 設定管理機能 | 2 | 必須 | **対応チケットなし** | 新規チケット作成 |
| **FR-031** | お問い合わせフォーム | 2 | 必須 | **対応チケットなし** | 新規チケット作成 |

### 2.2 Medium（推奨 - 計画的対応推奨）

| FR ID | 要件名 | Phase | 優先度 | 問題詳細 | 推奨対応 |
|-------|--------|-------|--------|----------|----------|
| **FR-011** | 通知設定 | 2 | 推奨 | #016がPhase 3扱い（要件はPhase 2） | フェーズ再検討 |
| **FR-017** | リマインダー通知 | 2 | 推奨 | #016がPhase 3扱い | フェーズ再検討 |
| **FR-018** | 達成通知 | 2 | 推奨 | #016がPhase 3扱い | フェーズ再検討 |
| **FR-023** | チュートリアル | 2 | 推奨 | **対応チケットなし** | 新規チケット作成 |
| **FR-028-1** | ML移行準備データ収集 | 2 | 推奨 | アノテーション戦略の明示なし | #009/#014に追記 |
| **FR-030** | ヘルプセンター | 2 | 推奨 | **対応チケットなし** | 新規チケット作成 |

### 2.3 Low（Phase 3 - 計画通り未対応）

| FR ID | 要件名 | Phase | 優先度 | 備考 |
|-------|--------|-------|--------|------|
| FR-013 | 言語設定（多言語対応） | 3 | 推奨 | 計画通り後回し |
| FR-015 | Google/Apple認証 | 1 | 推奨 | コード実装済み（#007）、Console設定待ち |

---

## 3. チケットにあるが要件定義に明示されていない実装

| チケット | 機能名 | 詳細 | 評価 |
|----------|--------|------|------|
| #006 | 監視・ログ基盤 | NFR-028～030として間接的に必要だが、明示的なFRがない | ✅ インフラ要件として妥当 |
| #017 | ソーシャル機能 | 要件定義1.8.2節にPhase 3として記載あり | ✅ 整合性あり |
| #018 | パフォーマンス最適化 | NFR-024/025/035に対応 | ✅ 整合性あり |
| #019 | テスト戦略 | 要件定義に明示なし（品質管理として暗黙的） | ⚠️ NFR化推奨 |
| #020 | デプロイ・リリース | 要件定義に明示なし（運用として暗黙的） | ⚠️ ドキュメント整備推奨 |
| #021 | UIバグ修正 | 運用タスク、要件定義対象外 | ✅ 適切 |

---

## 4. 要件とチケット内容の矛盾

### 4.1 チケットのFR番号参照エラー

以下のチケットで、参照しているFR番号が要件定義書の内容と一致していません。

| チケット | 現在の参照 | 正しい参照 | 修正理由 |
|----------|-----------|-----------|----------|
| **#010** フォーム確認ロジック | FR-010～FR-018 | **FR-003～FR-006** | FR-010はセッション詳細表示。フォーム評価はFR-003～FR-006 |
| **#011** トレーニング画面 | FR-019～FR-023 | **FR-003～FR-007** | FR-019～FR-022は課金機能。トレーニング画面はFR-003～FR-007 |
| **#012** 履歴・分析 | FR-028～FR-030 | **FR-007～FR-010** | FR-028/029はデータ収集。履歴・分析はFR-007～FR-010 |
| **#013** 課金機能 | FR-031～FR-033 | **FR-019～FR-022-1** | FR-031はお問い合わせフォーム。課金機能はFR-019～FR-022-1 |

### 4.2 フェーズの不一致

| 要件 | 要件定義でのPhase | チケットでのPhase | 問題 |
|------|------------------|------------------|------|
| FR-011/017/018（通知機能） | Phase 2（推奨） | Phase 3（#016） | フェーズが後ろにずれている |

### 4.3 実装内容の確認が必要な項目

| FR ID | 要件定義の内容 | チケット状況 | 確認事項 |
|-------|---------------|-------------|----------|
| FR-027 | データアクセス権 - PDF即時ダウンロード（MVP） | #015で95%完了 | PDFエクスポート機能の実装確認 |
| FR-006 | スコア表示 - 色分け（緑/黄/赤） | #011でFormScoreWidget実装 | 閾値（80-100:緑, 60-79:黄, 0-59:赤）の確認 |
| FR-003-1 | 種目詳細画面 | #011に含まれる可能性 | 画面実装の完了確認 |
| FR-004-1 | カメラ設定自動開始機能 | #011で自動カウントダウン実装 | 完全対応の確認 |

---

## 5. NFR（非機能要件）のチケット対応状況

### 5.1 対応済み

| NFR | 要件名 | 対応チケット | 完了率 |
|-----|--------|-------------|--------|
| NFR-024/025/035 | MediaPipeパフォーマンス | #009 | 85% |
| NFR-034 | Firestoreセキュリティルール | #002 | 100% |
| NFR-036 | BigQueryリトライ/DLQ | #014 | 85% |
| NFR-037 | コールドスタート対策 | #004 | 完了 |
| NFR-028/029/030 | 監視・ログ基盤 | #006 | 完了 |

### 5.2 対応確認が必要

| NFR | 要件名 | 状況 | 確認事項 |
|-----|--------|------|----------|
| NFR-015 | カメラ映像の端末処理のみ | #009で実装方針明記 | 実機テストでの確認 |
| NFR-017 | 削除予定ユーザーの読み取り専用化 | #002/015で実装済み | 統合テストでの確認 |
| NFR-020 | データ侵害72時間以内通知 | 未対応 | 手順書の作成が必要 |
| NFR-026 | コードカバレッジ80%以上 | 部分的対応 | 全体カバレッジの確認 |

---

## 6. コンプライアンス観点での懸念事項

### 6.1 GDPR準拠状況

| 項目 | 対応FR | チケット状況 | リスク |
|------|--------|-------------|--------|
| 同意管理 | FR-024/024-1 | #008完了 | 🟢 低 |
| データ削除権 | FR-025/025-1 | #015で95%完了 | 🟢 低 |
| データアクセス権 | FR-027 | PDFエクスポート確認要 | 🟡 中 |
| データ訂正権 | FR-026 | プロフィール編集で対応済み | 🟢 低 |
| 同意撤回 | FR-024 | #008完了 | 🟢 低 |
| データポータビリティ | FR-027 | JSON/CSVエクスポート実装済み | 🟢 低 |

### 6.2 薬機法対応

| 確認事項 | 状況 | リスク |
|----------|------|--------|
| 表現ガイドライン準拠 | 要件定義1.4節で定義済み | 🟡 実装確認要 |
| 「参考:」プレフィックス | 各画面・音声フィードバックでの実装確認要 | 🟡 中 |

---

## 7. 重大度別サマリー

### 7.1 Critical（即時対応必要）

**なし** - Phase 1必須要件は概ね対応済み（Console設定待ちを除く）

### 7.2 High（Phase 2リリース前に対応必須）

1. **課金機能（#013）未着手** - FR-019～FR-022-1の全5機能
2. **設定管理機能（FR-016）チケットなし** - 音声/通知/表示/プライバシー設定の統合画面
3. **お問い合わせフォーム（FR-031）チケットなし**

### 7.3 Medium（対応推奨）

1. 通知機能のフェーズ整合（Phase 2推奨 vs Phase 3チケット）
2. チュートリアル機能（FR-023）チケット化
3. ヘルプセンター（FR-030）チケット化
4. チケットのFR番号参照修正（#010, #011, #012, #013）

### 7.4 Low（改善項目）

1. テスト戦略のNFR化検討
2. デプロイ・リリース手順のドキュメント整備

---

## 8. 推奨アクション

### 8.1 即時対応（Phase 2リリースまでに必須）

| 優先度 | アクション | 対応要件 | 担当 |
|--------|-----------|----------|------|
| 1 | チケット#013（課金機能）の着手開始 | FR-019～FR-022-1 | 開発チーム |
| 2 | 新規チケット作成: 設定管理画面 | FR-016 | PM |
| 3 | 新規チケット作成: お問い合わせフォーム | FR-031 | PM |

### 8.2 短期対応（1-2週間以内）

| 優先度 | アクション | 詳細 |
|--------|-----------|------|
| 4 | チケットFR番号参照の修正 | #010, #011, #012, #013 |
| 5 | #016のフェーズ再検討 | Phase 2推奨として再評価 |

### 8.3 中期対応（Phase 2後半）

| 優先度 | アクション | 対応要件 |
|--------|-----------|----------|
| 6 | 新規チケット作成: チュートリアル | FR-023 |
| 7 | 新規チケット作成: ヘルプセンター | FR-030 |
| 8 | データ侵害通知手順書の作成 | NFR-020 |

---

## 9. 新規チケット作成候補

以下のチケットの新規作成を推奨します。

### 9.1 設定管理画面（FR-016対応）

```
チケット番号: #022
タイトル: 設定管理画面の実装
Phase: Phase 2 (機能実装)
関連要件: FR-016
概要: 音声/通知/表示/プライバシー/アカウント設定の統合管理画面
```

### 9.2 お問い合わせフォーム（FR-031対応）

```
チケット番号: #023
タイトル: お問い合わせフォームの実装
Phase: Phase 2 (機能実装)
関連要件: FR-031
概要: ユーザーサポート向けお問い合わせフォーム機能
```

### 9.3 チュートリアル（FR-023対応）

```
チケット番号: #024
タイトル: チュートリアル機能の実装
Phase: Phase 2 (機能実装)
関連要件: FR-023
概要: 初回ユーザー向けアプリ使用方法のチュートリアル機能
```

### 9.4 ヘルプセンター（FR-030対応）

```
チケット番号: #025
タイトル: ヘルプセンターの実装
Phase: Phase 2 (機能実装)
関連要件: FR-030
概要: FAQ、使用方法のヘルプセンター機能
```

---

## 10. 付録: FR-チケット対応表

### 10.1 Phase 1 機能要件

| FR ID | 要件名 | 対応チケット | 状況 |
|-------|--------|-------------|------|
| FR-001 | メール/パスワード認証 | #003, #007 | ✅ 実装済み |
| FR-002 | プロフィール管理 | #007 | ✅ 実装済み |
| FR-002-1 | 同意状態管理機能 | #008 | ✅ 実装済み |
| FR-014 | プライバシー設定 | #015 | ✅ 95%完了 |
| FR-015 | Google/Apple認証 | #003, #007 | ⚠️ Console設定待ち |
| FR-024 | 同意管理 | #008 | ✅ 完了 |
| FR-024-1 | ログイン時同意確認機能 | #008 | ✅ 完了 |
| FR-025 | データ削除権 | #015 | ✅ 95%完了 |
| FR-025-1 | 削除猶予期間のアクセス制御 | #002, #015 | ✅ 実装済み |
| FR-026 | データ訂正権 | #007 | ✅ 実装済み |
| FR-027 | データアクセス権 | #015 | ⚠️ PDF確認要 |

### 10.2 Phase 2 機能要件

| FR ID | 要件名 | 対応チケット | 状況 |
|-------|--------|-------------|------|
| FR-003 | 種目選択 | #011 | ✅ MVP完了 |
| FR-003-1 | 種目詳細画面 | #011 | ⚠️ 確認要 |
| FR-004 | フォーム確認補助(MediaPipe) | #009, #010 | ⚠️ 85-90% |
| FR-004-1 | カメラ設定自動開始機能 | #011 | ⚠️ 確認要 |
| FR-005 | 音声フィードバック | #010 | ⚠️ 90% |
| FR-006 | スコア表示 | #010, #011 | ⚠️ 確認要 |
| FR-007 | トレーニング記録保存 | #011 | ✅ MVP完了 |
| FR-008 | カレンダー表示 | #012 | ✅ 95% |
| FR-009 | グラフ表示 | #012 | ✅ 95% |
| FR-010 | セッション詳細表示 | #012 | ✅ 95% |
| FR-011 | 通知設定 | #016 | ❌ Phase 3扱い |
| FR-012 | 音声設定 | なし | ❌ チケットなし |
| FR-016 | 設定管理機能 | なし | ❌ **チケットなし** |
| FR-017 | リマインダー通知 | #016 | ❌ Phase 3扱い |
| FR-018 | 達成通知 | #016 | ❌ Phase 3扱い |
| FR-019 | 無料トライアル | #013 | ❌ **未着手** |
| FR-020 | 月額課金 | #013 | ❌ **未着手** |
| FR-021 | サブスクリプション管理 | #013 | ❌ **未着手** |
| FR-022 | 決済 | #013 | ❌ **未着手** |
| FR-022-1 | 課金エラーハンドリング | #013 | ❌ **未着手** |
| FR-023 | チュートリアル | なし | ❌ **チケットなし** |
| FR-028 | 骨格座標データ収集 | #009, #014 | ⚠️ 85% |
| FR-028-1 | ML移行準備データ収集 | #009, #014 | ⚠️ 部分対応 |
| FR-029 | セッションメタデータ収集 | #014 | ⚠️ 85% |
| FR-030 | ヘルプセンター | なし | ❌ **チケットなし** |
| FR-031 | お問い合わせフォーム | なし | ❌ **チケットなし** |

### 10.3 Phase 3 機能要件

| FR ID | 要件名 | 対応チケット | 状況 |
|-------|--------|-------------|------|
| FR-013 | 言語設定 | なし | 計画通り |

---

## 変更履歴

| バージョン | 日付 | 変更内容 | 作成者 |
|-----------|------|----------|--------|
| v1.0 | 2025-12-05 | 初版作成 | Claude Code |

---

**関連ドキュメント**:
- `docs/specs/00_要件定義書_v3_3.md`
- `docs/tickets/001_firebase_project_setup.md` ～ `021_ui_bug_fixes_phase1.md`
- `docs/specs/09_開発タスク詳細_スケジュール_v3_3.md`
