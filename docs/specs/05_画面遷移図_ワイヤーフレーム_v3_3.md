# 画面遷移図 + ワイヤーフレーム(UI設計)v3.3

**プロジェクト名**: AIフィットネスアプリ(仮称)
**バージョン**: 3.3 (MVP)
**作成日**: 2025年11月
**最終更新日**: 2025年11月23日
**対象期間**: Phase 1-2 (0-4ヶ月)

---

## 📋 v3.3での主な変更点

### v3.2からの変更

✅ **ナビゲーションバーの変更**:
- 4つのタブに統一: ホーム、トレーニング、履歴、プロフィール
- アカウントタブを「プロフィール」に変更
- 全画面で一貫したボトムナビゲーション表示

✅ **カメラ設定画面の自動開始機能**:
- チェック項目を全てクリアしたら3秒後に自動開始
- カウントダウン表示(3...2...1...)
- ユーザーは自動開始を待つか、手動で「開始」ボタンをタップ可能

✅ **プロフィール画面の強化**:
- 設定画面へ移動するボタンを追加
- 利用規約・プライバシーポリシーへのリンク追加
- 同意状況の表示と管理機能

✅ **設定画面の簡素化**:
- カウントダウン設定を削除(自動開始が3秒固定)
- その他の設定項目はそのまま維持

✅ **利用規約・プライバシーポリシー同意管理**:
- ログイン時に未同意の場合、同意画面を強制表示
- プロフィール画面から同意状況を確認可能
- 同意解除した場合、確認ダイアログ後に強制ログアウト

---

## 目次

### Part 1: 画面一覧と全体遷移図
1. [画面一覧](#1-画面一覧)
2. [画面遷移図(全体)](#2-画面遷移図全体)

### Part 2: 認証・オンボーディング画面
3. [各画面の詳細設計](#3-各画面の詳細設計)
   - 3.1 スプラッシュ画面
   - 3.2 オンボーディング画面
   - 3.3 ログイン画面
   - 3.4 新規登録画面(2ステップ)
   - 3.5 利用規約同意画面
   - 3.6 ホーム画面
   - 3.7 メニュー選択画面

### Part 3: トレーニング・履歴・アカウント画面
   - 3.8 カメラ設定画面
   - 3.9 トレーニング実行画面
   - 3.10 セッション結果画面
   - 3.11 履歴画面
   - 3.12 プロフィール画面
   - 3.13 設定画面
   - 3.14 課金画面
   - 3.15 サブスクリプション管理画面

### Part 4: UI/UXガイドライン
4. [UI/UXガイドライン](#4-uiuxガイドライン)
5. [レスポンシブ対応](#5-レスポンシブ対応)
6. [変更履歴](#6-変更履歴)

---

## 1. 画面一覧

### 1.1 全画面リスト

| No | 画面名 | カテゴリ | 認証 | v3.3変更点 | 備考 |
|----|--------|---------|------|-----------|------|
| 1 | スプラッシュ画面 | 起動 | 不要 | - | アプリ起動時の最初の画面 |
| 2 | オンボーディング画面 | 起動 | 不要 | - | 初回のみ表示(3画面) |
| 3 | ログイン画面 | 認証 | 不要 | - | メール/電話 |
| 4 | 新規登録画面 | 認証 | 不要 | - | 認証情報→身体情報 |
| 5 | 利用規約同意画面 | 認証 | 不要 | 同意管理強化 | v3.1準拠の全文表示 |
| 6 | ホーム画面 | メイン | 必要 | ナビゲーション変更 | ダッシュボード |
| 7 | メニュー選択画面 | トレーニング | 必要 | ナビゲーション変更 | 5種目の選択・検索 |
| 8 | カメラ設定画面 | トレーニング | 必要 | 自動開始機能追加 | 向き・距離ガイド |
| 9 | トレーニング実行画面 | トレーニング | 必要 | - | リアルタイムフィードバック |
| 10 | セッション結果画面 | トレーニング | 必要 | - | 今回の成績 |
| 11 | 履歴画面 | 記録 | 必要 | ナビゲーション変更 | グラフ・一覧 |
| 12 | プロフィール画面 | アカウント | 必要 | 設定ボタン・同意管理 | 個人情報表示・編集 |
| 13 | 設定画面 | アカウント | 必要 | カウントダウン削除 | 各種設定 |
| 14 | 課金画面 | 課金 | 必要 | - | サブスク購入 |
| 15 | サブスクリプション管理画面 | 課金 | 必要 | - | 課金状態確認 |

### 1.2 ナビゲーションバーの構成 (v3.3)

すべてのメイン画面(ログイン後)で共通のボトムナビゲーションを表示します:

| アイコン | ラベル | 遷移先 | 備考 |
|---------|--------|--------|------|
| 🏠 | ホーム | ホーム画面 | ダッシュボード |
| 💪 | トレーニング | メニュー選択画面 | 種目選択 |
| 📊 | 履歴 | 履歴画面 | 記録・統計 |
| 👤 | プロフィール | プロフィール画面 | アカウント情報 |

**重要**: v3.2の「アカウント」タブは「プロフィール」に名称変更されました。

---

## 2. 画面遷移図(全体)

```
┌──────────────────────────────────────────────────────────┐
│                         起動フロー                             │
└──────────────────────────────────────────────────────────┘

[アプリ起動]
    ↓
┌───────────────
│スプラッシュ   │ (1-2秒表示)
│画面          │
└──────┬────────
       │
       ├→ 初回起動?
       │    YES ↓
       │   ┌───────────────
       │   │オンボーディング│ (3画面、スキップ可)
       │   │画面 (1/3)     │
       │   └──────┬────────
       │          ↓
       │   ┌───────────────
       │   │オンボーディング│
       │   │画面 (2/3)     │
       │   └──────┬────────
       │          ↓
       │   ┌───────────────
       │   │オンボーディング│
       │   │画面 (3/3)     │
       │   └──────┬────────
       │          │
       └→ NO    │
                 ↓
       ┌─────────────────
       │ログイン済み?   │
       └────┬───────┬────
            │       │
          YES      NO
            │       ↓
            │  ┌───────────────
            │  │ログイン画面   │
            │  └──────┬────────
            │         │
            │         ├→ 新規登録ボタン
            │         │       ↓
            │         │  ┌───────────────
            │         │  │新規登録画面   │
            │         │  │(ステップ1/2)  │
            │         │  └──────┬────────
            │         │         │
            │         │         ↓
            │         │  ┌───────────────
            │         │  │新規登録画面   │
            │         │  │(ステップ2/2)  │
            │         │  └──────┬────────
            │         │         │
            │         └─────────┘
            │                   ↓
            │         ┌────────────────────
            │         │利用規約・PP同意確認│ ← v3.3強化
            │         └─────┬──────────────
            │               │
            │    未同意?    │
            │      YES ↓   NO
            │   ┌──────────────┐
            │   │利用規約同意  │ ← 強制表示
            │   │画面         │
            │   └──────┬───────┘
            │          │
            └──────────┴───────────────┘
                      ↓
┌──────────────────────────────────────────────────────────┐
│                      メインフロー                              │
└──────────────────────────────────────────────────────────┘

              ┌───────────────
              │ホーム画面     │
              │(ダッシュボード)│
              └──────┬────────
                     │
        ┌────────────┼────────────┐
        │            │            │
        ↓            ↓            ↓
┌──────────  ┌──────────  ┌──────────  ┌──────────
│トレーニング│  │履歴画面   │  │プロフィール│  (設定画面は
│(メニュー   │  │          │  │         │   プロフィールから)
│選択画面)   │  │          │  │         │
└────┬─────  └──────────  └────┬─────
     │                             │
     │                             ├→ [設定] ボタン
     │                             │       ↓
     │                             │  ┌──────────
     │                             │  │設定画面   │
     │                             │  └──────────
     ↓
┌───────────────
│課金状態チェック│
└───┬──────┬───
    │      │
   OK   無料枠 /期限切れ
    │      ↓
    │  ┌───────────
    │  │課金画面   │
    │  └───────────
    │
    ↓
┌───────────────
│カメラ設定     │
│画面          │ ← v3.3自動開始機能
│(向き・距離)   │    チェック完了→3秒後自動開始
└──────┬────────
       │
       ↓
┌───────────────
│トレーニング   │
│実行画面       │
│(リアルタイム) │
└──────┬────────
       │
       ↓
┌───────────────
│セッション結果 │
│画面          │
└──────┬────────
       │
       ├→ 「もう1セット」→ メニュー選択へ
       │
       └→ 「完了」→ 自動保存 → ホーム画面へ

┌──────────────────────────────────────────────────────────┐
│               ボトムナビゲーション (全画面共通)                    │
└──────────────────────────────────────────────────────────┘

  [🏠 ホーム]  [💪 トレーニング]  [📊 履歴]  [👤 プロフィール]
       ↓              ↓              ↓            ↓
   ホーム画面    メニュー選択画面   履歴画面   プロフィール画面
```

### 2.1 利用規約・プライバシーポリシー同意フロー (v3.3追加)

```
[ログイン成功]
     ↓
┌────────────────────
│同意状況チェック     │
│(users.tosAccepted)  │
│(users.ppAccepted)   │
└─────┬──────────────
      │
      ├→ 両方とも同意済み → ホーム画面
      │
      └→ 未同意あり
          ↓
     ┌──────────────
     │利用規約同意画面│ (強制表示)
     └──────┬───────
            │
            ├→ 同意 → users更新 → ホーム画面
            │
            └→ 拒否 → ログアウト → ログイン画面
```

### 2.2 同意解除フロー (v3.3追加)

```
[プロフィール画面]
     ↓
[利用規約・PP同意状況表示]
     ↓
[同意解除リンクタップ]
     ↓
┌──────────────────────
│  確認ダイアログ      │
│  「同意を解除すると  │
│   ログアウトされます」│
└─────┬────────────────
      │
      ├→ キャンセル → プロフィール画面
      │
      └→ 同意解除
          ↓
     users.tosAccepted = false
     users.ppAccepted = false
          ↓
     強制ログアウト
          ↓
     ログイン画面
```

---

## 3. 各画面の詳細設計

---

## 3.1 スプラッシュ画面

### 目的
- アプリ起動中のローディング表示
- ブランドの印象付け

### レイアウト

```
┌─────────────────────────────┐
│                             │
│                             │
│         [アプリロゴ]          │
│                             │
│      [アプリ名(仮称)]       │
│                             │
│                             │
│     ... (ローディング)      │
│                             │
│                             │
└─────────────────────────────┘
```

### 要素

| 要素 | 内容 | 位置 |
|-----|------|------|
| **ロゴ** | アイコン画像(準備済み) | 画面中央 |
| **アプリ名** | テキスト(未定) | ロゴの下 |
| **ローディング** | アニメーション(点滅・回転) | 画面下部 |
| **背景色** | 緑(ブランドカラー) | 全体 |

### 表示時間
- 1-2秒(初期化処理完了まで)

### 遷移条件
- 初回起動 → オンボーディング画面
- 2回目以降・ログイン済み → 同意状況チェック → ホーム画面 or 利用規約同意画面
- 2回目以降・未ログイン → ログイン画面

---

## 3.2 オンボーディング画面(3画面)

### 目的
- アプリの特徴を説明
- ユーザーの期待を高める
- 医療機器でない旨の明示(薬機法対応)

### 画面1/3: 「医療機器ではありません」

```
┌─────────────────────────────┐
│                      [スキップ]│
│                             │
│     [イラスト: スマホと人]     │
│                             │
│   「本サービスは医療機器では  │
│      ありません」             │
│                             │
│  ・参考情報としてご利用ください│
│  ・医学的判断は行いません     │
│  ・最終判断はご自身で         │
│                             │
│          ● ○ ○             │
│                             │
│          [次へ →]            │
└─────────────────────────────┘
```

### 画面2/3: 「リアルタイムフィードバック」

```
┌─────────────────────────────┐
│                      [スキップ]│
│                             │
│     [イラスト: AIとカメラ]    │
│                             │
│   「AIがあなたのフォームを    │
│      確認補助」               │
│                             │
│  ・カメラでフォームをチェック  │
│  ・音声で参考情報を提供       │
│  ・映像はデバイス内で処理     │
│                             │
│          ○ ● ○             │
│                             │
│          [次へ →]            │
└─────────────────────────────┘
```

### 画面3/3: 「低価格」

```
┌─────────────────────────────┐
│                             │
│                             │
│     [イラスト: コイン]        │
│                             │
│   「月額500円で              │
│      始められる」             │
│                             │
│  ・1週間無料トライアル       │
│  ・いつでもキャンセル可能     │
│                             │
│          ○ ○ ●             │
│                             │
│       [始める →]             │
└─────────────────────────────┘
```

### 要素

| 要素 | 内容 | 動作 |
|-----|------|------|
| **スキップボタン** | 右上配置 | ログイン画面へ |
| **イラスト** | 各画面の特徴を視覚化 | - |
| **説明文** | 簡潔な説明(2-3行) | - |
| **ページインジケーター** | ● ○ ○ | 現在位置表示 |
| **次へボタン** | 緑色の大きなボタン | 次の画面へ |
| **始めるボタン** | 最後の画面のみ | ログイン画面へ |

---

## 3.3 ログイン画面

### 目的
- 既存ユーザーのログイン
- 新規ユーザーを登録画面へ誘導

### レイアウト

```
┌─────────────────────────────┐
│                             │
│         [アプリロゴ]          │
│                             │
│   ┌─────────────────────┐   │
│   │ メールアドレス　 　　 │   │
│   └─────────────────────┘   │
│                             │
│   ┌─────────────────────┐   │
│   │ パスワード            │   │
│   └─────────────────────┘   │
│                             │
│   ┌─────────────────────┐   │
│   │ ログイン             │   │
│   └─────────────────────┘   │
│                             │
│   ────── または ──────      │
│                             │
│   [G] Googleでログイン       │
│   [] Appleでログイン        │
│                             │
│   パスワードをお忘れですか?    │
│                             │
│   アカウントをお持ちでない方   │
│   [新規登録]                 │
│                             │
└─────────────────────────────┘
```

### 要素

| 要素 | 内容 | 動作 |
|-----|------|------|
| **メール** | テキストフィールド | - |
| **パスワード入力** | パスワードフィールド | 目のアイコンで表示/非表示 |
| **ログインボタン** | 緑色の大きなボタン | Firebase Authentication |
| **Googleログイン** | OAuth認証 | Firebase OAuth |
| **Appleログイン** | OAuth認証 | Firebase OAuth |
| **パスワードリセット** | テキストリンク | パスワードリセット画面へ |
| **新規登録リンク** | テキストリンク | 新規登録画面へ |

### ログイン成功後の処理 (v3.3)

1. Firebase Authenticationで認証
2. Firestoreからユーザー情報取得
3. **同意状況チェック**:
   - `users.tosAccepted === true` かつ `users.ppAccepted === true` → ホーム画面
   - どちらか `false` → 利用規約同意画面(強制表示)

### バリデーション

| フィールド | 検証内容 |
|----------|---------|
| **メール/電話** | 空欄不可、形式チェック |
| **パスワード** | 空欄不可、6文字以上 |

---

## 3.4 新規登録画面(2ステップ)

### 目的
- 新規ユーザーのアカウント作成
- 必要最小限の情報を2ステップで収集

### ステップ1: 認証情報

```
┌─────────────────────────────┐
│ [← 戻る]  新規登録 (1/2)    │
│                             │
│   認証情報を入力してください   │
│                             │
│   ┌─────────────────────┐   │
│   │ メールアドレスまたは  │   │
│   │ 電話番号              │   │
│   └─────────────────────┘   │
│                             │
│   ┌─────────────────────┐   │
│   │ パスワード            │   │
│   └─────────────────────┘   │
│                             │
│   ┌─────────────────────┐   │
│   │ パスワード(確認)      │   │
│   └─────────────────────┘   │
│                             │
│   ┌─────────────────────┐   │
│   │ 名前(ニックネーム)    │   │
│   └─────────────────────┘   │
│                             │
│   ────── または ──────      │
│                             │
│   [G] Googleで登録           │
│   [] Appleで登録            │
│                             │
│   ┌─────────────────────┐   │
│   │ 次へ (2/2)            │   │
│   └─────────────────────┘   │
│                             │
└─────────────────────────────┘
```

### ステップ2: 身体情報

```
┌─────────────────────────────┐
│ [← 戻る]  新規登録 (2/2)    │
│                             │
│   身体情報を入力してください   │
│   (後から変更可能)            │
│                             │
│   ┌─────────────────────┐   │
│   │ 生年月日 (必須)        │   │
│   │ [1990/01/01]          │   │
│   └─────────────────────┘   │
│                             │
│   ┌─────────────────────┐   │
│   │ 性別 (任意)           │   │
│   │ [男性] [女性] [その他]│   │
│   │ [回答しない]          │   │
│   └─────────────────────┘   │
│                             │
│   ┌─────────────────────┐   │
│   │ 身長 (cm) (任意)      │   │
│   │ [  170  ]             │   │
│   └─────────────────────┘   │
│                             │
│   ┌─────────────────────┐   │
│   │ 体重 (kg) (任意)      │   │
│   │ [  65   ]             │   │
│   └─────────────────────┘   │
│                             │
│   ┌─────────────────────┐   │
│   │ 運動経験 (任意)        │   │
│   │ [初心者] [中級者]     │   │
│   │ [上級者]              │   │
│   └─────────────────────┘   │
│                             │
│   ┌─────────────────────┐   │
│   │ 目標 (任意)           │   │
│   │ [ダイエット ▾]        │   │
│   └─────────────────────┘   │
│                             │
│   ┌─────────────────────┐   │
│   │ 登録完了              │   │
│   └─────────────────────┘   │
│                             │
└─────────────────────────────┘
```

### 登録完了後の処理

1. Firebase Authenticationでアカウント作成
2. Firestoreに初期データ保存:
   - `users.tosAccepted = false`
   - `users.ppAccepted = false`
3. **利用規約同意画面へ強制遷移**

### バリデーション

| フィールド | 検証内容 | 必須 |
|----------|---------|------|
| **メール/電話** | 形式チェック、重複チェック | ○ |
| **パスワード** | 6文字以上、英数字含む | ○ |
| **パスワード(確認)** | パスワードと一致 | ○ |
| **名前** | 1文字以上、20文字以内 | ○ |
| **生年月日** | 13歳以上(日本)、16歳以上(EEA) | ○ |
| **性別** | male/female/other/prefer_not_to_say | - |
| **身長** | 100-250cm | - |
| **体重** | 30-200kg | - |
| **運動経験** | beginner/intermediate/advanced | - |
| **目標** | 選択肢から選択、最大100文字 | - |

### 性別の選択肢

- 男性 (male)
- 女性 (female)
- その他 (other)
- 回答しない (prefer_not_to_say)

### 運動経験の選択肢

- 初心者 (beginner): 運動を始めたばかり
- 中級者 (intermediate): 定期的に運動している
- 上級者 (advanced): 高強度のトレーニングが可能

### 目標の選択肢

- ダイエット
- 筋力アップ
- 健康維持
- 体力向上
- その他

---

## 3.5 利用規約同意画面 (v3.3強化)

### 目的
- 利用規約・プライバシーポリシーへの同意取得
- GDPR/EDPB Guidelines準拠の同意管理

### レイアウト

```
┌─────────────────────────────┐
│         利用規約と            │
│      プライバシーポリシー      │
│                             │
│  サービスをご利用いただく前に、│
│  以下の内容をご確認ください。  │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  利用規約                    │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  [スクロール可能なテキスト]   │
│  (利用規約v3.1の全文)        │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  プライバシーポリシー         │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  [スクロール可能なテキスト]   │
│  (プライバシーポリシーv3.1全文)│
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  ☐ 利用規約に同意します      │
│  ☐ プライバシーポリシーに    │
│     同意します                │
│                             │
│  ⚠️ 両方の同意が必要です     │
│                             │
│  ┌─────────────────────┐   │
│  │ 同意して続ける         │   │
│  └─────────────────────┘   │
│                             │
│  [同意しない(ログアウト)]     │
│                             │
└─────────────────────────────┘
```

### 要素

| 要素 | 内容 | 動作 |
|-----|------|------|
| **利用規約テキスト** | v3.1全文表示 | スクロール可能 |
| **PPテキスト** | v3.1全文表示 | スクロール可能 |
| **利用規約チェックボックス** | 個別チェック | 必須 |
| **PPチェックボックス** | 個別チェック | 必須 |
| **同意して続けるボタン** | 緑色の大きなボタン | 両方チェック時のみ有効 |
| **同意しないリンク** | テキストリンク | ログアウト → ログイン画面 |

### 同意処理 (v3.3)

1. 両方のチェックボックスがONの場合のみ「同意して続ける」ボタンが有効化
2. ボタンタップで以下を実行:
   - `users.tosAccepted = true`
   - `users.ppAccepted = true`
   - `users.tosAcceptedAt = [現在のタイムスタンプ]`
   - `users.ppAcceptedAt = [現在のタイムスタンプ]`
3. ホーム画面へ遷移

### 同意拒否時の処理

1. 「同意しない」リンクをタップ
2. 確認ダイアログ表示:
   - 「同意しないとサービスを利用できません。ログアウトしますか?」
3. OK → ログアウト → ログイン画面
4. キャンセル → 同意画面に戻る

### GDPR準拠のポイント

| 項目 | 対応内容 |
|-----|---------|
| **個別同意** | 利用規約とPPを個別にチェック |
| **明示的同意** | チェックボックスで明示的に取得 |
| **自由意思** | 拒否の選択肢を提供 |
| **同意記録** | タイムスタンプを記録 |
| **撤回可能** | プロフィール画面から撤回可能 |

---

# 画面遷移図 + ワイヤーフレーム(UI設計)v3.3 (Part 2)

## 3.6 ホーム画面

### 目的
- トレーニングの開始ポイント
- 今日の進捗確認
- 直近の履歴確認

### レイアウト

```
┌─────────────────────────────┐
│         ホーム              │
│                             │
│   こんにちは、[名前]さん!   │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  今日のセッション            │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│       [  3回  ]             │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  週間の進捗                  │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  10┐     ■                 │
│    │   ■ ■                 │
│   5├ ■ ■ ■ ■ ■            │
│    │ ■ ■ ■ ■ ■ ■ ■        │
│   0└─────────────          │
│    月 火 水 木 金 土 日       │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  直近の履歴                  │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│ ┌───────────────────────┐  │
│ │ 15:30 | スクワット        │  │
│ │ スコア: 85点 | 12回       │  │
│ └───────────────────────┘  │
│                             │
│ ┌───────────────────────┐  │
│ │ 14:00 | アームカール      │  │
│ │ スコア: 78点 | 10回       │  │
│ └───────────────────────┘  │
│                             │
│  ┌─────────────────────┐   │
│  │ トレーニング開始       │   │
│  └─────────────────────┘   │
│                             │
│  無料プラン: 残り 2回/3回    │
│  [プレミアムにアップグレード] │
│                             │
├─────────────────────────────┤
│  [🏠 ホーム] [💪 トレーニング]│
│  [📊 履歴] [👤 プロフィール] │
└─────────────────────────────┘
```

### 要素

| 要素 | 内容 | データソース |
|-----|------|------------|
| **挨拶** | ユーザー名を表示 | users.displayName |
| **今日のセッション数** | 大きく表示 | 今日のsessions数 |
| **週間進捗グラフ** | 棒グラフ(7日分) | 過去7日のsessions数 |
| **直近の履歴** | 最新2件 | sessions(limit: 2) |
| **トレーニング開始ボタン** | 緑色の大きなボタン | メニュー選択画面へ |
| **制限表示** | 無料プランの場合 | users.plan, todaySessions |
| **アップグレードリンク** | 無料プランの場合 | 課金画面へ |
| **ボトムナビゲーション** | 4つのタブ | v3.3変更 |

### v3.3変更点
- **ボトムナビゲーション**: 4タブ(ホーム、トレーニング、履歴、プロフィール)に変更

---

## 3.7 メニュー選択画面

### 目的
- トレーニング種目の選択
- 検索・フィルタ機能

### レイアウト

```
┌─────────────────────────────┐
│ [← ホームへ]  種目選択       │
│                             │
│   ┌─────────────────────┐   │
│   │ [🔍] 検索...          │   │
│   └─────────────────────┘   │
│                             │
│  フィルタ: [全て▾] [自重▾]   │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  自重トレーニング            │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│ ┌───────────────────────┐  │
│ │ スクワット               │  │
│ │ 下半身 | 初級            │  │
│ └───────────────────────┘  │
│                             │
│ ┌───────────────────────┐  │
│ │ プッシュアップ           │  │
│ │ 胸・腕 | 初級            │  │
│ └───────────────────────┘  │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  ダンベルトレーニング        │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│ ┌───────────────────────┐  │
│ │ ダンベルカール           │  │
│ │ 腕 | 初級                │  │
│ └───────────────────────┘  │
│                             │
│ ┌───────────────────────┐  │
│ │ ショルダープレス         │  │
│ │ 肩 | 中級                │  │
│ └───────────────────────┘  │
│                             │
│ ┌───────────────────────┐  │
│ │ デッドリフト             │  │
│ │ 背中・下半身 | 中級      │  │
│ └───────────────────────┘  │
│                             │
├─────────────────────────────┤
│  [🏠 ホーム] [💪 トレーニング]│
│  [📊 履歴] [👤 プロフィール] │
└─────────────────────────────┘
```

### 要素

| 要素 | 内容 | データソース |
|-----|------|------------|
| **検索バー** | 種目名で検索 | exercises.name |
| **カテゴリフィルタ** | 全て/自重/ダンベル | exercises.category |
| **難易度フィルタ** | 全て/初級/中級 | exercises.difficulty |
| **種目カード** | タップで選択 | exercises collection |
| **種目名** | 大きく表示 | exercises.name |
| **部位・難易度** | サブテキスト | exercises.bodyPart, difficulty |
| **ボトムナビゲーション** | 4つのタブ | v3.3変更 |

### 種目選択後の動作

1. 種目カードをタップ
2. 詳細画面
3. 設定完了 → カメラ設定画面へ

### 種目詳細画面(タップ時)

```
┌─────────────────────────────┐
│ [← 戻る]  スクワット         │
│                             │
│  [大きなGIF: 動作の様子]    │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  推奨向き                   │
│  ━━━━━━━━━━━━━━━━━━      │
│  ・正面: 姿勢確認            │
│  ・横向き: 深さ確認          │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  前回の記録                  │
│  ━━━━━━━━━━━━━━━━━━      │
│  2024/11/22                 │
│  ・レップ数: 10回           │
│  ・参考スコア: 85点          │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  今回の目標                  │
│  ━━━━━━━━━━━━━━━━━━      │
│  ┌─────────────────────┐   │
│  │ レップ数 (回)         │   │
│  └─────────────────────┘   │
│  例: 10、15、20            │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  ┌─────────────────────┐   │
│  │ 開始する               │   │
│  └─────────────────────┘   │
│                             │
└─────────────────────────────┘
```

### 重量の選択肢

| 種目タイプ | 選択肢 |
|----------|--------|
| **自重** | なし(固定) |
| **ダンベル** | 2.5kg, 5kg, 7.5kg, 10kg, 12.5kg, 15kg, ... |

---

## 3.8 カメラ設定画面 (v3.3自動開始機能追加)

### 目的
- カメラの向きと距離を調整
- ユーザーが全身映っているか確認
- チェック完了後3秒で自動開始

### レイアウト (チェック中)

```
┌─────────────────────────────┐
│ [← 戻る]  カメラ設定         │
│                             │
│  [カメラプレビュー]          │
│                             │
│  ┌─────────────────────┐   │
│  │                     │   │
│  │   [スケルトン表示]  │   │
│  │                     │   │
│  └─────────────────────┘   │
│                             │
│  スクワット | 推奨: 横向き   │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  確認事項                    │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  ☐ 全身が映っていますか?     │
│  ☐ 明るさは十分ですか?       │
│  ☐ 背景はシンプルですか?     │
│  ☐ カメラから1.5-2.5m離れて │
│     いますか?                │
│                             │
│  ┌─────────────────────┐   │
│  │ 開始                   │   │
│  └─────────────────────┘   │
│                             │
└─────────────────────────────┘
```

### レイアウト (チェック完了後)

```
┌─────────────────────────────┐
│ [← 戻る]  カメラ設定         │
│                             │
│  [カメラプレビュー]          │
│                             │
│  ┌─────────────────────┐   │
│  │                     │   │
│  │   [スケルトン表示]  │   │
│  │                     │   │
│  └─────────────────────┘   │
│                             │
│  スクワット | 推奨: 横向き   │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  確認事項                    │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  ☑ 全身が映っていますか?     │
│  ☑ 明るさは十分ですか?       │
│  ☑ 背景はシンプルですか?     │
│  ☑ カメラから1.5-2.5m離れて │
│     いますか?                │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│       3秒後に自動開始...     │
│                             │
│           [ 3 ]              │
│                             │
│  ┌─────────────────────┐   │
│  │ すぐに開始              │   │
│  └─────────────────────┘   │
│                             │
└─────────────────────────────┘
```

### 要素

| 要素 | 内容 | データソース |
|-----|------|------------|
| **カメラプレビュー** | リアルタイム映像 | デバイスカメラ |
| **骨格表示** | MediaPipe Pose | リアルタイム検出 |
| **種目名・推奨向き** | 選択した種目 | exercises.name, recommendedOrientation |
| **チェックリスト** | 4項目 | ユーザーが手動チェック |
| **カウントダウン表示** | 3→2→1 | チェック完了後に表示 |
| **すぐに開始ボタン** | 白色ボタン | カウントダウンをスキップ |

### チェック項目

| 項目 | 確認内容 | 自動検出 |
|-----|---------|---------|
| **全身が映っている** | 頭から足まで全身 | ◯ MediaPipeで検出 |
| **明るさは十分** | 顔が明るく映る | ◯ 画像の明るさ判定 |
| **背景はシンプル** | 余計なものがない | × 手動チェック |
| **距離は適切** | 1.5-2.5m | ◯ 骨格のサイズから推定 |

### v3.3変更点: 自動開始機能

1. **チェック完了時の動作**:
   - 4つのチェックボックスが全て✓になった瞬間
   - 「3秒後に自動開始...」というメッセージ表示
   - カウントダウン開始: 3...2...1...
   - 0になったら自動的にトレーニング実行画面へ遷移

2. **カウントダウン表示**:
   - 大きな数字(3→2→1)を画面中央に表示
   - フェードイン/フェードアウトアニメーション

3. **すぐに開始ボタン**:
   - カウントダウン中に表示
   - タップするとカウントダウンをスキップして即座に開始
   - 白色の目立たないボタン

4. **チェック解除時の動作**:
   - カウントダウン中にチェックを外すと、カウントダウンがキャンセル
   - 「開始」ボタンに戻る

### 推奨向き

| 種目 | 推奨向き | 理由 |
|-----|---------|------|
| **スクワット** | 横向き | 膝の角度確認 |
| **プッシュアップ** | 横向き | 肘の角度確認 |
| **ダンベルカール** | 正面 | 左右対称確認 |
| **ショルダープレス** | 正面 | 左右対称確認 |
| **デッドリフト** | 横向き | 背中の角度確認 |

### エラーハンドリング

| エラー | 条件 | 対応 |
|-------|------|------|
| **カメラ権限なし** | 初回起動時 | 権限リクエスト |
| **ユーザー検出不可** | 5秒以上検出できない | 警告ダイアログ |
| **明るさ不足** | 画像が暗い | 警告メッセージ |

### ユーザー検出できない時の警告ダイアログ

```
┌─────────────────────────────┐
│  ⚠️ ユーザーを検出できません   │
│                             │
│  ・明るい場所で撮影してください│
│  ・カメラから適切な距離で     │
│    撮影してください           │
│  ・全身が映るようにしてください│
│                             │
│  ┌───────────────────────┐  │
│  │ OK                      │  │
│  └───────────────────────┘  │
└─────────────────────────────┘
```

---

# 画面遷移図 + ワイヤーフレーム(UI設計)v3.3 (Part 3)

## 3.9 トレーニング実行画面

### 目的
- リアルタイムでフォームをチェック
- 音声による参考情報提供
- レップ数のカウント
- 進捗の可視化

### レイアウト

```
┌─────────────────────────────┐
│ [スクワット]        [× 終了]  │
│                             │
│  [カメラプレビュー + 骨格表示]│
│                             │
│  ┌─────────────────────┐   │
│  │                     │   │
│  │   [スケルトン表示]  │   │
│  │                     │   │
│  └─────────────────────┘   │
│                             │
│  ━━━━━━━━━━━━ 60%         │
│  レップ数: 8 / 10回          │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  💬 参考情報                │
│  ━━━━━━━━━━━━━━━━━━      │
│  膝をもう少し曲げましょう     │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  🔇 音声OFF  [🔊 音声ON]     │
│                             │
└─────────────────────────────┘
```

### 要素

| 要素 | 内容 | データソース |
|-----|------|------------|
| **種目名** | 現在の種目 | exercises.name |
| **終了ボタン** | 右上に配置 | 確認ダイアログ → ホーム画面 |
| **カメラプレビュー** | リアルタイム映像 | デバイスカメラ |
| **骨格表示** | MediaPipe Pose | リアルタイム検出 |
| **進捗バー** | 全体の進捗(YouTube風) | リアルタイム更新 |
| **セット・回数/時間表示** | 現在のセットと進捗 | リアルタイム更新 |
| **参考情報** | 音声+テキスト | リアルタイムフィードバック |
| **音声トグル** | ON/OFF切り替え | ユーザー設定 |

### 進捗バーの表示

```
━━━━━━━━━━━━ 60%
```

- 現在のレップ数 / 目標レップ数の割合で表示
- リアルタイムで更新

### 参考情報の表示

| 状態 | 表示内容 | 音声 |
|-----|---------|------|
| **良好** | 「良いフォームです」 | ○ |
| **改善必要** | 「膝をもう少し曲げましょう」 | ○ |
| **危険** | 「⚠️ 腰が曲がりすぎています」 | ○ |

### 音声フィードバック

- TTS(Text-to-Speech)で再生
- 「参考:」というプレフィックスを付与(薬機法対応)
- 音声トグルでON/OFF可能

---

## 3.10 セッション結果画面

### 目的
- 今回のトレーニング結果を表示
- メモの入力
- 次のアクションを促す

### レイアウト

```
┌─────────────────────────────┐
│ [← ホームへ]  セッション結果  │
│                             │
│   🎉 お疲れ様でした!         │
│                             │
│  ┌─────────────────────┐   │
│  │ スクワット              │   │
│  │                       │   │
│  │ 参考スコア: 85点       │   │
│  │                       │   │
│  │ 目標: 10回             │   │
│  │ 実績: 12回 ✓          │   │
│  │ 重量: 10kg             │   │
│  │ 所要時間: 2分30秒      │   │
│  └─────────────────────┘   │
│                             │
│  💬 フィードバック           │
│  ━━━━━━━━━━━━━━━━━━      │
│  ・良いフォームでした        │
│  ・膝の角度が安定していました │
│  ・次回は重量を増やしても    │
│    良いでしょう              │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  メモ                        │
│  ━━━━━━━━━━━━━━━━━━      │
│  ┌───────────────────────┐  │
│  │ [メモを入力]            │  │
│  │                         │  │
│  └───────────────────────┘  │
│                             │
│  ┌─────────────────────┐   │
│  │ もう1セット             │   │
│  └─────────────────────┘   │
│                             │
│  ┌─────────────────────┐   │
│  │ 完了                   │   │
│  └─────────────────────┘   │
│                             │
└─────────────────────────────┘
```

### 要素

| 要素 | 内容 | データソース |
|-----|------|------------|
| **種目名** | トレーニング種目 | exercises.name |
| **参考スコア** | フォームの評価 | sessions.score |
| **目標回数** | 設定した目標 | sessions.targetReps |
| **実績回数** | 実際の回数 | sessions.actualReps |
| **達成マーク** | 目標達成時に✓ | 目標 ≤ 実績 |
| **重量** | 使用重量 | sessions.weight (ダンベルのみ) |
| **所要時間** | トレーニング時間 | 自動計測 |
| **フィードバック** | AI生成の参考情報 | 分析結果 |
| **メモ入力** | 自由記述 | ユーザー入力 |
| **もう1セットボタン** | 白色ボタン | → メニュー選択画面 |
| **完了ボタン** | 緑色ボタン | 自動保存 → ホーム画面 |

### メモ入力の仕様

- 最大200文字
- フリーテキスト
- 任意入力(スキップ可能)
- sessions.noteに保存

---

## 3.11 履歴画面

### 目的
- 過去のトレーニング記録を確認
- グラフで成長を可視化
- 種目別にフィルタ

### 概要タブのレイアウト

```
┌─────────────────────────────┐
│ 履歴                         │
│                             │
│ ┌─────────────────────────┐ │
│ │概要│日│週│月│ 種目:[全て▾]│ │
│ └─────────────────────────┘ │
│                             │
│  < 前  2025/01/16  次 >     │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  セッション一覧              │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│ ┌───────────────────────┐  │
│ │ 15:30 | スクワット        │  │
│ │ スコア: 85点              │  │
│ │ 目標: 10回 | 実績: 12回   │  │
│ │ 重量: 10kg               │  │
│ │ メモ: 調子よかった        │  │
│ └───────────────────────┘  │
│                             │
│ ┌───────────────────────┐  │
│ │ 14:00 | アームカール      │  │
│ │ スコア: 78点              │  │
│ │ 目標: 10回 | 実績: 10回   │  │
│ │ 重量: 5kg                │  │
│ └───────────────────────┘  │
│                             │
│   [スクロール可能]           │
│                             │
├─────────────────────────────┤
│  [🏠 ホーム] [💪 トレーニング]│
│  [📊 履歴] [👤 プロフィール] │
└─────────────────────────────┘
```

### 日/週/月タブ選択時

```
┌─────────────────────────────┐
│ 履歴                         │
│                             │
│ ┌─────────────────────────┐ │
│ │概要│日│週│月│ 種目:[全て▾]│ │
│ └─────────────────────────┘ │
│                             │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  スコア                      │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  100 ┐                      │
│      │     ●─●              │
│      │    /   \●            │
│   50 ├───●─────●───         │
│      │                      │
│    0 └──────────────        │
│      月 火 水 木 金 土 日     │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  重量                        │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│   30kg┐                     │
│       │    ●─●              │
│       │   /                 │
│   15kg├──●──────           │
│       │                     │
│     0 └──────────────       │
│       月 火 水 木 金 土 日    │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  セッション一覧              │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  [スクロールして各セッション] │
│                             │
├─────────────────────────────┤
│  [🏠 ホーム] [💪 トレーニング]│
│  [📊 履歴] [👤 プロフィール] │
└─────────────────────────────┘
```

### タブ構造

| タブ | 期間 | グラフ表示 | セッション一覧 |
|-----|------|-----------|--------------|
| **概要** | 今日 | なし | 今日のみ |
| **日** | 選択した1日 | なし | 選択した日のみ |
| **週** | 選択した週(7日) | あり(参考スコア・重量) | 選択した週 |
| **月** | 選択した月(全日) | あり(参考スコア・重量) | 選択した月 |

### 月タブ選択時のカレンダーUI詳細

#### 概要
月タブ選択時は、`table_calendar` パッケージを使用してカレンダー形式で履歴を表示します。セッションが記録されている日にマーカーを表示し、日付をタップすることでその日のセッション一覧を下部に表示します。

#### ワイヤーフレーム

```
┌─────────────────────────────┐
│ 履歴                         │
│                             │
│ ┌─────────────────────────┐ │
│ │概要│日│週│月│ 種目:[全て▾]│ │
│ └─────────────────────────┘ │
│                             │
│  < 2025年1月 >              │
│                             │
│  月  火  水  木  金  土  日  │
│  ─  ─  1   2   3   4   5   │
│                 ●       ●   │
│  6   7   8   9  10  11  12  │
│  ●               ●       ●   │
│  13  14  15  16  17  18  19  │
│      ●   ●   ●   ●           │
│  20  21  22  23  24  25  26  │
│  ●                           │
│  27  28  29  30  31          │
│      ●                       │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  2025/01/15 (選択日)        │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│ ┌───────────────────────┐  │
│ │ 15:30 | スクワット        │  │
│ │ スコア: 85点              │  │
│ │ 目標: 10回 | 実績: 12回   │  │
│ │ 重量: 10kg               │  │
│ └───────────────────────┘  │
│                             │
│ ┌───────────────────────┐  │
│ │ 14:00 | アームカール      │  │
│ │ スコア: 78点              │  │
│ │ 目標: 10回 | 実績: 10回   │  │
│ │ 重量: 5kg                │  │
│ └───────────────────────┘  │
│                             │
├─────────────────────────────┤
│  [🏠 ホーム] [💪 トレーニング]│
│  [📊 履歴] [👤 プロフィール] │
└─────────────────────────────┘
```

#### UI要素の詳細

| 要素 | 内容 | 動作 |
|-----|------|------|
| **月選択ナビゲーション** | `< 2025年1月 >` | 前月/次月に移動 |
| **カレンダーグリッド** | 7列×5-6行の日付グリッド | `table_calendar` で実装 |
| **セッションマーカー** | 日付の下に表示される点（●） | その日にセッションが記録されていることを示す |
| **日付選択** | タップした日付がハイライト表示 | 選択日のセッション一覧を下部に表示 |
| **選択日ヘッダー** | `2025/01/15 (選択日)` | 現在選択されている日付を表示 |
| **セッション一覧** | 選択日のセッションカード | スクロール可能、タップで詳細画面へ |

#### 実装仕様

**使用パッケージ**: `table_calendar: ^3.0.0`

**データ取得**:
- Firestore `sessions` コレクションから選択月のデータを取得
- クエリ: `where('userId', '==', uid).where('startTime', '>=', startOfMonth).where('startTime', '<=', endOfMonth)`

**マーカー表示ロジック**:
```dart
Map<DateTime, List<Session>> _getEventsForMonth() {
  Map<DateTime, List<Session>> events = {};
  for (var session in sessions) {
    final date = DateTime(
      session.startTime.year,
      session.startTime.month,
      session.startTime.day,
    );
    if (events[date] == null) {
      events[date] = [];
    }
    events[date]!.add(session);
  }
  return events;
}
```

**日付選択時の処理**:
1. 選択日の `DateTime` を状態に保存
2. 該当日のセッション一覧をフィルタリング
3. セッション一覧セクションを更新して表示

**カレンダー設定**:
- `firstDay`: 過去2年
- `lastDay`: 今日
- `focusedDay`: 選択中の月の基準日
- `selectedDayPredicate`: 選択日の判定
- `eventLoader`: マーカー表示用のイベントローダー
- `calendarFormat`: `CalendarFormat.month` 固定
- `locale`: `ja_JP` (日本語表示)

**種目フィルタとの連携**:
- 種目ドロップダウンで特定種目を選択した場合、カレンダーのマーカーもフィルタ
- 選択日のセッション一覧も該当種目のみ表示

#### パフォーマンス考慮事項
- 月ごとにデータをキャッシュ（無駄なFirestoreクエリを削減）
- スクロール時の遅延読み込み（セッション一覧が多い場合）
- `table_calendar` の `shouldFillViewport` オプションで最適化

### v3.3変更点
- **ボトムナビゲーション**: 4タブに変更
- **月タブカレンダーUI**: `table_calendar` を使用した詳細仕様を追加

---

## 3.12 プロフィール画面 (v3.3強化)

### 目的
- ユーザー情報の表示・編集
- データ管理
- 利用規約・プライバシーポリシーの同意管理
- 設定画面への遷移

### レイアウト

```
┌─────────────────────────────┐
│         プロフィール         │
│                             │
│   ┌─────────────────────┐   │
│   │  [プロフィール画像]  │   │
│   │                     │   │
│   │   [ユーザー名]      │   │
│   │                     │   │
│   └─────────────────────┘   │
│                             │
│  基本情報                   │
│  ━━━━━━━━━━━━━━━━━━      │
│  ニックネーム: [編集]       │
│  メールアドレス: [編集]     │
│  身長: 170cm [編集]         │
│  体重: 65kg [編集]          │
│  生年月日: 1990/01/01       │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  統計情報                   │
│  ━━━━━━━━━━━━━━━━━━      │
│  総セッション数: 52回       │
│  総トレーニング時間: 3時間  │
│  平均参考スコア: 82点       │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  同意状況  ← v3.3追加       │
│  ━━━━━━━━━━━━━━━━━━      │
│  [📄 利用規約] 同意済み ✓   │
│  [🔒 プライバシーポリシー]   │
│     同意済み ✓              │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  データ管理                 │
│  ━━━━━━━━━━━━━━━━━━      │
│  ┌─────────────────────┐   │
│  │ データをエクスポート  │   │
│  └─────────────────────┘   │
│  ┌─────────────────────┐   │
│  │ データを削除         │   │
│  └─────────────────────┘   │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  ┌─────────────────────┐   │
│  │ ⚙️ 設定              │ ← v3.3追加
│  └─────────────────────┘   │
│                             │
├─────────────────────────────┤
│  [🏠 ホーム] [💪 トレーニング]│
│  [📊 履歴] [👤 プロフィール] │
└─────────────────────────────┘
```

### 要素

| 要素 | 内容 | データソース |
|-----|------|------------|
| **プロフィール画像** | アイコン | users.photoURL |
| **ユーザー名** | ニックネーム | users.displayName |
| **基本情報** | 編集可能 | users collection |
| **統計情報** | 読み取り専用 | 計算結果 |
| **同意状況** | 利用規約・PP | users.tosAccepted, ppAccepted |
| **データ管理ボタン** | エクスポート・削除 | GDPR対応 |
| **設定ボタン** | 設定画面へ遷移 | v3.3追加 |
| **ボトムナビゲーション** | 4つのタブ | v3.3変更 |

### v3.3追加機能

#### 1. 利用規約・プライバシーポリシーへのリンク

- 各ドキュメントへのリンクを表示
- タップすると全文を表示(モーダル)
- 同意状況を表示(✓マーク)

#### 2. 同意状況の管理

```
┌─────────────────────────────┐
│  📄 利用規約              │
│     同意済み ✓              │
│     2025/01/01 12:00に同意  │
│                             │
│  [全文を読む]               │
│  [同意を解除]               │
└─────────────────────────────┘
```

#### 3. 同意解除の確認ダイアログ

```
┌─────────────────────────────┐
│  ⚠️ 同意を解除しますか?      │
│                             │
│  同意を解除すると、サービスを │
│  利用できなくなります。       │
│                             │
│  この操作を行うと、自動的に   │
│  ログアウトされます。         │
│                             │
│  ┌───────────────────────┐  │
│  │ キャンセル              │  │
│  └───────────────────────┘  │
│                             │
│  ┌───────────────────────┐  │
│  │ 同意を解除してログアウト │  │
│  └───────────────────────┘  │
└─────────────────────────────┘
```

#### 4. 設定ボタン

- プロフィール画面の下部に配置
- タップすると設定画面へ遷移

### 同意解除の処理フロー (v3.3)

1. 「同意を解除」リンクをタップ
2. 確認ダイアログ表示
3. 「同意を解除してログアウト」をタップ:
   - `users.tosAccepted = false`
   - `users.ppAccepted = false`
   - `users.tosAcceptedAt = null`
   - `users.ppAcceptedAt = null`
4. 強制ログアウト
5. ログイン画面へ遷移

### データエクスポート

- JSON形式でダウンロード
- 以下のデータを含む:
  - ユーザー情報
  - トレーニング履歴
  - 設定情報

### データ削除

- 確認ダイアログ表示
- 削除後は復元不可
- アカウント削除とは別(データのみ削除)

---

## 3.13 設定画面 (v3.3変更)

### 目的
- アプリの各種設定
- アカウント管理

### レイアウト

```
┌─────────────────────────────┐
│ [← プロフィール]  設定       │
│                             │
│  トレーニング                │
│  ━━━━━━━━━━━━━━━━━━      │
│  音声フィードバック          │
│  [ON  /  OFF]               │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  通知                       │
│  ━━━━━━━━━━━━━━━━━━      │
│  リマインダー通知            │
│  [ON  /  OFF]               │
│                             │
│  お知らせ通知                │
│  [ON  /  OFF]               │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  アカウント                  │
│  ━━━━━━━━━━━━━━━━━━      │
│  [サブスクリプション管理]     │
│  [利用規約]                  │
│  [プライバシーポリシー]       │
│  [お問い合わせ]              │
│  [ログアウト]                │
│  [アカウント削除]            │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  アプリ情報                  │
│  ━━━━━━━━━━━━━━━━━━      │
│  バージョン: 1.0.0          │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
└─────────────────────────────┘
```

### 要素

| 要素 | 内容 | データソース |
|-----|------|------------|
| **音声フィードバック** | トグルスイッチ | users.audioFeedback |
| **リマインダー通知** | トグルスイッチ | users.reminderEnabled |
| **お知らせ通知** | トグルスイッチ | users.newsEnabled |
| **サブスク管理** | リンク | サブスク管理画面へ |
| **利用規約** | リンク | 利用規約全文表示 |
| **プライバシーポリシー** | リンク | PP全文表示 |
| **お問い合わせ** | リンク | メール送信 |
| **ログアウト** | ボタン | Firebase Auth |
| **アカウント削除** | ボタン | 確認ダイアログ → 削除 |

### v3.3変更点

- **カウントダウン設定を削除**: 自動開始が3秒固定のため不要
- その他の設定項目はv3.2と同じ

### 設定項目の詳細

| 設定項目 | 初期値 | 説明 |
|---------|-------|------|
| **音声フィードバック** | ON | トレーニング中の音声案内 |
| **リマインダー通知** | OFF | トレーニングの時間を通知 |
| **お知らせ通知** | ON | アプリからのお知らせ |

---

# 画面遷移図 + ワイヤーフレーム(UI設計)v3.3 (Part 4)

## 3.14 課金画面

### 目的
- サブスクリプションの購入
- 無料トライアルの開始

### レイアウト

```
┌─────────────────────────────┐
│ [← 戻る]  プラン選択         │
│                             │
│   💎 プレミアムプラン        │
│                             │
│  ┌─────────────────────┐   │
│  │                     │   │
│  │  月額 500円(税込)   │   │
│  │                     │   │
│  │  ✓ 無制限トレーニング│   │
│  │  ✓ 5種目対応        │   │
│  │  ✓ 広告なし          │   │
│  │  ✓ 履歴の無制限保存  │   │
│  │                     │   │
│  │  🎁 1週間無料        │   │
│  │     トライアル       │   │
│  │                     │   │
│  └─────────────────────┘   │
│                             │
│  ┌─────────────────────┐   │
│  │ 無料トライアルを開始  │   │
│  └─────────────────────┘   │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  無料プラン(現在)            │
│  ━━━━━━━━━━━━━━━━━━      │
│  ・1日3回まで               │
│  ・5種目対応                │
│  ・広告あり                  │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  ※ トライアル終了後、自動的に│
│    月額課金が開始されます。   │
│  ※ いつでもキャンセル可能です。│
│                             │
└─────────────────────────────┘
```

### 要素

| 要素 | 内容 | 動作 |
|-----|------|------|
| **プラン説明** | 料金・機能一覧 | - |
| **無料トライアルボタン** | 緑色の大きなボタン | RevenueCat経由で購入 |
| **無料プラン説明** | 現在のプラン | - |
| **注意事項** | 小さな文字 | - |

### 購入フロー

1. 「無料トライアルを開始」ボタンをタップ
2. App Store / Google Play決済画面
3. 購入完了
4. RevenueCatでステータス更新
5. Firestoreに同期
6. ホーム画面へ

---

## 3.15 サブスクリプション管理画面

### 目的
- 現在の課金状態を確認
- サブスクリプションの管理

### レイアウト (有料プラン加入中)

```
┌─────────────────────────────┐
│ [← 戻る]  サブスクリプション │
│                             │
│   現在のプラン               │
│                             │
│  ┌─────────────────────┐   │
│  │  💎 プレミアムプラン  │   │
│  │                     │   │
│  │  月額 500円(税込)   │   │
│  │                     │   │
│  │  次回更新日:         │   │
│  │  2025/02/01         │   │
│  └─────────────────────┘   │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  利用状況                    │
│  ━━━━━━━━━━━━━━━━━━      │
│  今月のセッション数: 28回    │
│  無制限で利用可能です        │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  ┌─────────────────────┐   │
│  │ サブスクリプションを   │   │
│  │ キャンセル             │   │
│  └─────────────────────┘   │
│                             │
│  ※ キャンセル後も次回更新日 │
│    まで利用できます。        │
│                             │
└─────────────────────────────┘
```

### レイアウト (無料プラン)

```
┌─────────────────────────────┐
│ [← 戻る]  サブスクリプション │
│                             │
│   現在のプラン               │
│                             │
│  ┌─────────────────────┐   │
│  │  無料プラン           │   │
│  │                     │   │
│  │  ・1日3回まで        │   │
│  │  ・5種目対応         │   │
│  │  ・広告あり           │   │
│  └─────────────────────┘   │
│                             │
│  ━━━━━━━━━━━━━━━━━━      │
│  今日の利用状況              │
│  ━━━━━━━━━━━━━━━━━━      │
│  残り 2回 / 3回             │
│  ━━━━━━━━━━━━━━━━━━      │
│                             │
│  ┌─────────────────────┐   │
│  │ プレミアムに            │   │
│  │ アップグレード          │   │
│  └─────────────────────┘   │
│                             │
└─────────────────────────────┘
```

### 要素

| 要素 | 内容 | データソース |
|-----|------|------------|
| **現在のプラン** | プレミアム or 無料 | RevenueCat |
| **次回更新日** | プレミアムのみ | RevenueCat |
| **今日の利用状況** | 無料プランのみ | Firestore |
| **キャンセルボタン** | プレミアムのみ | 確認ダイアログ → キャンセル |
| **アップグレードボタン** | 無料プランのみ | 課金画面へ |

### キャンセル確認ダイアログ

```
┌─────────────────────────────┐
│  サブスクリプションを         │
│  キャンセルしますか?         │
│                             │
│  キャンセル後も次回更新日まで │
│  (2025/02/01)利用できます。 │
│                             │
│  ┌───────────────────────┐  │
│  │ 戻る                    │  │
│  └───────────────────────┘  │
│                             │
│  ┌───────────────────────┐  │
│  │ キャンセルする          │  │
│  └───────────────────────┘  │
└─────────────────────────────┘
```

---

## 4. UI/UXガイドライン

### 4.1 デザイン原則

| 原則 | 説明 |
|-----|------|
| **シンプル** | 必要最小限の情報のみ表示 |
| **一貫性** | 同じ機能は同じ見た目・動作 |
| **フィードバック** | ユーザーの操作に即座に反応 |
| **アクセシビリティ** | 誰でも使いやすいUI |
| **薬機法対応** | 医療機器と誤解させない表現 |

### 4.2 カラーパレット

| 色 | 用途 | HEX |
|---|------|-----|
| **プライマリ(緑)** | ボタン、アクセント | #4CAF50 |
| **セカンダリ(青)** | リンク、情報 | #2196F3 |
| **エラー(赤)** | 警告、エラー | #F44336 |
| **成功(緑)** | 成功メッセージ | #4CAF50 |
| **背景(白)** | 背景色 | #FFFFFF |
| **テキスト(黒)** | メインテキスト | #212121 |
| **サブテキスト(グレー)** | 補足情報 | #757575 |

### 4.3 タイポグラフィ

| 要素 | フォントサイズ | 太さ |
|-----|-------------|------|
| **見出し1** | 24px | Bold |
| **見出し2** | 20px | Bold |
| **見出し3** | 18px | Semi-Bold |
| **本文** | 16px | Regular |
| **キャプション** | 14px | Regular |
| **小さい文字** | 12px | Regular |

### 4.4 ボタンスタイル

| ボタンタイプ | 背景色 | テキスト色 | 用途 |
|------------|-------|-----------|------|
| **プライマリ** | 緑 | 白 | メインアクション |
| **セカンダリ** | 白 | 緑 | サブアクション |
| **テキスト** | 透明 | 緑 | 軽いアクション |
| **危険** | 赤 | 白 | 削除等 |

### 4.5 スペーシング

- 基本単位: 8px
- 小: 8px
- 中: 16px
- 大: 24px
- 特大: 32px

### 4.6 アイコン

- サイズ: 24px × 24px
- Material Icons使用
- 一貫性のあるスタイル

### 4.7 ボトムナビゲーション (v3.3)

```
┌─────────────────────────────┐
│  [🏠]     [💪]     [📊]     [👤] │
│  ホーム  トレーニング 履歴  プロフィール │
└─────────────────────────────┘
```

| 項目 | 仕様 |
|-----|------|
| **高さ** | 56px |
| **アイコンサイズ** | 24px |
| **ラベルサイズ** | 12px |
| **背景色** | 白 |
| **選択色** | 緑 |
| **非選択色** | グレー |

### 4.8 薬機法対応の表現ガイドライン

| NGワード | OKワード | 備考 |
|---------|---------|------|
| ❌ フォーム判定 | ✅ フォーム確認補助 | 利用規約第1.2条 |
| ❌ 改善アドバイス | ✅ 参考情報の提供 | 利用規約第1.2条 |
| ❌ 正しいフォーム | ✅ 参考スコア | 利用規約第1.2条 |
| ❌ 怪我を防ぐ | ✅ フォーム確認の機会を提供 | 利用規約第3.3.3条 |
| ❌ AIによる判定 | ✅ AIによる確認補助 | プライバシーポリシー第4.1条 |

---

## 5. レスポンシブ対応

### 5.1 対応画面サイズ

| デバイス | 幅 | 高さ | 備考 |
|---------|---|------|------|
| **iPhone SE (第3世代)** | 375px | 667px | 最小サイズ |
| **iPhone 14** | 390px | 844px | 標準サイズ |
| **iPhone 14 Pro Max** | 430px | 932px | 大画面 |
| **Android (小)** | 360px | 640px | 最小サイズ |
| **Android (中)** | 411px | 731px | 標準サイズ |
| **Android (大)** | 480px | 853px | 大画面 |

### 5.2 レスポンシブデザインの原則

1. **モバイルファースト**: 小さい画面から設計
2. **可変レイアウト**: 画面サイズに応じて調整
3. **タッチ最適化**: ボタンサイズ最小44×44px
4. **可読性**: 十分なコントラスト、読みやすいフォントサイズ

---

## 6. 変更履歴

### v3.3 (2025年11月23日)

#### 主な変更点

1. **ナビゲーションバーの統一**:
   - 4タブ構成: ホーム、トレーニング、履歴、プロフィール
   - 「アカウント」→「プロフィール」に名称変更
   - すべてのメイン画面で一貫したボトムナビゲーション

2. **カメラ設定画面の自動開始機能**:
   - チェック項目全てクリア後、3秒で自動開始
   - カウントダウン表示(3...2...1...)
   - 「すぐに開始」ボタンでスキップ可能
   - チェック解除でカウントダウンキャンセル

3. **プロフィール画面の強化**:
   - 設定画面へのボタン追加
   - 利用規約・プライバシーポリシーへのリンク追加
   - 同意状況の表示と管理機能
   - 同意解除時の確認ダイアログと強制ログアウト

4. **設定画面の簡素化**:
   - カウントダウン設定を削除(3秒固定)
   - その他の設定項目はそのまま維持

5. **利用規約・プライバシーポリシー同意管理**:
   - ログイン時に未同意の場合、強制表示
   - プロフィール画面から同意状況確認
   - 同意解除時の確認ダイアログと強制ログアウト
   - users.tosAccepted, ppAcceptedフラグで管理

#### v3.2からの変更まとめ

| 項目 | v3.2 | v3.3 |
|-----|------|------|
| **ボトムナビゲーション** | 4タブ(ホーム、トレーニング、履歴、アカウント) | 4タブ(ホーム、トレーニング、履歴、プロフィール) |
| **カメラ設定** | 手動で「開始」ボタン | チェック完了後3秒で自動開始 |
| **プロフィール画面** | 基本情報のみ | 設定ボタン、同意管理追加 |
| **設定画面** | カウントダウン設定あり | カウントダウン設定削除 |
| **同意管理** | 新規登録時のみ | ログイン時チェック、解除機能追加 |

### v3.2 (2025年11月22日)

#### 主な変更点

1. **新規登録画面の2ステップ化**
2. **ホーム画面の整理**
3. **カメラ設定画面の簡素化**
4. **トレーニング実行画面の改善**
5. **セッション結果画面にメモ入力追加**
6. **履歴画面の大幅改善**
7. **エラーハンドリング追加**

### v3.1 (2025年11月21日)

#### 主な変更点

1. **利用規約・プライバシーポリシーとの整合性確保**
2. **薬機法対応の表現統一**
3. **GDPR/EDPB Guidelines完全準拠**

---

## 7. 画面数と開発規模

### 7.1 画面数

| カテゴリ | 画面数 |
|---------|--------|
| **起動・認証** | 5画面 |
| **メイン** | 4画面 |
| **トレーニング** | 4画面 |
| **アカウント** | 3画面 |
| **課金** | 2画面 |
| **合計** | **15画面** |

### 7.2 モーダル・ダイアログ

| 種類 | 数 |
|-----|---|
| **確認ダイアログ** | 5個 |
| **モーダル画面** | 3個 |
| **警告ダイアログ** | 2個 |

### 7.3 開発規模の見積もり

| 項目 | 工数(人日) |
|-----|-----------|
| **UI実装** | 30日 |
| **ロジック実装** | 20日 |
| **Firebase連携** | 10日 |
| **MediaPipe統合** | 15日 |
| **テスト** | 15日 |
| **合計** | **90日** |

---

## 8. まとめ

### 8.1 v3.3で実現したこと

✅ **ナビゲーションの統一**:
- すべてのメイン画面で一貫した4タブボトムナビゲーション
- 「プロフィール」という名称で統一

✅ **カメラ設定の自動化**:
- チェック完了後3秒で自動開始
- ユーザーの手間を削減
- スキップ機能で柔軟性も確保

✅ **同意管理の強化**:
- ログイン時の同意状況チェック
- プロフィール画面からの同意状況確認
- 同意解除機能と強制ログアウト
- GDPR準拠の適切な管理

✅ **プロフィール画面の充実**:
- 設定画面への明確な導線
- 利用規約・PPへの簡単アクセス
- 同意状況の可視化

✅ **設定画面の簡素化**:
- 不要な設定(カウントダウン)を削除
- シンプルで分かりやすい構成

### 8.2 実装時の注意点

1. **ボトムナビゲーション**:
   - すべてのメイン画面で一貫して表示
   - 現在のタブをハイライト
   - Material Designに準拠

2. **カメラ設定の自動開始**:
   - チェック完了を正確に検知
   - カウントダウンのアニメーション
   - チェック解除時のキャンセル処理

3. **同意管理**:
   - ログイン成功後、必ず同意状況をチェック
   - 未同意の場合、利用規約同意画面を強制表示
   - 同意解除時の確認ダイアログは必須

4. **薬機法対応**:
   - すべてのUIで統一された表現を使用
   - 「参考情報」「確認補助」等の用語を徹底

5. **GDPR対応**:
   - 同意記録のタイムスタンプ保存
   - 同意撤回機能の実装
   - データエクスポート機能

---

**Document Version**: v3.3
**Last Updated**: 2025年11月23日
**Author**: Project Team
**Approved by**: (承認待ち)

---

## 付録: 整合性確認

### A. 要件定義書との整合性

| 要件定義書の項目 | 画面遷移図での対応 | 確認 |
|----------------|------------------|------|
| FR-001 認証 | ログイン画面、新規登録画面 | ✅ |
| FR-004 フォーム確認補助 | カメラ設定画面、トレーニング実行画面 | ✅ |
| FR-024 同意管理 | 利用規約同意画面、プロフィール画面 | ✅ |
| 1.4 薬機法対応 | すべての画面で統一表現 | ✅ |

### B. 利用規約との整合性

| 利用規約の項目 | 画面遷移図での対応 | 確認 |
|--------------|------------------|------|
| 第1.2条 用語定義 | すべての画面で統一表現 | ✅ |
| 第3.3条 本サービスの位置づけ | オンボーディング画面 | ✅ |
| 第4.1条 年齢制限 | 新規登録画面のバリデーション | ✅ |
| 第5条 アカウント登録 | 新規登録画面 | ✅ |

### C. プライバシーポリシーとの整合性

| PPの項目 | 画面遷移図での対応 | 確認 |
|---------|------------------|------|
| 第9.1条 同意管理 | 利用規約同意画面、プロフィール画面 | ✅ |
| 第9.6条 データ削除 | プロフィール画面 | ✅ |
| 第8.1条 オンデバイス処理 | カメラ設定画面、トレーニング実行画面 | ✅ |

---

**以上**
