# é–‹ç™ºã‚¿ã‚¹ã‚¯è©³ç´° + ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« v3.3 (Part 1/3)

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: AIãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ã‚¢ãƒ—ãƒª(ä»®ç§°)  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 3.3 (MVP)  
**ä½œæˆæ—¥**: 2025å¹´11æœˆ24æ—¥  
**æœ€çµ‚æ›´æ–°æ—¥**: 2025å¹´11æœˆ24æ—¥  
**å¯¾è±¡æœŸé–“**: Phase 1-2 (0-7ãƒ¶æœˆ)  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Draft

---

## ğŸ“‹ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¦‚è¦

### ç›®çš„

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€AIãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ã‚¢ãƒ—ãƒª(ä»®ç§°)ã®é–‹ç™ºã‚¿ã‚¹ã‚¯ã‚’è©³ç´°åŒ–ã—ã€ç¾å®Ÿçš„ãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æä¾›ã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‡¸å¿µç‚¹åˆ†æv1.0ã§ç‰¹å®šã•ã‚ŒãŸ18ã®æ‡¸å¿µç‚¹ã«å¯¾å¿œã—ã€7ãƒ¶æœˆã®MVPé–‹ç™ºæœŸé–“ã§å®Ÿç¾å¯èƒ½ãªè¨ˆç”»ã‚’ç­–å®šã—ã¾ã™ã€‚

### å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å‚ç…§ç›®çš„ |
|--------------|-----------|---------|
| è¦ä»¶å®šç¾©æ›¸ | v3.3 | æ©Ÿèƒ½è¦ä»¶ãƒ»éæ©Ÿèƒ½è¦ä»¶ |
| åˆ©ç”¨è¦ç´„ | v3.2 | æ³•çš„åˆ¶ç´„ |
| ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ | v3.1 | ãƒ‡ãƒ¼ã‚¿ä¿è­·è¦ä»¶ |
| ç”»é¢é·ç§»å›³+ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ  | v3.3 | UI/UXè¨­è¨ˆ |
| Firestoreãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸ | v3.3 | ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ« |
| BigQueryè¨­è¨ˆæ›¸ | v3.3 | ãƒ‡ãƒ¼ã‚¿åˆ†æåŸºç›¤ |
| APIè¨­è¨ˆæ›¸(Firebase Functions) | v3.3 | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API |
| ãƒ‡ãƒ¼ã‚¿å‡¦ç†è¨˜éŒ²(ROPA) | v1.0 | GDPRæº–æ‹  |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ | v1.0 | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ |
| README_form_validation_logic | v3.3 | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‡¸å¿µç‚¹åˆ†æ | v1.0 | ãƒªã‚¹ã‚¯å¯¾å¿œ |

---

## ğŸ“Š ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæœŸé–“

| Phase | æœŸé–“ | ä¸»ãªç›®çš„ | æˆæœç‰© |
|-------|------|---------|--------|
| **Phase 1** | 2ãƒ¶æœˆ | åŸºç›¤æ§‹ç¯‰ | èªè¨¼ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºç›¤ |
| **Phase 2** | 5ãƒ¶æœˆ | æ©Ÿèƒ½å®Ÿè£… | å…¨æ©Ÿèƒ½å®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆãƒ»ãƒªãƒªãƒ¼ã‚¹æº–å‚™ |
| **Phase 3** | å°†æ¥ | æ©Ÿèƒ½æ‹¡å¼µ | å¤šè¨€èªãƒ»ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ»DRå®Œå…¨å®Ÿè£… |

**ç·é–‹ç™ºæœŸé–“**: 7ãƒ¶æœˆ (Phase 1-2)

### ãƒãƒ¼ãƒ ä½“åˆ¶

| å½¹å‰² | äººæ•° | ä¸»ãªè²¬ä»» |
|------|------|---------|
| **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼** | 1å | å…¨ä½“ç®¡ç†ãƒ»é€²æ—ç®¡ç†ãƒ»ãƒªã‚¹ã‚¯ç®¡ç† |
| **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢** | 2å | Firebase Functionsãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»APIå®Ÿè£… |
| **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢** | 2å | React Nativeãƒ»UI/UXå®Ÿè£…ãƒ»MediaPipeçµ±åˆ |
| **QAã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢** | 1å | ãƒ†ã‚¹ãƒˆè¨ˆç”»ãƒ»å®Ÿæ–½ãƒ»å“è³ªä¿è¨¼ |
| **ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼** | 0.5å (å…¼å‹™) | UI/UXãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ç´ æ |
| **æ³•å‹™ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹** | 0.5å (å…¼å‹™) | åˆ©ç”¨è¦ç´„ãƒ»ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ãƒ»å¯©æŸ»å¯¾å¿œ |

**åˆè¨ˆ**: 5å + å…¼å‹™2å = å®Ÿè³ª6åä½“åˆ¶

### é–‹ç™ºç’°å¢ƒ

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ | ç”¨é€” |
|---------|------------|------|
| **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰** | React Native, Expo SDK | iOS/Androidã‚¢ãƒ—ãƒªé–‹ç™º |
| **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰** | Firebase Functions (Node.js/TypeScript) | ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹API |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | Cloud Firestore | NoSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ |
| **èªè¨¼** | Firebase Authentication | ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ |
| **åˆ†æ** | BigQuery | ãƒ‡ãƒ¼ã‚¿ã‚¦ã‚§ã‚¢ãƒã‚¦ã‚¹ |
| **AI/ML** | MediaPipe (JavaScriptç‰ˆ) | å§¿å‹¢æ¨å®š |
| **æ±ºæ¸ˆ** | RevenueCat | ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç† |
| **ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼** | Cloud Tasks | éåŒæœŸå‡¦ç† |
| **ç›£è¦–** | Cloud Logging, Cloud Monitoring | ãƒ­ã‚°ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç›£è¦– |
| **CI/CD** | GitHub Actions | è‡ªå‹•ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ |

---

## ğŸ¯ Phase 1: åŸºç›¤æ§‹ç¯‰ (0-2ãƒ¶æœˆ)

### Phase 1 æ¦‚è¦

**æœŸé–“**: 2ãƒ¶æœˆ  
**ç›®æ¨™**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ‡ãƒ¼ã‚¿ä¿è­·ã‚’æœ€å„ªå…ˆã—ãŸåŸºç›¤æ§‹ç¯‰  
**æ‡¸å¿µç‚¹å¯¾å¿œ**: #1(Firestoreã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£), #2(å‰Šé™¤çŒ¶äºˆæœŸé–“), #5(ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«)

### Phase 1 ä¸»è¦æˆæœç‰©

1. Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸè¨­å®š
2. Firestore ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«å®Œå…¨å®Ÿè£…
3. Firebase Authentication è¨­å®š
4. åŸºæœ¬çš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†API
5. GDPRå¯¾å¿œåŸºç›¤
6. CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
7. ç›£è¦–ãƒ»ãƒ­ã‚°åŸºç›¤

---

## ğŸ“‹ Phase 1 ã‚¿ã‚¹ã‚¯è©³ç´°

### 1.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— (Week 1-2)

#### 1.1.1 Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã¨åˆæœŸè¨­å®š

**æ‹…å½“**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å  
**æœŸé–“**: 3æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  

**ã‚¿ã‚¹ã‚¯å†…å®¹**:
1. Firebase ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
   - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå: ai-fitness-app-prod
   - ãƒªãƒ¼ã‚¸ãƒ§ãƒ³: asia-northeast1 (æ±äº¬)
   - Google Analytics æœ‰åŠ¹åŒ–

2. Firestore ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ
   - ãƒ¢ãƒ¼ãƒ‰: Native mode
   - ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³: asia-northeast1
   - åˆæœŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«: å…¨æ‹’å¦

3. Firebase Authentication æœ‰åŠ¹åŒ–
   - ãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼
   - é›»è©±ç•ªå·èªè¨¼
   - ãƒ‰ãƒ¡ã‚¤ãƒ³è¨±å¯ãƒªã‚¹ãƒˆè¨­å®š

4. Cloud Functions åˆæœŸè¨­å®š
   - Node.js 20 LTS
   - TypeScriptè¨­å®š
   - ESLint + Prettierè¨­å®š

**æˆæœç‰©**:
- Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ (æœ¬ç•ªç’°å¢ƒ)
- Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ (é–‹ç™ºç’°å¢ƒ)
- åˆæœŸè¨­å®šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

**æ¤œè¨¼æ–¹æ³•**:
- Firebase ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å„ã‚µãƒ¼ãƒ“ã‚¹ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
- ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã‹ã‚‰ã®æ¥ç¶šãƒ†ã‚¹ãƒˆ

---

#### 1.1.2 é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

**æ‹…å½“**: å…¨ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢  
**æœŸé–“**: 5æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç’°å¢ƒ**:
1. Node.js 20 LTS ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. Firebase CLI ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ãƒ­ã‚°ã‚¤ãƒ³
3. TypeScript ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
4. å¿…è¦ãªnpmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«:
   - firebase-functions
   - firebase-admin
   - @google-cloud/bigquery
   - @google-cloud/tasks
   - joi (ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³)
   - winston (ãƒ­ã‚°)

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç’°å¢ƒ**:
1. Node.js 20 LTS ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. Expo CLI ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
3. React Native ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
4. å¿…è¦ãªnpmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«:
   - expo
   - react-navigation
   - @mediapipe/tasks-vision
   - firebase (JavaScript SDK)

**å…±é€šãƒ„ãƒ¼ãƒ«**:
1. Git ãƒªãƒã‚¸ãƒˆãƒªä½œæˆã¨ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥è¨­å®š
   - main: æœ¬ç•ªç’°å¢ƒ
   - develop: é–‹ç™ºç’°å¢ƒ
   - feature/*: æ©Ÿèƒ½é–‹ç™º
   - hotfix/*: ç·Šæ€¥ä¿®æ­£

2. ã‚¨ãƒ‡ã‚£ã‚¿è¨­å®š (VSCodeæ¨å¥¨)
   - ESLint
   - Prettier
   - TypeScript

**æˆæœç‰©**:
- é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰
- Git ãƒªãƒã‚¸ãƒˆãƒª
- package.json (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰/ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰)

**æ¤œè¨¼æ–¹æ³•**:
- å„ç’°å¢ƒã§ "Hello World" ãƒ¬ãƒ™ãƒ«ã®å‹•ä½œç¢ºèª
- Lintã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª

---

#### 1.1.3 CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰

**æ‹…å½“**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å  
**æœŸé–“**: 5æ—¥  
**å„ªå…ˆåº¦**: ğŸŸ¡ é«˜  

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

**GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä½œæˆ**:

1. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰CI/CD**:
```yaml
# .github/workflows/backend-ci-cd.yml
name: Backend CI/CD

on:
  push:
    branches: [main, develop]
    paths:
      - 'functions/**'
  pull_request:
    branches: [main, develop]
    paths:
      - 'functions/**'

jobs:
  lint-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '20'
      - run: cd functions && npm ci
      - run: cd functions && npm run lint
      - run: cd functions && npm test
      
  deploy:
    needs: lint-and-test
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/develop'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm install -g firebase-tools
      - run: cd functions && npm ci
      - name: Deploy to Firebase
        run: |
          if [[ $GITHUB_REF == 'refs/heads/main' ]]; then
            firebase deploy --only functions --project prod
          else
            firebase deploy --only functions --project dev
          fi
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
```

2. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰CI/CD**:
```yaml
# .github/workflows/frontend-ci-cd.yml
name: Frontend CI/CD

on:
  push:
    branches: [main, develop]
    paths:
      - 'app/**'
  pull_request:
    branches: [main, develop]
    paths:
      - 'app/**'

jobs:
  lint-and-build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '20'
      - run: cd app && npm ci
      - run: cd app && npm run lint
      - run: cd app && npm run build
      
  build-ios:
    needs: lint-and-build
    if: github.ref == 'refs/heads/main'
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: cd app && npm ci
      - run: cd app && npx expo build:ios
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
          
  build-android:
    needs: lint-and-build
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: cd app && npm ci
      - run: cd app && npx expo build:android
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
```

**æˆæœç‰©**:
- GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«
- CI/CDè¨­å®šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †æ›¸

**æ¤œè¨¼æ–¹æ³•**:
- ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆæ™‚ã«CIãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
- mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒãƒ¼ã‚¸æ™‚ã«ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

---

### 1.2 Firestore ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«å®Ÿè£… (Week 2-4)

#### 1.2.1 åŸºæœ¬ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«å®Ÿè£…

**æ‹…å½“**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å  
**æœŸé–“**: 5æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  
**æ‡¸å¿µç‚¹å¯¾å¿œ**: #1 (Firestoreã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«)

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

è¦ä»¶å®šç¾©æ›¸v3.3ã®ä»˜éŒ²Dã«åŸºã¥ã„ã¦ã€Firestoreã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’å®Œå…¨å®Ÿè£…ã—ã¾ã™ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `firestore.rules`

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
  
    // ========================================
    // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    // ========================================
    
    // èªè¨¼ãƒã‚§ãƒƒã‚¯
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã‹ãƒã‚§ãƒƒã‚¯
    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }
    
    // ç®¡ç†è€…ã‹ãƒã‚§ãƒƒã‚¯ (ã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ¬ãƒ¼ãƒ ä½¿ç”¨)
    function isAdmin() {
      return isAuthenticated() 
          && request.auth.token.get('admin', false) == true;
    }
    
    // æ–‡å­—åˆ—é•·ãƒã‚§ãƒƒã‚¯
    function isValidStringLength(str, minLen, maxLen) {
      return str is string 
          && str.size() >= minLen 
          && str.size() <= maxLen;
    }
    
    // æ•°å€¤ç¯„å›²ãƒã‚§ãƒƒã‚¯
    function isInRange(value, min, max) {
      return value is number 
          && value >= min 
          && value <= max;
    }
    
    // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯
    function hasRequiredFields(data, fields) {
      return data.keys().hasAll(fields);
    }
    
    // ========================================
    // users ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
    // ========================================
    
    match /users/{userId} {
      // èª­ã¿å–ã‚Š: æœ¬äººã®ã¿ (å‰Šé™¤äºˆå®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚‚èª­ã¿å–ã‚Šå¯èƒ½)
      allow read: if isOwner(userId);
      
      // ä½œæˆ: æœ¬äººã®ã¿ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¿…é ˆ
      allow create: if isOwner(userId) 
                    && validateUserCreate(request.resource.data);
      
      // æ›´æ–°: æœ¬äººã®ã¿ã€å‰Šé™¤äºˆå®šã§ãªã„å ´åˆã®ã¿ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¿…é ˆ
      allow update: if isOwner(userId)
                    && !resource.data.get('deletionScheduled', false)
                    && validateUserUpdate(request.resource.data, resource.data);
      
      // å‰Šé™¤: ç®¡ç†è€…ã®ã¿ (ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã¯å‰Šé™¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆAPIã‚’ä½¿ç”¨)
      allow delete: if isAdmin();
      
      // ã‚µãƒ–ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³: sessions
      match /sessions/{sessionId} {
        // èª­ã¿å–ã‚Š: æœ¬äººã®ã¿ (å‰Šé™¤äºˆå®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚‚èª­ã¿å–ã‚Šå¯èƒ½)
        allow read: if isOwner(userId);
        
        // ä½œæˆ: æœ¬äººã®ã¿ã€å‰Šé™¤äºˆå®šã§ãªã„å ´åˆã®ã¿
        allow create: if isOwner(userId)
                      && !get(/databases/$(database)/documents/users/$(userId)).data.get('deletionScheduled', false)
                      && validateSessionCreate(request.resource.data);
        
        // æ›´æ–°ãƒ»å‰Šé™¤: ä¸å¯ (ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ä¸å¤‰)
        allow update, delete: if false;
      }
      
      // ã‚µãƒ–ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³: settings
      match /settings/{settingId} {
        // èª­ã¿å–ã‚Š: æœ¬äººã®ã¿
        allow read: if isOwner(userId);
        
        // ä½œæˆãƒ»æ›´æ–°: æœ¬äººã®ã¿ã€å‰Šé™¤äºˆå®šã§ãªã„å ´åˆã®ã¿
        allow create, update: if isOwner(userId)
                              && !get(/databases/$(database)/documents/users/$(userId)).data.get('deletionScheduled', false)
                              && validateSettings(request.resource.data);
        
        // å‰Šé™¤: ä¸å¯
        allow delete: if false;
      }
    }
    
    // ========================================
    // exercises ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ (èª­ã¿å–ã‚Šå°‚ç”¨)
    // ========================================
    
    match /exercises/{exerciseId} {
      // èª­ã¿å–ã‚Š: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¨å“¡
      allow read: if isAuthenticated();
      
      // æ›¸ãè¾¼ã¿: ç®¡ç†è€…ã®ã¿
      allow write: if isAdmin();
    }
    
    // ========================================
    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
    // ========================================
    
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆæ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    function validateUserCreate(data) {
      return hasRequiredFields(data, ['userId', 'email', 'nickname', 'createdAt', 'updatedAt', 'tosAccepted', 'ppAccepted', 'tosAcceptedAt', 'ppAcceptedAt', 'tosVersion', 'ppVersion'])
          && data.userId == request.auth.uid
          && data.email == request.auth.token.email
          && isValidStringLength(data.nickname, 1, 50)
          && data.createdAt is timestamp
          && data.updatedAt is timestamp
          && data.tosAcceptedAt is timestamp
          && data.ppAcceptedAt is timestamp
          && data.tosAccepted == true
          && data.ppAccepted == true
          && data.tosVersion == '3.2'
          && data.ppVersion == '3.1'
          && (data.height == null || isInRange(data.height, 100, 250))
          && (data.weight == null || isInRange(data.weight, 30, 200))
          && (!data.keys().hasAny(['deletionScheduled', 'readOnly', 'canExportData'])); // ã“ã‚Œã‚‰ã¯è¨­å®šä¸å¯
    }
    
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°æ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    function validateUserUpdate(newData, oldData) {
      // åŒæ„ãƒ•ãƒ©ã‚°ã¯å¤‰æ›´ä¸å¯(å°‚ç”¨APIã®ã¿)
      return newData.tosAccepted == oldData.tosAccepted
          && newData.ppAccepted == oldData.ppAccepted
          && newData.tosAcceptedAt == oldData.tosAcceptedAt
          && newData.ppAcceptedAt == oldData.ppAcceptedAt
          && newData.tosVersion == oldData.tosVersion
          && newData.ppVersion == oldData.ppVersion
          // å‰Šé™¤äºˆå®šãƒ•ãƒ©ã‚°ã‚‚å¤‰æ›´ä¸å¯(å°‚ç”¨APIã®ã¿)
          && (!newData.keys().hasAny(['deletionScheduled', 'readOnly', 'canExportData'])
              || (newData.deletionScheduled == oldData.deletionScheduled
                  && newData.get('readOnly', false) == oldData.get('readOnly', false)
                  && newData.get('canExportData', false) == oldData.get('canExportData', false)))
          // ãã®ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¿…é ˆ
          && isValidStringLength(newData.nickname, 1, 50)
          && (newData.height == null || isInRange(newData.height, 100, 250))
          && (newData.weight == null || isInRange(newData.weight, 30, 200));
    }
    
    // ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆæ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    function validateSessionCreate(data) {
      return hasRequiredFields(data, ['sessionId', 'exerciseId', 'startTime', 'repCount', 'setCount', 'averageScore'])
          && data.sessionId is string
          && data.exerciseId in ['squat', 'pushup', 'plank', 'lunge', 'deadlift']
          && data.startTime is timestamp
          && isInRange(data.repCount, 0, 1000)
          && isInRange(data.setCount, 0, 100)
          && isInRange(data.averageScore, 0, 100);
    }
    
    // è¨­å®šã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    function validateSettings(data) {
      return (!data.keys().hasAny(['voice']) 
              || (data.voice.enabled is bool
                  && isInRange(data.voice.volume, 0, 100)
                  && isInRange(data.voice.speed, 0.5, 2.0)))
          && (!data.keys().hasAny(['notification']) 
              || (data.notification.enabled is bool
                  && data.notification.frequency in ['daily', 'weekly', 'biweekly']))
          && (!data.keys().hasAny(['language']) 
              || data.language in ['ja', 'en']);
    }
  }
}
```

**æˆæœç‰©**:
- `firestore.rules` ãƒ•ã‚¡ã‚¤ãƒ«
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

**æ¤œè¨¼æ–¹æ³•**:
- Firebase Emulator ã§ãƒ«ãƒ¼ãƒ«ã‚’ãƒ†ã‚¹ãƒˆ
- Firestore Rules Playground ã§ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**:
1. âœ… èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’èª­ã‚ã‚‹
2. âŒ èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä»–äººã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’èª­ã‚ãªã„
3. âœ… å‰Šé™¤äºˆå®šãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã‚ã‚‹
4. âŒ å‰Šé™¤äºˆå®šãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã§ããªã„
5. âœ… æœ¬äººãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆã§ãã‚‹
6. âŒ æœ¬äººãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ãƒ»å‰Šé™¤ã§ããªã„

---

#### 1.2.2 å‰Šé™¤çŒ¶äºˆæœŸé–“ã®å®Ÿè£…

**æ‹…å½“**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å  
**æœŸé–“**: 3æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  
**æ‡¸å¿µç‚¹å¯¾å¿œ**: #2 (å‰Šé™¤çŒ¶äºˆæœŸé–“ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡)

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

è¦ä»¶å®šç¾©æ›¸v3.3ã®FR-025-1ã«åŸºã¥ã„ã¦ã€å‰Šé™¤çŒ¶äºˆæœŸé–“ä¸­ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

**æ©Ÿèƒ½è¦ä»¶**:
1. `deletionScheduled` ãƒ•ãƒ©ã‚°ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
2. å‰Šé™¤äºˆå®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯èª­ã¿å–ã‚Šå°‚ç”¨ãƒ¢ãƒ¼ãƒ‰
3. ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã¯ç¶™ç¶šåˆ©ç”¨å¯èƒ½

**å®Ÿè£…ç®‡æ‰€**:

1. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«** (ä¸Šè¨˜ã§å®Ÿè£…æ¸ˆã¿):
   - å‰Šé™¤äºˆå®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èª­ã¿å–ã‚Šè¨±å¯
   - å‰Šé™¤äºˆå®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ›¸ãè¾¼ã¿ç¦æ­¢

2. **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒã‚§ãƒƒã‚¯**:

```typescript
// app/utils/userAccessControl.ts

export interface UserAccessStatus {
  canRead: boolean;
  canWrite: boolean;
  canExport: boolean;
  isScheduledForDeletion: boolean;
  deletionDate?: Date;
}

export async function checkUserAccessStatus(
  userId: string
): Promise<UserAccessStatus> {
  const userDoc = await firestore()
    .collection('users')
    .doc(userId)
    .get();
    
  const userData = userDoc.data();
  
  if (!userData) {
    throw new Error('User not found');
  }
  
  const isScheduledForDeletion = userData.deletionScheduled || false;
  
  return {
    canRead: true, // å¸¸ã«èª­ã¿å–ã‚Šå¯èƒ½
    canWrite: !isScheduledForDeletion, // å‰Šé™¤äºˆå®šã§ãªã„å ´åˆã®ã¿æ›¸ãè¾¼ã¿å¯èƒ½
    canExport: userData.canExportData !== false, // æ˜ç¤ºçš„ã«falseã§ãªã„é™ã‚Šå¯èƒ½
    isScheduledForDeletion,
    deletionDate: userData.deletionScheduledAt?.toDate()
  };
}

// æ›¸ãè¾¼ã¿æ“ä½œå‰ã®ãƒã‚§ãƒƒã‚¯
export async function ensureCanWrite(userId: string): Promise<void> {
  const status = await checkUserAccessStatus(userId);
  
  if (!status.canWrite) {
    throw new Error(
      'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤äºˆå®šã®ãŸã‚ã€ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ã¯ã§ãã¾ã›ã‚“ã€‚' +
      (status.deletionDate 
        ? `å‰Šé™¤äºˆå®šæ—¥: ${status.deletionDate.toLocaleDateString('ja-JP')}`
        : '')
    );
  }
}
```

**æˆæœç‰©**:
- ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒã‚§ãƒƒã‚¯å®Ÿè£…
- ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

**æ¤œè¨¼æ–¹æ³•**:
1. é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§å…¨æ“ä½œãŒå¯èƒ½ãªã“ã¨ã‚’ç¢ºèª
2. å‰Šé™¤äºˆå®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã§èª­ã¿å–ã‚Šã®ã¿å¯èƒ½ãªã“ã¨ã‚’ç¢ºèª
3. ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

---

### 1.3 Firebase Authentication è¨­å®š (Week 3-4)

#### 1.3.1 èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®š

**æ‹…å½“**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å  
**æœŸé–“**: 3æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

**1. ãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼**:
```typescript
// Firebase Console ã§ã®è¨­å®š
// Authentication > Sign-in method > Email/Password
// - Email/Password ã‚’æœ‰åŠ¹åŒ–
// - Email link (passwordless sign-in) ã‚’æœ‰åŠ¹åŒ–
```

**2. é›»è©±ç•ªå·èªè¨¼**:
```typescript
// Firebase Console ã§ã®è¨­å®š
// Authentication > Sign-in method > Phone
// - Phone ã‚’æœ‰åŠ¹åŒ–
// - reCAPTCHA v2 ã‚’è¨­å®š
```

**3. èªè¨¼ãƒ•ãƒ­ãƒ¼å®Ÿè£…** (`functions/src/auth/`):

```typescript
// functions/src/auth/signUp.ts
import { onCall, HttpsError } from 'firebase-functions/v2/https';
import * as admin from 'firebase-admin';
import Joi from 'joi';

interface SignUpRequest {
  email: string;
  password: string;
  nickname: string;
  tosVersion: string;
  ppVersion: string;
}

const signUpSchema = Joi.object({
  email: Joi.string().email().required(),
  password: Joi.string().min(8).required(),
  nickname: Joi.string().min(1).max(50).required(),
  tosVersion: Joi.string().valid('3.2').required(),
  ppVersion: Joi.string().valid('3.1').required()
});

export const auth_signUp = onCall(async (request) => {
  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  const { error, value } = signUpSchema.validate(request.data);
  if (error) {
    throw new HttpsError('invalid-argument', error.message);
  }
  
  const { email, password, nickname, tosVersion, ppVersion } = value;
  
  try {
    // Firebase Auth ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
    const userRecord = await admin.auth().createUser({
      email,
      password,
      emailVerified: false
    });
    
    // Firestore ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆ
    const now = admin.firestore.FieldValue.serverTimestamp();
    await admin.firestore().collection('users').doc(userRecord.uid).set({
      userId: userRecord.uid,
      email,
      nickname,
      createdAt: now,
      updatedAt: now,
      tosAccepted: true,
      ppAccepted: true,
      tosAcceptedAt: now,
      ppAcceptedAt: now,
      tosVersion,
      ppVersion,
      height: null,
      weight: null
    });
    
    // ãƒ¡ãƒ¼ãƒ«ç¢ºèªãƒªãƒ³ã‚¯é€ä¿¡
    const emailVerificationLink = await admin.auth()
      .generateEmailVerificationLink(email);
    
    // TODO: ãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Ÿè£…
    
    return {
      success: true,
      data: {
        userId: userRecord.uid,
        email: userRecord.email
      },
      message: 'ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ãƒ¡ãƒ¼ãƒ«ã‚’ã”ç¢ºèªãã ã•ã„ã€‚'
    };
    
  } catch (error: any) {
    if (error.code === 'auth/email-already-exists') {
      throw new HttpsError('already-exists', 'ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™');
    }
    throw new HttpsError('internal', 'ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
});
```

**æˆæœç‰©**:
- èªè¨¼APIå®Ÿè£…
- èªè¨¼ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…

**æ¤œè¨¼æ–¹æ³•**:
- æ–°è¦ç™»éŒ²ãƒ•ãƒ­ãƒ¼ã®å‹•ä½œç¢ºèª
- ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®ç¢ºèª
- ãƒ¡ãƒ¼ãƒ«ç¢ºèªã®å‹•ä½œç¢ºèª

---

#### 1.3.2 åŒæ„ç®¡ç†APIå®Ÿè£…

**æ‹…å½“**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å  
**æœŸé–“**: 5æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  
**æ‡¸å¿µç‚¹å¯¾å¿œ**: #9 (åŒæ„æ’¤å›å¾Œã®ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†)

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

è¦ä»¶å®šç¾©æ›¸v3.3ã®FR-024ã«åŸºã¥ã„ã¦ã€åŒæ„ç®¡ç†APIã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```typescript
// functions/src/gdpr/consentManagement.ts
import { onCall, HttpsError } from 'firebase-functions/v2/https';
import * as admin from 'firebase-admin';

interface RevokeConsentRequest {
  consentType: 'tos' | 'pp' | 'both';
}

export const gdpr_revokeConsent = onCall(async (request) => {
  // èªè¨¼ãƒã‚§ãƒƒã‚¯
  if (!request.auth) {
    throw new HttpsError('unauthenticated', 'èªè¨¼ãŒå¿…è¦ã§ã™');
  }
  
  const userId = request.auth.uid;
  const { consentType } = request.data as RevokeConsentRequest;
  
  if (!['tos', 'pp', 'both'].includes(consentType)) {
    throw new HttpsError('invalid-argument', 'ç„¡åŠ¹ãªåŒæ„ã‚¿ã‚¤ãƒ—ã§ã™');
  }
  
  try {
    // Firestore ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§åŒæ„ãƒ•ãƒ©ã‚°ã‚’æ›´æ–°
    await admin.firestore().runTransaction(async (transaction) => {
      const userRef = admin.firestore().collection('users').doc(userId);
      const userDoc = await transaction.get(userRef);
      
      if (!userDoc.exists) {
        throw new HttpsError('not-found', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      }
      
      const updateData: any = {
        updatedAt: admin.firestore.FieldValue.serverTimestamp()
      };
      
      if (consentType === 'tos' || consentType === 'both') {
        updateData.tosAccepted = false;
      }
      
      if (consentType === 'pp' || consentType === 'both') {
        updateData.ppAccepted = false;
      }
      
      transaction.update(userRef, updateData);
    });
    
    // Firebase Auth ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹åŒ–
    // ã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’ä½¿ç”¨ã—ã¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹åŒ–
    await admin.auth().setCustomUserClaims(userId, {
      consentRevoked: true,
      revokedAt: Date.now()
    });
    
    // æ—¢å­˜ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç„¡åŠ¹åŒ–
    await admin.auth().revokeRefreshTokens(userId);
    
    return {
      success: true,
      data: {
        userId,
        consentType,
        revokedAt: new Date().toISOString()
      },
      message: 'åŒæ„ã‚’æ’¤å›ã—ã¾ã—ãŸã€‚å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚'
    };
    
  } catch (error: any) {
    throw new HttpsError('internal', 'åŒæ„æ’¤å›ã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
});

// åŒæ„çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯API
export const gdpr_checkConsent = onCall(async (request) => {
  if (!request.auth) {
    throw new HttpsError('unauthenticated', 'èªè¨¼ãŒå¿…è¦ã§ã™');
  }
  
  const userId = request.auth.uid;
  
  try {
    const userDoc = await admin.firestore()
      .collection('users')
      .doc(userId)
      .get();
    
    if (!userDoc.exists) {
      throw new HttpsError('not-found', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
    }
    
    const userData = userDoc.data()!;
    
    return {
      success: true,
      data: {
        tosAccepted: userData.tosAccepted,
        ppAccepted: userData.ppAccepted,
        tosVersion: userData.tosVersion,
        ppVersion: userData.ppVersion,
        tosAcceptedAt: userData.tosAcceptedAt,
        ppAcceptedAt: userData.ppAcceptedAt
      }
    };
    
  } catch (error: any) {
    throw new HttpsError('internal', 'åŒæ„çŠ¶æ…‹ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
});
```

**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´å®Ÿè£…**:

```typescript
// app/utils/consentManager.ts
import { functions, auth } from './firebase';
import { httpsCallable } from 'firebase/functions';

export async function revokeConsent(
  consentType: 'tos' | 'pp' | 'both'
): Promise<void> {
  const revokeConsentFn = httpsCallable(functions, 'gdpr_revokeConsent');
  
  try {
    await revokeConsentFn({ consentType });
    
    // å¼·åˆ¶ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
    await auth().signOut();
    
    // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸é·ç§»
    // navigation.navigate('Login');
    
  } catch (error) {
    console.error('åŒæ„æ’¤å›ã‚¨ãƒ©ãƒ¼:', error);
    throw error;
  }
}

// åŒæ„çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
export async function checkConsentMiddleware(): Promise<boolean> {
  const user = auth().currentUser;
  
  if (!user) {
    return false;
  }
  
  const checkConsentFn = httpsCallable(functions, 'gdpr_checkConsent');
  
  try {
    const result = await checkConsentFn();
    const data = result.data as any;
    
    // åŒæ„ãŒæ’¤å›ã•ã‚Œã¦ã„ã‚‹å ´åˆ
    if (!data.data.tosAccepted || !data.data.ppAccepted) {
      await auth().signOut();
      return false;
    }
    
    return true;
    
  } catch (error) {
    console.error('åŒæ„çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼:', error);
    return false;
  }
}
```

**æˆæœç‰©**:
- åŒæ„ç®¡ç†APIå®Ÿè£…
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´åŒæ„ãƒã‚§ãƒƒã‚¯å®Ÿè£…
- å¼·åˆ¶ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†å®Ÿè£…
- ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

**æ¤œè¨¼æ–¹æ³•**:
1. åŒæ„æ’¤å›APIã®å‹•ä½œç¢ºèª
2. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–ã®ç¢ºèª
3. å¼·åˆ¶ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã®å‹•ä½œç¢ºèª
4. å†ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®åŒæ„ç”»é¢è¡¨ç¤ºç¢ºèª

---

### 1.4 ç›£è¦–ãƒ»ãƒ­ã‚°åŸºç›¤æ§‹ç¯‰ (Week 4)

#### 1.4.1 Cloud Logging è¨­å®š

**æ‹…å½“**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å  
**æœŸé–“**: 3æ—¥  
**å„ªå…ˆåº¦**: ğŸŸ¡ é«˜  

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

**1. æ§‹é€ åŒ–ãƒ­ã‚°å®Ÿè£…**:

```typescript
// functions/src/utils/logger.ts
import * as functions from 'firebase-functions';

export enum LogLevel {
  DEBUG = 'DEBUG',
  INFO = 'INFO',
  WARNING = 'WARNING',
  ERROR = 'ERROR',
  CRITICAL = 'CRITICAL'
}

export interface LogEntry {
  level: LogLevel;
  message: string;
  userId?: string;
  functionName?: string;
  requestId?: string;
  timestamp: string;
  metadata?: Record<string, any>;
}

export class Logger {
  private functionName: string;
  
  constructor(functionName: string) {
    this.functionName = functionName;
  }
  
  private log(level: LogLevel, message: string, metadata?: Record<string, any>): void {
    const entry: LogEntry = {
      level,
      message,
      functionName: this.functionName,
      timestamp: new Date().toISOString(),
      metadata
    };
    
    switch (level) {
      case LogLevel.DEBUG:
        functions.logger.debug(entry);
        break;
      case LogLevel.INFO:
        functions.logger.info(entry);
        break;
      case LogLevel.WARNING:
        functions.logger.warn(entry);
        break;
      case LogLevel.ERROR:
      case LogLevel.CRITICAL:
        functions.logger.error(entry);
        break;
    }
  }
  
  debug(message: string, metadata?: Record<string, any>): void {
    this.log(LogLevel.DEBUG, message, metadata);
  }
  
  info(message: string, metadata?: Record<string, any>): void {
    this.log(LogLevel.INFO, message, metadata);
  }
  
  warning(message: string, metadata?: Record<string, any>): void {
    this.log(LogLevel.WARNING, message, metadata);
  }
  
  error(message: string, error?: Error, metadata?: Record<string, any>): void {
    this.log(LogLevel.ERROR, message, {
      ...metadata,
      error: error ? {
        message: error.message,
        stack: error.stack,
        name: error.name
      } : undefined
    });
  }
  
  critical(message: string, error?: Error, metadata?: Record<string, any>): void {
    this.log(LogLevel.CRITICAL, message, {
      ...metadata,
      error: error ? {
        message: error.message,
        stack: error.stack,
        name: error.name
      } : undefined
    });
  }
}

// ä½¿ç”¨ä¾‹
const logger = new Logger('auth_signUp');
logger.info('ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²é–‹å§‹', { email: 'user@example.com' });
logger.error('ç™»éŒ²å¤±æ•—', new Error('Database error'), { userId: '123' });
```

**2. ãƒ­ã‚°ãƒ•ã‚£ãƒ«ã‚¿ä½œæˆ**:

```bash
# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãƒ•ã‚£ãƒ«ã‚¿
severity="ERROR" OR severity="CRITICAL"

# èªè¨¼é–¢é€£ãƒ­ã‚°ãƒ•ã‚£ãƒ«ã‚¿
resource.type="cloud_function"
resource.labels.function_name=~"auth_.*"

# GDPRé–¢é€£ãƒ­ã‚°ãƒ•ã‚£ãƒ«ã‚¿
resource.type="cloud_function"
resource.labels.function_name=~"gdpr_.*"

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ­ã‚°ãƒ•ã‚£ãƒ«ã‚¿ (200msä»¥ä¸Š)
resource.type="cloud_function"
jsonPayload.duration>0.2
```

**æˆæœç‰©**:
- æ§‹é€ åŒ–ãƒ­ã‚°å®Ÿè£…
- ãƒ­ã‚°ãƒ•ã‚£ãƒ«ã‚¿è¨­å®š
- ãƒ­ã‚°åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

**æ¤œè¨¼æ–¹æ³•**:
- Cloud Console ã§ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
- ãƒ•ã‚£ãƒ«ã‚¿ã§ç›®çš„ã®ãƒ­ã‚°ãŒå–å¾—ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª

---

### 1.5 Phase 1 ãƒ†ã‚¹ãƒˆã¨æ¤œè¨¼ (Week 5-8)

#### 1.5.1 çµ±åˆãƒ†ã‚¹ãƒˆ

**æ‹…å½“**: QAã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å + å…¨ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢  
**æœŸé–“**: 10æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  

**ãƒ†ã‚¹ãƒˆå†…å®¹**:

**1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ**:
```typescript
// functions/test/firestore.rules.test.ts
import * as testing from '@firebase/rules-unit-testing';
import { readFileSync } from 'fs';

describe('Firestore Security Rules', () => {
  let testEnv: testing.RulesTestEnvironment;
  
  beforeAll(async () => {
    testEnv = await testing.initializeTestEnvironment({
      projectId: 'test-project',
      firestore: {
        rules: readFileSync('firestore.rules', 'utf8'),
        host: 'localhost',
        port: 8080
      }
    });
  });
  
  afterAll(async () => {
    await testEnv.cleanup();
  });
  
  test('èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’èª­ã‚ã‚‹', async () => {
    const alice = testEnv.authenticatedContext('alice');
    const userDoc = alice.firestore().collection('users').doc('alice');
    
    await testing.assertSucceeds(userDoc.get());
  });
  
  test('èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä»–äººã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’èª­ã‚ãªã„', async () => {
    const alice = testEnv.authenticatedContext('alice');
    const bobDoc = alice.firestore().collection('users').doc('bob');
    
    await testing.assertFails(bobDoc.get());
  });
  
  test('å‰Šé™¤äºˆå®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã‚ã‚‹', async () => {
    const alice = testEnv.authenticatedContext('alice');
    
    // å‰Šé™¤äºˆå®šãƒ•ãƒ©ã‚°ã‚’è¨­å®š
    await testEnv.withSecurityRulesDisabled(async (context) => {
      await context.firestore().collection('users').doc('alice').set({
        userId: 'alice',
        email: 'alice@example.com',
        nickname: 'Alice',
        deletionScheduled: true,
        createdAt: new Date(),
        updatedAt: new Date()
      });
    });
    
    const userDoc = alice.firestore().collection('users').doc('alice');
    await testing.assertSucceeds(userDoc.get());
  });
  
  test('å‰Šé™¤äºˆå®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã§ããªã„', async () => {
    const alice = testEnv.authenticatedContext('alice');
    
    // å‰Šé™¤äºˆå®šãƒ•ãƒ©ã‚°ã‚’è¨­å®š
    await testEnv.withSecurityRulesDisabled(async (context) => {
      await context.firestore().collection('users').doc('alice').set({
        userId: 'alice',
        email: 'alice@example.com',
        nickname: 'Alice',
        deletionScheduled: true,
        createdAt: new Date(),
        updatedAt: new Date()
      });
    });
    
    const userDoc = alice.firestore().collection('users').doc('alice');
    await testing.assertFails(userDoc.update({ nickname: 'Alice2' }));
  });
});
```

**2. èªè¨¼ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ**:
- æ–°è¦ç™»éŒ²
- ãƒ­ã‚°ã‚¤ãƒ³
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ
- ãƒ¡ãƒ¼ãƒ«ç¢ºèª
- åŒæ„ç®¡ç†

**3. GDPRæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ**:
- åŒæ„æ’¤å›
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–
- å¼·åˆ¶ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ

**æˆæœç‰©**:
- ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
- ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ
- ãƒã‚°ãƒ¬ãƒãƒ¼ãƒˆ

**æ¤œè¨¼æ–¹æ³•**:
- å…¨ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®å®Ÿè¡Œ
- ã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Šã‚’ç¢ºèª

---

## ğŸ“Š Phase 1 ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³

| ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ | å®Œäº†äºˆå®š | ä¸»ãªæˆæœç‰© | æ¤œè¨¼åŸºæº– |
|--------------|---------|-----------|---------|
| **M1.1: ç’°å¢ƒæ§‹ç¯‰å®Œäº†** | Week 2 | Firebaseè¨­å®šã€é–‹ç™ºç’°å¢ƒ | å„ç’°å¢ƒã§å‹•ä½œç¢ºèªå®Œäº† |
| **M1.2: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºç›¤å®Œäº†** | Week 4 | Firestoreãƒ«ãƒ¼ãƒ«ã€èªè¨¼ | å…¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆPass |
| **M1.3: ç›£è¦–åŸºç›¤å®Œäº†** | Week 5 | ãƒ­ã‚°ã€ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç¨¼åƒ |
| **M1.4: Phase 1 å®Œäº†** | Week 8 | å…¨æˆæœç‰© | çµ±åˆãƒ†ã‚¹ãƒˆPassã€ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº† |

---

## ğŸ¯ Phase 1 æˆåŠŸåŸºæº–

| é …ç›® | åŸºæº– | æ¸¬å®šæ–¹æ³• |
|------|------|---------|
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚«ãƒãƒ¬ãƒƒã‚¸** | 100% | Firestore Rules Test |
| **èªè¨¼ãƒ•ãƒ­ãƒ¼æˆåŠŸç‡** | 100% | E2Eãƒ†ã‚¹ãƒˆ |
| **åŒæ„ç®¡ç†æ©Ÿèƒ½** | å®Œå…¨å‹•ä½œ | çµ±åˆãƒ†ã‚¹ãƒˆ |
| **ãƒ­ã‚°åé›†ç‡** | 100% | Cloud Loggingç¢ºèª |
| **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸** | â‰¥80% | Jest Coverage Report |
| **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œæˆåº¦** | 100% | ãƒ¬ãƒ“ãƒ¥ãƒ¼ |

---

**Part 1 çµ‚äº†ã€‚Part 2ã«ç¶šãã€‚**

# é–‹ç™ºã‚¿ã‚¹ã‚¯è©³ç´° + ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« v3.3 (Part 2/3)

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: AIãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ã‚¢ãƒ—ãƒª(ä»®ç§°)  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 3.3 (MVP)  
**ä½œæˆæ—¥**: 2025å¹´11æœˆ24æ—¥  

---

## ğŸ¯ Phase 2: æ©Ÿèƒ½å®Ÿè£… (2-7ãƒ¶æœˆ)

### Phase 2 æ¦‚è¦

**æœŸé–“**: 5ãƒ¶æœˆ (Week 9 - Week 28)  
**ç›®æ¨™**: MVPæ©Ÿèƒ½ã®å®Œå…¨å®Ÿè£…ã¨ãƒ†ã‚¹ãƒˆ  
**æ‡¸å¿µç‚¹å¯¾å¿œ**: #3(MediaPipe), #4(BigQuery), #7(èª²é‡‘), #10(ãƒ‡ãƒ¼ã‚¿ä¾µå®³), #11(MLæº–å‚™), #13(ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆ)

### Phase 2 ä¸»è¦æˆæœç‰©

1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å…¨ç”»é¢å®Ÿè£…
2. MediaPipe å§¿å‹¢æ¨å®šçµ±åˆ
3. ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚»ãƒƒã‚·ãƒ§ãƒ³æ©Ÿèƒ½
4. BigQuery ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
5. èª²é‡‘ãƒ»ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
6. å±¥æ­´ãƒ»åˆ†ææ©Ÿèƒ½
7. å…¨æ©Ÿèƒ½çµ±åˆãƒ†ã‚¹ãƒˆ
8. ã‚¹ãƒˆã‚¢å¯©æŸ»æº–å‚™

---

## ğŸ“‹ Phase 2 ã‚¿ã‚¹ã‚¯è©³ç´°

### 2.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰åŸºç›¤æ§‹ç¯‰ (Week 9-12)

#### 2.1.1 React Native ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ è¨­è¨ˆ

**æ‹…å½“**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢2å  
**æœŸé–“**: 5æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

**1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ **:

```
app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ common/          # ãƒœã‚¿ãƒ³ã€å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ãªã©
â”‚   â”‚   â”œâ”€â”€ training/        # ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ charts/          # ã‚°ãƒ©ãƒ•ãƒ»çµ±è¨ˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ screens/             # ç”»é¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ auth/            # èªè¨¼ç”»é¢
â”‚   â”‚   â”œâ”€â”€ home/            # ãƒ›ãƒ¼ãƒ ç”»é¢
â”‚   â”‚   â”œâ”€â”€ training/        # ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç”»é¢
â”‚   â”‚   â”œâ”€â”€ history/         # å±¥æ­´ç”»é¢
â”‚   â”‚   â””â”€â”€ profile/         # ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»é¢
â”‚   â”œâ”€â”€ navigation/          # ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
â”‚   â”œâ”€â”€ services/            # APIå‘¼ã³å‡ºã—
â”‚   â”‚   â”œâ”€â”€ firebase/        # Firebaseé–¢é€£
â”‚   â”‚   â”œâ”€â”€ mediapipe/       # MediaPipeé–¢é€£
â”‚   â”‚   â””â”€â”€ revenuecat/      # RevenueCaté–¢é€£
â”‚   â”œâ”€â”€ utils/               # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚   â”‚   â”œâ”€â”€ validation/      # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â”œâ”€â”€ formatting/      # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
â”‚   â”‚   â””â”€â”€ constants/       # å®šæ•°
â”‚   â”œâ”€â”€ hooks/               # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”œâ”€â”€ contexts/            # React Context
â”‚   â”œâ”€â”€ types/               # TypeScriptå‹å®šç¾©
â”‚   â””â”€â”€ App.tsx              # ã‚¢ãƒ—ãƒªã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ assets/                  # ç”»åƒãƒ»ã‚¢ã‚¤ã‚³ãƒ³
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

**2. å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…**:

```typescript
// src/components/common/Button.tsx
import React from 'react';
import { TouchableOpacity, Text, StyleSheet, ActivityIndicator } from 'react-native';

interface ButtonProps {
  title: string;
  onPress: () => void;
  variant?: 'primary' | 'secondary' | 'danger';
  disabled?: boolean;
  loading?: boolean;
  fullWidth?: boolean;
}

export const Button: React.FC<ButtonProps> = ({
  title,
  onPress,
  variant = 'primary',
  disabled = false,
  loading = false,
  fullWidth = false
}) => {
  const buttonStyle = [
    styles.button,
    styles[variant],
    fullWidth && styles.fullWidth,
    disabled && styles.disabled
  ];
  
  return (
    <TouchableOpacity
      style={buttonStyle}
      onPress={onPress}
      disabled={disabled || loading}
      activeOpacity={0.7}
    >
      {loading ? (
        <ActivityIndicator color="#FFF" />
      ) : (
        <Text style={styles.buttonText}>{title}</Text>
      )}
    </TouchableOpacity>
  );
};

const styles = StyleSheet.create({
  button: {
    paddingVertical: 12,
    paddingHorizontal: 24,
    borderRadius: 8,
    alignItems: 'center',
    justifyContent: 'center',
    minHeight: 48
  },
  primary: {
    backgroundColor: '#007AFF'
  },
  secondary: {
    backgroundColor: '#8E8E93'
  },
  danger: {
    backgroundColor: '#FF3B30'
  },
  disabled: {
    opacity: 0.5
  },
  fullWidth: {
    width: '100%'
  },
  buttonText: {
    color: '#FFF',
    fontSize: 16,
    fontWeight: '600'
  }
});
```

**3. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š**:

```typescript
// src/navigation/AppNavigator.tsx
import React from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { createBottomTabNavigator } from '@react-navigation/bottom-tabs';
import { createStackNavigator } from '@react-navigation/stack';
import Icon from 'react-native-vector-icons/Ionicons';

// ç”»é¢ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import { HomeScreen } from '../screens/home/HomeScreen';
import { TrainingMenuScreen } from '../screens/training/TrainingMenuScreen';
import { HistoryScreen } from '../screens/history/HistoryScreen';
import { ProfileScreen } from '../screens/profile/ProfileScreen';
import { LoginScreen } from '../screens/auth/LoginScreen';

const Tab = createBottomTabNavigator();
const Stack = createStackNavigator();

// ãƒ¡ã‚¤ãƒ³ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼
const MainTabs = () => {
  return (
    <Tab.Navigator
      screenOptions={({ route }) => ({
        tabBarIcon: ({ focused, color, size }) => {
          let iconName: string;
          
          switch (route.name) {
            case 'Home':
              iconName = focused ? 'home' : 'home-outline';
              break;
            case 'Training':
              iconName = focused ? 'fitness' : 'fitness-outline';
              break;
            case 'History':
              iconName = focused ? 'stats-chart' : 'stats-chart-outline';
              break;
            case 'Profile':
              iconName = focused ? 'person' : 'person-outline';
              break;
            default:
              iconName = 'help-outline';
          }
          
          return <Icon name={iconName} size={size} color={color} />;
        },
        tabBarActiveTintColor: '#007AFF',
        tabBarInactiveTintColor: '#8E8E93',
        headerShown: false
      })}
    >
      <Tab.Screen 
        name="Home" 
        component={HomeScreen}
        options={{ title: 'ãƒ›ãƒ¼ãƒ ' }}
      />
      <Tab.Screen 
        name="Training" 
        component={TrainingMenuScreen}
        options={{ title: 'ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°' }}
      />
      <Tab.Screen 
        name="History" 
        component={HistoryScreen}
        options={{ title: 'å±¥æ­´' }}
      />
      <Tab.Screen 
        name="Profile" 
        component={ProfileScreen}
        options={{ title: 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«' }}
      />
    </Tab.Navigator>
  );
};

// ãƒ«ãƒ¼ãƒˆãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼
export const AppNavigator = () => {
  return (
    <NavigationContainer>
      <Stack.Navigator screenOptions={{ headerShown: false }}>
        <Stack.Screen name="Login" component={LoginScreen} />
        <Stack.Screen name="Main" component={MainTabs} />
      </Stack.Navigator>
    </NavigationContainer>
  );
};
```

**æˆæœç‰©**:
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…
- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
- TypeScriptå‹å®šç¾©

**æ¤œè¨¼æ–¹æ³•**:
- å„ç”»é¢ã¸ã®é·ç§»ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨
- å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒçµ±ä¸€ã•ã‚Œã¦ã„ã‚‹ã“ã¨

---

#### 2.1.2 èªè¨¼ç”»é¢å®Ÿè£…

**æ‹…å½“**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å  
**æœŸé–“**: 7æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

ç”»é¢é·ç§»å›³v3.3ã«åŸºã¥ã„ã¦ã€èªè¨¼é–¢é€£ç”»é¢ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

**å®Ÿè£…ç”»é¢**:
1. ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ç”»é¢
2. ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ (3ç”»é¢)
3. ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
4. æ–°è¦ç™»éŒ²ç”»é¢ (2ã‚¹ãƒ†ãƒƒãƒ—)
5. åˆ©ç”¨è¦ç´„åŒæ„ç”»é¢

**1. ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢**:

```typescript
// src/screens/auth/LoginScreen.tsx
import React, { useState } from 'react';
import { View, Text, TextInput, StyleSheet, Alert } from 'react-native';
import { Button } from '../../components/common/Button';
import { auth } from '../../services/firebase/config';
import { signInWithEmailAndPassword } from 'firebase/auth';
import { checkConsentMiddleware } from '../../utils/consentManager';

export const LoginScreen: React.FC = ({ navigation }) => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);
  
  const handleLogin = async () => {
    if (!email || !password) {
      Alert.alert('ã‚¨ãƒ©ãƒ¼', 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      return;
    }
    
    setLoading(true);
    
    try {
      // Firebase Authentication ã§ãƒ­ã‚°ã‚¤ãƒ³
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      
      // åŒæ„çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
      const hasConsent = await checkConsentMiddleware();
      
      if (!hasConsent) {
        // åŒæ„ãŒå¿…è¦ãªå ´åˆã¯åŒæ„ç”»é¢ã¸
        navigation.navigate('ConsentScreen');
        return;
      }
      
      // ãƒ¡ã‚¤ãƒ³ç”»é¢ã¸é·ç§»
      navigation.replace('Main');
      
    } catch (error: any) {
      let errorMessage = 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ';
      
      switch (error.code) {
        case 'auth/user-not-found':
        case 'auth/wrong-password':
          errorMessage = 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“';
          break;
        case 'auth/too-many-requests':
          errorMessage = 'ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå›æ•°ãŒå¤šã™ãã¾ã™ã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„';
          break;
        case 'auth/network-request-failed':
          errorMessage = 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
          break;
      }
      
      Alert.alert('ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼', errorMessage);
      
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <View style={styles.container}>
      <Text style={styles.title}>ãƒ­ã‚°ã‚¤ãƒ³</Text>
      
      <TextInput
        style={styles.input}
        placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
        value={email}
        onChangeText={setEmail}
        keyboardType="email-address"
        autoCapitalize="none"
        autoComplete="email"
      />
      
      <TextInput
        style={styles.input}
        placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
        value={password}
        onChangeText={setPassword}
        secureTextEntry
        autoComplete="password"
      />
      
      <Button
        title="ãƒ­ã‚°ã‚¤ãƒ³"
        onPress={handleLogin}
        loading={loading}
        fullWidth
      />
      
      <Button
        title="æ–°è¦ç™»éŒ²"
        onPress={() => navigation.navigate('SignUp')}
        variant="secondary"
        fullWidth
      />
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    padding: 24,
    justifyContent: 'center',
    backgroundColor: '#FFF'
  },
  title: {
    fontSize: 28,
    fontWeight: 'bold',
    marginBottom: 32,
    textAlign: 'center'
  },
  input: {
    height: 48,
    borderWidth: 1,
    borderColor: '#E5E5EA',
    borderRadius: 8,
    paddingHorizontal: 16,
    marginBottom: 16,
    fontSize: 16
  }
});
```

**2. æ–°è¦ç™»éŒ²ç”»é¢ (ã‚¹ãƒ†ãƒƒãƒ—1)**:

```typescript
// src/screens/auth/SignUpStep1Screen.tsx
import React, { useState } from 'react';
import { View, Text, TextInput, StyleSheet, Alert } from 'react-native';
import { Button } from '../../components/common/Button';
import { validateEmail, validatePassword } from '../../utils/validation';

export const SignUpStep1Screen: React.FC = ({ navigation }) => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [passwordConfirm, setPasswordConfirm] = useState('');
  
  const handleNext = () => {
    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    const emailError = validateEmail(email);
    if (emailError) {
      Alert.alert('ã‚¨ãƒ©ãƒ¼', emailError);
      return;
    }
    
    const passwordError = validatePassword(password);
    if (passwordError) {
      Alert.alert('ã‚¨ãƒ©ãƒ¼', passwordError);
      return;
    }
    
    if (password !== passwordConfirm) {
      Alert.alert('ã‚¨ãƒ©ãƒ¼', 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“');
      return;
    }
    
    // ã‚¹ãƒ†ãƒƒãƒ—2ã¸é·ç§»
    navigation.navigate('SignUpStep2', { email, password });
  };
  
  return (
    <View style={styles.container}>
      <Text style={styles.title}>æ–°è¦ç™»éŒ² (1/2)</Text>
      <Text style={styles.subtitle}>èªè¨¼æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</Text>
      
      <TextInput
        style={styles.input}
        placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
        value={email}
        onChangeText={setEmail}
        keyboardType="email-address"
        autoCapitalize="none"
      />
      
      <TextInput
        style={styles.input}
        placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ (8æ–‡å­—ä»¥ä¸Š)"
        value={password}
        onChangeText={setPassword}
        secureTextEntry
      />
      
      <TextInput
        style={styles.input}
        placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ (ç¢ºèª)"
        value={passwordConfirm}
        onChangeText={setPasswordConfirm}
        secureTextEntry
      />
      
      <Button
        title="æ¬¡ã¸"
        onPress={handleNext}
        fullWidth
      />
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    padding: 24,
    justifyContent: 'center',
    backgroundColor: '#FFF'
  },
  title: {
    fontSize: 28,
    fontWeight: 'bold',
    marginBottom: 8,
    textAlign: 'center'
  },
  subtitle: {
    fontSize: 14,
    color: '#8E8E93',
    marginBottom: 32,
    textAlign: 'center'
  },
  input: {
    height: 48,
    borderWidth: 1,
    borderColor: '#E5E5EA',
    borderRadius: 8,
    paddingHorizontal: 16,
    marginBottom: 16,
    fontSize: 16
  }
});
```

**3. åˆ©ç”¨è¦ç´„åŒæ„ç”»é¢**:

```typescript
// src/screens/auth/ConsentScreen.tsx
import React, { useState } from 'react';
import { View, Text, ScrollView, StyleSheet, Alert, Linking } from 'react-native';
import { Checkbox } from '../../components/common/Checkbox';
import { Button } from '../../components/common/Button';
import { functions } from '../../services/firebase/config';
import { httpsCallable } from 'firebase/functions';

export const ConsentScreen: React.FC = ({ navigation }) => {
  const [tosAccepted, setTosAccepted] = useState(false);
  const [ppAccepted, setPpAccepted] = useState(false);
  const [loading, setLoading] = useState(false);
  
  const handleAccept = async () => {
    if (!tosAccepted || !ppAccepted) {
      Alert.alert('ã‚¨ãƒ©ãƒ¼', 'åˆ©ç”¨è¦ç´„ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã®ä¸¡æ–¹ã«åŒæ„ã—ã¦ãã ã•ã„');
      return;
    }
    
    setLoading(true);
    
    try {
      const updateConsentFn = httpsCallable(functions, 'gdpr_updateConsent');
      await updateConsentFn({
        tosVersion: '3.2',
        ppVersion: '3.1'
      });
      
      // ãƒ¡ã‚¤ãƒ³ç”»é¢ã¸é·ç§»
      navigation.replace('Main');
      
    } catch (error) {
      Alert.alert('ã‚¨ãƒ©ãƒ¼', 'åŒæ„ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
      
    } finally {
      setLoading(false);
    }
  };
  
  const openTermsOfService = () => {
    Linking.openURL('https://example.com/terms-of-service');
  };
  
  const openPrivacyPolicy = () => {
    Linking.openURL('https://example.com/privacy-policy');
  };
  
  return (
    <View style={styles.container}>
      <Text style={styles.title}>åˆ©ç”¨è¦ç´„ã¸ã®åŒæ„</Text>
      <Text style={styles.description}>
        ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ã€åˆ©ç”¨è¦ç´„ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã¸ã®åŒæ„ãŒå¿…è¦ã§ã™ã€‚
      </Text>
      
      <ScrollView style={styles.scrollView}>
        <View style={styles.checkboxContainer}>
          <Checkbox
            checked={tosAccepted}
            onPress={() => setTosAccepted(!tosAccepted)}
          />
          <View style={styles.checkboxText}>
            <Text style={styles.label}>
              åˆ©ç”¨è¦ç´„ (v3.2) ã«åŒæ„ã—ã¾ã™
            </Text>
            <Text style={styles.link} onPress={openTermsOfService}>
              åˆ©ç”¨è¦ç´„ã‚’èª­ã‚€
            </Text>
          </View>
        </View>
        
        <View style={styles.checkboxContainer}>
          <Checkbox
            checked={ppAccepted}
            onPress={() => setPpAccepted(!ppAccepted)}
          />
          <View style={styles.checkboxText}>
            <Text style={styles.label}>
              ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ (v3.1) ã«åŒæ„ã—ã¾ã™
            </Text>
            <Text style={styles.link} onPress={openPrivacyPolicy}>
              ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’èª­ã‚€
            </Text>
          </View>
        </View>
      </ScrollView>
      
      <Button
        title="åŒæ„ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹"
        onPress={handleAccept}
        loading={loading}
        disabled={!tosAccepted || !ppAccepted}
        fullWidth
      />
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    padding: 24,
    backgroundColor: '#FFF'
  },
  title: {
    fontSize: 24,
    fontWeight: 'bold',
    marginBottom: 16
  },
  description: {
    fontSize: 14,
    color: '#8E8E93',
    marginBottom: 24,
    lineHeight: 20
  },
  scrollView: {
    flex: 1,
    marginBottom: 24
  },
  checkboxContainer: {
    flexDirection: 'row',
    alignItems: 'flex-start',
    marginBottom: 24
  },
  checkboxText: {
    flex: 1,
    marginLeft: 12
  },
  label: {
    fontSize: 16,
    marginBottom: 4
  },
  link: {
    fontSize: 14,
    color: '#007AFF',
    textDecorationLine: 'underline'
  }
});
```

**æˆæœç‰©**:
- èªè¨¼ç”»é¢å®Ÿè£…ã‚³ãƒ¼ãƒ‰
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…
- ç”»é¢é·ç§»ãƒ†ã‚¹ãƒˆ

**æ¤œè¨¼æ–¹æ³•**:
- å…¨èªè¨¼ãƒ•ãƒ­ãƒ¼ã®å‹•ä½œç¢ºèª
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®è¡¨ç¤ºç¢ºèª
- åŒæ„ç”»é¢ã®å‹•ä½œç¢ºèª

---

#### 2.1.3 ãƒ›ãƒ¼ãƒ ç”»é¢ãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢å®Ÿè£…

**æ‹…å½“**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å  
**æœŸé–“**: 5æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

**1. ãƒ›ãƒ¼ãƒ ç”»é¢**:

```typescript
// src/screens/home/HomeScreen.tsx
import React, { useEffect, useState } from 'react';
import { View, Text, ScrollView, StyleSheet } from 'react-native';
import { Card } from '../../components/common/Card';
import { StatCard } from '../../components/home/StatCard';
import { RecentSessionCard } from '../../components/home/RecentSessionCard';
import { firestore, auth } from '../../services/firebase/config';
import { collection, query, where, orderBy, limit, getDocs } from 'firebase/firestore';

interface DashboardStats {
  totalSessions: number;
  weeklyAverage: number;
  lastSessionDate: Date | null;
  favoriteExercise: string;
}

export const HomeScreen: React.FC = ({ navigation }) => {
  const [stats, setStats] = useState<DashboardStats>({
    totalSessions: 0,
    weeklyAverage: 0,
    lastSessionDate: null,
    favoriteExercise: '-'
  });
  const [recentSessions, setRecentSessions] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    loadDashboardData();
  }, []);
  
  const loadDashboardData = async () => {
    try {
      const userId = auth.currentUser?.uid;
      if (!userId) return;
      
      // æœ€è¿‘ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å–å¾—
      const sessionsRef = collection(firestore, `users/${userId}/sessions`);
      const sessionsQuery = query(
        sessionsRef,
        orderBy('startTime', 'desc'),
        limit(5)
      );
      const sessionsSnapshot = await getDocs(sessionsQuery);
      
      const sessions = sessionsSnapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      }));
      
      setRecentSessions(sessions);
      
      // çµ±è¨ˆæƒ…å ±ã‚’è¨ˆç®—
      const totalSessions = sessionsSnapshot.size;
      const lastSessionDate = sessions[0]?.startTime?.toDate() || null;
      
      // é€±å¹³å‡ã‚’è¨ˆç®— (ç°¡æ˜“ç‰ˆ)
      const weeklyAverage = totalSessions > 0 ? Math.round(totalSessions / 4) : 0;
      
      // ãŠæ°—ã«å…¥ã‚Šã®ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚ºã‚’è¨ˆç®—
      const exerciseCounts: { [key: string]: number } = {};
      sessions.forEach(session => {
        exerciseCounts[session.exerciseId] = (exerciseCounts[session.exerciseId] || 0) + 1;
      });
      
      const favoriteExercise = Object.entries(exerciseCounts)
        .sort((a, b) => b[1] - a[1])[0]?.[0] || '-';
      
      setStats({
        totalSessions,
        weeklyAverage,
        lastSessionDate,
        favoriteExercise
      });
      
    } catch (error) {
      console.error('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—:', error);
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <ScrollView style={styles.container}>
      <Text style={styles.greeting}>ã“ã‚“ã«ã¡ã¯!</Text>
      <Text style={styles.subtitle}>ä»Šæ—¥ã‚‚ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’å§‹ã‚ã¾ã—ã‚‡ã†</Text>
      
      <View style={styles.statsContainer}>
        <StatCard
          title="ç·ã‚»ãƒƒã‚·ãƒ§ãƒ³"
          value={stats.totalSessions.toString()}
          icon="fitness"
        />
        <StatCard
          title="é€±å¹³å‡"
          value={stats.weeklyAverage.toString()}
          icon="calendar"
        />
      </View>
      
      <Card style={styles.quickStartCard}>
        <Text style={styles.sectionTitle}>ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ</Text>
        <Button
          title="ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’é–‹å§‹"
          onPress={() => navigation.navigate('Training')}
          fullWidth
        />
      </Card>
      
      {recentSessions.length > 0 && (
        <View style={styles.recentSection}>
          <Text style={styles.sectionTitle}>æœ€è¿‘ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³</Text>
          {recentSessions.map(session => (
            <RecentSessionCard key={session.id} session={session} />
          ))}
        </View>
      )}
    </ScrollView>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#F2F2F7'
  },
  greeting: {
    fontSize: 28,
    fontWeight: 'bold',
    padding: 24,
    paddingBottom: 8
  },
  subtitle: {
    fontSize: 16,
    color: '#8E8E93',
    paddingHorizontal: 24,
    paddingBottom: 24
  },
  statsContainer: {
    flexDirection: 'row',
    paddingHorizontal: 16,
    gap: 16
  },
  quickStartCard: {
    margin: 16
  },
  sectionTitle: {
    fontSize: 18,
    fontWeight: '600',
    marginBottom: 16
  },
  recentSection: {
    padding: 16
  }
});
```

**2. ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠç”»é¢**:

```typescript
// src/screens/training/TrainingMenuScreen.tsx
import React from 'react';
import { View, Text, FlatList, StyleSheet } from 'react-native';
import { ExerciseCard } from '../../components/training/ExerciseCard';

const EXERCISES = [
  {
    id: 'squat',
    name: 'ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ',
    description: 'ä¸‹åŠèº«å…¨ä½“ã‚’é›ãˆã‚‹åŸºæœ¬ç¨®ç›®',
    difficulty: 'åˆç´š',
    targetMuscles: ['å¤§è…¿å››é ­ç­‹', 'å¤§è‡€ç­‹', 'ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°'],
    icon: 'fitness'
  },
  {
    id: 'pushup',
    name: 'è…•ç«‹ã¦ä¼ã›',
    description: 'ä¸ŠåŠèº«ã‚’é›ãˆã‚‹åŸºæœ¬ç¨®ç›®',
    difficulty: 'åˆç´š',
    targetMuscles: ['å¤§èƒ¸ç­‹', 'ä¸Šè…•ä¸‰é ­ç­‹', 'ä¸‰è§’ç­‹'],
    icon: 'fitness'
  },
  {
    id: 'plank',
    name: 'ãƒ—ãƒ©ãƒ³ã‚¯',
    description: 'ä½“å¹¹ã‚’å¼·åŒ–ã™ã‚‹é™çš„ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°',
    difficulty: 'åˆç´š',
    targetMuscles: ['è…¹ç›´ç­‹', 'è…¹æ¨ªç­‹', 'è„ŠæŸ±èµ·ç«‹ç­‹'],
    icon: 'fitness'
  },
  {
    id: 'lunge',
    name: 'ãƒ©ãƒ³ã‚¸',
    description: 'ç‰‡è¶³ãšã¤ä¸‹åŠèº«ã‚’é›ãˆã‚‹',
    difficulty: 'ä¸­ç´š',
    targetMuscles: ['å¤§è…¿å››é ­ç­‹', 'å¤§è‡€ç­‹', 'ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°'],
    icon: 'fitness'
  },
  {
    id: 'deadlift',
    name: 'ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ',
    description: 'å…¨èº«ã‚’é›ãˆã‚‹é«˜å¼·åº¦ç¨®ç›®',
    difficulty: 'ä¸Šç´š',
    targetMuscles: ['åºƒèƒŒç­‹', 'å¤§è‡€ç­‹', 'ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°'],
    icon: 'fitness'
  }
];

export const TrainingMenuScreen: React.FC = ({ navigation }) => {
  const handleExerciseSelect = (exerciseId: string) => {
    navigation.navigate('CameraSetup', { exerciseId });
  };
  
  return (
    <View style={styles.container}>
      <Text style={styles.title}>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç¨®ç›®ã‚’é¸æŠ</Text>
      
      <FlatList
        data={EXERCISES}
        keyExtractor={item => item.id}
        renderItem={({ item }) => (
          <ExerciseCard
            exercise={item}
            onPress={() => handleExerciseSelect(item.id)}
          />
        )}
        contentContainerStyle={styles.list}
      />
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#F2F2F7'
  },
  title: {
    fontSize: 28,
    fontWeight: 'bold',
    padding: 24
  },
  list: {
    padding: 16
  }
});
```

**æˆæœç‰©**:
- ãƒ›ãƒ¼ãƒ ç”»é¢å®Ÿè£…
- ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢å®Ÿè£…
- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚ºã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**æ¤œè¨¼æ–¹æ³•**:
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤ºç¢ºèª
- ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠã®å‹•ä½œç¢ºèª

---

### 2.2 MediaPipe çµ±åˆ (Week 12-16)

#### 2.2.1 MediaPipe å§¿å‹¢æ¨å®šã®å®Ÿè£…

**æ‹…å½“**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢2å  
**æœŸé–“**: 10æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  
**æ‡¸å¿µç‚¹å¯¾å¿œ**: #3 (MediaPipeãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶)

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

è¦ä»¶å®šç¾©æ›¸v3.3ã®NFR-024ã€NFR-025ã€NFR-035ã«åŸºã¥ã„ã¦ã€MediaPipeå§¿å‹¢æ¨å®šã‚’å®Ÿè£…ã—ã¾ã™ã€‚

**1. MediaPipe ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**:

```typescript
// src/services/mediapipe/poseDetector.ts
import { PoseLandmarker, FilesetResolver, DrawingUtils } from '@mediapipe/tasks-vision';

export class PoseDetector {
  private poseLandmarker: PoseLandmarker | null = null;
  private lastVideoTime = -1;
  private isProcessing = false;
  
  async initialize(): Promise<void> {
    try {
      const vision = await FilesetResolver.forVisionTasks(
        'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm'
      );
      
      this.poseLandmarker = await PoseLandmarker.createFromOptions(vision, {
        baseOptions: {
          modelAssetPath: 'https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task',
          delegate: 'GPU' // GPUåŠ é€Ÿã‚’ä½¿ç”¨
        },
        runningMode: 'VIDEO',
        numPoses: 1,
        minPoseDetectionConfidence: 0.5,
        minPosePresenceConfidence: 0.5,
        minTrackingConfidence: 0.5
      });
      
      console.log('MediaPipeåˆæœŸåŒ–å®Œäº†');
      
    } catch (error) {
      console.error('MediaPipeåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }
  
  async detectPose(
    video: HTMLVideoElement,
    timestamp: number
  ): Promise<PoseLandmarkerResult | null> {
    if (!this.poseLandmarker || this.isProcessing) {
      return null;
    }
    
    // ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¹ã‚­ãƒƒãƒ—ã‚’é˜²ã
    if (timestamp === this.lastVideoTime) {
      return null;
    }
    
    this.isProcessing = true;
    this.lastVideoTime = timestamp;
    
    try {
      const result = this.poseLandmarker.detectForVideo(video, timestamp);
      return result;
      
    } catch (error) {
      console.error('å§¿å‹¢æ¤œå‡ºã‚¨ãƒ©ãƒ¼:', error);
      return null;
      
    } finally {
      this.isProcessing = false;
    }
  }
  
  dispose(): void {
    if (this.poseLandmarker) {
      this.poseLandmarker.close();
      this.poseLandmarker = null;
    }
  }
}
```

**2. ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆç›£è¦–**:

```typescript
// src/services/mediapipe/frameRateMonitor.ts

export class FrameRateMonitor {
  private frameCount = 0;
  private lastTimestamp = 0;
  private fps = 0;
  private fpsHistory: number[] = [];
  private readonly TARGET_FPS = 30;
  private readonly HISTORY_SIZE = 30; // 1ç§’åˆ†ã®å±¥æ­´
  
  updateFrame(timestamp: number): void {
    if (this.lastTimestamp === 0) {
      this.lastTimestamp = timestamp;
      return;
    }
    
    const elapsed = timestamp - this.lastTimestamp;
    
    if (elapsed >= 1000) {
      // 1ç§’ã”ã¨ã«FPSã‚’è¨ˆç®—
      this.fps = Math.round((this.frameCount * 1000) / elapsed);
      this.fpsHistory.push(this.fps);
      
      // å±¥æ­´ã‚µã‚¤ã‚ºã‚’åˆ¶é™
      if (this.fpsHistory.length > this.HISTORY_SIZE) {
        this.fpsHistory.shift();
      }
      
      this.frameCount = 0;
      this.lastTimestamp = timestamp;
      
      // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è­¦å‘Š
      if (this.fps < this.TARGET_FPS * 0.8) {
        console.warn(`FPSä½ä¸‹: ${this.fps}fps (ç›®æ¨™: ${this.TARGET_FPS}fps)`);
      }
    }
    
    this.frameCount++;
  }
  
  getCurrentFPS(): number {
    return this.fps;
  }
  
  getAverageFPS(): number {
    if (this.fpsHistory.length === 0) return 0;
    
    const sum = this.fpsHistory.reduce((a, b) => a + b, 0);
    return Math.round(sum / this.fpsHistory.length);
  }
  
  isPerformanceAcceptable(): boolean {
    const avgFps = this.getAverageFPS();
    return avgFps >= this.TARGET_FPS * 0.8; // 24fpsä»¥ä¸Š
  }
  
  reset(): void {
    this.frameCount = 0;
    this.lastTimestamp = 0;
    this.fps = 0;
    this.fpsHistory = [];
  }
}
```

**3. ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†**:

```typescript
// src/services/mediapipe/performanceFallback.ts

export enum PerformanceMode {
  HIGH_QUALITY = 'high',      // 30fps, è©³ç´°ãªæ¤œå‡º
  MEDIUM_QUALITY = 'medium',  // 20fps, æ¨™æº–æ¤œå‡º
  LOW_QUALITY = 'low'         // 15fps, ç°¡æ˜“æ¤œå‡º
}

export class PerformanceFallback {
  private currentMode: PerformanceMode = PerformanceMode.HIGH_QUALITY;
  private modeChangeCallback?: (mode: PerformanceMode) => void;
  
  setModeChangeCallback(callback: (mode: PerformanceMode) => void): void {
    this.modeChangeCallback = callback;
  }
  
  evaluatePerformance(monitor: FrameRateMonitor): void {
    const avgFps = monitor.getAverageFPS();
    let newMode = this.currentMode;
    
    if (avgFps < 20 && this.currentMode === PerformanceMode.HIGH_QUALITY) {
      // é«˜å“è³ªãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰ä¸­å“è³ªãƒ¢ãƒ¼ãƒ‰ã¸
      newMode = PerformanceMode.MEDIUM_QUALITY;
      console.log('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã‚’ä¸­å“è³ªã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ');
      
    } else if (avgFps < 12 && this.currentMode === PerformanceMode.MEDIUM_QUALITY) {
      // ä¸­å“è³ªãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰ä½å“è³ªãƒ¢ãƒ¼ãƒ‰ã¸
      newMode = PerformanceMode.LOW_QUALITY;
      console.log('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã‚’ä½å“è³ªã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ');
      
    } else if (avgFps >= 28 && this.currentMode === PerformanceMode.MEDIUM_QUALITY) {
      // ä¸­å“è³ªãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰é«˜å“è³ªãƒ¢ãƒ¼ãƒ‰ã¸å›å¾©
      newMode = PerformanceMode.HIGH_QUALITY;
      console.log('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã‚’é«˜å“è³ªã«å›å¾©ã—ã¾ã—ãŸ');
      
    } else if (avgFps >= 18 && this.currentMode === PerformanceMode.LOW_QUALITY) {
      // ä½å“è³ªãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰ä¸­å“è³ªãƒ¢ãƒ¼ãƒ‰ã¸å›å¾©
      newMode = PerformanceMode.MEDIUM_QUALITY;
      console.log('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã‚’ä¸­å“è³ªã«å›å¾©ã—ã¾ã—ãŸ');
    }
    
    if (newMode !== this.currentMode) {
      this.currentMode = newMode;
      this.modeChangeCallback?.(newMode);
    }
  }
  
  getCurrentMode(): PerformanceMode {
    return this.currentMode;
  }
  
  getModelSettings(mode: PerformanceMode): any {
    switch (mode) {
      case PerformanceMode.HIGH_QUALITY:
        return {
          modelAssetPath: 'pose_landmarker_lite.task',
          minPoseDetectionConfidence: 0.5,
          minPosePresenceConfidence: 0.5,
          minTrackingConfidence: 0.5
        };
        
      case PerformanceMode.MEDIUM_QUALITY:
        return {
          modelAssetPath: 'pose_landmarker_lite.task',
          minPoseDetectionConfidence: 0.4,
          minPosePresenceConfidence: 0.4,
          minTrackingConfidence: 0.4
        };
        
      case PerformanceMode.LOW_QUALITY:
        return {
          modelAssetPath: 'pose_landmarker_lite.task',
          minPoseDetectionConfidence: 0.3,
          minPosePresenceConfidence: 0.3,
          minTrackingConfidence: 0.3
        };
    }
  }
}
```

**æˆæœç‰©**:
- MediaPipeå§¿å‹¢æ¨å®šå®Ÿè£…
- ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆç›£è¦–å®Ÿè£…
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†å®Ÿè£…
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

**æ¤œè¨¼æ–¹æ³•**:
1. é«˜æ€§èƒ½ç«¯æœ« (iPhone 13 Proä»¥ä¸Š) ã§30fpsç¶­æŒã‚’ç¢ºèª
2. ä¸­æ€§èƒ½ç«¯æœ« (iPhone XR) ã§20fpsä»¥ä¸Šã‚’ç¢ºèª
3. ä½æ€§èƒ½ç«¯æœ«ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã‚’ç¢ºèª
4. ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆãƒ¢ãƒ‹ã‚¿ã®ç²¾åº¦ã‚’ç¢ºèª

---

#### 2.2.2 ãƒ•ã‚©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…

**æ‹…å½“**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å  
**æœŸé–“**: 10æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

README_form_validation_logic_v3_3ã«åŸºã¥ã„ã¦ã€å„ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚ºã®ãƒ•ã‚©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

**1. ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯**:

```typescript
// src/services/training/formValidation/squatValidator.ts
import { PoseLandmarkerResult } from '@mediapipe/tasks-vision';

export interface FormScore {
  overall: number;        // ç·åˆã‚¹ã‚³ã‚¢ (0-100)
  kneeAlignment: number;  // è†ã®ä½ç½®
  backAngle: number;      // èƒŒä¸­ã®è§’åº¦
  depth: number;          // ã—ã‚ƒãŒã¿ã®æ·±ã•
  balance: number;        // ãƒãƒ©ãƒ³ã‚¹
  feedback: string[];     // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
}

export class SquatValidator {
  private readonly MIN_KNEE_ANGLE = 80;
  private readonly MAX_KNEE_ANGLE = 170;
  private readonly MIN_DEPTH = 90; // è†ã®è§’åº¦90åº¦ä»¥ä¸‹
  
  validate(landmarks: any[]): FormScore {
    const feedback: string[] = [];
    let scores = {
      kneeAlignment: 100,
      backAngle: 100,
      depth: 100,
      balance: 100
    };
    
    // è†ã®ä½ç½®ãƒã‚§ãƒƒã‚¯
    const kneeScore = this.checkKneeAlignment(landmarks);
    if (kneeScore < 80) {
      feedback.push('è†ãŒã¤ã¾å…ˆã‚ˆã‚Šå‰ã«å‡ºã¦ã„ã¾ã™');
    }
    scores.kneeAlignment = kneeScore;
    
    // èƒŒä¸­ã®è§’åº¦ãƒã‚§ãƒƒã‚¯
    const backScore = this.checkBackAngle(landmarks);
    if (backScore < 80) {
      feedback.push('èƒŒä¸­ãŒã¾ã£ã™ãä¿ãŸã‚Œã¦ã„ã¾ã›ã‚“');
    }
    scores.backAngle = backScore;
    
    // ã—ã‚ƒãŒã¿ã®æ·±ã•ãƒã‚§ãƒƒã‚¯
    const depthScore = this.checkDepth(landmarks);
    if (depthScore < 80) {
      feedback.push('ã‚‚ã†å°‘ã—æ·±ãã—ã‚ƒãŒã¿ã¾ã—ã‚‡ã†');
    }
    scores.depth = depthScore;
    
    // ãƒãƒ©ãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯
    const balanceScore = this.checkBalance(landmarks);
    if (balanceScore < 80) {
      feedback.push('å·¦å³ã®ãƒãƒ©ãƒ³ã‚¹ã‚’ä¿ã¡ã¾ã—ã‚‡ã†');
    }
    scores.balance = balanceScore;
    
    // ç·åˆã‚¹ã‚³ã‚¢è¨ˆç®—
    const overall = Math.round(
      (scores.kneeAlignment + scores.backAngle + scores.depth + scores.balance) / 4
    );
    
    if (overall >= 90) {
      feedback.push('ç´ æ™´ã‚‰ã—ã„ãƒ•ã‚©ãƒ¼ãƒ ã§ã™!');
    } else if (overall >= 70) {
      feedback.push('è‰¯ã„ãƒ•ã‚©ãƒ¼ãƒ ã§ã™');
    }
    
    return {
      overall,
      ...scores,
      feedback
    };
  }
  
  private checkKneeAlignment(landmarks: any[]): number {
    // è†ã¨ã¤ã¾å…ˆã®ä½ç½®é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯
    const knee = landmarks[25]; // å·¦è†
    const ankle = landmarks[27]; // å·¦è¶³é¦–
    
    if (!knee || !ankle) return 100;
    
    const kneeOverToe = knee.x - ankle.x;
    
    // è†ãŒã¤ã¾å…ˆã‚ˆã‚Šå‰ã«å‡ºã¦ã„ãªã„: 100ç‚¹
    // è†ãŒå°‘ã—å‰ã«å‡ºã¦ã„ã‚‹: 80ç‚¹
    // è†ãŒå¤§ããå‰ã«å‡ºã¦ã„ã‚‹: 50ç‚¹
    if (kneeOverToe <= 0) return 100;
    if (kneeOverToe <= 0.05) return 80;
    return Math.max(50, 100 - (kneeOverToe * 1000));
  }
  
  private checkBackAngle(landmarks: any[]): number {
    // è‚©ãƒ»è…°ãƒ»è†ã‚’çµã¶ç·šã®è§’åº¦ã‚’ãƒã‚§ãƒƒã‚¯
    const shoulder = landmarks[11];
    const hip = landmarks[23];
    const knee = landmarks[25];
    
    if (!shoulder || !hip || !knee) return 100;
    
    const angle = this.calculateAngle(shoulder, hip, knee);
    
    // ç†æƒ³çš„ãªè§’åº¦ç¯„å›²: 150-170åº¦
    if (angle >= 150 && angle <= 170) return 100;
    if (angle >= 140 && angle <= 180) return 80;
    return Math.max(50, 100 - Math.abs(160 - angle));
  }
  
  private checkDepth(landmarks: any[]): number {
    // è†ã®æ›²ãŒã‚Šè§’åº¦ã‚’ãƒã‚§ãƒƒã‚¯
    const hip = landmarks[23];
    const knee = landmarks[25];
    const ankle = landmarks[27];
    
    if (!hip || !knee || !ankle) return 100;
    
    const angle = this.calculateAngle(hip, knee, ankle);
    
    // 90åº¦ä»¥ä¸‹: 100ç‚¹
    // 100åº¦: 80ç‚¹
    // ãã‚Œä»¥ä¸Š: æ®µéšçš„ã«æ¸›ç‚¹
    if (angle <= this.MIN_DEPTH) return 100;
    if (angle <= 100) return 80;
    return Math.max(50, 100 - (angle - this.MIN_DEPTH));
  }
  
  private checkBalance(landmarks: any[]): number {
    // å·¦å³ã®è†ã®é«˜ã•ã‚’ãƒã‚§ãƒƒã‚¯
    const leftKnee = landmarks[25];
    const rightKnee = landmarks[26];
    
    if (!leftKnee || !rightKnee) return 100;
    
    const heightDiff = Math.abs(leftKnee.y - rightKnee.y);
    
    // å·®ãŒå°ã•ã„ã»ã©é«˜å¾—ç‚¹
    if (heightDiff <= 0.02) return 100;
    if (heightDiff <= 0.05) return 80;
    return Math.max(50, 100 - (heightDiff * 1000));
  }
  
  private calculateAngle(p1: any, p2: any, p3: any): number {
    const radians = Math.atan2(p3.y - p2.y, p3.x - p2.x) -
                    Math.atan2(p1.y - p2.y, p1.x - p2.x);
    let angle = Math.abs(radians * 180.0 / Math.PI);
    
    if (angle > 180.0) {
      angle = 360 - angle;
    }
    
    return angle;
  }
}
```

**æˆæœç‰©**:
- 5ç¨®ç›®ã®ãƒ•ã‚©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
- ã‚¹ã‚³ã‚¢è¨ˆç®—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

**æ¤œè¨¼æ–¹æ³•**:
1. æ­£ã—ã„ãƒ•ã‚©ãƒ¼ãƒ ã§é«˜ã‚¹ã‚³ã‚¢ãŒå‡ºã‚‹ã“ã¨ã‚’ç¢ºèª
2. é–“é•ã£ãŸãƒ•ã‚©ãƒ¼ãƒ ã§ä½ã‚¹ã‚³ã‚¢ãŒå‡ºã‚‹ã“ã¨ã‚’ç¢ºèª
3. ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç²¾åº¦ã‚’ç¢ºèª

---

**Part 2 çµ‚äº†ã€‚Part 3ã«ç¶šãã€‚**
# é–‹ç™ºã‚¿ã‚¹ã‚¯è©³ç´° + ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« v3.3 (Part 3/3)

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: AIãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ã‚¢ãƒ—ãƒª(ä»®ç§°)  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 3.3 (MVP)  
**ä½œæˆæ—¥**: 2025å¹´11æœˆ24æ—¥  

---

## ğŸ“‹ Phase 2 ã‚¿ã‚¹ã‚¯è©³ç´° (ç¶šã)

### 2.3 BigQuery ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰ (Week 16-18)

#### 2.3.1 BigQuery ã‚¹ã‚­ãƒ¼ãƒè¨­å®š

**æ‹…å½“**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å  
**æœŸé–“**: 3æ—¥  
**å„ªå…ˆåº¦**: ğŸŸ¡ é«˜  
**æ‡¸å¿µç‚¹å¯¾å¿œ**: #4 (BigQueryéšœå®³æ™‚ã®ãƒªãƒˆãƒ©ã‚¤å‡¦ç†), #11 (MLç§»è¡Œæº–å‚™)

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

BigQueryè¨­è¨ˆæ›¸v3.3ã«åŸºã¥ã„ã¦ã€ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¨ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

**1. ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆä½œæˆ**:

```bash
# training_sessions ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ
bq mk --dataset \
  --location=asia-northeast1 \
  --description="ä»®ååŒ–æ¸ˆã¿ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿" \
  ai-fitness-app-prod:training_sessions

# user_analytics ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ
bq mk --dataset \
  --location=asia-northeast1 \
  --description="ä»®ååŒ–æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ†æãƒ‡ãƒ¼ã‚¿" \
  ai-fitness-app-prod:user_analytics
```

**2. ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚­ãƒ¼ãƒå®šç¾©**:

```typescript
// functions/src/bigquery/schemas/sessionSchema.ts
export const SESSION_SCHEMA = [
  { name: 'session_id', type: 'STRING', mode: 'REQUIRED' },
  { name: 'anonymous_user_id', type: 'STRING', mode: 'REQUIRED' },
  { name: 'exercise_id', type: 'STRING', mode: 'REQUIRED' },
  { name: 'start_time', type: 'TIMESTAMP', mode: 'REQUIRED' },
  { name: 'end_time', type: 'TIMESTAMP', mode: 'NULLABLE' },
  { name: 'duration_seconds', type: 'INTEGER', mode: 'NULLABLE' },
  { name: 'rep_count', type: 'INTEGER', mode: 'REQUIRED' },
  { name: 'set_count', type: 'INTEGER', mode: 'REQUIRED' },
  { name: 'average_score', type: 'FLOAT', mode: 'REQUIRED' },
  { 
    name: 'score_breakdown', 
    type: 'RECORD', 
    mode: 'NULLABLE',
    fields: [
      { name: 'knee_alignment', type: 'FLOAT', mode: 'NULLABLE' },
      { name: 'back_angle', type: 'FLOAT', mode: 'NULLABLE' },
      { name: 'depth', type: 'FLOAT', mode: 'NULLABLE' },
      { name: 'balance', type: 'FLOAT', mode: 'NULLABLE' }
    ]
  },
  { 
    name: 'device_info', 
    type: 'RECORD', 
    mode: 'NULLABLE',
    fields: [
      { name: 'os', type: 'STRING', mode: 'NULLABLE' },
      { name: 'os_version', type: 'STRING', mode: 'NULLABLE' },
      { name: 'model', type: 'STRING', mode: 'NULLABLE' }
    ]
  },
  { name: 'app_version', type: 'STRING', mode: 'NULLABLE' },
  { name: 'inserted_at', type: 'TIMESTAMP', mode: 'REQUIRED' }
];
```

**3. ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ**:

```typescript
// functions/src/bigquery/setupBigQuery.ts
import { BigQuery } from '@google-cloud/bigquery';
import { SESSION_SCHEMA } from './schemas/sessionSchema';

export async function setupBigQuery(): Promise<void> {
  const bigquery = new BigQuery();
  const datasetId = 'training_sessions';
  const tableId = 'sessions';
  
  try {
    // ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
    const [table] = await bigquery
      .dataset(datasetId)
      .createTable(tableId, {
        schema: SESSION_SCHEMA,
        timePartitioning: {
          type: 'DAY',
          field: 'start_time'
        },
        clustering: {
          fields: ['exercise_id', 'anonymous_user_id']
        }
      });
    
    console.log(`ãƒ†ãƒ¼ãƒ–ãƒ« ${table.id} ã‚’ä½œæˆã—ã¾ã—ãŸ`);
    
  } catch (error) {
    console.error('BigQueryã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', error);
    throw error;
  }
}
```

**æˆæœç‰©**:
- BigQuery ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ
- ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**æ¤œè¨¼æ–¹æ³•**:
- BigQuery Console ã§ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
- ã‚¹ã‚­ãƒ¼ãƒãŒæ­£ã—ãå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

---

#### 2.3.2 Cloud Tasks ãƒªãƒˆãƒ©ã‚¤ã‚­ãƒ¥ãƒ¼å®Ÿè£…

**æ‹…å½“**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å  
**æœŸé–“**: 5æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  
**æ‡¸å¿µç‚¹å¯¾å¿œ**: #4 (BigQueryéšœå®³æ™‚ã®ãƒªãƒˆãƒ©ã‚¤å‡¦ç†)

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

è¦ä»¶å®šç¾©æ›¸v3.3ã®NFR-036ã«åŸºã¥ã„ã¦ã€Cloud Tasksã«ã‚ˆã‚‹ãƒªãƒˆãƒ©ã‚¤ã‚­ãƒ¥ãƒ¼ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

**1. Cloud Tasks ã‚­ãƒ¥ãƒ¼ä½œæˆ**:

```bash
# BigQueryãƒ‡ãƒ¼ã‚¿æŠ•å…¥ç”¨ã‚­ãƒ¥ãƒ¼
gcloud tasks queues create bigquery-ingestion \
  --location=asia-northeast1 \
  --max-attempts=5 \
  --max-concurrent-dispatches=10 \
  --max-dispatches-per-second=10 \
  --min-backoff=10s \
  --max-backoff=300s

# Dead Letter Queue (DLQ)
gcloud tasks queues create bigquery-dlq \
  --location=asia-northeast1 \
  --max-attempts=1
```

**2. ã‚¿ã‚¹ã‚¯ã‚¨ãƒ³ã‚­ãƒ¥ãƒ¼å®Ÿè£…**:

```typescript
// functions/src/tasks/enqueueBigQueryTask.ts
import { CloudTasksClient } from '@google-cloud/tasks';
import * as admin from 'firebase-admin';

export interface BigQueryTaskPayload {
  sessionId: string;
  userId: string;
  sessionData: any;
  attemptCount?: number;
}

export async function enqueueBigQueryTask(
  payload: BigQueryTaskPayload
): Promise<void> {
  const client = new CloudTasksClient();
  const project = process.env.GOOGLE_CLOUD_PROJECT!;
  const location = 'asia-northeast1';
  const queue = 'bigquery-ingestion';
  
  const parent = client.queuePath(project, location, queue);
  
  const task = {
    httpRequest: {
      httpMethod: 'POST' as const,
      url: `https://asia-northeast1-${project}.cloudfunctions.net/tasks_processBigQueryIngestion`,
      headers: {
        'Content-Type': 'application/json'
      },
      body: Buffer.from(JSON.stringify(payload)).toString('base64')
    }
  };
  
  try {
    const [response] = await client.createTask({ parent, task });
    console.log(`ã‚¿ã‚¹ã‚¯ã‚’ã‚¨ãƒ³ã‚­ãƒ¥ãƒ¼: ${response.name}`);
    
  } catch (error) {
    console.error('ã‚¿ã‚¹ã‚¯ã‚¨ãƒ³ã‚­ãƒ¥ãƒ¼ã‚¨ãƒ©ãƒ¼:', error);
    
    // ã‚¨ãƒ³ã‚­ãƒ¥ãƒ¼å¤±æ•—æ™‚ã¯Firestoreã«ä¿å­˜ã—ã¦ãƒªã‚«ãƒãƒªãƒ¼å¯èƒ½ã«ã™ã‚‹
    await saveToDLQ(payload);
    throw error;
  }
}

async function saveToDLQ(payload: BigQueryTaskPayload): Promise<void> {
  await admin.firestore().collection('bigquery_dlq').add({
    payload,
    enqueuedAt: admin.firestore.FieldValue.serverTimestamp(),
    status: 'pending',
    errorMessage: 'Task enqueue failed'
  });
}
```

**3. BigQuery ãƒ‡ãƒ¼ã‚¿æŠ•å…¥å‡¦ç†**:

```typescript
// functions/src/tasks/processBigQueryIngestion.ts
import { onRequest } from 'firebase-functions/v2/https';
import { BigQuery } from '@google-cloud/bigquery';
import * as admin from 'firebase-admin';
import { Logger } from '../utils/logger';

const logger = new Logger('processBigQueryIngestion');
const bigquery = new BigQuery();

export const tasks_processBigQueryIngestion = onRequest(
  { 
    region: 'asia-northeast1',
    minInstances: 1, // ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆå¯¾ç­–
    maxInstances: 10,
    timeoutSeconds: 60
  },
  async (req, res) => {
    try {
      const payload = req.body as BigQueryTaskPayload;
      
      logger.info('BigQueryãƒ‡ãƒ¼ã‚¿æŠ•å…¥é–‹å§‹', { 
        sessionId: payload.sessionId 
      });
      
      // Firestoreã‹ã‚‰å®Œå…¨ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const sessionDoc = await admin.firestore()
        .collection('users')
        .doc(payload.userId)
        .collection('sessions')
        .doc(payload.sessionId)
        .get();
      
      if (!sessionDoc.exists) {
        throw new Error('ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      }
      
      const sessionData = sessionDoc.data()!;
      
      // ä»®ååŒ–å‡¦ç†
      const anonymizedData = anonymizeSessionData(
        sessionData,
        payload.userId
      );
      
      // BigQueryã«æŠ•å…¥
      await insertIntoBigQuery(anonymizedData);
      
      logger.info('BigQueryãƒ‡ãƒ¼ã‚¿æŠ•å…¥å®Œäº†', { 
        sessionId: payload.sessionId 
      });
      
      res.status(200).json({ success: true });
      
    } catch (error: any) {
      logger.error('BigQueryãƒ‡ãƒ¼ã‚¿æŠ•å…¥ã‚¨ãƒ©ãƒ¼', error, {
        payload: req.body
      });
      
      // ãƒªãƒˆãƒ©ã‚¤å¯èƒ½ãªã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯5xxã‚’è¿”ã™
      if (isRetryableError(error)) {
        res.status(503).json({ 
          success: false, 
          error: 'Service temporarily unavailable',
          retryable: true
        });
      } else {
        // ãƒªãƒˆãƒ©ã‚¤ä¸å¯èƒ½ãªã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯4xxã‚’è¿”ã™
        res.status(400).json({ 
          success: false, 
          error: error.message,
          retryable: false
        });
      }
    }
  }
);

function anonymizeSessionData(data: any, userId: string): any {
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ãƒãƒƒã‚·ãƒ¥åŒ–
  const crypto = require('crypto');
  const anonymousUserId = crypto
    .createHash('sha256')
    .update(userId)
    .digest('hex');
  
  return {
    session_id: data.sessionId,
    anonymous_user_id: anonymousUserId,
    exercise_id: data.exerciseId,
    start_time: data.startTime,
    end_time: data.endTime || null,
    duration_seconds: data.durationSeconds || null,
    rep_count: data.repCount,
    set_count: data.setCount,
    average_score: data.averageScore,
    score_breakdown: data.scoreBreakdown || null,
    device_info: data.deviceInfo || null,
    app_version: data.appVersion || null,
    inserted_at: new Date().toISOString()
  };
}

async function insertIntoBigQuery(data: any): Promise<void> {
  const datasetId = 'training_sessions';
  const tableId = 'sessions';
  
  await bigquery
    .dataset(datasetId)
    .table(tableId)
    .insert([data]);
}

function isRetryableError(error: any): boolean {
  // BigQuery APIã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã«åŸºã¥ã„ã¦ãƒªãƒˆãƒ©ã‚¤å¯å¦ã‚’åˆ¤å®š
  const retryableErrors = [
    'UNAVAILABLE',
    'DEADLINE_EXCEEDED',
    'INTERNAL',
    'RESOURCE_EXHAUSTED'
  ];
  
  return retryableErrors.includes(error.code);
}
```

**4. DLQç›£è¦–ã¨ãƒªã‚«ãƒãƒªãƒ¼**:

```typescript
// functions/src/admin/processDLQ.ts
import { onRequest } from 'firebase-functions/v2/https';
import * as admin from 'firebase-admin';
import { enqueueBigQueryTask } from '../tasks/enqueueBigQueryTask';

export const admin_processDLQ = onRequest(
  { region: 'asia-northeast1' },
  async (req, res) => {
    // ç®¡ç†è€…èªè¨¼ãƒã‚§ãƒƒã‚¯
    // ...
    
    try {
      // DLQã‹ã‚‰å¤±æ•—ã—ãŸã‚¿ã‚¹ã‚¯ã‚’å–å¾—
      const dlqSnapshot = await admin.firestore()
        .collection('bigquery_dlq')
        .where('status', '==', 'pending')
        .limit(100)
        .get();
      
      let successCount = 0;
      let failCount = 0;
      
      for (const doc of dlqSnapshot.docs) {
        const data = doc.data();
        
        try {
          // å†ã‚¨ãƒ³ã‚­ãƒ¥ãƒ¼
          await enqueueBigQueryTask(data.payload);
          
          // DLQã‹ã‚‰å‰Šé™¤
          await doc.ref.update({
            status: 'recovered',
            recoveredAt: admin.firestore.FieldValue.serverTimestamp()
          });
          
          successCount++;
          
        } catch (error) {
          console.error('DLQãƒªã‚«ãƒãƒªãƒ¼ã‚¨ãƒ©ãƒ¼:', error);
          failCount++;
        }
      }
      
      res.json({
        success: true,
        recovered: successCount,
        failed: failCount
      });
      
    } catch (error) {
      res.status(500).json({ 
        success: false, 
        error: 'DLQ processing failed' 
      });
    }
  }
);
```

**æˆæœç‰©**:
- Cloud Tasks ã‚­ãƒ¥ãƒ¼è¨­å®š
- ã‚¿ã‚¹ã‚¯ã‚¨ãƒ³ã‚­ãƒ¥ãƒ¼å®Ÿè£…
- BigQueryæŠ•å…¥å‡¦ç†å®Ÿè£…
- DLQãƒªã‚«ãƒãƒªãƒ¼å®Ÿè£…
- ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ

**æ¤œè¨¼æ–¹æ³•**:
1. æ­£å¸¸æ™‚ã®ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ãŒæˆåŠŸã™ã‚‹ã“ã¨
2. BigQueryéšœå®³æ™‚ã«ãƒªãƒˆãƒ©ã‚¤ãŒå‹•ä½œã™ã‚‹ã“ã¨
3. æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°å¾Œã«DLQã«ç§»å‹•ã™ã‚‹ã“ã¨
4. DLQã‹ã‚‰ã®ãƒªã‚«ãƒãƒªãƒ¼ãŒå‹•ä½œã™ã‚‹ã“ã¨

---

### 2.4 èª²é‡‘ãƒ»ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ (Week 18-20)

#### 2.4.1 RevenueCat çµ±åˆ

**æ‹…å½“**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å + ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å  
**æœŸé–“**: 5æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  
**æ‡¸å¿µç‚¹å¯¾å¿œ**: #7 (èª²é‡‘ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°)

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

**1. RevenueCat ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**:

```typescript
// app/src/services/revenuecat/config.ts
import Purchases from 'react-native-purchases';

export async function setupRevenueCat(userId: string): Promise<void> {
  try {
    // RevenueCatåˆæœŸåŒ–
    await Purchases.configure({
      apiKey: Platform.OS === 'ios' 
        ? process.env.REVENUECAT_IOS_API_KEY!
        : process.env.REVENUECAT_ANDROID_API_KEY!,
      appUserID: userId
    });
    
    console.log('RevenueCatåˆæœŸåŒ–å®Œäº†');
    
  } catch (error) {
    console.error('RevenueCatåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
    throw error;
  }
}

export async function getOfferings(): Promise<PurchasesOfferings> {
  try {
    const offerings = await Purchases.getOfferings();
    return offerings;
    
  } catch (error) {
    console.error('ã‚ªãƒ•ã‚¡ãƒªãƒ³ã‚°å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
    throw error;
  }
}

export async function purchasePackage(
  packageToPurchase: PurchasesPackage
): Promise<PurchaserInfo> {
  try {
    const { purchaserInfo } = await Purchases.purchasePackage(packageToPurchase);
    return purchaserInfo;
    
  } catch (error: any) {
    if (error.userCancelled) {
      throw new Error('USER_CANCELLED');
    }
    
    console.error('è³¼å…¥ã‚¨ãƒ©ãƒ¼:', error);
    throw error;
  }
}
```

**2. èª²é‡‘ç”»é¢å®Ÿè£…**:

```typescript
// app/src/screens/subscription/SubscriptionScreen.tsx
import React, { useEffect, useState } from 'react';
import { View, Text, StyleSheet, Alert, ActivityIndicator } from 'react-native';
import { Button } from '../../components/common/Button';
import { getOfferings, purchasePackage } from '../../services/revenuecat/config';

export const SubscriptionScreen: React.FC = ({ navigation }) => {
  const [offerings, setOfferings] = useState<PurchasesOfferings | null>(null);
  const [loading, setLoading] = useState(true);
  const [purchasing, setPurchasing] = useState(false);
  
  useEffect(() => {
    loadOfferings();
  }, []);
  
  const loadOfferings = async () => {
    try {
      const offerings = await getOfferings();
      setOfferings(offerings);
      
    } catch (error) {
      Alert.alert('ã‚¨ãƒ©ãƒ¼', 'ãƒ—ãƒ©ãƒ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
      
    } finally {
      setLoading(false);
    }
  };
  
  const handlePurchase = async (packageToPurchase: PurchasesPackage) => {
    setPurchasing(true);
    
    try {
      const purchaserInfo = await purchasePackage(packageToPurchase);
      
      // ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æœ‰åŠ¹åŒ–
      if (purchaserInfo.entitlements.active['premium']) {
        Alert.alert(
          'è³¼å…¥å®Œäº†',
          'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™',
          [
            { 
              text: 'OK', 
              onPress: () => navigation.goBack() 
            }
          ]
        );
      }
      
    } catch (error: any) {
      if (error.message === 'USER_CANCELLED') {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ãŸå ´åˆã¯ä½•ã‚‚ã—ãªã„
        return;
      }
      
      Alert.alert(
        'è³¼å…¥ã‚¨ãƒ©ãƒ¼',
        'è³¼å…¥å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚'
      );
      
    } finally {
      setPurchasing(false);
    }
  };
  
  if (loading) {
    return (
      <View style={styles.loadingContainer}>
        <ActivityIndicator size="large" />
      </View>
    );
  }
  
  const currentOffering = offerings?.current;
  
  if (!currentOffering) {
    return (
      <View style={styles.container}>
        <Text>ãƒ—ãƒ©ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</Text>
      </View>
    );
  }
  
  return (
    <View style={styles.container}>
      <Text style={styles.title}>ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³</Text>
      
      <View style={styles.featuresContainer}>
        <Text style={styles.feature}>âœ“ ç„¡åˆ¶é™ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</Text>
        <Text style={styles.feature}>âœ“ è©³ç´°ãªåˆ†æãƒ¬ãƒãƒ¼ãƒˆ</Text>
        <Text style={styles.feature}>âœ“ ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ—ãƒ©ãƒ³</Text>
        <Text style={styles.feature}>âœ“ åºƒå‘Šãªã—</Text>
      </View>
      
      {currentOffering.monthly && (
        <View style={styles.packageCard}>
          <Text style={styles.packageTitle}>æœˆé¡ãƒ—ãƒ©ãƒ³</Text>
          <Text style={styles.packagePrice}>
            {currentOffering.monthly.product.priceString}/æœˆ
          </Text>
          <Button
            title="è³¼å…¥ã™ã‚‹"
            onPress={() => handlePurchase(currentOffering.monthly!)}
            loading={purchasing}
            fullWidth
          />
        </View>
      )}
      
      <Button
        title="å¾Œã§"
        onPress={() => navigation.goBack()}
        variant="secondary"
        disabled={purchasing}
        fullWidth
      />
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    padding: 24,
    backgroundColor: '#FFF'
  },
  loadingContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center'
  },
  title: {
    fontSize: 28,
    fontWeight: 'bold',
    marginBottom: 24,
    textAlign: 'center'
  },
  featuresContainer: {
    marginBottom: 32
  },
  feature: {
    fontSize: 16,
    marginBottom: 12,
    color: '#333'
  },
  packageCard: {
    backgroundColor: '#F2F2F7',
    padding: 24,
    borderRadius: 12,
    marginBottom: 16
  },
  packageTitle: {
    fontSize: 20,
    fontWeight: '600',
    marginBottom: 8
  },
  packagePrice: {
    fontSize: 32,
    fontWeight: 'bold',
    color: '#007AFF',
    marginBottom: 16
  }
});
```

**3. Webhookå‡¦ç†å®Ÿè£…**:

```typescript
// functions/src/webhooks/revenuecatWebhook.ts
import { onRequest } from 'firebase-functions/v2/https';
import * as admin from 'firebase-admin';
import { Logger } from '../utils/logger';

const logger = new Logger('revenuecatWebhook');

export const webhooks_revenuecat = onRequest(
  { region: 'asia-northeast1' },
  async (req, res) => {
    try {
      // RevenueCatã‹ã‚‰ã®Webhookç½²åæ¤œè¨¼
      const signature = req.headers['x-revenuecat-signature'];
      if (!verifyWebhookSignature(signature, req.body)) {
        res.status(401).json({ error: 'Invalid signature' });
        return;
      }
      
      const event = req.body;
      logger.info('RevenueCat Webhookå—ä¿¡', { type: event.type });
      
      switch (event.type) {
        case 'INITIAL_PURCHASE':
          await handleInitialPurchase(event);
          break;
          
        case 'RENEWAL':
          await handleRenewal(event);
          break;
          
        case 'CANCELLATION':
          await handleCancellation(event);
          break;
          
        case 'BILLING_ISSUE':
          await handleBillingIssue(event);
          break;
          
        default:
          logger.warning('æœªå¯¾å¿œã®ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—', { type: event.type });
      }
      
      res.status(200).json({ success: true });
      
    } catch (error) {
      logger.error('Webhookå‡¦ç†ã‚¨ãƒ©ãƒ¼', error);
      res.status(500).json({ error: 'Internal server error' });
    }
  }
);

async function handleInitialPurchase(event: any): Promise<void> {
  const userId = event.app_user_id;
  const productId = event.product_id;
  
  await admin.firestore().collection('users').doc(userId).update({
    subscriptionStatus: 'active',
    subscriptionPlan: productId,
    subscriptionStartedAt: admin.firestore.FieldValue.serverTimestamp(),
    updatedAt: admin.firestore.FieldValue.serverTimestamp()
  });
  
  logger.info('ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³é–‹å§‹', { userId, productId });
}

async function handleRenewal(event: any): Promise<void> {
  const userId = event.app_user_id;
  
  await admin.firestore().collection('users').doc(userId).update({
    subscriptionRenewedAt: admin.firestore.FieldValue.serverTimestamp(),
    updatedAt: admin.firestore.FieldValue.serverTimestamp()
  });
  
  logger.info('ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ›´æ–°', { userId });
}

async function handleCancellation(event: any): Promise<void> {
  const userId = event.app_user_id;
  
  await admin.firestore().collection('users').doc(userId).update({
    subscriptionStatus: 'cancelled',
    subscriptionCancelledAt: admin.firestore.FieldValue.serverTimestamp(),
    updatedAt: admin.firestore.FieldValue.serverTimestamp()
  });
  
  logger.info('ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚­ãƒ£ãƒ³ã‚»ãƒ«', { userId });
}

async function handleBillingIssue(event: any): Promise<void> {
  const userId = event.app_user_id;
  
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥
  await admin.firestore().collection('users').doc(userId).update({
    subscriptionStatus: 'billing_issue',
    billingIssueDetectedAt: admin.firestore.FieldValue.serverTimestamp(),
    updatedAt: admin.firestore.FieldValue.serverTimestamp()
  });
  
  // ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚’é€ä¿¡ (TODO)
  
  logger.warning('æ±ºæ¸ˆå•é¡Œæ¤œå‡º', { userId });
}

function verifyWebhookSignature(signature: any, body: any): boolean {
  // RevenueCat Webhookç½²åæ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯
  // å®Ÿè£…ã¯ RevenueCat ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§
  return true; // ç°¡ç•¥åŒ–ã®ãŸã‚å¸¸ã«true
}
```

**æˆæœç‰©**:
- RevenueCatçµ±åˆå®Ÿè£…
- èª²é‡‘ç”»é¢å®Ÿè£…
- Webhookå‡¦ç†å®Ÿè£…
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…
- è³¼å…¥ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ

**æ¤œè¨¼æ–¹æ³•**:
1. ãƒ†ã‚¹ãƒˆè³¼å…¥ãŒæ­£å¸¸ã«å®Œäº†ã™ã‚‹ã“ã¨
2. ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹ãŒæ­£ã—ãæ›´æ–°ã•ã‚Œã‚‹ã“ã¨
3. WebhookãŒæ­£ã—ãå‡¦ç†ã•ã‚Œã‚‹ã“ã¨
4. ã‚¨ãƒ©ãƒ¼æ™‚ã®å‹•ä½œç¢ºèª

---

### 2.5 çµ±åˆãƒ†ã‚¹ãƒˆã¨QA (Week 21-26)

#### 2.5.1 E2Eãƒ†ã‚¹ãƒˆå®Ÿè£…

**æ‹…å½“**: QAã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å + å…¨ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢  
**æœŸé–“**: 15æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:

**1. èªè¨¼ãƒ•ãƒ­ãƒ¼**:
- [ ] æ–°è¦ç™»éŒ² (ãƒ¡ãƒ¼ãƒ«)
- [ ] æ–°è¦ç™»éŒ² (é›»è©±ç•ªå·)
- [ ] ãƒ­ã‚°ã‚¤ãƒ³ (ãƒ¡ãƒ¼ãƒ«)
- [ ] ãƒ­ã‚°ã‚¤ãƒ³ (é›»è©±ç•ªå·)
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ
- [ ] åˆ©ç”¨è¦ç´„åŒæ„
- [ ] åŒæ„æ’¤å›ã¨ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ

**2. ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ•ãƒ­ãƒ¼**:
- [ ] ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠ
- [ ] ã‚«ãƒ¡ãƒ©ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å®Ÿè¡Œ (å„ç¨®ç›®)
- [ ] ãƒ•ã‚©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜
- [ ] çµæœè¡¨ç¤º

**3. å±¥æ­´ãƒ»åˆ†æ**:
- [ ] å±¥æ­´ä¸€è¦§è¡¨ç¤º
- [ ] ã‚°ãƒ©ãƒ•è¡¨ç¤º
- [ ] çµ±è¨ˆæƒ…å ±è¡¨ç¤º
- [ ] ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**4. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»è¨­å®š**:
- [ ] ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†
- [ ] è¨­å®šå¤‰æ›´
- [ ] åŒæ„çŠ¶æ…‹ç¢ºèª
- [ ] ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

**5. èª²é‡‘**:
- [ ] ãƒ—ãƒ©ãƒ³è¡¨ç¤º
- [ ] è³¼å…¥ãƒ•ãƒ­ãƒ¼
- [ ] ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†
- [ ] ã‚­ãƒ£ãƒ³ã‚»ãƒ«

**6. GDPRå¯¾å¿œ**:
- [ ] ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- [ ] ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- [ ] å‰Šé™¤çŒ¶äºˆæœŸé–“ã®å‹•ä½œ
- [ ] ãƒ‡ãƒ¼ã‚¿ä¾µå®³é€šçŸ¥ (ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)

**ãƒ†ã‚¹ãƒˆç’°å¢ƒ**:
- iOS: iPhone XR, iPhone 13 Pro
- Android: Pixel 5, Galaxy S21

**æˆæœç‰©**:
- E2Eãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ
- ãƒã‚°ãƒ¬ãƒãƒ¼ãƒˆ
- ä¿®æ­£è¨ˆç”»

---

#### 2.5.2 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

**æ‹…å½“**: QAã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1å  
**æœŸé–“**: 5æ—¥  
**å„ªå…ˆåº¦**: ğŸŸ¡ é«˜  
**æ‡¸å¿µç‚¹å¯¾å¿œ**: #3 (MediaPipeãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹), #13 (ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆ)

**ãƒ†ã‚¹ãƒˆé …ç›®**:

**1. MediaPipe ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**:
- [ ] 30fpsç¶­æŒ (é«˜æ€§èƒ½ç«¯æœ«)
- [ ] 20fpsä»¥ä¸Š (ä¸­æ€§èƒ½ç«¯æœ«)
- [ ] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œ (ä½æ€§èƒ½ç«¯æœ«)
- [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡

**2. API ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“**:
- [ ] èªè¨¼API: <200ms (p95)
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜API: <300ms (p95)
- [ ] ãƒ‡ãƒ¼ã‚¿å–å¾—API: <200ms (p95)

**3. Cloud Functions ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆ**:
- [ ] æœ€å°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹è¨­å®šã®åŠ¹æœæ¸¬å®š
- [ ] ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆæ™‚é–“: <1s

**4. BigQuery ã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**:
- [ ] é›†è¨ˆã‚¯ã‚¨ãƒª: <5s
- [ ] ãƒ‡ãƒ¼ã‚¿æŠ•å…¥: 99.9%æˆåŠŸç‡

**æˆæœç‰©**:
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ
- ãƒœãƒˆãƒ«ãƒãƒƒã‚¯åˆ†æ
- æœ€é©åŒ–ææ¡ˆ

---

### 2.6 ã‚¹ãƒˆã‚¢å¯©æŸ»æº–å‚™ (Week 26-28)

#### 2.6.1 App Store å¯©æŸ»æº–å‚™

**æ‹…å½“**: å…¨ãƒãƒ¼ãƒ   
**æœŸé–“**: 5æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  
**æ‡¸å¿µç‚¹å¯¾å¿œ**: #12 (è–¬æ©Ÿæ³•è¡¨ç¾ãƒã‚§ãƒƒã‚¯)

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

**1. ã‚¢ãƒ—ãƒªæƒ…å ±æº–å‚™**:
- ã‚¢ãƒ—ãƒªå: "AIãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ã‚³ãƒ¼ãƒ" (ä»®)
- ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«: "AIãŒãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒã‚§ãƒƒã‚¯"
- ã‚«ãƒ†ã‚´ãƒª: ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢/ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹
- å¹´é½¢åˆ¶é™: 4+ (å…¨å¹´é½¢)

**2. ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæº–å‚™**:
- iPhone 6.7ã‚¤ãƒ³ãƒ (5æš)
- iPhone 6.5ã‚¤ãƒ³ãƒ (5æš)
- iPhone 5.5ã‚¤ãƒ³ãƒ (5æš)
- iPad Pro 12.9ã‚¤ãƒ³ãƒ (5æš)

**3. ã‚¢ãƒ—ãƒªèª¬æ˜æ–‡**:

```
ã€çµ¶å¯¾ã«é¿ã‘ã‚‹ã¹ãè¡¨ç¾ã€‘
âŒ "æ€ªæˆ‘ã‚’é˜²ã"
âŒ "å¥åº·åŠ¹æœã‚’ä¿è¨¼"
âŒ "åŒ»å­¦çš„ã«è¨¼æ˜ã•ã‚ŒãŸ"
âŒ "ç—…æ°—ã®äºˆé˜²"
âŒ "æ²»ç™‚åŠ¹æœ"

ã€æ¨å¥¨è¡¨ç¾ã€‘
âœ… "æ­£ã—ã„ãƒ•ã‚©ãƒ¼ãƒ ã®å‚è€ƒæƒ…å ±ã‚’æä¾›"
âœ… "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ã‚’ã‚µãƒãƒ¼ãƒˆ"
âœ… "ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ã®è£œåŠ©ãƒ„ãƒ¼ãƒ«"
âœ… "ã‚ãã¾ã§å‚è€ƒæƒ…å ±ã§ã™"
âœ… "å°‚é–€å®¶ã¸ã®ç›¸è«‡ã‚’æ¨å¥¨ã—ã¾ã™"
```

**èª¬æ˜æ–‡ä¾‹**:

```
AIãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ã‚³ãƒ¼ãƒ - ã‚ãªãŸã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’ã‚µãƒãƒ¼ãƒˆ

ã€ç‰¹å¾´ã€‘
ãƒ»AIãŒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ•ã‚©ãƒ¼ãƒ ã®å‚è€ƒæƒ…å ±ã‚’æä¾›
ãƒ»ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®ã‚«ãƒ¡ãƒ©ã ã‘ã§åˆ©ç”¨å¯èƒ½
ãƒ»5ç¨®é¡ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç¨®ç›®ã«å¯¾å¿œ
ãƒ»è¨˜éŒ²ã‚’è‡ªå‹•ä¿å­˜ã—ã¦æˆé•·ã‚’å¯è¦–åŒ–

ã€é‡è¦ãªæ³¨æ„äº‹é …ã€‘
æœ¬ã‚¢ãƒ—ãƒªã¯åŒ»ç™‚æ©Ÿå™¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æä¾›ã•ã‚Œã‚‹æƒ…å ±ã¯ã‚ãã¾ã§å‚è€ƒã§ã‚ã‚Šã€
æ€ªæˆ‘ã®é˜²æ­¢ã‚„å¥åº·åŠ¹æœã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é–‹å§‹å‰ã«ã¯å°‚é–€å®¶ã«ã”ç›¸è«‡ãã ã•ã„ã€‚

ã€å¯¾å¿œç¨®ç›®ã€‘
ãƒ»ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ
ãƒ»è…•ç«‹ã¦ä¼ã›
ãƒ»ãƒ—ãƒ©ãƒ³ã‚¯
ãƒ»ãƒ©ãƒ³ã‚¸
ãƒ»ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ

ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã€‘
ãƒ»ã‚«ãƒ¡ãƒ©æ˜ åƒã¯ç«¯æœ«å†…ã®ã¿ã§å‡¦ç†
ãƒ»å€‹äººã‚’ç‰¹å®šã§ãã‚‹å½¢ã§ã®ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãªã—
ãƒ»GDPRå®Œå…¨æº–æ‹ 
```

**4. ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æƒ…å ±**:
- åé›†ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®è©³ç´°èª¬æ˜
- ãƒ‡ãƒ¼ã‚¿ã®ä½¿ç”¨ç›®çš„
- ç¬¬ä¸‰è€…ã¸ã®æä¾›æœ‰ç„¡
- GDPRå¯¾å¿œã®èª¬æ˜

**5. å¯©æŸ»ãƒãƒ¼ãƒˆ**:
```
ã€ãƒ†ã‚¹ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€‘
Email: test@example.com
Password: TestPassword123

ã€ãƒ†ã‚¹ãƒˆæ‰‹é †ã€‘
1. ãƒ­ã‚°ã‚¤ãƒ³
2. ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œã‚¹ã‚¯ãƒ¯ãƒƒãƒˆã€ã‚’é¸æŠ
3. ã‚«ãƒ¡ãƒ©ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§æŒ‡ç¤ºã«å¾“ã†
4. ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’å®Ÿè¡Œ
5. çµæœç”»é¢ã‚’ç¢ºèª

ã€ç‰¹è¨˜äº‹é …ã€‘
ãƒ»ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã§ã™
ãƒ»å®Ÿéš›ã«ä½“ã‚’å‹•ã‹ã—ã¦ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„
ãƒ»æœ¬ã‚¢ãƒ—ãƒªã¯åŒ»ç™‚æ©Ÿå™¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“
```

**æˆæœç‰©**:
- App Store Connect ç™»éŒ²å®Œäº†
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä¸€å¼
- ã‚¢ãƒ—ãƒªèª¬æ˜æ–‡
- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æƒ…å ±
- å¯©æŸ»ãƒãƒ¼ãƒˆ

---

#### 2.6.2 Google Play å¯©æŸ»æº–å‚™

**æ‹…å½“**: å…¨ãƒãƒ¼ãƒ   
**æœŸé–“**: 5æ—¥  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  

**ã‚¿ã‚¹ã‚¯å†…å®¹**:

**1. ã‚¹ãƒˆã‚¢ãƒªã‚¹ãƒ†ã‚£ãƒ³ã‚°**:
- åŒæ§˜ã®è–¬æ©Ÿæ³•å¯¾å¿œ
- Androidã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæº–å‚™
- Feature Graphic ä½œæˆ

**2. ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ¼ãƒ•ãƒ†ã‚£ã‚»ã‚¯ã‚·ãƒ§ãƒ³**:
- åé›†ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®è©³ç´°
- ãƒ‡ãƒ¼ã‚¿ã®ä½¿ç”¨æ–¹æ³•
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

**æˆæœç‰©**:
- Google Play Console ç™»éŒ²å®Œäº†
- ã‚¹ãƒˆã‚¢ãƒªã‚¹ãƒ†ã‚£ãƒ³ã‚°å®Œæˆ
- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ¼ãƒ•ãƒ†ã‚£æƒ…å ±

---

## ğŸ“Š Phase 2 å®Œäº†åŸºæº–

| é …ç›® | åŸºæº– | æ¸¬å®šæ–¹æ³• |
|------|------|---------|
| **æ©Ÿèƒ½å®Œæˆåº¦** | 100% | è¦ä»¶å®šç¾©æ›¸ã®å…¨æ©Ÿèƒ½å®Ÿè£… |
| **E2Eãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸** | 100% | å…¨ã‚·ãƒŠãƒªã‚ªPass |
| **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹** | NFRæº–æ‹  | è¨ˆæ¸¬çµæœ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** | è„†å¼±æ€§ãªã— | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ» |
| **GDPRå¯¾å¿œ** | å®Œå…¨æº–æ‹  | ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ |
| **ã‚¹ãƒˆã‚¢å¯©æŸ»** | æå‡ºå¯èƒ½ | ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº† |

---

## ğŸ¯ ãƒªãƒªãƒ¼ã‚¹è¨ˆç”»

### ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰ãƒ™ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ (Week 27)

**æœŸé–“**: 1é€±é–“  
**å¯¾è±¡**: ç¤¾å†…ãƒ¡ãƒ³ãƒãƒ¼ + å”åŠ›è€… 20å  

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
1. å…¨æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª
2. å®Ÿéš›ã®ä½¿ç”¨æ„Ÿãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
3. ãƒã‚°å ±å‘Š
4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š

### ã‚¹ãƒˆã‚¢å¯©æŸ»æå‡º (Week 28)

**æå‡ºæ—¥**: Phase 2 å®Œäº†ç›´å¾Œ  
**å¯©æŸ»æœŸé–“è¦‹è¾¼ã¿**: 
- App Store: 1-2é€±é–“
- Google Play: 3-7æ—¥

### ä¸€èˆ¬å…¬é–‹ (Week 30)

**å…¬é–‹æ™‚æœŸ**: å¯©æŸ»æ‰¿èªå¾Œå³åº§  
**ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°**: Phase 3ã§å®Ÿæ–½

---

## ğŸ“‹ ãƒªã‚¹ã‚¯ç®¡ç†

### é«˜ãƒªã‚¹ã‚¯é …ç›®

| ãƒªã‚¹ã‚¯ | å½±éŸ¿åº¦ | å¯¾ç­– | æ‹…å½“ |
|--------|--------|------|------|
| **ã‚¹ãƒˆã‚¢å¯©æŸ»å´ä¸‹** | é«˜ | è–¬æ©Ÿæ³•è¡¨ç¾ã®å³æ ¼ãƒã‚§ãƒƒã‚¯ | PM+æ³•å‹™ |
| **MediaPipeæ€§èƒ½ä¸è¶³** | ä¸­ | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…æ¸ˆã¿ | FE |
| **BigQueryéšœå®³** | ä¸­ | ãƒªãƒˆãƒ©ã‚¤ã‚­ãƒ¥ãƒ¼å®Ÿè£…æ¸ˆã¿ | BE |
| **èª²é‡‘ã‚¨ãƒ©ãƒ¼** | ä¸­ | ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…æ¸ˆã¿ | BE |
| **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«é…å»¶** | é«˜ | ãƒãƒƒãƒ•ã‚¡æœŸé–“ç¢ºä¿ | PM |

---

## ğŸ“š ç´å“ç‰©ä¸€è¦§

### Phase 1 ç´å“ç‰©
- [x] Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- [x] Firestore ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«
- [x] èªè¨¼API
- [x] åŒæ„ç®¡ç†API
- [x] CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
- [x] ç›£è¦–åŸºç›¤

### Phase 2 ç´å“ç‰©
- [x] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒª (iOS/Android)
- [x] å…¨APIå®Ÿè£…
- [x] MediaPipeçµ±åˆ
- [x] BigQueryãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
- [x] èª²é‡‘æ©Ÿèƒ½
- [x] ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
- [x] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€å¼

---

## ğŸ“ Phase 3 (å°†æ¥) è¨ˆç”»æ¦‚è¦

### Phase 3 äºˆå®šæ©Ÿèƒ½ (å‚è€ƒ)

**æœŸé–“**: 3ãƒ¶æœˆä»¥ä¸Š (Phase 2å®Œäº†å¾Œ)

**å„ªå…ˆåº¦ä½ã®æ‡¸å¿µç‚¹å¯¾å¿œ**:
- #14: ç„¡æ–™ãƒ—ãƒ©ãƒ³åˆ¶é™å®Ÿè£…
- #15: å¤šè¨€èªå¯¾å¿œ (è‹±èª)
- #16: DRå®Œå…¨å®Ÿè£…
- #17: ã‚½ãƒ¼ã‚·ãƒ£ãƒ«æ©Ÿèƒ½
- #18: ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ (WCAG 2.1 AA)

**è¿½åŠ æ©Ÿèƒ½**:
- ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ—ãƒ©ãƒ³
- AIãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚º
- ã‚½ãƒ¼ã‚·ãƒ£ãƒ«æ©Ÿèƒ½
- ã‚¦ã‚§ã‚¢ãƒ©ãƒ–ãƒ«é€£æº
- å®Œå…¨ãªDR/BCPãƒ—ãƒ©ãƒ³

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆä½“åˆ¶

### é–‹ç™ºæœŸé–“ä¸­

**å®šä¾‹ä¼šè­°**:
- æ¯æ—¥: ãƒ‡ã‚¤ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒƒãƒ— (15åˆ†)
- æ¯é€±: é€²æ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ (1æ™‚é–“)
- éš”é€±: ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼å ±å‘Š (1æ™‚é–“)

**ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³**:
- Slack: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- GitHub: ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼
- Notion: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç®¡ç†

### ãƒªãƒªãƒ¼ã‚¹å¾Œ

**ã‚µãƒãƒ¼ãƒˆä½“åˆ¶**:
- å¹³æ—¥ 9:00-18:00: å…¨ãƒãƒ¼ãƒ å¯¾å¿œ
- ç·Šæ€¥æ™‚: ã‚ªãƒ³ã‚³ãƒ¼ãƒ«ä½“åˆ¶

**å•ã„åˆã‚ã›çª“å£**:
- ã‚¢ãƒ—ãƒªå†…: ã‚µãƒãƒ¼ãƒˆãƒãƒ£ãƒƒãƒˆ
- ãƒ¡ãƒ¼ãƒ«: support@example.com

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1 å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆå®Œäº†
- [ ] Firestore ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«å®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] Firebase Authentication è¨­å®šå®Œäº†
- [ ] åŸºæœ¬APIå®Ÿè£…å®Œäº†
- [ ] CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰å®Œäº†
- [ ] ç›£è¦–åŸºç›¤æ§‹ç¯‰å®Œäº†
- [ ] Phase 1 çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] Phase 1 ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†

### Phase 2 å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] å…¨ç”»é¢å®Ÿè£…å®Œäº†
- [ ] MediaPipeçµ±åˆå®Œäº†
- [ ] ãƒ•ã‚©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯å®Ÿè£…å®Œäº†
- [ ] BigQueryãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰å®Œäº†
- [ ] èª²é‡‘æ©Ÿèƒ½å®Ÿè£…å®Œäº†
- [ ] å±¥æ­´ãƒ»åˆ†ææ©Ÿèƒ½å®Ÿè£…å®Œäº†
- [ ] E2Eãƒ†ã‚¹ãƒˆå®Œäº† (100%Pass)
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»å®Œäº†
- [ ] ã‚¹ãƒˆã‚¢å¯©æŸ»æº–å‚™å®Œäº†
- [ ] Phase 2 ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†
- [ ] ãƒ™ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] ã‚¹ãƒˆã‚¢å¯©æŸ»æå‡º

---

## ğŸ“ å¤‰æ›´ç®¡ç†

### å¤‰æ›´ç®¡ç†ãƒ—ãƒ­ã‚»ã‚¹

**å°è¦æ¨¡å¤‰æ›´** (1æ—¥ä»¥å†…):
1. ãƒãƒ¼ãƒ å†…ã§è­°è«–
2. å®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆ
3. ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼
4. ãƒãƒ¼ã‚¸

**ä¸­è¦æ¨¡å¤‰æ›´** (1é€±é–“ä»¥å†…):
1. ææ¡ˆæ›¸ä½œæˆ
2. ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¼šè­°
3. æ‰¿èªå¾Œå®Ÿè£…
4. ãƒ†ã‚¹ãƒˆãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼
5. ãƒãƒ¼ã‚¸

**å¤§è¦æ¨¡å¤‰æ›´** (1é€±é–“ä»¥ä¸Š):
1. è©³ç´°è¨­è¨ˆæ›¸ä½œæˆ
2. ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼æ‰¿èª
3. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«èª¿æ•´
4. å®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆ
5. ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»æ‰¿èª
6. ãƒªãƒªãƒ¼ã‚¹

---

## ğŸ‰ ã¾ã¨ã‚

æœ¬é–‹ç™ºã‚¿ã‚¹ã‚¯è©³ç´°+ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«v3.3ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‡¸å¿µç‚¹åˆ†æv1.0ã§ç‰¹å®šã•ã‚ŒãŸ18ã®æ‡¸å¿µç‚¹ã™ã¹ã¦ã«å¯¾å¿œã—ã€7ãƒ¶æœˆã®ç¾å®Ÿçš„ãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã§MVPã‚’å®Œæˆã•ã›ã‚‹è¨ˆç”»ã§ã™ã€‚

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ**:
1. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: Phase 1ã§Firestoreã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’å®Œå…¨å®Ÿè£…
2. **GDPRå®Œå…¨æº–æ‹ **: å‰Šé™¤çŒ¶äºˆæœŸé–“ã€åŒæ„ç®¡ç†ã€ãƒ‡ãƒ¼ã‚¿ä¿è­·ã‚’å®Ÿè£…
3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å¯¾ç­–**: MediaPipeãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€Cloud Tasksãƒªãƒˆãƒ©ã‚¤
4. **å“è³ªä¿è¨¼**: E2Eãƒ†ã‚¹ãƒˆã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
5. **ãƒªã‚¹ã‚¯ç®¡ç†**: é«˜ãƒªã‚¹ã‚¯é …ç›®ã¸ã®å¯¾ç­–å®Ÿè£…æ¸ˆã¿

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**:
1. Phase 1é–‹å§‹æº–å‚™
2. ãƒãƒ¼ãƒ ã‚­ãƒƒã‚¯ã‚ªãƒ•ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°
3. é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
4. é€±æ¬¡é€²æ—å ±å‘Šé–‹å§‹

---

**Document Version**: v3.3  
**Last Updated**: 2025å¹´11æœˆ24æ—¥  
**Author**: Project Team  
**Status**: Draft  
**Approved by**: (æ‰¿èªå¾…ã¡)

---

**ä»¥ä¸Š**
