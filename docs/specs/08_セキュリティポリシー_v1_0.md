# セキュリティポリシー v1.0

**プロジェクト名**: AIフィットネスアプリ(仮称)  
**バージョン**: 1.0  
**作成日**: 2025年11月22日  
**最終更新日**: 2025年11月22日  
**適用範囲**: 全システム、全従業員、全協力業者  
**承認状態**: 承認待ち

---

## 📋 目次

1. [概要](#1-概要)
2. [セキュリティ組織体制](#2-セキュリティ組織体制)
3. [情報資産管理](#3-情報資産管理)
4. [アクセス制御](#4-アクセス制御)
5. [認証・認可](#5-認証認可)
6. [暗号化](#6-暗号化)
7. [ネットワークセキュリティ](#7-ネットワークセキュリティ)
8. [アプリケーションセキュリティ](#8-アプリケーションセキュリティ)
9. [データ保護](#9-データ保護)
10. [バックアップと災害復旧](#10-バックアップと災害復旧)
11. [監視とログ管理](#11-監視とログ管理)
12. [インシデント対応](#12-インシデント対応)
13. [脆弱性管理](#13-脆弱性管理)
14. [セキュリティ教育](#14-セキュリティ教育)
15. [監査とコンプライアンス](#15-監査とコンプライアンス)
16. [サードパーティ管理](#16-サードパーティ管理)
17. [物理的セキュリティ](#17-物理的セキュリティ)
18. [セキュリティポリシーの管理](#18-セキュリティポリシーの管理)

---

## 1. 概要

### 1.1 目的

本セキュリティポリシーは、AIフィットネスアプリにおける情報資産を適切に保護し、利用者のプライバシーとデータセキュリティを確保することを目的とします。

### 1.2 適用範囲

**対象者**:
- 全従業員
- 全協力業者(開発パートナー、保守業者等)
- 役員
- インターン・派遣社員

**対象システム**:
- モバイルアプリケーション(iOS/Android)
- バックエンドシステム(Firebase、GCP)
- 管理システム
- 開発環境
- 本番環境
- テスト環境

### 1.3 基本方針

本プロジェクトは、以下の基本方針に基づきセキュリティを確保します:

1. **プライバシーバイデザイン**: 設計段階からプライバシー保護を組み込む
2. **データ最小化**: 必要最小限のデータのみを収集・保存
3. **多層防御**: 複数のセキュリティ層で防御
4. **継続的改善**: 定期的な見直しと改善
5. **透明性**: 利用者への明確な情報提供
6. **説明責任**: セキュリティ対策の実施記録と証明

### 1.4 参照ドキュメント

| ドキュメント | バージョン | 関連箇所 |
|------------|----------|---------|
| **要件定義書** | v3.1 | 第4章(非機能要件) |
| **利用規約** | v3.1 | 第7条(利用者の責任)、第8条(禁止事項) |
| **プライバシーポリシー** | v3.1 | 第8条(セキュリティ対策) |
| **システムアーキテクチャ設計書** | v3.1 | 第8章(セキュリティアーキテクチャ) |
| **Firestoreデータベース設計書** | v3.1 | 第5章(Security Rules) |
| **BigQuery設計書** | v3.1 | 第5章(セキュリティ設計) |
| **API設計書** | v3.1 | 第3章(認証・認可) |
| **データ処理記録(ROPA)** | v1.0 | 第8章(技術的・組織的セキュリティ対策) |

### 1.5 法的要件

本セキュリティポリシーは、以下の法令・規制に準拠します:

| 法令・規制 | 適用条項 | 準拠内容 |
|----------|---------|---------|
| **GDPR** | 第25条、第32条 | プライバシーバイデザイン、セキュリティ対策 |
| **個人情報保護法** | 第23条 | 安全管理措置 |
| **薬機法** | 第2条 | 医療機器に該当しない旨の明確化 |
| **不正アクセス禁止法** | - | アクセス制御の実施 |

---

## 2. セキュリティ組織体制

### 2.1 役割と責任

#### 2.1.1 組織構造

```
最高責任者(CEO/CTO)
    │
    ├── データ保護責任者(DPO)
    │   ├── プライバシー担当
    │   └── GDPR対応担当
    │
    ├── セキュリティ責任者(CISO)
    │   ├── セキュリティエンジニア
    │   ├── インシデント対応チーム
    │   └── 脆弱性管理担当
    │
    ├── 技術責任者
    │   ├── インフラ担当者
    │   ├── バックエンドエンジニア
    │   ├── フロントエンドエンジニア
    │   └── QAエンジニア
    │
    └── 法務・コンプライアンス責任者
        ├── 法務担当者
        └── 監査担当者
```

#### 2.1.2 責任者の役割

| 役職 | 責任 | 権限 |
|-----|------|------|
| **最高責任者** | セキュリティポリシーの承認・全体統括 | 最終決定権 |
| **DPO** | プライバシー保護・GDPR対応 | プライバシー関連の決定権 |
| **CISO** | セキュリティ対策の計画・実施・監視 | セキュリティ対策の決定権 |
| **技術責任者** | システムのセキュリティ実装 | 技術的実装の決定権 |
| **法務責任者** | 法的要件の確認・監査 | コンプライアンス判断権 |

#### 2.1.3 セキュリティ委員会

**構成**:
- 最高責任者
- DPO
- CISO
- 技術責任者
- 法務責任者

**開催頻度**: 四半期ごと

**議題**:
- セキュリティインシデントのレビュー
- セキュリティポリシーの見直し
- 脆弱性対応状況の確認
- セキュリティ予算の承認

### 2.2 権限委譲

#### 2.2.1 権限マトリクス

| 操作 | 開発者 | QA | 技術責任者 | CISO | 最高責任者 |
|-----|-------|----|-----------|----|----------|
| **コード変更** | ✅ | ❌ | ✅ | ❌ | ❌ |
| **本番デプロイ承認** | ❌ | ❌ | ✅ | ✅ | ✅ |
| **ユーザーデータアクセス** | ❌ | ❌ | ✅ | ✅ | ✅ |
| **セキュリティ設定変更** | ❌ | ❌ | ✅ | ✅ | ✅ |
| **インシデント対応** | ❌ | ❌ | ✅ | ✅ | ✅ |
| **ポリシー変更** | ❌ | ❌ | ❌ | ✅ | ✅ |

---

## 3. 情報資産管理

### 3.1 情報資産の分類

#### 3.1.1 機密度レベル

| レベル | 定義 | 例 |
|-------|------|---|
| **レベル1(最高機密)** | 漏洩により重大な影響 | 暗号鍵、認証情報 |
| **レベル2(機密)** | 漏洩により大きな影響 | 個人情報、トレーニングデータ |
| **レベル3(社外秘)** | 漏洩により一定の影響 | システム設計書、ソースコード |
| **レベル4(公開)** | 漏洩による影響なし | 利用規約、マニュアル |

#### 3.1.2 取扱規則

| レベル | 保存場所 | アクセス制限 | 暗号化 | 削除方法 |
|-------|---------|------------|--------|---------|
| **レベル1** | Secret Manager、KMS | 最小権限 | 必須 | 完全削除 |
| **レベル2** | Firestore、BigQuery | ロールベース | 必須 | GDPR準拠削除 |
| **レベル3** | GitHub、Cloud Storage | 認証必須 | 推奨 | 通常削除 |
| **レベル4** | 公開サーバー | 制限なし | 不要 | 通常削除 |

### 3.2 データライフサイクル管理

#### 3.2.1 データ保持期間

| データカテゴリー | 保持期間 | 削除方法 | 根拠 |
|---------------|---------|---------|------|
| **アカウント情報** | アカウント削除まで | GDPR準拠削除 | 利用規約第14条 |
| **トレーニングデータ** | アカウント削除まで | GDPR準拠削除 | プライバシーポリシー第10.1条 |
| **骨格座標データ** | 90日間 | 自動削除 | プライバシーポリシー第10.1条 |
| **セッションメタデータ** | 2年間 | 自動削除 | プライバシーポリシー第10.1条 |
| **課金情報** | 7年間 | 法的保存後削除 | 税法 |
| **監査ログ** | 1年間 | 自動削除 | 要件定義書NFR-017 |

#### 3.2.2 自動削除の実装

| データ | 実装方法 | 実行頻度 |
|-------|---------|---------|
| **骨格座標データ** | Cloud Scheduler + Cloud Functions | 日次 |
| **古いセッションデータ** | BigQueryパーティション削除 | 月次 |
| **一時ファイル** | Cloud Storageライフサイクルポリシー | 自動 |
| **古いログ** | Cloud Loggingの保持期間設定 | 自動 |

---

## 4. アクセス制御

### 4.1 アクセス制御の原則

#### 4.1.1 基本原則

1. **最小権限の原則**: 業務に必要な最小限の権限のみ付与
2. **職務分離**: 重要な操作は複数人の承認を必要とする
3. **デフォルト拒否**: 明示的に許可されていない操作は拒否
4. **定期的な見直し**: アクセス権限を定期的にレビュー

#### 4.1.2 アクセス制御モデル

**採用モデル**: ロールベースアクセス制御(RBAC)

```
ユーザー → ロール → 権限 → リソース
```

### 4.2 ロール定義

#### 4.2.1 システムロール

| ロール | 権限 | 対象リソース | 付与対象 |
|-------|------|------------|---------|
| **プロジェクトオーナー** | すべて | すべて | 最高責任者 |
| **管理者** | 管理操作 | Firebase、GCP | CISO、技術責任者 |
| **開発者** | 開発環境アクセス | 開発環境 | バックエンド/フロントエンドエンジニア |
| **データアナリスト** | 読み取り専用 | BigQuery | データアナリスト |
| **セキュリティ監査者** | 読み取り専用 | 監査ログ | CISO、監査担当 |
| **サポート担当** | 限定的な読み取り | ユーザーサポートデータ | カスタマーサポート |

#### 4.2.2 ユーザーロール

| ロール | 権限 | 対象 |
|-------|------|------|
| **一般ユーザー** | 自分のデータのみアクセス | 全利用者 |
| **プレミアムユーザー** | 自分のデータ+追加機能 | 有料プラン利用者 |

### 4.3 GCP IAMによるアクセス制御

#### 4.3.1 GCPプロジェクトレベル

| ロール | 付与対象 | 権限内容 |
|-------|---------|---------|
| **Owner** | 最高責任者 | すべての操作 |
| **Editor** | 技術責任者 | リソースの作成・変更 |
| **Viewer** | データアナリスト | リソースの閲覧 |
| **Security Admin** | CISO | セキュリティ設定の変更 |

#### 4.3.2 サービスアカウント

| サービスアカウント | 用途 | 権限 |
|----------------|------|------|
| **firebase-to-bigquery@** | データ取り込み | BigQuery Data Editor |
| **looker-studio@** | ダッシュボード | BigQuery Data Viewer |
| **data-deletion@** | GDPR削除 | BigQuery Data Editor |
| **backup-service@** | バックアップ | Storage Admin |

**参照**: BigQuery設計書v3.1第5.1節

### 4.4 Firebase Security Rules

#### 4.4.1 基本ルール

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // デフォルトは全拒否
    match /{document=**} {
      allow read, write: if false;
    }
    
    // ユーザーは自分のデータのみアクセス可能
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // トレーニングセッション
    match /training_sessions/{sessionId} {
      allow read: if request.auth != null && 
                     resource.data.userId == request.auth.uid;
      allow write: if request.auth != null && 
                      request.resource.data.userId == request.auth.uid;
    }
    
    // 種目マスター(読み取り専用)
    match /exercises/{exerciseId} {
      allow read: if request.auth != null;
      allow write: if false;  // 管理者のみ(Admin SDKから)
    }
  }
}
```

**参照**: Firestoreデータベース設計書v3.1第5章

### 4.5 アクセス権限のレビュー

#### 4.5.1 定期レビュー

| 項目 | 頻度 | 実施者 | 承認者 |
|-----|------|-------|-------|
| **GCP IAM権限** | 四半期ごと | CISO | 技術責任者 |
| **Firebase Security Rules** | 四半期ごと | バックエンドエンジニア | CISO |
| **サービスアカウント権限** | 半年ごと | インフラ担当 | CISO |
| **ユーザーアクセス権限** | 月次 | セキュリティ担当 | CISO |

#### 4.5.2 アクセス権限の剥奪

**即時剥奪が必要なケース**:
- 退職時
- 役割変更時
- セキュリティインシデント発生時
- 不正利用の疑いがある場合

**手順**:
1. アカウント無効化(即時)
2. アクセス権限の削除(24時間以内)
3. 関連ログの確認(1週間以内)
4. 記録の保管(1年間)

---

## 5. 認証・認可

### 5.1 ユーザー認証

#### 5.1.1 認証方式

| 認証方式 | プロバイダー | 対応Phase | セキュリティレベル |
|---------|------------|----------|------------------|
| **Google OAuth 2.0** | Google | Phase 1 | 高 |
| **Apple Sign In** | Apple | Phase 1 | 高 |
| **匿名認証** | Firebase | Phase 2(検討中) | 低 |

#### 5.1.2 パスワードポリシー

**要件定義書NFR-009準拠**

本サービスではOAuth認証を推奨していますが、将来的にメール/パスワード認証を実装する場合の要件:

| 項目 | 要件 |
|-----|------|
| **最小長** | 8文字以上 |
| **複雑性** | 英数字混在を推奨 |
| **禁止パターン** | 辞書攻撃に脆弱なパスワード |
| **有効期限** | なし(多要素認証があれば不要) |
| **再利用制限** | 過去3回のパスワードは使用不可 |

#### 5.1.3 多要素認証(MFA)

**適用対象**:
- 管理者アカウント: **必須**
- 一般ユーザー: 任意(Phase 3以降で実装検討)

**MFA方式**:
- SMS認証
- アプリベース認証(Google Authenticator等)
- 生体認証(Face ID、Touch ID)

### 5.2 セッション管理

#### 5.2.1 セッション設定

| 項目 | 設定値 | 根拠 |
|-----|--------|------|
| **セッションタイムアウト** | 7日間 | Firebase Authenticationデフォルト |
| **アイドルタイムアウト** | 30分(モバイルアプリでは無効) | - |
| **同時セッション数** | 制限なし | 複数デバイス対応 |
| **トークン更新** | 自動(1時間ごと) | Firebase Authenticationが管理 |

#### 5.2.2 セッショントークン

**JWT(JSON Web Token)を使用**:

```
Authorization: Bearer <JWT_TOKEN>
```

**トークンの検証**:
- 署名検証
- 有効期限確認
- 発行者確認
- 対象者確認

**参照**: API設計書v3.1第3章

### 5.3 API認証

#### 5.3.1 認証フロー

```
モバイルアプリ
    ↓ (1) Firebase Authentication
Firebase Authentication
    ↓ (2) IDトークン発行
モバイルアプリ
    ↓ (3) APIリクエスト + IDトークン
Cloud Functions
    ↓ (4) トークン検証
Firebase Admin SDK
    ↓ (5) レスポンス
モバイルアプリ
```

#### 5.3.2 レート制限

**要件定義書NFR-001準拠**

| エンドポイント | 制限 | 時間窓 |
|-------------|------|-------|
| **すべてのAPI** | 100リクエスト | 1分 |
| **セッション作成** | 10リクエスト | 1分 |
| **データエクスポート** | 3リクエスト | 1日 |
| **アカウント削除リクエスト** | 1リクエスト | 1日 |

**参照**: API設計書v3.1第11章

---

## 6. 暗号化

### 6.1 暗号化の原則

#### 6.1.1 基本方針

1. **保存時の暗号化**: すべての機密データを暗号化
2. **転送時の暗号化**: すべての通信をTLS 1.3で暗号化
3. **強力な暗号アルゴリズム**: AES-256を使用
4. **鍵管理の厳格化**: Cloud KMS、Secret Managerを使用

#### 6.1.2 暗号化対象

| データ | 保存時 | 転送時 | 暗号化方式 |
|-------|-------|-------|----------|
| **個人情報** | ✅ | ✅ | AES-256、TLS 1.3 |
| **トレーニングデータ** | ✅ | ✅ | AES-256、TLS 1.3 |
| **骨格座標データ** | ✅ | ✅ | AES-256、TLS 1.3 |
| **課金情報** | ✅ | ✅ | AES-256、TLS 1.3 |
| **認証トークン** | ✅ | ✅ | JWT署名、TLS 1.3 |
| **ログデータ** | ✅ | ✅ | AES-256、TLS 1.3 |

### 6.2 保存時の暗号化

#### 6.2.1 データベース暗号化

| システム | 暗号化方式 | 鍵管理 | 実装 |
|---------|----------|-------|------|
| **Firestore** | AES-256 | Google管理 | 自動 |
| **BigQuery** | AES-256 | Google管理 | 自動 |
| **Cloud Storage** | AES-256 | Google管理 | 自動 |
| **ローカルDB(Hive)** | AES-256 | デバイスキーチェーン | 手動実装 |

**参照**: 
- プライバシーポリシーv3.1第8.4条
- データ処理記録v1.0第8.1.1節

#### 6.2.2 パスワード暗号化

| 項目 | 方式 | ソルト | ストレッチング |
|-----|------|-------|--------------|
| **パスワード** | bcrypt | ランダム生成 | 10ラウンド |

### 6.3 転送時の暗号化

#### 6.3.1 TLS設定

| 項目 | 設定 |
|-----|------|
| **プロトコル** | TLS 1.3(最小: TLS 1.2) |
| **暗号スイート** | ECDHE-RSA-AES256-GCM-SHA384 |
| **証明書** | Let's Encrypt(自動更新) |
| **HSTS** | 有効(max-age=31536000) |
| **Perfect Forward Secrecy** | 有効 |

#### 6.3.2 APIセキュリティ

```
すべてのAPIエンドポイント: HTTPS必須
HTTP → HTTPS自動リダイレクト: 有効
```

### 6.4 鍵管理

#### 6.4.1 鍵管理システム

| 鍵の種類 | 管理システム | アクセス権限 |
|---------|------------|------------|
| **データ暗号化鍵** | Google Cloud KMS | CISO、インフラ担当 |
| **APIキー** | Secret Manager | CISO、バックエンドエンジニア |
| **OAuth Client Secret** | Secret Manager | CISO、バックエンドエンジニア |
| **署名鍵** | Cloud KMS | CISO |

#### 6.4.2 鍵のライフサイクル

| フェーズ | 手順 | 頻度 |
|---------|------|------|
| **生成** | Cloud KMSで自動生成 | 初回のみ |
| **保管** | Cloud KMS、Secret Manager | - |
| **使用** | 必要に応じて復号化 | - |
| **ローテーション** | 自動ローテーション | 年1回 |
| **廃棄** | 無効化→削除 | 必要時 |

#### 6.4.3 鍵ローテーション

| 鍵の種類 | ローテーション頻度 | 方法 |
|---------|-----------------|------|
| **データ暗号化鍵** | 年1回 | Cloud KMS自動ローテーション |
| **APIキー** | 6ヶ月ごと | 手動ローテーション |
| **OAuth Client Secret** | 必要時 | 手動ローテーション |
| **仮名化Salt** | 年1回 | 手動ローテーション+再仮名化 |

---

## 7. ネットワークセキュリティ

### 7.1 ネットワーク構成

#### 7.1.1 ネットワークアーキテクチャ

```
インターネット
    │
    ├── Cloud Load Balancer (HTTPS)
    │       │
    │       ├── Cloud Armor (WAF)
    │       │
    │       └── Cloud Functions (API)
    │
    ├── Firebase Hosting (Webサイト)
    │
    └── Firebase/GCP (バックエンド)
            │
            ├── Firestore (VPC内)
            ├── BigQuery (VPC内)
            └── Cloud Storage (VPC内)
```

#### 7.1.2 ネットワーク分離

| ネットワーク | 用途 | アクセス制限 |
|------------|------|------------|
| **本番環境** | 本番システム | 厳格な制限 |
| **ステージング環境** | テスト | 開発者のみ |
| **開発環境** | 開発 | 開発者のみ |

### 7.2 ファイアウォール

#### 7.2.1 Cloud Armor(WAF)

**保護対象**:
- Cloud Functions(API)
- Cloud Run(Phase 3以降)

**ルール**:

| ルール | アクション | 優先度 |
|-------|----------|--------|
| **SQLインジェクション** | 拒否 | 1000 |
| **XSS** | 拒否 | 1001 |
| **既知の悪意のあるIP** | 拒否 | 1002 |
| **DDoS保護** | レート制限 | 1003 |
| **正当なトラフィック** | 許可 | 2000 |

#### 7.2.2 VPCファイアウォール

**送信ルール**:
- デフォルト: 全拒否
- 必要なサービスのみ許可

**受信ルール**:
- デフォルト: 全拒否
- HTTPS(443)のみ許可

### 7.3 DDoS対策

#### 7.3.1 対策レイヤー

| レイヤー | 対策 | 実装 |
|---------|------|------|
| **L3/L4** | Google Cloud Armor | 自動 |
| **L7** | レート制限、WAF | Cloud Functions、Cloud Armor |
| **アプリケーション** | 入力検証、認証 | アプリケーションコード |

#### 7.3.2 レート制限

**要件定義書NFR-001準拠**

| レイヤー | 制限 | 実装 |
|---------|------|------|
| **Cloud Armor** | 1000リクエスト/分/IP | WAFルール |
| **Cloud Functions** | 100リクエスト/分/ユーザー | ミドルウェア |
| **Firebase** | 自動スケーリング | Firebase設定 |

---

## 8. アプリケーションセキュリティ

### 8.1 セキュアコーディング

#### 8.1.1 コーディング規約

**必須要件**:

1. **入力検証**:
   - すべての入力をサーバーサイドで検証
   - ホワイトリスト方式を採用
   - 型チェック、範囲チェック、フォーマットチェック

2. **出力エスケープ**:
   - HTMLエスケープ
   - JSONエスケープ
   - SQLエスケープ(ORMを使用)

3. **エラーハンドリング**:
   - 詳細なエラー情報をユーザーに公開しない
   - エラーログを適切に記録
   - 攻撃の兆候を検知

4. **認証・認可**:
   - すべてのAPIで認証を必須化
   - 認可チェックを実装
   - セッション管理を適切に実施

#### 8.1.2 禁止事項

| 禁止事項 | 理由 |
|---------|------|
| **ハードコードされた認証情報** | 漏洩リスク |
| **eval()の使用** | コードインジェクション |
| **innerHTML** | XSS脆弱性 |
| **MD5、SHA1** | 弱い暗号化アルゴリズム |
| **平文でのパスワード保存** | セキュリティリスク |

### 8.2 脆弱性対策

#### 8.2.1 OWASP Top 10対策

| 脆弱性 | 対策 | 実装 |
|-------|------|------|
| **A01: アクセス制御の不備** | Firebase Security Rules、Cloud IAM | 第4章参照 |
| **A02: 暗号化の失敗** | TLS 1.3、AES-256 | 第6章参照 |
| **A03: インジェクション** | パラメータ化クエリ、入力検証 | Zodライブラリ |
| **A04: 安全でない設計** | プライバシーバイデザイン | 設計段階で実施 |
| **A05: セキュリティ設定ミス** | 自動化されたデプロイ、レビュー | CI/CD |
| **A06: 脆弱なコンポーネント** | 依存関係の定期更新 | Dependabot |
| **A07: 認証の失敗** | Firebase Authentication、MFA | 第5章参照 |
| **A08: データ完全性の失敗** | 署名検証、整合性チェック | Cloud Functions |
| **A09: ログ・監視の不備** | Cloud Logging、Cloud Monitoring | 第11章参照 |
| **A10: SSRF** | ホワイトリスト方式、検証 | Cloud Functions |

#### 8.2.2 入力検証

**Zodライブラリによる検証**:

```typescript
import { z } from 'zod';

// ユーザー登録のバリデーション
const userSchema = z.object({
  email: z.string().email(),
  displayName: z.string().min(1).max(20),
  height: z.number().min(100).max(250),
  weight: z.number().min(30).max(200),
  birthDate: z.string().regex(/^\d{4}-\d{2}-\d{2}$/),
});

// 使用例
try {
  const validatedData = userSchema.parse(requestBody);
} catch (error) {
  // バリデーションエラー
  throw new ValidationError('入力エラー', error.errors);
}
```

**参照**: API設計書v3.1第6章

### 8.3 モバイルアプリセキュリティ

#### 8.3.1 アプリ保護

| 保護項目 | 対策 | 実装 |
|---------|------|------|
| **コード難読化** | ProGuard(Android)、Obfuscation(iOS) | ビルド時 |
| **ルート検知** | flutter_jailbreak_detection | 起動時チェック |
| **SSL Pinning** | 証明書固定 | Phase 2以降 |
| **ローカルストレージ暗号化** | Hive + AES-256 | flutter_secure_storage |
| **スクリーンショット防止** | 機密画面のみ | Flutterプラグイン |

#### 8.3.2 APIキーの保護

**環境変数による管理**:

```dart
// ❌ ハードコード(禁止)
const apiKey = "AIzaSyDxxxxxxxxxxxxx";

// ✅ 環境変数から読み込み
final apiKey = dotenv.env['FIREBASE_API_KEY'];
```

---

## 9. データ保護

### 9.1 個人情報保護

#### 9.1.1 プライバシーバイデザイン

**GDPR第25条準拠**

| 原則 | 実装 | 参照 |
|-----|------|------|
| **データ最小化** | 必要最小限のデータのみ収集 | プライバシーポリシー第8.1条 |
| **目的制限** | 収集目的を明示、目的外利用禁止 | プライバシーポリシー第5条 |
| **正確性** | データの正確性を維持 | Firestoreバリデーション |
| **保存期間制限** | 自動削除の実装 | 第3.2節参照 |
| **完全性・機密性** | 暗号化、アクセス制御 | 第4章、第6章参照 |
| **説明責任** | 記録の保持、監査 | データ処理記録v1.0 |

#### 9.1.2 データ最小化の実装

**収集しないデータ**:
- カメラ映像(オンデバイス処理のみ)
- 正確な位置情報(都市レベルのみ)
- 生体情報(骨格座標は収集)
- 健康情報(トレーニング記録のみ)

**参照**: プライバシーポリシーv3.1第8.1条

### 9.2 仮名化

#### 9.2.1 仮名化対象

| データ | 仮名化方法 | 実装 |
|-------|----------|------|
| **ユーザーID** | SHA-256ハッシュ | BigQueryへの転送時 |
| **IPアドレス** | SHA-256ハッシュ | ログ記録時 |
| **メールアドレス** | 保存しない | - |

#### 9.2.2 仮名化関数

```javascript
const crypto = require('crypto');

function pseudonymizeUserId(userId) {
  const salt = process.env.PSEUDONYMIZATION_SALT;
  return crypto
    .createHash('sha256')
    .update(userId + salt)
    .digest('hex');
}
```

**参照**: BigQuery設計書v3.1第5.3節

### 9.3 GDPR権利への対応

#### 9.3.1 データ主体の権利

| 権利 | 対応期限 | 実装 | 参照 |
|-----|---------|------|------|
| **アクセス権(第15条)** | 1ヶ月以内 | FR-026 | API設計書第9.3節 |
| **訂正権(第16条)** | 即座 | FR-002 | アプリ内設定 |
| **削除権(第17条)** | 1ヶ月以内 | FR-025 | API設計書第9.4節 |
| **ポータビリティ権(第20条)** | 1ヶ月以内 | FR-027 | API設計書第9.3節 |
| **異議権(第21条)** | 即座 | FR-024 | アプリ内設定 |

#### 9.3.2 データエクスポート

**フォーマット**:
- JSON(機械可読)
- CSV(人間可読)

**エクスポート内容**:
- アカウント情報
- プロフィール情報
- トレーニング履歴
- 骨格座標データ(オプション)

**参照**: API設計書v3.1第9.3節

#### 9.3.3 アカウント削除

**削除範囲**:
- Firestoreのすべてのデータ
- Cloud Storageの関連ファイル
- BigQueryの該当レコード(仮名化済み)

**保持データ**:
- 課金情報(7年間、税法上の義務)
- 削除ログ(証拠として)

**参照**: API設計書v3.1第9.4節

---

## 10. バックアップと災害復旧

### 10.1 バックアップ戦略

#### 10.1.1 バックアップ対象

| システム | バックアップ方法 | 頻度 | 保持期間 |
|---------|----------------|------|---------|
| **Firestore** | Exportコマンド | 日次 | 30日間 |
| **BigQuery** | Snapshot | 週次 | 90日間 |
| **Cloud Storage** | Bucket versioning | 自動 | 30日間 |
| **設定ファイル** | GitHub | 随時 | 無期限 |
| **暗号鍵** | Cloud KMS自動バックアップ | 自動 | 無期限 |

#### 10.1.2 バックアップ手順

**Firestoreの日次バックアップ**:

```bash
#!/bin/bash
# 日次バックアップスクリプト

# バックアップ実行
gcloud firestore export \
  gs://ai-fitness-app-backups/firestore/$(date +%Y%m%d) \
  --collection-ids=users,training_sessions,subscriptions

# 古いバックアップの削除(30日以上前)
gsutil -m rm -r \
  gs://ai-fitness-app-backups/firestore/$(date -d '30 days ago' +%Y%m%d)
```

**Cloud Schedulerでの自動化**:

```yaml
name: daily-firestore-backup
schedule: "0 2 * * *"  # 毎日午前2時(JST)
timeZone: Asia/Tokyo
httpTarget:
  uri: https://asia-northeast1-ai-fitness-app.cloudfunctions.net/backupFirestore
  httpMethod: POST
  headers:
    Content-Type: application/json
```

### 10.2 災害復旧計画(DRP)

#### 10.2.1 RPO/RTO目標

| システム | RPO | RTO | 優先度 |
|---------|-----|-----|-------|
| **Firebase Authentication** | 0分(冗長化) | 5分 | 最高 |
| **Firestore** | 24時間 | 4時間 | 高 |
| **BigQuery** | 7日間 | 8時間 | 中 |
| **Cloud Functions** | 0分(再デプロイ) | 1時間 | 高 |

**RPO(Recovery Point Objective)**: 復旧時点目標  
**RTO(Recovery Time Objective)**: 復旧時間目標

#### 10.2.2 災害復旧手順

**レベル1: 軽微な障害(1サービスの一時的な障害)**

| ステップ | 実施内容 | 担当者 | 想定時間 |
|---------|---------|-------|---------|
| 1 | 障害検知 | 監視システム | 即時 |
| 2 | 初期対応 | オンコール担当 | 15分以内 |
| 3 | 復旧作業 | インフラ担当 | 1時間以内 |
| 4 | 動作確認 | QA担当 | 30分以内 |
| 5 | 報告 | CISO | 1時間以内 |

**レベル2: 重大な障害(複数サービスの障害)**

| ステップ | 実施内容 | 担当者 | 想定時間 |
|---------|---------|-------|---------|
| 1 | 障害検知 | 監視システム | 即時 |
| 2 | 緊急対策本部設置 | CISO、技術責任者 | 30分以内 |
| 3 | バックアップからの復旧 | インフラ担当 | 4時間以内 |
| 4 | データ整合性確認 | バックエンドエンジニア | 2時間以内 |
| 5 | サービス再開 | 技術責任者 | 6時間以内 |
| 6 | ユーザー通知 | カスタマーサポート | 即時 |
| 7 | 事後報告 | 最高責任者 | 24時間以内 |

**レベル3: 壊滅的な障害(GCPリージョン全体の障害)**

| ステップ | 実施内容 | 担当者 | 想定時間 |
|---------|---------|-------|---------|
| 1 | 障害検知 | 監視システム | 即時 |
| 2 | 災害対策本部設置 | 全役員 | 1時間以内 |
| 3 | 代替リージョンへの切り替え | インフラ担当 | 8時間以内 |
| 4 | バックアップからの復旧 | 全技術部門 | 24時間以内 |
| 5 | サービス再開 | 最高責任者 | 24時間以内 |
| 6 | 全ユーザーへの通知 | 広報担当 | 即時 |

#### 10.2.3 復旧テスト

| テスト | 頻度 | 実施者 | 目的 |
|-------|------|-------|------|
| **バックアップの復元テスト** | 四半期ごと | インフラ担当 | 復旧手順の確認 |
| **フェイルオーバーテスト** | 半年ごと | 全技術部門 | 代替環境への切り替え |
| **災害復旧訓練** | 年1回 | 全部門 | 総合的な対応力の確認 |

---

## 11. 監視とログ管理

### 11.1 監視戦略

#### 11.1.1 監視レイヤー

| レイヤー | 監視項目 | ツール | アラート閾値 |
|---------|---------|--------|------------|
| **インフラ** | CPU、メモリ、ネットワーク | Cloud Monitoring | CPU > 80% |
| **アプリケーション** | エラー率、レスポンスタイム | Cloud Monitoring | エラー率 > 1% |
| **セキュリティ** | 不正アクセス、異常な動作 | Cloud Logging | 即時 |
| **ビジネス** | ユーザー数、売上 | BigQuery + Looker Studio | - |

#### 11.1.2 監視ダッシュボード

**Cloud Monitoringダッシュボード**:

1. **システム監視**:
   - Cloud Functions実行時間
   - Firestoreの読み取り/書き込み回数
   - BigQueryのジョブ実行時間
   - エラー発生率

2. **セキュリティ監視**:
   - 認証失敗回数
   - 異常なアクセスパターン
   - WAFブロック数
   - レート制限超過回数

3. **コスト監視**:
   - 日次コスト
   - サービス別コスト
   - 予算アラート

**参照**: BigQuery設計書v3.1第12章

### 11.2 ログ管理

#### 11.2.1 ログ種別

| ログ種別 | 内容 | 保持期間 | ツール |
|---------|------|---------|--------|
| **アプリケーションログ** | API実行、エラー | 30日 | Cloud Logging |
| **監査ログ** | 管理操作、データアクセス | 1年 | Cloud Audit Logs |
| **セキュリティログ** | 認証、認可、不正アクセス | 1年 | Cloud Logging |
| **システムログ** | インフラ、ネットワーク | 90日 | Cloud Logging |

#### 11.2.2 ログフォーマット

**構造化ログ**(JSON形式):

```json
{
  "severity": "INFO",
  "timestamp": "2025-11-22T12:34:56.789Z",
  "userId": "user123",
  "action": "create_session",
  "resource": "/api/v1/sessions",
  "method": "POST",
  "statusCode": 201,
  "elapsedTime": 123,
  "ip": "192.0.2.1",
  "userAgent": "MyApp/1.0.0"
}
```

#### 11.2.3 ログ分析

**Cloud Loggingでのクエリ例**:

```
# 過去1時間の認証失敗
resource.type="cloud_function"
severity="ERROR"
jsonPayload.action="authentication_failed"
timestamp >= "2025-11-22T11:00:00Z"

# 不審なアクセスパターン
resource.type="cloud_function"
jsonPayload.statusCode=401
jsonPayload.ip="192.0.2.1"
```

### 11.3 アラート設定

#### 11.3.1 アラート種別

| アラート | 条件 | 通知先 | 対応SLA |
|---------|------|-------|---------|
| **Critical** | システム停止、データ漏洩 | オンコール全員 | 15分以内 |
| **High** | エラー率上昇、パフォーマンス低下 | CISO、技術責任者 | 1時間以内 |
| **Medium** | 警告レベルのエラー | 担当エンジニア | 4時間以内 |
| **Low** | 情報通知 | メール | 24時間以内 |

#### 11.3.2 通知チャネル

| チャネル | 用途 | 設定 |
|---------|------|------|
| **PagerDuty** | Criticalアラート | オンコール担当に通知 |
| **Slack** | High/Mediumアラート | #security-alerts |
| **Email** | Lowアラート、レポート | security-team@company.com |

---

## 12. インシデント対応

### 12.1 インシデント対応体制

#### 12.1.1 CSIRT構成

**Computer Security Incident Response Team**

| 役割 | 担当者 | 責任 |
|-----|-------|------|
| **CSIRT リーダー** | CISO | 全体統括、意思決定 |
| **技術対応** | インフラ担当、バックエンドエンジニア | 技術的対応、復旧 |
| **法務対応** | 法務担当 | 法的対応、当局への報告 |
| **広報対応** | 広報担当 | ユーザー通知、メディア対応 |
| **記録担当** | セキュリティ担当 | 対応の記録、報告書作成 |

#### 12.1.2 連絡体制

```
インシデント検知
    ↓
オンコール担当(24時間体制)
    ↓
CSIRTリーダー(CISO)
    ↓
経営層(必要に応じて)
    ↓
関係部門(並行)
    ├── 技術部門
    ├── 法務部門
    ├── 広報部門
    └── カスタマーサポート
```

### 12.2 インシデント対応フロー

#### 12.2.1 対応フェーズ

**NIST SP 800-61準拠**

```
準備 → 検知・分析 → 封じ込め・根絶・復旧 → 事後対応
```

#### 12.2.2 詳細手順

**フェーズ1: 準備**

| 項目 | 内容 |
|-----|------|
| **体制整備** | CSIRTの編成、連絡先の整備 |
| **ツール準備** | 監視ツール、ログ分析ツール |
| **訓練** | 年2回の訓練実施 |
| **文書化** | 手順書、連絡先リストの整備 |

**フェーズ2: 検知・分析**

| ステップ | 実施内容 | 担当者 | 制限時間 |
|---------|---------|-------|---------|
| 1 | インシデント検知 | 監視システム | 即時 |
| 2 | 初期評価 | オンコール担当 | 15分以内 |
| 3 | CSIRTへの報告 | オンコール担当 | 30分以内 |
| 4 | 詳細分析 | CSIRT | 2時間以内 |
| 5 | 影響範囲の特定 | CSIRT | 4時間以内 |

**フェーズ3: 封じ込め・根絶・復旧**

| ステップ | 実施内容 | 担当者 | 制限時間 |
|---------|---------|-------|---------|
| 1 | 短期的封じ込め | 技術対応チーム | 1時間以内 |
| 2 | システム隔離 | インフラ担当 | 2時間以内 |
| 3 | 証拠保全 | セキュリティ担当 | 4時間以内 |
| 4 | 長期的封じ込め | 技術対応チーム | 24時間以内 |
| 5 | 根絶措置 | 技術対応チーム | 48時間以内 |
| 6 | 復旧 | 全技術部門 | 72時間以内 |

**フェーズ4: 事後対応**

| ステップ | 実施内容 | 担当者 | 期限 |
|---------|---------|-------|------|
| 1 | インシデントレポート作成 | 記録担当 | 1週間以内 |
| 2 | 根本原因分析 | CSIRT | 2週間以内 |
| 3 | 再発防止策の実施 | 全部門 | 1ヶ月以内 |
| 4 | 関係者への報告 | CISO | 必要に応じて |

### 12.3 データ侵害対応

#### 12.3.1 GDPR第33条・第34条準拠

**データ処理記録v1.0第8.3節準拠**

| 段階 | 期限 | 担当者 | 対応内容 |
|-----|------|-------|---------|
| **1. 検知** | 即時 | 技術部門 | 異常検知システムによる自動検知 |
| **2. 初期評価** | 24時間以内 | セキュリティ担当者 | 侵害の範囲と影響を評価 |
| **3. 封じ込め** | 48時間以内 | 技術部門 | 侵害の拡大を防止 |
| **4. 監督機関への通知** | 72時間以内 | DPO | GDPR第33条に基づく通知 |
| **5. データ主体への通知** | 必要に応じて | DPO | GDPR第34条に基づく通知 |
| **6. 事後対応** | 2週間以内 | 全部門 | 再発防止策の実施 |

#### 12.3.2 通知内容

**監督機関への通知(GDPR第33条)**:
- 個人データ侵害の性質
- 関係する個人データ主体の種類と概数
- DPOの氏名と連絡先
- 個人データ侵害の影響
- 管理者が講じた、または講じることを提案する措置

**データ主体への通知(GDPR第34条)**:
- 個人データ侵害の性質
- DPOの連絡先
- 個人データ侵害の影響
- 管理者が講じた、または講じることを提案する措置

### 12.4 インシデント分類

#### 12.4.1 重要度レベル

| レベル | 定義 | 例 | 対応SLA |
|-------|------|---|---------|
| **Critical** | サービス停止、データ漏洩 | 大規模なデータ侵害 | 15分以内 |
| **High** | セキュリティ侵害、重大な機能障害 | 不正アクセス成功 | 1時間以内 |
| **Medium** | 軽微なセキュリティ問題 | 脆弱性発見 | 4時間以内 |
| **Low** | 情報提供レベル | 不審なアクセス試行 | 24時間以内 |

#### 12.4.2 インシデント種別

| 種別 | 説明 | 対応チーム |
|-----|------|----------|
| **不正アクセス** | 認証の突破、権限昇格 | CSIRT全員 |
| **マルウェア** | ウイルス、ランサムウェア | 技術対応チーム |
| **DDoS** | サービス妨害攻撃 | インフラ担当 |
| **データ漏洩** | 個人情報の外部流出 | CSIRT全員、DPO |
| **内部不正** | 従業員による不正行為 | CSIRT、法務 |
| **設定ミス** | セキュリティ設定の誤り | 技術対応チーム |

---

## 13. 脆弱性管理

### 13.1 脆弱性管理プロセス

#### 13.1.1 脆弱性のライフサイクル

```
発見 → 評価 → 優先順位付け → 対応 → 検証 → クローズ
```

#### 13.1.2 脆弱性情報源

| 情報源 | 確認頻度 | 担当者 |
|-------|---------|-------|
| **GitHub Dependabot** | 自動 | バックエンドエンジニア |
| **CVE/NVD** | 週次 | セキュリティ担当 |
| **ベンダーセキュリティ情報** | 週次 | セキュリティ担当 |
| **ペネトレーションテスト** | 年次 | 外部専門家 |
| **脆弱性診断** | 年次 | 外部専門家 |

### 13.2 脆弱性評価

#### 13.2.1 CVSSスコア

| スコア | レベル | 対応期限 | 対応方針 |
|-------|-------|---------|---------|
| **9.0-10.0** | Critical | 24時間以内 | 緊急パッチ適用 |
| **7.0-8.9** | High | 7日以内 | 優先的にパッチ適用 |
| **4.0-6.9** | Medium | 30日以内 | 計画的にパッチ適用 |
| **0.1-3.9** | Low | 90日以内 | 次回メンテナンス時に対応 |

#### 13.2.2 脆弱性評価基準

**影響度の評価**:
- 機密性への影響(C)
- 完全性への影響(I)
- 可用性への影響(A)

**攻撃の容易性**:
- 攻撃元区分(AV)
- 攻撃条件の複雑さ(AC)
- 必要な特権レベル(PR)
- 利用者の関与(UI)

### 13.3 パッチ管理

#### 13.3.1 パッチ適用プロセス

| フェーズ | 実施内容 | 担当者 | 期限 |
|---------|---------|-------|------|
| **1. 情報収集** | 脆弱性情報の収集 | セキュリティ担当 | 日次 |
| **2. 評価** | CVSSスコア評価 | セキュリティ担当 | 検知後24時間 |
| **3. テスト** | 開発環境でのテスト | QAエンジニア | 評価後48時間 |
| **4. 承認** | 適用承認 | CISO | テスト完了後 |
| **5. 適用** | 本番環境への適用 | インフラ担当 | 承認後24時間 |
| **6. 検証** | 適用後の動作確認 | QAエンジニア | 適用後4時間 |

#### 13.3.2 緊急パッチ

**Critical脆弱性の場合**:
- テストを最小限に簡略化
- 即座に適用
- 適用後に詳細テスト

### 13.4 依存関係管理

#### 13.4.1 使用ライブラリの管理

| ライブラリ | 更新頻度 | 確認ツール |
|----------|---------|----------|
| **Flutter** | 月次 | pub outdated |
| **Node.js** | 月次 | npm audit |
| **Firebase SDK** | 四半期ごと | GitHub Dependabot |
| **システムパッケージ** | 月次 | apt-get upgrade |

#### 13.4.2 自動化

**GitHub Dependabot設定**:

```yaml
version: 2
updates:
  - package-ecosystem: "npm"
    directory: "/functions"
    schedule:
      interval: "weekly"
    open-pull-requests-limit: 10
    
  - package-ecosystem: "pub"
    directory: "/"
    schedule:
      interval: "weekly"
```

---

## 14. セキュリティ教育

### 14.1 教育プログラム

#### 14.1.1 全従業員向け研修

| 研修名 | 頻度 | 期間 | 対象者 |
|-------|------|------|-------|
| **セキュリティ基礎研修** | 新規採用時 | 2時間 | 全従業員 |
| **GDPR基礎研修** | 年1回 | 1時間 | 全従業員 |
| **フィッシング対策訓練** | 年2回 | - | 全従業員 |
| **インシデント対応訓練** | 年1回 | 半日 | 関連部門 |

#### 14.1.2 技術部門向け研修

| 研修名 | 頻度 | 期間 | 対象者 |
|-------|------|------|-------|
| **セキュアコーディング研修** | 年2回 | 4時間 | 全エンジニア |
| **OWASP Top 10研修** | 年1回 | 2時間 | 全エンジニア |
| **脆弱性診断実習** | 年1回 | 1日 | セキュリティ担当 |
| **インシデント対応演習** | 年2回 | 半日 | 技術部門 |

### 14.2 教育内容

#### 14.2.1 セキュリティ基礎研修

**内容**:
1. 情報セキュリティの重要性
2. 本ポリシーの概要
3. パスワード管理
4. フィッシング対策
5. 個人情報の取り扱い
6. インシデント報告手順

#### 14.2.2 セキュアコーディング研修

**内容**:
1. OWASP Top 10の解説
2. 入力検証の実装
3. 認証・認可の実装
4. セッション管理
5. エラーハンドリング
6. ログ記録

### 14.3 認識向上活動

#### 14.3.1 定期的な情報発信

| 活動 | 頻度 | 内容 |
|-----|------|------|
| **セキュリティニュースレター** | 月次 | 最新の脅威情報、事例紹介 |
| **セキュリティTips** | 週次 | Slackでの簡単なTips |
| **インシデント事例共有** | 随時 | 他社事例、教訓の共有 |

#### 14.3.2 フィッシング訓練

**実施内容**:
- 模擬フィッシングメールの送信
- クリック率の測定
- フィードバックと教育

**目標**:
- クリック率 < 5%
- 報告率 > 50%

---

## 15. 監査とコンプライアンス

### 15.1 内部監査

#### 15.1.1 監査計画

| 監査項目 | 頻度 | 実施者 | 期間 |
|---------|------|-------|------|
| **セキュリティポリシー遵守状況** | 年2回 | 監査担当 | 2週間 |
| **アクセス権限レビュー** | 四半期ごと | セキュリティ担当 | 1週間 |
| **ログレビュー** | 月次 | セキュリティ担当 | 1日 |
| **バックアップ検証** | 四半期ごと | インフラ担当 | 1日 |

#### 15.1.2 監査チェックリスト

**セキュリティ対策の確認**:
- [ ] アクセス制御が適切に設定されている
- [ ] 暗号化が正しく実装されている
- [ ] ログが適切に記録されている
- [ ] バックアップが正常に動作している
- [ ] パッチが適切に適用されている

**プロセスの確認**:
- [ ] インシデント対応手順が整備されている
- [ ] 教育訓練が実施されている
- [ ] 脆弱性管理が適切に実施されている
- [ ] 定期レビューが実施されている

### 15.2 外部監査

#### 15.2.1 外部監査の種類

| 監査種別 | 頻度 | 実施者 | 目的 |
|---------|------|-------|------|
| **セキュリティ診断** | 年1回 | 外部専門家 | 脆弱性の発見 |
| **ペネトレーションテスト** | 年1回 | 外部専門家 | 実際の攻撃シミュレーション |
| **GDPR監査** | 年1回 | DPO/外部専門家 | GDPR遵守状況の確認 |

#### 15.2.2 監査対応

**手順**:
1. 監査計画の確認
2. 関連文書の準備
3. 監査の実施
4. 指摘事項の確認
5. 改善計画の策定
6. 改善の実施
7. フォローアップ監査

### 15.3 コンプライアンス

#### 15.3.1 準拠法令

| 法令 | 適用範囲 | 主な要件 | 確認頻度 |
|-----|---------|---------|---------|
| **GDPR** | EEA居住者 | プライバシー保護、データ保護 | 年次 |
| **個人情報保護法** | 日本居住者 | 個人情報の適正管理 | 年次 |
| **薬機法** | 全ユーザー | 医療機器非該当の明示 | 随時 |
| **不正アクセス禁止法** | 全システム | アクセス制御の実施 | 随時 |

#### 15.3.2 コンプライアンスチェック

**GDPR遵守チェックリスト**:
- [ ] 第25条: プライバシーバイデザイン実装
- [ ] 第30条: 処理活動の記録(ROPA)作成
- [ ] 第32条: 適切なセキュリティ対策
- [ ] 第33条: データ侵害通知手順
- [ ] 第34条: データ主体への通知手順

**参照**: データ処理記録v1.0付録A

---

## 16. サードパーティ管理

### 16.1 サードパーティサービスの評価

#### 16.1.1 使用サービス

| サービス | 提供者 | 用途 | データ転送 |
|---------|-------|------|-----------|
| **Firebase** | Google LLC | バックエンド | 米国 |
| **Google Cloud Platform** | Google LLC | インフラ | 米国 |
| **RevenueCat** | RevenueCat, Inc. | 課金管理 | 米国 |
| **Apple** | Apple Inc. | 決済 | 米国 |
| **Google Play** | Google LLC | 決済 | 米国 |

#### 16.1.2 評価基準

| 評価項目 | 確認内容 |
|---------|---------|
| **セキュリティ対策** | 暗号化、アクセス制御、監査ログ |
| **プライバシー保護** | GDPR準拠、プライバシーポリシー |
| **データ保管場所** | データセンターの所在地 |
| **SLA** | 可用性保証、サポート体制 |
| **第三国転送** | 適切性決定、SCC |

### 16.2 データ処理契約(DPA)

#### 16.2.1 必須条項

**GDPR第28条準拠**:

1. 処理の目的と期間
2. 個人データの性質と種類
3. データ主体のカテゴリー
4. 管理者の義務と権利
5. 技術的・組織的セキュリティ対策
6. サブプロセッサーの使用条件
7. データ侵害通知義務
8. 契約終了時のデータ削除

#### 16.2.2 DPA締結状況

| サービス | DPA締結 | SCC締結 | 適切性決定 |
|---------|---------|---------|----------|
| **Google LLC** | ✅ | ✅ | ✅ EU-US DPF |
| **RevenueCat** | ✅ | ✅ | ❌ |
| **Apple** | ✅ | ✅ | ❌ |

**参照**: データ処理記録v1.0第7章

### 16.3 定期レビュー

#### 16.3.1 レビュー項目

| 項目 | 頻度 | 担当者 |
|-----|------|-------|
| **セキュリティ対策の確認** | 年次 | CISO |
| **SLA遵守状況** | 四半期ごと | 技術責任者 |
| **DPA遵守状況** | 年次 | DPO |
| **コスト最適化** | 四半期ごと | 財務担当 |

---

## 17. 物理的セキュリティ

### 17.1 データセンターセキュリティ

#### 17.1.1 Google Cloud Platform

**Google データセンターのセキュリティ**:
- 24時間365日の監視
- 生体認証によるアクセス制御
- セキュリティゲート
- 監視カメラ
- 冗長電源
- 消火システム

**参照**: https://cloud.google.com/security/infrastructure

### 17.2 オフィスセキュリティ

#### 17.2.1 物理的アクセス制御

| 対策 | 実施内容 |
|-----|---------|
| **入退室管理** | ICカードによる認証 |
| **来訪者管理** | 受付での記録、エスコート |
| **監視カメラ** | 主要エリアへの設置 |
| **クリーンデスク** | 機密情報の放置禁止 |
| **シュレッダー** | 機密文書の適切な廃棄 |

#### 17.2.2 デバイス管理

| 項目 | 対策 |
|-----|------|
| **PC/スマホ** | デバイス暗号化、パスワード設定 |
| **USBメモリ** | 暗号化USBのみ使用許可 |
| **持ち出し** | 事前承認制 |
| **紛失時** | 即座に報告、リモートワイプ |

---

## 18. セキュリティポリシーの管理

### 18.1 ポリシーの見直し

#### 18.1.1 定期見直し

| 項目 | 頻度 | 担当者 | 承認者 |
|-----|------|-------|-------|
| **ポリシー全体** | 年1回 | CISO | 最高責任者 |
| **重要事項** | 四半期ごと | セキュリティ委員会 | CISO |
| **手順書** | 半年ごと | 担当部門 | CISO |

#### 18.1.2 見直しトリガー

**即座に見直しが必要なケース**:
- 重大なインシデント発生
- 法令改正
- 新規サービス開始
- 組織変更
- 脅威環境の変化

### 18.2 バージョン管理

#### 18.2.1 バージョン履歴

| バージョン | 日付 | 主な変更内容 | 承認者 |
|----------|------|-------------|-------|
| **v1.0** | 2025-11-22 | 初版作成 | (承認待ち) |

#### 18.2.2 変更管理

**変更手順**:
1. 変更提案
2. 影響分析
3. セキュリティ委員会での審議
4. 承認
5. 全従業員への通知
6. 教育実施
7. 実施確認

### 18.3 周知・教育

#### 18.3.1 周知方法

| 対象 | 方法 | タイミング |
|-----|------|----------|
| **全従業員** | メール、社内ポータル | ポリシー改定時 |
| **新入社員** | オリエンテーション | 入社時 |
| **協力業者** | 契約書、説明会 | 契約時 |

#### 18.3.2 理解度確認

**確認方法**:
- 年1回のテスト
- 研修後のアンケート
- インシデント対応訓練

---

## 付録

### A. 用語集

| 用語 | 定義 |
|-----|------|
| **GDPR** | EU一般データ保護規則 |
| **DPO** | データ保護責任者 |
| **CISO** | 最高情報セキュリティ責任者 |
| **CSIRT** | コンピュータセキュリティインシデント対応チーム |
| **CVE** | 共通脆弱性識別子 |
| **CVSS** | 共通脆弱性評価システム |
| **TLS** | Transport Layer Security |
| **WAF** | Webアプリケーションファイアウォール |
| **MFA** | 多要素認証 |
| **RPO** | 復旧時点目標 |
| **RTO** | 復旧時間目標 |
| **SLA** | サービスレベル契約 |
| **DPA** | データ処理契約 |
| **SCC** | 標準契約条項 |

### B. 関連文書

| ドキュメント | バージョン | 保管場所 |
|------------|----------|---------|
| **要件定義書** | v3.1 | /mnt/project/ |
| **利用規約** | v3.1 | /mnt/project/ |
| **プライバシーポリシー** | v3.1 | /mnt/project/ |
| **システムアーキテクチャ設計書** | v3.1 | /mnt/project/ |
| **Firestoreデータベース設計書** | v3.1 | /mnt/project/ |
| **BigQuery設計書** | v3.1 | /mnt/project/ |
| **API設計書** | v3.1 | /mnt/project/ |
| **データ処理記録(ROPA)** | v1.0 | /mnt/project/ |

### C. 連絡先

| 役職 | 連絡先 | 用途 |
|-----|-------|------|
| **DPO** | dpo@example.com | プライバシー関連 |
| **CISO** | ciso@example.com | セキュリティ関連 |
| **技術サポート** | support@example.com | 技術的問題 |
| **緊急連絡** | emergency@example.com | 重大インシデント |

---

**Document Version**: v1.0  
**Created**: 2025年11月22日  
**Last Updated**: 2025年11月22日  
**Author**: Security Team  
**Approved by**: (承認待ち)

---

**以上**