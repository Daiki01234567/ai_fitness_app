# データ処理記録(ROPA) v1.0 (Part 1/4)

**Record of Processing Activities**

**組織名**: [事業者名]  
**作成日**: 2025年11月24日  
**最終更新日**: 2025年11月24日  
**バージョン**: 1.0  
**ステータス**: Draft  
**法的根拠**: GDPR第30条

---

## 📝 ドキュメント概要

### 目的

本ドキュメントは、GDPR第30条に基づき、AIフィットネスアプリ(仮称)におけるすべてのデータ処理活動を記録したものです。

### 適用範囲

- EEA(欧州経済領域)内のデータ主体の個人データ処理
- 日本国内のデータ主体の個人データ処理(個人情報保護法対応含む)

### 参照ドキュメント

| ドキュメント名 | バージョン | 参照目的 |
|--------------|-----------|---------|
| 要件定義書 | v3.2 | 機能要件・非機能要件 |
| プライバシーポリシー | v3.1 | データ処理の法的根拠 |
| 利用規約 | v3.1 | サービス定義 |
| システムアーキテクチャ設計書 | v3.2 | 技術的実装 |
| Firestoreデータベース設計書 | v3.2 | データ構造 |
| BigQuery設計書 | v3.2 | 分析データの処理 |
| API設計書(Firebase Functions) | v3.2 | データフロー |

### 用語定義

| 用語 | 定義 |
|-----|------|
| **データ管理者(Controller)** | 個人データの処理目的と手段を決定する者。本サービスにおいては[事業者名] |
| **データ処理者(Processor)** | データ管理者に代わって個人データを処理する者。本サービスではGoogle(Firebase/GCP)、Stripe、Apple、Google Play |
| **データ主体(Data Subject)** | 個人データによって識別される自然人。本サービスの利用者 |
| **処理活動(Processing Activity)** | 個人データに対して行われる操作。収集、記録、保存、利用、開示、削除等 |
| **仮名化(Pseudonymization)** | 追加情報を用いずに個人データを特定のデータ主体に帰属させることができないような処理(GDPR第4条5項) |
| **個人データ(Personal Data)** | 識別された又は識別され得る自然人に関する情報(GDPR第4条1項) |
| **特別カテゴリーの個人データ** | 人種、政治的意見、宗教的信条、健康データ等の機微な個人データ(GDPR第9条) |

---

## 目次

### Part 1: 基本情報とデータ処理活動の概要
1. [データ管理者情報](#1-データ管理者情報)
2. [データ保護責任者(DPO)情報](#2-データ保護責任者dpo情報)
3. [処理活動の概要](#3-処理活動の概要)
4. [データ処理の法的根拠](#4-データ処理の法的根拠)

### Part 2: 処理活動の詳細(認証・ユーザー管理)
5. [処理活動1: ユーザー認証とアカウント管理](#5-処理活動1-ユーザー認証とアカウント管理)
6. [処理活動2: プロフィール情報管理](#6-処理活動2-プロフィール情報管理)
7. [処理活動3: 同意管理](#7-処理活動3-同意管理)

### Part 3: 処理活動の詳細(トレーニングデータ)
8. [処理活動4: トレーニングセッション記録](#8-処理活動4-トレーニングセッション記録)
9. [処理活動5: 骨格座標データ収集](#9-処理活動5-骨格座標データ収集)
10. [処理活動6: セッションメタデータ収集](#10-処理活動6-セッションメタデータ収集)

### Part 4: 処理活動の詳細(その他)、セキュリティ、データ主体の権利
11. [処理活動7: 課金・決済情報処理](#11-処理活動7-課金決済情報処理)
12. [処理活動8: デバイス情報収集](#12-処理活動8-デバイス情報収集)
13. [処理活動9: メール通知](#13-処理活動9-メール通知)
14. [処理活動10: データ分析(BigQuery)](#14-処理活動10-データ分析bigquery)
15. [技術的・組織的セキュリティ対策](#15-技術的組織的セキュリティ対策)
16. [データ主体の権利行使](#16-データ主体の権利行使)
17. [データ侵害対応手順](#17-データ侵害対応手順)
18. [第三者へのデータ移転](#18-第三者へのデータ移転)
19. [データ保存期間と削除](#19-データ保存期間と削除)
20. [監査とレビュー](#20-監査とレビュー)

---

## 1. データ管理者情報

### 1.1 基本情報

| 項目 | 内容 |
|-----|------|
| **組織名** | [事業者名] |
| **法人格** | 株式会社/合同会社/個人事業主(該当するものを記載) |
| **代表者氏名** | [代表者名] |
| **登録住所** | [住所] |
| **連絡先電話番号** | [電話番号] |
| **連絡先メールアドレス** | contact@example.com |
| **Webサイト** | https://example.com |
| **設立日** | [設立日] |

### 1.2 事業内容

AIフィットネスアプリ(仮称)の開発・運営

**サービス概要**:
- スマートフォンアプリによるトレーニングフォーム確認補助
- MediaPipe Poseを用いた骨格検出による参考情報提供
- トレーニング記録の管理と可視化
- 将来的なカスタムMLモデル開発のためのデータ蓄積

**重要**: 本サービスは医療機器ではなく、診断・治療・予防を目的とするものではありません(利用規約v3.1第3.3条、プライバシーポリシーv3.1第2.3条)。

---

## 2. データ保護責任者(DPO)情報

### 2.1 DPO任命の必要性

**GDPR第37条1項**に基づき、以下の場合にDPOの任命が義務付けられます:

| 条件 | 本サービスの該当状況 |
|-----|------------------|
| (a) 公的機関または公的団体による処理 | ❌ 該当しない |
| (b) 大規模な体系的監視を伴う処理 | ❌ 該当しない(小規模MVP) |
| (c) 特別カテゴリーデータの大規模処理 | ❌ 該当しない(健康データは扱わない) |

**結論**: MVP期(Phase 1-2)においては、**DPOの任命は法的義務ではありません**。

ただし、以下の理由により、**任意でDPOまたはプライバシー担当者を指名することを推奨**します:
- 将来的な規模拡大に備える
- GDPR遵守の継続的な確認
- データ主体からの問い合わせ対応

### 2.2 プライバシー担当者情報(任意)

| 項目 | 内容 |
|-----|------|
| **氏名** | [担当者名] |
| **役職** | プライバシー担当者/DPO(任意) |
| **連絡先メールアドレス** | privacy@example.com |
| **連絡先電話番号** | [電話番号] |
| **責任範囲** | GDPR遵守の監督、データ主体の権利行使対応、データ侵害対応 |

**参照**: プライバシーポリシーv3.1第10条(お問い合わせ)

---

## 3. 処理活動の概要

### 3.1 処理活動の全体像

本サービスでは、以下の10の主要な処理活動があります:

| ID | 処理活動名 | データカテゴリー | 法的根拠 | データ主体 |
|----|-----------|----------------|---------|----------|
| **PA-01** | ユーザー認証とアカウント管理 | メールアドレス、パスワード(ハッシュ化)、UID | 契約履行(第6条1項(b)) | 利用者 |
| **PA-02** | プロフィール情報管理 | 氏名(任意)、生年月日(任意)、性別(任意) | 契約履行(第6条1項(b)) | 利用者 |
| **PA-03** | 同意管理 | 同意状態、同意取得日時、同意バージョン | 法的義務(第6条1項(c)) | 利用者 |
| **PA-04** | トレーニングセッション記録 | 種目、回数、セット、スコア、タイムスタンプ | 契約履行(第6条1項(b)) | 利用者 |
| **PA-05** | 骨格座標データ収集 | 33個の関節位置(x,y,z)、信頼度スコア | 同意(第6条1項(a)) | 利用者 |
| **PA-06** | セッションメタデータ収集 | セッションID、種目、回数、平均スコア | 正当な利益(第6条1項(f)) | 利用者 |
| **PA-07** | 課金・決済情報処理 | サブスクリプションステータス、プランID | 契約履行(第6条1項(b)) | 利用者 |
| **PA-08** | デバイス情報収集 | OS種別、OSバージョン、デバイスモデル | 正当な利益(第6条1項(f)) | 利用者 |
| **PA-09** | メール通知 | メールアドレス、通知内容 | 契約履行(第6条1項(b))、同意(第6条1項(a)) | 利用者 |
| **PA-10** | データ分析(BigQuery) | 仮名化されたトレーニングデータ | 正当な利益(第6条1項(f)) | 利用者 |

### 3.2 データフロー概要図

```
┌──────────────────────────────────────────────────────┐
│               データ主体(利用者)                      │
│               - スマートフォンアプリ                  │
└───────────────────┬──────────────────────────────────┘
                    ↓
        ┌──────────────────────┐
        │   Firebase Authentication    │
        │   - メール/パスワード認証    │
        │   - Google/Apple認証         │
        └───────────┬──────────────┘
                    ↓
        ┌──────────────────────┐
        │   Cloud Firestore            │
        │   - ユーザーデータ           │
        │   - トレーニング記録         │
        │   - 骨格座標データ           │
        └───────────┬──────────────┘
                    ↓
        ┌──────────────────────┐
        │   BigQuery                   │
        │   - 仮名化されたデータ       │
        │   - 統計分析                 │
        │   - ML学習準備               │
        └──────────────────────┘

        ┌──────────────────────┐
        │   第三者サービス             │
        ├──────────────────────┤
        │   - RevenueCat(課金)         │
        │   - Apple/Google(決済)       │
        │   - Firebase Cloud Messaging │
        └──────────────────────┘
```

### 3.3 データ最小化の原則(GDPR第5条1項(c))

**実装方針**:
1. **収集データの最小化**: 目的達成に必要最小限のデータのみ収集
2. **任意項目の活用**: 氏名、生年月日、性別は任意項目として設計
3. **カメラ映像の非保存**: オンデバイス処理により、カメラ映像はサーバーに送信しない
4. **仮名化の実施**: ユーザーIDをハッシュ化し、個人を直接特定できないようにする

**参照**: プライバシーポリシーv3.1第7条(データ最小化の原則)

---

## 4. データ処理の法的根拠

### 4.1 GDPR第6条1項の法的根拠

本サービスでは、GDPR第6条1項に基づき、以下の法的根拠でデータ処理を行います:

#### 4.1.1 同意(第6条1項(a))

**適用処理活動**:
- PA-05: 骨格座標データ収集
- PA-09: メール通知(マーケティング目的)

**同意の取得方法**:
- アプリ初回起動時に明示的な同意を取得
- チェックボックスによる能動的な同意
- 同意撤回の方法を明記

**参照**: プライバシーポリシーv3.1第5.1条、要件定義書v3.2 FR-024

#### 4.1.2 契約履行(第6条1項(b))

**適用処理活動**:
- PA-01: ユーザー認証とアカウント管理
- PA-02: プロフィール情報管理
- PA-04: トレーニングセッション記録
- PA-07: 課金・決済情報処理
- PA-09: メール通知(サービス関連)

**根拠**: これらの処理は、本サービスの提供に不可欠であり、契約履行のために必要

**参照**: 利用規約v3.1第5条、第6条

#### 4.1.3 法的義務(第6条1項(c))

**適用処理活動**:
- PA-03: 同意管理(GDPR第7条3項の記録義務)
- PA-07: 課金履歴の保存(税法上の保存義務)

**根拠**: GDPR第7条3項、日本の国税関係帳簿書類の保存義務

#### 4.1.4 正当な利益(第6条1項(f))

**適用処理活動**:
- PA-06: セッションメタデータ収集
- PA-08: デバイス情報収集
- PA-10: データ分析(BigQuery)

**当社の正当な利益**:
1. **サービスの安定提供**: デバイス情報収集により、互換性とパフォーマンスを確保
2. **不正利用の防止**: セキュリティとサービス品質の維持
3. **サービス改善**: 統計データに基づく機能開発の優先順位付け

**利用者の利益**:
1. 安定したサービス体験
2. 個人データの保護
3. 快適な動作速度

**利益衡量テスト(Balancing Test)**:
- **データの侵害性**: 低(デバイス情報のみ、個人特定困難)
- **利用者の期待**: 合理的(サービス安定化のため)
- **代替手段**: 限定的(デバイス情報なしでは安定提供困難)
- **透明性**: 高(プライバシーポリシーに明記)
- **データ最小化**: 遵守(必要最小限の情報のみ)

**結論**: 正当な利益が利用者の権利・自由を上回る

**参照**: プライバシーポリシーv3.1第5.2条、要件定義書v3.2第1.7節

### 4.2 特別カテゴリーの個人データ(GDPR第9条)

**本サービスの方針**: 特別カテゴリーの個人データ(健康データ等)は**収集しません**。

**理由**:
1. 本サービスは医療機器ではない(利用規約v3.1第3.3条)
2. 診断・治療・予防を目的としない(プライバシーポリシーv3.1第2.3条)
3. 骨格座標データは健康データに該当しない(個人の健康状態を示すものではない)

**参照**: プライバシーポリシーv3.1第6条(特別カテゴリーの個人データ)

### 4.3 日本の個人情報保護法との関係

本サービスは、GDPR準拠に加えて、日本の個人情報保護法にも準拠します。

| 項目 | GDPR | 日本の個人情報保護法 |
|-----|------|-------------------|
| **同意取得** | 第7条 | 第18条(利用目的の通知) |
| **利用目的の明示** | 第13条、第14条 | 第18条 |
| **安全管理措置** | 第32条 | 第23条 |
| **第三者提供** | 第44条以下 | 第27条 |
| **開示・訂正・削除** | 第15条、第16条、第17条 | 第33条、第34条、第35条 |

**参照**: プライバシーポリシーv3.1第11条(日本の個人情報保護法への準拠)

---

**Part 1 完了**

次のPart 2では、以下の処理活動の詳細を記載します:
- PA-01: ユーザー認証とアカウント管理
- PA-02: プロフィール情報管理
- PA-03: 同意管理
# データ処理記録(ROPA) v1.0 (Part 2/4)

## 5. 処理活動1: ユーザー認証とアカウント管理

### 5.1 処理活動の基本情報

| 項目 | 内容 |
|-----|------|
| **処理活動ID** | PA-01 |
| **処理活動名** | ユーザー認証とアカウント管理 |
| **処理目的** | ユーザーの本人確認とアカウント管理 |
| **法的根拠** | GDPR第6条1項(b) 契約履行 |
| **データカテゴリー** | 識別データ(メールアドレス、UID) |
| **データ主体** | 本サービスの利用者 |
| **保存期間** | アカウント削除まで、削除後30日以内に完全削除 |

### 5.2 収集する個人データ

#### 5.2.1 メールアドレス/パスワード認証

| データ項目 | データ型 | 必須/任意 | 目的 | 保存場所 |
|----------|---------|----------|------|---------|
| **メールアドレス** | String | 必須 | ユーザー識別、ログイン、連絡 | Firebase Authentication |
| **パスワード** | String(ハッシュ化) | 必須 | 認証 | Firebase Authentication(ハッシュ値のみ) |
| **UID** | String(自動生成) | 自動 | 内部的なユーザー識別子 | Firebase Authentication、Firestore |
| **作成日時** | Timestamp | 自動 | アカウント管理 | Firebase Authentication |
| **最終ログイン日時** | Timestamp | 自動 | アカウント管理 | Firebase Authentication |

**セキュリティ対策**:
- パスワードはFirebase Authenticationによりbcryptでハッシュ化
- 平文パスワードは保存されない
- メールアドレスの検証(Email Verification)を実施

#### 5.2.2 Google認証

| データ項目 | データ型 | 必須/任意 | 目的 | 保存場所 |
|----------|---------|----------|------|---------|
| **Googleアカウント情報** | Object | 必須 | ユーザー識別、ログイン | Firebase Authentication |
| **メールアドレス** | String | 必須 | ユーザー識別、連絡 | Firebase Authentication |
| **表示名** | String | 自動取得 | UI表示 | Firebase Authentication |
| **プロフィール画像URL** | String | 自動取得(任意) | UI表示 | Firebase Authentication |
| **UID** | String(自動生成) | 自動 | 内部的なユーザー識別子 | Firebase Authentication、Firestore |

**データ提供元**: Google LLC

#### 5.2.3 Apple認証

| データ項目 | データ型 | 必須/任意 | 目的 | 保存場所 |
|----------|---------|----------|------|---------|
| **AppleアカウントID** | String | 必須 | ユーザー識別、ログイン | Firebase Authentication |
| **メールアドレス** | String | 必須(または仮想アドレス) | ユーザー識別、連絡 | Firebase Authentication |
| **表示名** | String | 任意 | UI表示 | Firebase Authentication |
| **UID** | String(自動生成) | 自動 | 内部的なユーザー識別子 | Firebase Authentication、Firestore |

**データ提供元**: Apple Inc.

**Appleの「メールを非公開」機能**:
- ユーザーが選択した場合、仮想メールアドレスが提供される
- 仮想アドレスはAppleがリレーし、実際のアドレスに転送される

### 5.3 処理の詳細

#### 5.3.1 アカウント登録フロー

```
[ユーザーがアプリ起動]
        ↓
[認証方法選択]
 - メール/パスワード
 - Google
 - Apple
        ↓
[認証情報入力]
        ↓
[Firebase Authenticationで認証処理]
        ↓
[UIDの自動生成]
        ↓
[Firestoreにユーザードキュメント作成]
 - /users/{uid}
 - 初期プロフィール情報
        ↓
[同意取得画面表示]
 - 利用規約
 - プライバシーポリシー
        ↓
[アカウント登録完了]
```

**参照**: 要件定義書v3.2 FR-001、画面遷移図v3.3 3.3(ログイン画面)

#### 5.3.2 ログインフロー

```
[ユーザーがログイン]
        ↓
[認証情報入力]
        ↓
[Firebase Authenticationで認証]
        ↓
[同意状態確認](FR-024-1)
 - 利用規約の最新バージョンに同意済みか?
 - プライバシーポリシーの最新バージョンに同意済みか?
        ↓
[未同意の場合]
 → 同意画面表示
 → 同意取得
        ↓
[ホーム画面表示]
```

**参照**: 要件定義書v3.2 FR-024-1、画面遷移図v3.3

#### 5.3.3 アカウント削除フロー

```
[ユーザーがアカウント削除を選択]
        ↓
[確認ダイアログ表示]
 - 削除の影響を説明
 - 復元不可能であることを明示
        ↓
[パスワード再入力](本人確認)
        ↓
[削除処理実行]
 1. Firebase Authenticationのユーザー削除
 2. Firestoreのユーザーデータ削除
 3. BigQueryの論理削除フラグ設定
        ↓
[削除完了メール送信]
        ↓
[30日以内に物理削除]
 - BigQueryの自動削除スクリプト実行
```

**参照**: 要件定義書v3.2 FR-025、プライバシーポリシーv3.1第9.6条

### 5.4 データ処理者(Processor)

| 処理者名 | 所在国 | 役割 | データカテゴリー | 契約 |
|---------|--------|------|----------------|------|
| **Google LLC** | 米国 | Firebase Authentication提供 | メールアドレス、UID、認証情報 | Firebase Terms of Service |
| **Google Cloud** | 米国(データセンター: 日本) | インフラ提供 | すべての個人データ | Google Cloud Customer Agreement |

**データ移転の保護措置**:
- EU標準契約条項(SCCs)を使用
- Googleのデータ処理規約(Data Processing Amendment)に基づく

**参照**: プライバシーポリシーv3.1第4.3条(第三者サービス)

### 5.5 技術的・組織的セキュリティ対策

| 対策カテゴリー | 具体的対策 |
|-------------|----------|
| **暗号化** | TLS 1.3による通信暗号化、パスワードのハッシュ化(bcrypt) |
| **アクセス制御** | Firebase Security Rulesによるアクセス制御、最小権限の原則 |
| **監査ログ** | Cloud Loggingによるすべての認証イベントの記録 |
| **多要素認証** | Phase 3以降で実装予定 |
| **セッション管理** | Firebase Authenticationのトークンベース認証(有効期限1時間) |

**参照**: システムアーキテクチャ設計書v3.2、要件定義書v3.2 NFR-009〜NFR-012

### 5.6 データ主体の権利

| 権利 | 実装方法 | 対応期限 |
|-----|---------|---------|
| **アクセス権**(第15条) | プロフィール画面で閲覧可能 | 即時 |
| **訂正権**(第16条) | プロフィール画面で編集可能 | 即時 |
| **削除権**(第17条) | アカウント削除機能 | 30日以内に完全削除 |
| **ポータビリティ権**(第20条) | JSONエクスポート機能(Phase 2実装予定) | 1ヶ月以内 |
| **処理の制限権**(第18条) | privacy@example.comへの連絡 | 1ヶ月以内 |
| **異議権**(第21条) | privacy@example.comへの連絡 | 1ヶ月以内 |

**参照**: 要件定義書v3.2 FR-025〜FR-027、プライバシーポリシーv3.1第9条

---

## 6. 処理活動2: プロフィール情報管理

### 6.1 処理活動の基本情報

| 項目 | 内容 |
|-----|------|
| **処理活動ID** | PA-02 |
| **処理活動名** | プロフィール情報管理 |
| **処理目的** | ユーザーのプロフィール情報の管理、サービスのパーソナライズ |
| **法的根拠** | GDPR第6条1項(b) 契約履行 |
| **データカテゴリー** | 識別データ(氏名、生年月日、性別) |
| **データ主体** | 本サービスの利用者 |
| **保存期間** | アカウント削除まで、削除後30日以内に完全削除 |

### 6.2 収集する個人データ

| データ項目 | データ型 | 必須/任意 | 目的 | 保存場所 |
|----------|---------|----------|------|---------|
| **氏名** | String | 任意 | UI表示、利用者の識別 | Firestore(/users/{uid}) |
| **生年月日** | Timestamp | 任意 | 年齢確認、統計分析 | Firestore(/users/{uid}) |
| **性別** | Enum(male, female, other, prefer_not_to_say) | 任意 | 統計分析 | Firestore(/users/{uid}) |
| **身長** | Number(cm) | 任意 | トレーニング参考情報の最適化 | Firestore(/users/{uid}) |
| **体重** | Number(kg) | 任意 | トレーニング参考情報の最適化 | Firestore(/users/{uid}) |
| **プロフィール画像** | String(URL) | 任意 | UI表示 | Firebase Authentication(Google/Apple認証時のみ) |

**データ最小化の実装**:
- すべての項目を任意にすることで、データ最小化の原則(GDPR第5条1項(c))を実現
- ユーザーは必要最小限の情報のみ提供可能

**参照**: 要件定義書v3.2 FR-002、プライバシーポリシーv3.1第7条

### 6.3 処理の詳細

#### 6.3.1 プロフィール編集フロー

```
[ユーザーがプロフィール画面を開く]
        ↓
[現在のプロフィール情報を表示]
 - Firestoreから取得
        ↓
[ユーザーが情報を編集]
 - 氏名、生年月日、性別等
        ↓
[バリデーション]
 - 入力値の妥当性確認
 - 年齢制限の確認(13歳以上/16歳以上)
        ↓
[Firestoreに保存]
 - /users/{uid}のドキュメント更新
        ↓
[保存完了通知]
```

**参照**: 要件定義書v3.2 FR-002、画面遷移図v3.3 3.12(プロフィール画面)

#### 6.3.2 年齢制限の確認

**年齢制限**:
- 日本: 13歳以上(利用規約v3.1第4.1条)
- EEA: 16歳以上(GDPR第8条、プライバシーポリシーv3.1第11.1条)
- 未成年者(18歳未満): 親権者の同意が必要(利用規約v3.1第4.2条)

**実装**:
```javascript
// 生年月日から年齢を計算
const age = calculateAge(dateOfBirth);

// 地域ごとの年齢制限チェック
if (userRegion === 'EEA' && age < 16) {
  // 親権者の同意が必要
  showParentalConsentScreen();
} else if (age < 13) {
  // サービス利用不可
  showAgeRestrictionError();
} else if (age < 18) {
  // 親権者の同意が必要
  showParentalConsentScreen();
}
```

**参照**: 要件定義書v3.2第1.2.4節、プライバシーポリシーv3.1第11条

### 6.4 データ処理者(Processor)

| 処理者名 | 所在国 | 役割 | データカテゴリー | 契約 |
|---------|--------|------|----------------|------|
| **Google LLC** | 米国 | Cloud Firestore提供 | すべてのプロフィール情報 | Firebase Terms of Service |
| **Google Cloud** | 米国(データセンター: 日本) | インフラ提供 | すべてのプロフィール情報 | Google Cloud Customer Agreement |

### 6.5 技術的・組織的セキュリティ対策

| 対策カテゴリー | 具体的対策 |
|-------------|----------|
| **暗号化** | TLS 1.3による通信暗号化、AES-256によるデータ暗号化(at rest) |
| **アクセス制御** | Firebase Security Rules: ユーザーは自分のデータのみアクセス可能 |
| **監査ログ** | Cloud Loggingによるすべての書き込み操作の記録 |
| **バックアップ** | 自動バックアップ(日次)、PITR(Point-in-Time Recovery)対応 |

**参照**: システムアーキテクチャ設計書v3.2、Firestoreデータベース設計書v3.2

### 6.6 データ主体の権利

| 権利 | 実装方法 | 対応期限 |
|-----|---------|---------|
| **アクセス権**(第15条) | プロフィール画面で閲覧可能 | 即時 |
| **訂正権**(第16条) | プロフィール画面で編集可能 | 即時 |
| **削除権**(第17条) | プロフィール画面で各項目削除可能、またはアカウント削除 | 即時/30日以内 |
| **ポータビリティ権**(第20条) | JSONエクスポート機能(Phase 2実装予定) | 1ヶ月以内 |

**参照**: 要件定義書v3.2 FR-025〜FR-027

---

## 7. 処理活動3: 同意管理

### 7.1 処理活動の基本情報

| 項目 | 内容 |
|-----|------|
| **処理活動ID** | PA-03 |
| **処理活動名** | 同意管理 |
| **処理目的** | GDPRに基づく同意の記録と管理 |
| **法的根拠** | GDPR第6条1項(c) 法的義務(第7条3項の記録義務) |
| **データカテゴリー** | 同意状態、同意取得日時、同意バージョン |
| **データ主体** | 本サービスの利用者 |
| **保存期間** | 同意撤回後3年間(説明責任の履行) |

### 7.2 収集する個人データ

| データ項目 | データ型 | 必須/任意 | 目的 | 保存場所 |
|----------|---------|----------|------|---------|
| **利用規約同意状態** | Boolean | 必須 | 同意管理 | Firestore(/users/{uid}) |
| **利用規約同意日時** | Timestamp | 自動 | GDPR第7条3項の記録義務 | Firestore(/users/{uid}) |
| **利用規約バージョン** | String | 自動 | 同意した規約のバージョン管理 | Firestore(/users/{uid}) |
| **プライバシーポリシー同意状態** | Boolean | 必須 | 同意管理 | Firestore(/users/{uid}) |
| **プライバシーポリシー同意日時** | Timestamp | 自動 | GDPR第7条3項の記録義務 | Firestore(/users/{uid}) |
| **プライバシーポリシーバージョン** | String | 自動 | 同意したポリシーのバージョン管理 | Firestore(/users/{uid}) |
| **骨格座標データ収集同意** | Boolean | 任意 | 同意管理(第6条1項(a)) | Firestore(/users/{uid}) |
| **骨格座標データ収集同意日時** | Timestamp | 自動 | GDPR第7条3項の記録義務 | Firestore(/users/{uid}) |

**GDPR第7条3項準拠**:
> 「データ主体が同意を与えたという事実を証明できるように、管理者は同意を保持しなければならない」

**参照**: 要件定義書v3.2 FR-024、プライバシーポリシーv3.1第9.1条

### 7.3 処理の詳細

#### 7.3.1 初回同意取得フロー

```
[新規ユーザーがアカウント登録]
        ↓
[同意画面表示](画面遷移図v3.3 3.5)
 - 利用規約へのリンク
 - プライバシーポリシーへのリンク
 - 骨格座標データ収集に関する説明
        ↓
[ユーザーがチェックボックスをチェック]
 - 利用規約に同意する
 - プライバシーポリシーに同意する
 - 骨格座標データの収集に同意する(任意)
        ↓
[同意ボタンをタップ]
        ↓
[Firestoreに同意情報を記録]
 - consentedToTerms: true
 - consentToTermsDate: [現在日時]
 - termsVersion: "v3.1"
 - consentedToPrivacyPolicy: true
 - consentToPrivacyPolicyDate: [現在日時]
 - privacyPolicyVersion: "v3.1"
 - consentedToSkeletonDataCollection: true/false
 - consentToSkeletonDataDate: [現在日時]
        ↓
[サービス利用開始]
```

**参照**: 要件定義書v3.2 FR-024、画面遷移図v3.3 3.5

#### 7.3.2 ログイン時同意確認フロー(FR-024-1)

```
[既存ユーザーがログイン]
        ↓
[Firestoreから同意状態を取得]
        ↓
[最新バージョンと比較]
 - 現在のバージョン: v3.1
 - ユーザーが同意したバージョン: v2.0(例)
        ↓
[バージョンが異なる場合]
 → 同意画面表示(再同意が必要)
 → 変更内容のハイライト表示
 → 新バージョンへの同意取得
        ↓
[バージョンが同じ場合]
 → ホーム画面表示
```

**GDPR第7条3項準拠**: バージョン管理により、どの時点でどの内容に同意したかを記録

**参照**: 要件定義書v3.2 FR-024-1、画面遷移図v3.3

#### 7.3.3 同意撤回フロー

```
[ユーザーがプロフィール画面を開く]
        ↓
[同意管理セクションを表示](FR-002-1)
 - 骨格座標データ収集: [ON/OFF]
        ↓
[ユーザーがトグルをOFFにする]
        ↓
[確認ダイアログ表示]
 - 「骨格座標データの収集を停止しますか?」
 - 影響の説明
        ↓
[ユーザーが確認]
        ↓
[Firestoreの同意状態を更新]
 - consentedToSkeletonDataCollection: false
 - consentRevokedDate: [現在日時]
        ↓
[以降、骨格座標データは収集されない]
```

**GDPR第7条3項準拠**: 同意撤回の日時も記録し、説明責任を果たす

**参照**: 要件定義書v3.2 FR-002-1、プライバシーポリシーv3.1第9.1条

### 7.4 データ処理者(Processor)

| 処理者名 | 所在国 | 役割 | データカテゴリー | 契約 |
|---------|--------|------|----------------|------|
| **Google LLC** | 米国 | Cloud Firestore提供 | 同意状態、同意日時、バージョン情報 | Firebase Terms of Service |

### 7.5 技術的・組織的セキュリティ対策

| 対策カテゴリー | 具体的対策 |
|-------------|----------|
| **データ整合性** | Firestoreのトランザクション機能により、同意状態の整合性を保証 |
| **監査ログ** | すべての同意取得・撤回イベントをCloud Loggingに記録 |
| **バックアップ** | 同意記録の自動バックアップ(日次) |
| **アクセス制御** | Firebase Security Rules: ユーザーは自分の同意状態のみ閲覧・変更可能 |

### 7.6 データ主体の権利

| 権利 | 実装方法 | 対応期限 |
|-----|---------|---------|
| **アクセス権**(第15条) | プロフィール画面で同意状態を閲覧可能 | 即時 |
| **同意撤回権**(第7条3項) | プロフィール画面でトグルOFF | 即時 |

---

## 8. 処理活動4: トレーニングセッション記録

### 8.1 処理活動の基本情報

| 項目 | 内容 |
|-----|------|
| **処理活動ID** | PA-04 |
| **処理活動名** | トレーニングセッション記録 |
| **処理目的** | トレーニング履歴の管理、進捗の可視化 |
| **法的根拠** | GDPR第6条1項(b) 契約履行 |
| **データカテゴリー** | トレーニングデータ(種目、回数、セット、スコア) |
| **データ主体** | 本サービスの利用者 |
| **保存期間** | アカウント削除まで、削除後30日以内に完全削除 |

### 8.2 収集する個人データ

| データ項目 | データ型 | 必須/任意 | 目的 | 保存場所 |
|----------|---------|----------|------|---------|
| **セッションID** | String(UUID) | 自動生成 | セッション識別 | Firestore(/sessions/{sessionId}) |
| **ユーザーID** | String | 自動 | ユーザーとの紐付け | Firestore(/sessions/{sessionId}) |
| **種目** | Enum(squat, pushup, plank, lunge, burpee) | 自動 | トレーニング種目 | Firestore(/sessions/{sessionId}) |
| **回数** | Number | 自動 | 実行回数 | Firestore(/sessions/{sessionId}) |
| **セット数** | Number | 自動 | 実行セット数 | Firestore(/sessions/{sessionId}) |
| **平均スコア** | Number(0-100) | 自動 | 参考スコアの平均 | Firestore(/sessions/{sessionId}) |
| **セッション時間** | Number(秒) | 自動 | トレーニング時間 | Firestore(/sessions/{sessionId}) |
| **作成日時** | Timestamp | 自動 | セッション実施日時 | Firestore(/sessions/{sessionId}) |
| **メモ** | String | 任意 | ユーザーが入力したメモ | Firestore(/sessions/{sessionId}) |

**参照**: 要件定義書v3.2 FR-007、Firestoreデータベース設計書v3.2

### 8.3 処理の詳細

#### 8.3.1 セッション記録フロー

```
[ユーザーがトレーニングを完了]
        ↓
[セッション結果画面表示](画面遷移図v3.3 3.10)
 - 種目名
 - 回数
 - セット数
 - 平均スコア
 - セッション時間
        ↓
[ユーザーがメモを入力](任意)
        ↓
[保存ボタンをタップ]
        ↓
[Firestoreにセッションデータを保存]
 - /sessions/{sessionId}に新規ドキュメント作成
        ↓
[保存完了通知]
        ↓
[履歴画面に反映]
```

**参照**: 要件定義書v3.2 FR-007、画面遷移図v3.3 3.10

#### 8.3.2 履歴表示フロー

```
[ユーザーが履歴画面を開く](画面遷移図v3.3 3.11)
        ↓
[Firestoreからセッションデータを取得]
 - /sessions コレクション
 - where userId == 現在のユーザー
 - order by createdAt desc
        ↓
[カレンダー表示]
 - 月ごとのセッション数
 - 日ごとのセッション詳細
        ↓
[グラフ表示]
 - 週ごとの平均スコア
 - 月ごとのトレーニング回数
```

**参照**: 要件定義書v3.2 FR-008、画面遷移図v3.3 3.11

### 8.4 データ処理者(Processor)

| 処理者名 | 所在国 | 役割 | データカテゴリー | 契約 |
|---------|--------|------|----------------|------|
| **Google LLC** | 米国 | Cloud Firestore提供 | すべてのトレーニングセッションデータ | Firebase Terms of Service |
| **Google Cloud** | 米国(データセンター: 日本) | インフラ提供 | すべてのトレーニングセッションデータ | Google Cloud Customer Agreement |

### 8.5 技術的・組織的セキュリティ対策

| 対策カテゴリー | 具体的対策 |
|-------------|----------|
| **暗号化** | TLS 1.3による通信暗号化、AES-256によるデータ暗号化(at rest) |
| **アクセス制御** | Firebase Security Rules: ユーザーは自分のセッションデータのみアクセス可能 |
| **監査ログ** | Cloud Loggingによるすべての書き込み操作の記録 |
| **バックアップ** | 自動バックアップ(日次)、PITR対応 |

### 8.6 データ主体の権利

| 権利 | 実装方法 | 対応期限 |
|-----|---------|---------|
| **アクセス権**(第15条) | 履歴画面で閲覧可能 | 即時 |
| **訂正権**(第16条) | メモの編集機能(Phase 2実装予定) | 即時 |
| **削除権**(第17条) | 個別セッションの削除機能(Phase 2実装予定)、またはアカウント削除 | 即時/30日以内 |
| **ポータビリティ権**(第20条) | JSONエクスポート機能(Phase 2実装予定) | 1ヶ月以内 |

---

## 9. 処理活動5: 骨格座標データ収集

### 9.1 処理活動の基本情報

| 項目 | 内容 |
|-----|------|
| **処理活動ID** | PA-05 |
| **処理活動名** | 骨格座標データ収集 |
| **処理目的** | 将来のカスタムMLモデル開発のためのデータ蓄積 |
| **法的根拠** | GDPR第6条1項(a) 同意 |
| **データカテゴリー** | 骨格座標データ(33個の関節位置) |
| **データ主体** | 本サービスの利用者(同意した者のみ) |
| **保存期間** | アカウント削除まで、削除後30日以内に完全削除 |

### 9.2 収集する個人データ

| データ項目 | データ型 | 必須/任意 | 目的 | 保存場所 |
|----------|---------|----------|------|---------|
| **骨格座標データ** | Array[Object] | 自動(同意時のみ) | ML学習 | Firestore(/skeleton_data/{dataId}) |
| **関節位置(x, y, z)** | Number | 自動 | 骨格の位置情報 | Firestore |
| **信頼度スコア** | Number(0-1) | 自動 | 検出精度 | Firestore |
| **タイムスタンプ** | Timestamp | 自動 | フレームの時刻 | Firestore |
| **フレーム番号** | Number | 自動 | 連続性の確保 | Firestore |
| **セッションID** | String | 自動 | セッションとの紐付け | Firestore |
| **ユーザーID** | String | 自動 | ユーザーとの紐付け | Firestore |

**重要な特性**:
1. **カメラ映像は保存しない**: オンデバイス処理により、カメラ映像はサーバーに送信されない
2. **個人識別不可能**: 骨格座標データのみでは個人を特定できない
3. **同意が必要**: ユーザーの明示的な同意がある場合のみ収集

**参照**: 要件定義書v3.2 FR-028、プライバシーポリシーv3.1第5.1条

### 9.3 処理の詳細

#### 9.3.1 骨格座標データ収集フロー

```
[ユーザーがトレーニングを開始]
        ↓
[カメラ映像取得]
 - フロントカメラで撮影
        ↓
[MediaPipe Poseで骨格検出](オンデバイス)
 - 33個の関節位置を検出
 - x, y, z座標と信頼度スコアを抽出
        ↓
[カメラ映像を即座に破棄]
 - メモリから削除
 - サーバーに送信しない
        ↓
[同意確認]
 - consentedToSkeletonDataCollection == true?
        ↓
[同意がある場合のみFirestoreに保存]
 - /skeleton_data/{dataId}に新規ドキュメント作成
        ↓
[定期的にBigQueryにエクスポート]
 - ユーザーIDは仮名化(SHA-256ハッシュ)
 - 統計分析・ML学習準備
```

**参照**: 要件定義書v3.2 FR-028、付録B.1(カメラ映像処理フロー)

#### 9.3.2 データ構造

```json
{
  "dataId": "uuid",
  "sessionId": "session_uuid",
  "userId": "user_uid",
  "exerciseId": "squat",
  "timestamp": "2025-11-23T10:00:00Z",
  "frameNumber": 123,
  "landmarks": [
    {
      "index": 0,
      "name": "nose",
      "x": 0.5,
      "y": 0.5,
      "z": 0.0,
      "visibility": 0.99
    },
    // ... 32個の関節データ
  ]
}
```

### 9.4 プライバシー保護措置

| 保護措置 | 詳細 |
|---------|------|
| **カメラ映像の非保存** | オンデバイス処理により、カメラ映像はサーバーに送信されない |
| **同意取得** | ユーザーの明示的な同意がある場合のみ収集 |
| **同意撤回** | いつでも同意を撤回可能(プロフィール画面) |
| **仮名化** | BigQueryエクスポート時にユーザーIDをハッシュ化 |
| **個人識別不可能** | 骨格座標データのみでは個人を特定できない |
| **アクセス制御** | Firebase Security Rulesによるアクセス制御 |

**参照**: プライバシーポリシーv3.1第8条(プライバシー保護の技術的措置)

### 9.5 データ処理者(Processor)

| 処理者名 | 所在国 | 役割 | データカテゴリー | 契約 |
|---------|--------|------|----------------|------|
| **Google LLC** | 米国 | Cloud Firestore提供 | 骨格座標データ | Firebase Terms of Service |
| **Google Cloud** | 米国(データセンター: 日本) | BigQuery、インフラ提供 | 骨格座標データ(仮名化済み) | Google Cloud Customer Agreement |

### 9.6 技術的・組織的セキュリティ対策

| 対策カテゴリー | 具体的対策 |
|-------------|----------|
| **暗号化** | TLS 1.3による通信暗号化、AES-256によるデータ暗号化(at rest) |
| **アクセス制御** | Firebase Security Rules、最小権限の原則 |
| **監査ログ** | Cloud Loggingによるすべてのアクセスの記録 |
| **オンデバイス処理** | カメラ映像は端末上でのみ処理、サーバーに送信しない |
| **仮名化** | BigQueryエクスポート時にSHA-256ハッシュ化 |

### 9.7 データ主体の権利

| 権利 | 実装方法 | 対応期限 |
|-----|---------|---------|
| **アクセス権**(第15条) | privacy@example.comへの連絡 | 1ヶ月以内 |
| **削除権**(第17条) | アカウント削除機能 | 30日以内に完全削除 |
| **ポータビリティ権**(第20条) | JSONエクスポート機能(Phase 2実装予定) | 1ヶ月以内 |
| **同意撤回権**(第7条3項) | プロフィール画面でトグルOFF | 即時(以降収集停止) |

---

## 10. 処理活動6: セッションメタデータ収集

### 10.1 処理活動の基本情報

| 項目 | 内容 |
|-----|------|
| **処理活動ID** | PA-06 |
| **処理活動名** | セッションメタデータ収集 |
| **処理目的** | サービス改善のための統計データ収集 |
| **法的根拠** | GDPR第6条1項(f) 正当な利益 |
| **データカテゴリー** | セッションメタデータ(種目、回数、平均スコア等) |
| **データ主体** | 本サービスの利用者 |
| **保存期間** | 2年間(GDPR第5条1項(e)) |

### 10.2 収集する個人データ

| データ項目 | データ型 | 必須/任意 | 目的 | 保存場所 |
|----------|---------|----------|------|---------|
| **セッションID** | String(UUID) | 自動生成 | セッション識別 | BigQuery |
| **ユーザーID(仮名化)** | String(SHA-256ハッシュ) | 自動 | 統計分析 | BigQuery |
| **種目** | Enum | 自動 | 人気種目の分析 | BigQuery |
| **回数** | Number | 自動 | 利用状況の分析 | BigQuery |
| **セット数** | Number | 自動 | 利用状況の分析 | BigQuery |
| **セッション時間** | Number(秒) | 自動 | パフォーマンス分析 | BigQuery |
| **平均スコア** | Number | 自動 | 品質分析 | BigQuery |
| **作成日時** | Timestamp | 自動 | 時系列分析 | BigQuery |
| **デバイス情報** | Object | 自動 | 互換性確認 | BigQuery |

**仮名化処理**:
- ユーザーIDはSHA-256でハッシュ化
- 個人を直接特定できないようにする
- GDPR第4条5項(仮名化)に準拠

**参照**: 要件定義書v3.2 FR-029、プライバシーポリシーv3.1第5.2条

### 10.3 正当な利益の詳細(GDPR第6条1項(f))

#### 10.3.1 当社の正当な利益

1. **サービス改善**: 利用状況の分析により、ユーザーニーズに合った機能開発
2. **パフォーマンス最適化**: デバイス情報に基づく互換性とパフォーマンスの向上
3. **統計分析**: 集計データによる傾向把握と課題発見

#### 10.3.2 利用者の利益

1. より良いサービス体験
2. 自分のニーズに合った機能の提供
3. 安定したパフォーマンス

#### 10.3.3 利益衡量テスト(Balancing Test)

| 評価項目 | 評価結果 |
|---------|---------|
| **データの侵害性** | 低(仮名化されたメタデータのみ、個人特定困難) |
| **利用者の期待** | 合理的(サービス改善のためのデータ収集は一般的) |
| **代替手段** | 限定的(統計データなしではサービス改善困難) |
| **透明性** | 高(プライバシーポリシーに明記) |
| **データ最小化** | 遵守(必要最小限のメタデータのみ) |
| **保存期間** | 2年間(必要最小限) |

**結論**: 正当な利益が利用者の権利・自由を上回る

**参照**: プライバシーポリシーv3.1第5.2条、要件定義書v3.2第1.7節

### 10.4 処理の詳細

#### 10.4.1 セッションメタデータ収集フロー

```
[ユーザーがトレーニングセッションを完了]
        ↓
[セッションデータをFirestoreに保存]
        ↓
[定期的にBigQueryにエクスポート](日次バッチ)
 - Firestore → BigQuery Data Transfer Service
 - ユーザーIDを仮名化(SHA-256)
        ↓
[BigQueryで集計・分析]
 - 日次/週次/月次の集計
 - 種目別の人気ランキング
 - デバイス別のパフォーマンス分析
```

**参照**: BigQuery設計書v3.2第5節(データパイプライン設計)

#### 10.4.2 利用例

**統計分析の例**:
1. **人気種目ランキング**: どの種目が最も利用されているか
2. **利用時間帯分析**: いつトレーニングする人が多いか
3. **継続率分析**: ユーザーの継続利用状況
4. **デバイス互換性**: どのデバイスで問題が発生しているか

**個人を特定しない**: すべての分析は集計データに基づき、個人を特定しない

### 10.5 データ処理者(Processor)

| 処理者名 | 所在国 | 役割 | データカテゴリー | 契約 |
|---------|--------|------|----------------|------|
| **Google LLC** | 米国 | Cloud Firestore提供 | セッションメタデータ | Firebase Terms of Service |
| **Google Cloud** | 米国(データセンター: 日本) | BigQuery、インフラ提供 | セッションメタデータ(仮名化済み) | Google Cloud Customer Agreement |

### 10.6 技術的・組織的セキュリティ対策

| 対策カテゴリー | 具体的対策 |
|-------------|----------|
| **仮名化** | ユーザーIDのSHA-256ハッシュ化 |
| **暗号化** | TLS 1.3による通信暗号化、AES-256によるデータ暗号化(at rest) |
| **アクセス制御** | BigQuery IAMによるアクセス制御、最小権限の原則 |
| **監査ログ** | Cloud Loggingによるすべてのアクセスの記録 |
| **データ保存期間管理** | 2年経過後の自動削除スクリプト |

### 10.7 データ主体の権利

| 権利 | 実装方法 | 対応期限 |
|-----|---------|---------|
| **アクセス権**(第15条) | privacy@example.comへの連絡 | 1ヶ月以内 |
| **削除権**(第17条) | アカウント削除機能 | 30日以内に完全削除 |
| **異議権**(第21条) | privacy@example.comへの連絡、処理停止 | 1ヶ月以内 |

**参照**: プライバシーポリシーv3.1第9条(データ主体の権利)

---

**Part 2 完了**

次のPart 3では、以下の処理活動の詳細を記載します:
- PA-07: 課金・決済情報処理
- PA-08: デバイス情報収集
- PA-09: メール通知
- PA-10: データ分析(BigQuery)
# データ処理記録(ROPA) v1.0 (Part 3/4)

## 11. 処理活動7: 課金・決済情報処理

### 11.1 処理活動の基本情報

| 項目 | 内容 |
|-----|------|
| **処理活動ID** | PA-07 |
| **処理活動名** | 課金・決済情報処理 |
| **処理目的** | 有料プランの課金管理、領収書発行 |
| **法的根拠** | GDPR第6条1項(b) 契約履行、第6条1項(c) 法的義務(税法上の保存義務) |
| **データカテゴリー** | サブスクリプション情報、取引履歴 |
| **データ主体** | 有料プラン利用者 |
| **保存期間** | 契約期間中+7年間(税法上の保存義務) |

### 11.2 収集する個人データ

#### 11.2.1 当社が保存するデータ

| データ項目 | データ型 | 必須/任意 | 目的 | 保存場所 |
|----------|---------|----------|------|---------|
| **サブスクリプションID** | String | 自動生成 | サブスクリプション識別 | Firestore(/users/{uid}/subscriptions/{subId}) |
| **プランID** | String | 自動 | 契約プランの識別 | Firestore |
| **ステータス** | Enum(active, canceled, expired) | 自動 | 契約状態 | Firestore |
| **開始日** | Timestamp | 自動 | 契約開始日 | Firestore |
| **終了日** | Timestamp | 自動 | 契約終了日 | Firestore |
| **次回課金日** | Timestamp | 自動 | 課金スケジュール | Firestore |
| **RevenueCatユーザーID** | String | 自動 | RevenueCatとの紐付け | Firestore |
| **取引履歴** | Array[Object] | 自動 | 課金履歴 | Firestore |

**重要**: 決済情報(クレジットカード番号等)は**当社では保存しません**

#### 11.2.2 第三者が保存するデータ

| データ項目 | 保存先 | 目的 |
|----------|--------|------|
| **クレジットカード番号** | Apple/Google | 決済処理 |
| **CVV** | Apple/Google | 決済処理 |
| **有効期限** | Apple/Google | 決済処理 |
| **請求先住所** | Apple/Google | 決済処理 |
| **決済履歴** | Apple/Google/RevenueCat | 決済管理 |

**PCI DSS準拠**: 決済情報はApple/Googleが管理し、PCI DSSに準拠

**参照**: 要件定義書v3.2 FR-020、利用規約v3.1第6条

### 11.3 処理の詳細

#### 11.3.1 サブスクリプション開始フロー

```
[ユーザーが有料プランを選択]
        ↓
[App Store/Google Playの決済画面へ遷移]
 - Apple/Googleの決済システムを使用
        ↓
[ユーザーが決済情報を入力]
 - クレジットカード情報等
 - 当社は決済情報を取得しない
        ↓
[決済完了]
        ↓
[RevenueCatがWebhookで通知]
 - サブスクリプション開始
 - トランザクション情報
        ↓
[Firebase Functionsで処理]
 - Firestoreにサブスクリプション情報を保存
 - ユーザーのプラン権限を更新
        ↓
[アプリ内でプレミアム機能が利用可能に]
```

**参照**: 要件定義書v3.2 FR-020、API設計書v3.2

#### 11.3.2 サブスクリプション更新フロー

```
[次回課金日が近づく]
        ↓
[Apple/Googleが自動的に課金]
        ↓
[RevenueCatがWebhookで通知]
        ↓
[Firebase Functionsで処理]
 - 次回課金日を更新
 - ステータスをactiveに維持
        ↓
[継続利用可能]
```

#### 11.3.3 サブスクリプションキャンセルフロー

```
[ユーザーがApp Store/Google Playでキャンセル]
        ↓
[RevenueCatがWebhookで通知]
        ↓
[Firebase Functionsで処理]
 - ステータスをcanceledに変更
 - 終了日を設定(現在の期間終了日)
        ↓
[期間終了まで利用可能]
        ↓
[期間終了後、無料プランに降格]
```

**参照**: 利用規約v3.1第6.6条(解約)

### 11.4 データ処理者(Processor)

| 処理者名 | 所在国 | 役割 | データカテゴリー | 契約 |
|---------|--------|------|----------------|------|
| **RevenueCat Inc.** | 米国 | サブスクリプション管理 | サブスクリプション情報、取引履歴 | RevenueCat Terms of Service |
| **Apple Inc.** | 米国 | 決済処理(iOS) | 決済情報、取引履歴 | Apple Developer Agreement |
| **Google LLC** | 米国 | 決済処理(Android) | 決済情報、取引履歴 | Google Play Developer Distribution Agreement |
| **Google LLC** | 米国 | Cloud Firestore提供 | サブスクリプション情報 | Firebase Terms of Service |

**PCI DSS準拠**: Apple、Googleは決済情報をPCI DSSに準拠して管理

**参照**: プライバシーポリシーv3.1第4.3条

### 11.5 技術的・組織的セキュリティ対策

| 対策カテゴリー | 具体的対策 |
|-------------|----------|
| **決済情報の非保存** | 当社は決済情報を一切保存しない |
| **PCI DSS準拠** | Apple/GoogleがPCI DSSに準拠した決済処理を実施 |
| **通信暗号化** | TLS 1.3によるすべての通信の暗号化 |
| **Webhook検証** | RevenueCatからのWebhookを署名検証 |
| **アクセス制御** | Firebase Security Rulesによるアクセス制御 |
| **監査ログ** | Cloud Loggingによるすべてのサブスクリプション変更の記録 |

### 11.6 データ保存期間

| データ種別 | 保存期間 | 法的根拠 |
|----------|---------|---------|
| **サブスクリプション情報(アクティブ)** | 契約期間中 | 契約履行(第6条1項(b)) |
| **取引履歴** | 7年間 | 日本の国税関係帳簿書類の保存義務(国税通則法) |
| **キャンセルされたサブスクリプション** | 7年間 | 税法上の保存義務 |

**参照**: 利用規約v3.1第15.2条

### 11.7 データ主体の権利

| 権利 | 実装方法 | 対応期限 |
|-----|---------|---------|
| **アクセス権**(第15条) | プロフィール画面で閲覧可能 | 即時 |
| **削除権**(第17条) | アカウント削除可能(ただし税法上の保存義務があるデータは7年間保存) | 30日以内(一部例外あり) |
| **ポータビリティ権**(第20条) | JSONエクスポート機能(Phase 2実装予定) | 1ヶ月以内 |

**注意**: 税法上の保存義務があるデータ(取引履歴等)は、GDPR第17条3項(e)に基づき、7年間保存されます。

---

## 12. 処理活動8: デバイス情報収集

### 12.1 処理活動の基本情報

| 項目 | 内容 |
|-----|------|
| **処理活動ID** | PA-08 |
| **処理活動名** | デバイス情報収集 |
| **処理目的** | サービスの安定提供、不正利用の防止、パフォーマンス最適化 |
| **法的根拠** | GDPR第6条1項(f) 正当な利益 |
| **データカテゴリー** | デバイス情報(OS、バージョン、モデル) |
| **データ主体** | 本サービスの利用者 |
| **保存期間** | 1年間 |

### 12.2 収集する個人データ

#### 12.2.1 収集するデバイス情報

| データ項目 | データ型 | 目的 | 保存場所 |
|----------|---------|------|---------|
| **OS種別** | Enum(iOS, Android) | 互換性確認 | Firestore(/users/{uid}/devices/{deviceId}) |
| **OSバージョン** | String | 互換性確認 | Firestore |
| **デバイスモデル** | String | パフォーマンス最適化 | Firestore |
| **アプリバージョン** | String | バグ追跡 | Firestore |
| **IPアドレス(匿名化)** | String(最後のオクテットをマスク) | 不正利用防止 | Cloud Logging(一時的) |
| **タイムゾーン** | String | 通知の最適化 | Firestore |
| **言語設定** | String | UI言語の設定 | Firestore |

#### 12.2.2 収集しないデバイス情報

| データ項目 | 理由 |
|----------|------|
| **デバイスID(UDID/IMEI)** | プライバシー侵害のリスクが高い |
| **電話番号** | 不要(認証はメールアドレスで実施) |
| **連絡先** | サービス提供に不要 |
| **位置情報(GPS)** | サービス提供に不要 |
| **インストール済みアプリリスト** | プライバシー侵害のリスクが高い |

**データ最小化の実装**: 必要最小限のデバイス情報のみ収集

**参照**: 要件定義書v3.2第1.7節、プライバシーポリシーv3.1第5.2条

### 12.3 正当な利益の詳細(GDPR第6条1項(f))

#### 12.3.1 当社の正当な利益

1. **サービスの安定提供**: デバイス互換性の確認とパフォーマンス最適化
2. **不正利用の防止**: セキュリティとサービス品質の維持
3. **バグ修正**: デバイス固有の問題の特定と修正

#### 12.3.2 利用者の利益

1. 安定したサービス体験
2. 個人データの保護
3. 快適な動作速度
4. デバイスに最適化されたUI

#### 12.3.3 利益衡量テスト(Balancing Test)

| 評価項目 | 評価結果 |
|---------|---------|
| **データの侵害性** | 低(デバイス情報のみ、個人特定困難) |
| **利用者の期待** | 合理的(サービス安定化のため) |
| **代替手段** | 限定的(デバイス情報なしでは互換性確認困難) |
| **透明性** | 高(プライバシーポリシーに明記) |
| **データ最小化** | 遵守(必要最小限の情報のみ) |
| **保存期間** | 1年間(必要最小限) |

**結論**: 正当な利益が利用者の権利・自由を上回る

**参照**: プライバシーポリシーv3.1第5.2条、要件定義書v3.2第1.7節

### 12.4 処理の詳細

#### 12.4.1 デバイス情報収集フロー

```
[アプリ起動時]
        ↓
[デバイス情報を取得]
 - OS種別、OSバージョン
 - デバイスモデル
 - アプリバージョン
        ↓
[Firestoreに保存]
 - /users/{uid}/devices/{deviceId}
 - 既存のデバイス情報があれば更新
        ↓
[互換性確認]
 - サポートされているOSバージョンか?
 - 既知の問題があるデバイスか?
        ↓
[問題がある場合]
 → 警告メッセージ表示
 → アップデートを推奨
```

**参照**: システムアーキテクチャ設計書v3.2

#### 12.4.2 利用例

**互換性確認の例**:
1. **OSバージョンチェック**: iOS 14以上、Android 8.0以上をサポート
2. **デバイスモデル**: 古いデバイスではパフォーマンス警告を表示
3. **バグ修正**: デバイス固有の問題を特定し、修正

**パフォーマンス最適化の例**:
1. **画質調整**: 古いデバイスでは画質を下げてパフォーマンスを確保
2. **フレームレート調整**: デバイスの性能に応じてフレームレートを調整

### 12.5 データ処理者(Processor)

| 処理者名 | 所在国 | 役割 | データカテゴリー | 契約 |
|---------|--------|------|----------------|------|
| **Google LLC** | 米国 | Cloud Firestore提供 | デバイス情報 | Firebase Terms of Service |
| **Google Cloud** | 米国(データセンター: 日本) | インフラ提供 | デバイス情報 | Google Cloud Customer Agreement |

### 12.6 技術的・組織的セキュリティ対策

| 対策カテゴリー | 具体的対策 |
|-------------|----------|
| **データ最小化** | 必要最小限のデバイス情報のみ収集 |
| **匿名化** | IPアドレスの最後のオクテットをマスク |
| **暗号化** | TLS 1.3による通信暗号化、AES-256によるデータ暗号化(at rest) |
| **アクセス制御** | Firebase Security Rulesによるアクセス制御 |
| **保存期間管理** | 1年経過後の自動削除スクリプト |

### 12.7 データ主体の権利

| 権利 | 実装方法 | 対応期限 |
|-----|---------|---------|
| **アクセス権**(第15条) | privacy@example.comへの連絡 | 1ヶ月以内 |
| **削除権**(第17条) | アカウント削除機能 | 30日以内に完全削除 |
| **異議権**(第21条) | privacy@example.comへの連絡、処理停止 | 1ヶ月以内 |

---

## 13. 処理活動9: メール通知

### 13.1 処理活動の基本情報

| 項目 | 内容 |
|-----|------|
| **処理活動ID** | PA-09 |
| **処理活動名** | メール通知 |
| **処理目的** | サービス関連の重要な通知、マーケティング(オプトイン) |
| **法的根拠** | GDPR第6条1項(b) 契約履行(サービス関連)、第6条1項(a) 同意(マーケティング) |
| **データカテゴリー** | メールアドレス、通知内容 |
| **データ主体** | 本サービスの利用者 |
| **保存期間** | アカウント削除まで、削除後30日以内に完全削除 |

### 13.2 メール通知の種類

#### 13.2.1 サービス関連通知(オプトアウト不可)

| 通知種別 | 法的根拠 | 頻度 | 例 |
|---------|---------|------|-----|
| **アカウント関連** | 契約履行(第6条1項(b)) | 必要時 | アカウント作成確認、パスワード変更通知 |
| **セキュリティ関連** | 契約履行(第6条1項(b)) | 必要時 | 不正ログイン検知、2FA設定変更 |
| **サブスクリプション関連** | 契約履行(第6条1項(b)) | 必要時 | 課金完了、プラン変更確認 |
| **サービス重要変更** | 契約履行(第6条1項(b)) | 必要時 | 利用規約変更、重大な機能変更 |
| **データ削除完了** | 契約履行(第6条1項(b)) | 1回(削除時) | アカウント削除完了通知 |

**オプトアウト不可の理由**: サービス提供に不可欠な通知のため

#### 13.2.2 マーケティング通知(オプトイン必須)

| 通知種別 | 法的根拠 | 頻度 | 例 |
|---------|---------|------|-----|
| **新機能紹介** | 同意(第6条1項(a)) | 月1回程度 | 新しい種目追加、機能アップデート |
| **キャンペーン** | 同意(第6条1項(a)) | 不定期 | 割引キャンペーン、紹介プログラム |
| **ニュースレター** | 同意(第6条1項(a)) | 月1回程度 | フィットネスTips、利用者の成功事例 |

**オプトイン必須**: ユーザーが明示的に同意した場合のみ送信

**参照**: 要件定義書v3.2 FR-018、利用規約v3.1第15条

### 13.3 処理の詳細

#### 13.3.1 メール通知送信フロー

```
[トリガーイベント発生]
 - アカウント作成
 - サブスクリプション変更
 - セキュリティイベント
        ↓
[通知種別を判定]
 - サービス関連? → 即座に送信
 - マーケティング? → 同意確認
        ↓
[マーケティングメールの場合]
 - ユーザーのメール通知設定を確認
 - emailMarketingConsent == true?
        ↓
[同意がある場合のみ]
 → メール送信(Firebase Extensions: Trigger Email)
 → 配信ログをFirestoreに記録
        ↓
[オプトアウトリンクを含める]
 - すべてのマーケティングメールに配信停止リンク
```

**参照**: API設計書v3.2

#### 13.3.2 オプトアウトフロー

```
[ユーザーがメール内の配信停止リンクをクリック]
        ↓
[オプトアウト確認画面表示]
        ↓
[ユーザーが確認]
        ↓
[Firestoreの設定を更新]
 - emailMarketingConsent: false
 - emailOptOutDate: [現在日時]
        ↓
[以降、マーケティングメールは送信されない]
```

**GDPR第21条(異議権)準拠**: いつでもマーケティングメールを停止可能

### 13.4 収集する個人データ

| データ項目 | データ型 | 目的 | 保存場所 |
|----------|---------|------|---------|
| **メールアドレス** | String | メール送信先 | Firebase Authentication、Firestore |
| **メール通知設定** | Boolean | マーケティングメールの同意状態 | Firestore(/users/{uid}) |
| **メール送信履歴** | Array[Object] | 配信管理、トラブルシューティング | Firestore(/email_logs/{logId}) |
| **配信停止日時** | Timestamp | オプトアウト記録 | Firestore(/users/{uid}) |

### 13.5 データ処理者(Processor)

| 処理者名 | 所在国 | 役割 | データカテゴリー | 契約 |
|---------|--------|------|----------------|------|
| **Firebase Extensions** | 米国 | メール送信 | メールアドレス、通知内容 | Firebase Terms of Service |
| **SendGrid(Twilioの一部)** | 米国 | メール配信インフラ | メールアドレス、通知内容 | SendGrid Terms of Service |

**参照**: プライバシーポリシーv3.1第4.3条

### 13.6 技術的・組織的セキュリティ対策

| 対策カテゴリー | 具体的対策 |
|-------------|----------|
| **同意管理** | マーケティングメールは明示的な同意がある場合のみ送信 |
| **オプトアウト** | すべてのマーケティングメールに配信停止リンクを含める |
| **暗号化** | TLS 1.3による通信暗号化 |
| **アクセス制御** | メール送信権限は最小限のサービスアカウントのみ |
| **監査ログ** | すべてのメール送信をCloud Loggingに記録 |
| **頻度制限** | スパム防止のため、送信頻度を制限 |

### 13.7 データ主体の権利

| 権利 | 実装方法 | 対応期限 |
|-----|---------|---------|
| **アクセス権**(第15条) | プロフィール画面で設定閲覧可能 | 即時 |
| **異議権**(第21条) | メール内の配信停止リンク、またはプロフィール画面で設定変更 | 即時 |
| **削除権**(第17条) | アカウント削除機能 | 30日以内に完全削除 |

---

## 14. 処理活動10: データ分析(BigQuery)

### 14.1 処理活動の基本情報

| 項目 | 内容 |
|-----|------|
| **処理活動ID** | PA-10 |
| **処理活動名** | データ分析(BigQuery) |
| **処理目的** | サービス改善、統計分析、将来のML学習準備 |
| **法的根拠** | GDPR第6条1項(f) 正当な利益 |
| **データカテゴリー** | 仮名化されたトレーニングデータ |
| **データ主体** | 本サービスの利用者 |
| **保存期間** | トレーニング記録:アカウント削除まで、メタデータ:2年間 |

### 14.2 収集する個人データ

| データ項目 | データ型 | 目的 | 保存場所 |
|----------|---------|------|---------|
| **ユーザーID(仮名化)** | String(SHA-256ハッシュ) | 統計分析 | BigQuery(fitness_analytics.training_sessions) |
| **セッションID** | String(UUID) | セッション識別 | BigQuery |
| **種目** | Enum | 人気種目の分析 | BigQuery |
| **回数・セット数** | Number | 利用状況の分析 | BigQuery |
| **平均スコア** | Number | 品質分析 | BigQuery |
| **セッション時間** | Number(秒) | パフォーマンス分析 | BigQuery |
| **作成日時** | Timestamp | 時系列分析 | BigQuery |
| **骨格座標データ(仮名化)** | Array[Object] | ML学習準備 | BigQuery(fitness_analytics.skeleton_data) |
| **デバイス情報** | Object | 互換性分析 | BigQuery |

**仮名化処理**: ユーザーIDはSHA-256でハッシュ化し、個人を直接特定できないようにする

**参照**: BigQuery設計書v3.2、要件定義書v3.2 FR-028、FR-029

### 14.3 正当な利益の詳細(GDPR第6条1項(f))

#### 14.3.1 当社の正当な利益

1. **サービス改善**: 利用状況の分析により、ユーザーニーズに合った機能開発
2. **統計分析**: 集計データによる傾向把握と課題発見
3. **ML学習準備**: 将来のカスタムMLモデル開発のためのデータ蓄積

#### 14.3.2 利用者の利益

1. より良いサービス体験
2. 自分のニーズに合った機能の提供
3. より正確なフォーム確認補助(将来)

#### 14.3.3 利益衡量テスト(Balancing Test)

| 評価項目 | 評価結果 |
|---------|---------|
| **データの侵害性** | 低(仮名化済み、集計データのみ使用) |
| **利用者の期待** | 合理的(サービス改善のためのデータ分析は一般的) |
| **代替手段** | 限定的(データなしではサービス改善困難) |
| **透明性** | 高(プライバシーポリシーに明記) |
| **データ最小化** | 遵守(必要最小限のデータのみ) |
| **保存期間** | 2年間(必要最小限) |

**結論**: 正当な利益が利用者の権利・自由を上回る

**参照**: プライバシーポリシーv3.1第5.2条、要件定義書v3.2第1.7節

### 14.4 処理の詳細

#### 14.4.1 データパイプライン

```
[Firestoreにデータ保存]
 - /sessions/{sessionId}
 - /skeleton_data/{dataId}
        ↓
[日次バッチ処理](Cloud Scheduler)
 - Firestore → BigQuery Data Transfer Service
        ↓
[ユーザーIDの仮名化]
 - SHA-256ハッシュ化
 - 元のuserIdは送信しない
        ↓
[BigQueryに挿入]
 - fitness_analytics.training_sessions
 - fitness_analytics.skeleton_data
        ↓
[集計クエリ実行]
 - 日次/週次/月次の集計
 - 種目別の統計
 - デバイス別のパフォーマンス分析
        ↓
[結果を可視化]
 - Data Studio(オプション)
 - 社内ダッシュボード
```

**参照**: BigQuery設計書v3.2第5節(データパイプライン設計)

#### 14.4.2 分析の例

**統計分析の例**:
1. **人気種目ランキング**: どの種目が最も利用されているか
2. **継続率分析**: ユーザーの継続利用状況
3. **スコア分布**: ユーザーのスコアの分布と傾向
4. **デバイス互換性**: どのデバイスで問題が発生しているか

**ML学習準備の例**(Phase 4以降):
1. **骨格座標データの蓄積**: 10,000セッション以上のデータ蓄積
2. **データクリーニング**: 異常値の除去、正規化
3. **特徴量エンジニアリング**: ML学習に適したデータ形式への変換
4. **モデル学習**: カスタムMLモデルのトレーニング

**個人を特定しない**: すべての分析は集計データまたは仮名化データに基づき、個人を特定しない

### 14.5 データ処理者(Processor)

| 処理者名 | 所在国 | 役割 | データカテゴリー | 契約 |
|---------|--------|------|----------------|------|
| **Google Cloud** | 米国(データセンター: 日本) | BigQuery提供 | 仮名化されたトレーニングデータ | Google Cloud Customer Agreement |
| **Google LLC** | 米国 | データ転送サービス提供 | 仮名化されたトレーニングデータ | Firebase Terms of Service |

### 14.6 技術的・組織的セキュリティ対策

| 対策カテゴリー | 具体的対策 |
|-------------|----------|
| **仮名化** | ユーザーIDのSHA-256ハッシュ化 |
| **暗号化** | TLS 1.3による通信暗号化、AES-256によるデータ暗号化(at rest) |
| **アクセス制御** | BigQuery IAMによるアクセス制御、最小権限の原則 |
| **監査ログ** | Cloud Loggingによるすべてのクエリの記録 |
| **データ保存期間管理** | 2年経過後の自動削除スクリプト |
| **パーティショニング** | 日付ベースのパーティショニングにより、効率的なデータ管理 |

**参照**: BigQuery設計書v3.2第8節(パフォーマンス最適化)、第12節(セキュリティ)

### 14.7 データ主体の権利

| 権利 | 実装方法 | 対応期限 |
|-----|---------|---------|
| **アクセス権**(第15条) | privacy@example.comへの連絡 | 1ヶ月以内 |
| **削除権**(第17条) | アカウント削除機能、BigQueryの論理削除→物理削除 | 30日以内に完全削除 |
| **異議権**(第21条) | privacy@example.comへの連絡、処理停止 | 1ヶ月以内 |
| **ポータビリティ権**(第20条) | JSONエクスポート機能(Phase 2実装予定) | 1ヶ月以内 |

**参照**: プライバシーポリシーv3.1第9条、BigQuery設計書v3.2第6.2節(データ削除対応)

---

**Part 3 完了**

次のPart 4では、以下の内容を記載します:
- 技術的・組織的セキュリティ対策
- データ主体の権利行使
- データ侵害対応手順
- 第三者へのデータ移転
- データ保存期間と削除
- 監査とレビュー
# データ処理記録(ROPA) v1.0 (Part 4/4)

## 15. 技術的・組織的セキュリティ対策

### 15.1 概要

GDPR第32条に基づき、当社は適切な技術的・組織的セキュリティ対策を実施します。

**GDPR第32条(処理の安全性)**:
> 「管理者及び処理者は、技術水準、実装コスト、処理の性質、範囲、状況及び目的、並びに自然人の権利及び自由に対する様々な可能性及び深刻度のリスクを考慮して、リスクに適した安全性を保証するために適切な技術上及び組織上の措置を実施しなければならない。」

**参照**: 要件定義書v3.2第4.2節(セキュリティ要件)、システムアーキテクチャ設計書v3.2

### 15.2 技術的セキュリティ対策

#### 15.2.1 暗号化(Encryption)

| 対策 | 詳細 | 適用範囲 | 技術仕様 |
|-----|------|---------|---------|
| **通信暗号化** | TLS 1.3による暗号化 | すべての通信 | TLS 1.3、最小限TLS 1.2 |
| **データ暗号化(at rest)** | AES-256による暗号化 | Firestore、BigQuery | AES-256-GCM |
| **パスワードハッシュ化** | bcryptによるハッシュ化 | Firebase Authentication | bcrypt(コスト係数10) |
| **ユーザーID仮名化** | SHA-256ハッシュ化 | BigQuery | SHA-256 |

**参照**: 要件定義書v3.2 NFR-009、NFR-010

#### 15.2.2 アクセス制御(Access Control)

| 対策 | 詳細 | 適用範囲 | 実装 |
|-----|------|---------|------|
| **認証** | Firebase Authenticationによる認証 | すべてのユーザー | メール/パスワード、Google、Apple |
| **最小権限の原則** | 必要最小限の権限のみ付与 | すべてのサービスアカウント | IAM、Firebase Security Rules |
| **Firebase Security Rules** | Firestoreアクセス制御 | すべてのFirestoreデータ | ユーザーは自分のデータのみアクセス可 |
| **BigQuery IAM** | BigQueryアクセス制御 | すべてのBigQueryデータ | 読み取り専用、書き込み専用の分離 |

**Firebase Security Rulesの例**:
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ユーザーは自分のデータのみアクセス可能
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // セッションデータも同様
    match /sessions/{sessionId} {
      allow read, write: if request.auth != null 
        && request.auth.uid == resource.data.userId;
    }
  }
}
```

**参照**: 要件定義書v3.2 NFR-011、NFR-012、Firestoreデータベース設計書v3.2

#### 15.2.3 監査ログ(Audit Logging)

| 対策 | 詳細 | 保存期間 | ツール |
|-----|------|---------|--------|
| **認証ログ** | すべての認証イベントを記録 | 1年間 | Cloud Logging |
| **データアクセスログ** | Firestore、BigQueryへのアクセスを記録 | 1年間 | Cloud Logging |
| **管理操作ログ** | IAM変更、Security Rules変更等を記録 | 1年間 | Cloud Logging |
| **データ削除ログ** | すべてのデータ削除操作を記録 | 3年間 | Cloud Logging |

**参照**: 要件定義書v3.2 NFR-014

#### 15.2.4 オンデバイス処理(Privacy by Design)

| 対策 | 詳細 | 目的 |
|-----|------|------|
| **カメラ映像の非保存** | カメラ映像は端末上でのみ処理 | プライバシー保護 |
| **MediaPipe Poseのオンデバイス実行** | 骨格検出は端末上で完結 | プライバシー保護、レイテンシ削減 |
| **データ最小化** | 必要最小限のデータのみ収集 | GDPR第5条1項(c)準拠 |

**参照**: 要件定義書v3.2 NFR-015、プライバシーポリシーv3.1第8.1条

#### 15.2.5 仮名化(Pseudonymization)

| 対策 | 詳細 | 適用データ | アルゴリズム |
|-----|------|----------|-----------|
| **ユーザーID仮名化** | BigQueryエクスポート時に仮名化 | トレーニングデータ、骨格座標データ | SHA-256 |
| **追加情報の保護** | 元のuserIdとハッシュ値のマッピングを厳重に保護 | Firestore | IAM、Security Rules |

**参照**: 要件定義書v3.2 NFR-016、BigQuery設計書v3.2第6.1節

### 15.3 組織的セキュリティ対策

#### 15.3.1 アクセス管理

| 対策 | 詳細 |
|-----|------|
| **アクセス権限の定期レビュー** | 3ヶ月ごとにIAMロールとFirebase Security Rulesをレビュー |
| **最小権限の原則** | 各メンバーに必要最小限の権限のみ付与 |
| **サービスアカウント管理** | サービスアカウントの鍵のローテーション(90日ごと) |
| **離職時の対応** | 離職者のアカウントを即座に無効化 |

#### 15.3.2 データ保護ポリシー

| ポリシー | 詳細 |
|---------|------|
| **データ取り扱いガイドライン** | 全従業員がデータ取り扱いガイドラインを遵守 |
| **守秘義務契約** | 全従業員が守秘義務契約に署名 |
| **GDPR研修** | 全従業員に対してGDPR研修を実施(年1回) |
| **インシデント対応手順** | データ侵害対応手順を文書化 |

#### 15.3.3 物理的セキュリティ

| 対策 | 詳細 |
|-----|------|
| **クラウドインフラ** | Google Cloudのデータセンターを利用(ISO 27001認証) |
| **バックアップ** | Firestoreの自動バックアップ(日次) |
| **災害復旧計画** | RPO: 24時間、RTO: 4時間 |

**参照**: システムアーキテクチャ設計書v3.2

#### 15.3.4 インシデント対応

| 対策 | 詳細 |
|-----|------|
| **インシデント検知** | Cloud Loggingによる異常検知とアラート |
| **対応チーム** | プライバシー担当者を中心としたインシデント対応チーム |
| **エスカレーション手順** | 重大インシデント発生時のエスカレーション手順を文書化 |
| **事後レビュー** | インシデント発生後、必ず事後レビューを実施 |

### 15.4 リスク評価

#### 15.4.1 リスクマトリックス

| リスク | 可能性 | 影響度 | リスクレベル | 対策 |
|-------|--------|--------|------------|------|
| **不正アクセス** | 低 | 高 | 中 | 強力な認証、アクセス制御、監査ログ |
| **データ漏洩** | 低 | 高 | 中 | 暗号化、アクセス制御、仮名化 |
| **データ消失** | 低 | 中 | 低 | 自動バックアップ、PITR |
| **サービス停止** | 中 | 中 | 中 | 冗長化、災害復旧計画 |
| **内部不正** | 低 | 高 | 中 | アクセス制御、監査ログ、定期レビュー |

**参照**: 要件定義書v3.2第7節(リスク管理)

#### 15.4.2 継続的改善

- 四半期ごとのリスク評価レビュー
- セキュリティインシデントからの学習
- 新しい脅威への対応
- 技術進歩に応じたセキュリティ対策のアップデート

---

## 16. データ主体の権利行使

### 16.1 概要

GDPR第3章(データ主体の権利)に基づき、当社はデータ主体の以下の権利を尊重し、適切に対応します。

**参照**: プライバシーポリシーv3.1第9条、要件定義書v3.2 FR-025〜FR-027

### 16.2 データ主体の権利一覧

| 権利 | GDPR条文 | 実装方法 | 対応期限 |
|-----|---------|---------|---------|
| **情報提供を受ける権利** | 第13条、第14条 | プライバシーポリシーで明示 | アカウント登録時 |
| **アクセス権** | 第15条 | プロフィール画面、JSONエクスポート機能 | 即時〜1ヶ月以内 |
| **訂正権** | 第16条 | プロフィール画面で編集可能 | 即時 |
| **削除権(忘れられる権利)** | 第17条 | アカウント削除機能 | 30日以内に完全削除 |
| **処理の制限権** | 第18条 | privacy@example.comへの連絡 | 1ヶ月以内 |
| **データポータビリティ権** | 第20条 | JSONエクスポート機能(Phase 2) | 1ヶ月以内 |
| **異議権** | 第21条 | privacy@example.comへの連絡 | 1ヶ月以内 |
| **自動化された意思決定に関する権利** | 第22条 | 該当なし(自動化された意思決定は行わない) | - |

### 16.3 権利行使の手続き

#### 16.3.1 リクエスト受付方法

| 受付方法 | 詳細 | 連絡先 |
|---------|------|--------|
| **アプリ内** | プロフィール画面から直接実行可能 | - |
| **メール** | privacy@example.comへ連絡 | privacy@example.com |
| **Webフォーム** | 公式Webサイトのお問い合わせフォーム | https://example.com/contact |

#### 16.3.2 本人確認

| 確認方法 | 詳細 |
|---------|------|
| **アプリ内** | Firebase Authenticationによる認証で本人確認 |
| **メール** | 登録済みメールアドレスからの連絡、または追加の本人確認書類の提出 |

**重要**: なりすまし防止のため、厳格な本人確認を実施

#### 16.3.3 対応フロー

```
[ユーザーから権利行使のリクエスト受付]
        ↓
[本人確認]
 - Firebase Authentication(アプリ内)
 - メールアドレス確認+追加書類(メール)
        ↓
[権利の種類判定]
 - アクセス権、訂正権、削除権、ポータビリティ権、制限権、異議権
        ↓
[該当するデータの特定]
 - Firestoreからデータ取得
 - BigQueryからデータ取得(必要に応じて)
        ↓
[権利行使の実行]
 - データ提供(アクセス権、ポータビリティ権)
 - データ更新(訂正権)
 - データ削除(削除権)
 - 処理停止(制限権、異議権)
        ↓
[1ヶ月以内に対応完了]
 - 複雑な場合は2ヶ月まで延長可能
 - 延長する場合は1ヶ月以内にユーザーに通知
        ↓
[結果をユーザーに通知]
 - アプリ内通知
 - メール送信
 - 対応完了日時の記録
```

**参照**: 要件定義書v3.2付録B.3(ユーザー権利行使フロー)

### 16.4 各権利の詳細な実装

#### 16.4.1 アクセス権(第15条)

**実装方法**:
1. **プロフィール画面**: ユーザーは自分のプロフィール情報を即座に閲覧可能
2. **JSONエクスポート機能**(Phase 2実装予定):
   - すべての個人データをJSON形式でエクスポート
   - メールでダウンロードリンクを送信
   - 有効期限7日間

**提供する情報**:
- プロフィール情報
- トレーニング記録
- 骨格座標データ(同意がある場合)
- サブスクリプション情報
- 同意状態
- デバイス情報

**対応期限**: 即時(プロフィール画面)、1ヶ月以内(JSONエクスポート)

#### 16.4.2 訂正権(第16条)

**実装方法**:
- プロフィール画面で直接編集可能
- 氏名、生年月日、性別、身長、体重等

**対応期限**: 即時

#### 16.4.3 削除権(第17条)

**実装方法**:
1. **アプリ内**:
   - プロフィール画面から「アカウント削除」を選択
   - 確認ダイアログ表示(削除の影響を説明)
   - パスワード再入力(本人確認)
   - 削除処理実行

2. **削除対象**:
   - Firebase Authenticationのユーザー
   - Firestoreのすべてのユーザーデータ
   - BigQueryのデータ(論理削除→30日後に物理削除)
   - Cloud Storageのファイル(将来実装時)

3. **削除完了通知**:
   - 削除完了メール送信
   - 「30日以内に完全削除されます」と明記

**例外**(GDPR第17条3項):
- 税法上の保存義務があるデータ(取引履歴等)は7年間保存

**対応期限**: 30日以内に完全削除

**参照**: 要件定義書v3.2 FR-025

#### 16.4.4 処理の制限権(第18条)

**実装方法**:
- privacy@example.comへの連絡
- 処理の制限を希望する理由をヒアリング
- 該当するデータへのアクセスを一時停止

**対応期限**: 1ヶ月以内

#### 16.4.5 データポータビリティ権(第20条)

**実装方法**(Phase 2実装予定):
- プロフィール画面から「データダウンロード」を選択
- バックグラウンドでデータ収集
- JSON形式でエクスポート
- メールでダウンロードリンクを送信(有効期限7日間)

**提供形式**: JSON、CSV(構造化データ)

**対応期限**: 1ヶ月以内

**参照**: 要件定義書v3.2 FR-027

#### 16.4.6 異議権(第21条)

**実装方法**:
1. **マーケティングメールへの異議**:
   - メール内の配信停止リンク
   - またはプロフィール画面で設定変更
   - 即座に配信停止

2. **正当な利益に基づく処理への異議**:
   - privacy@example.comへの連絡
   - 異議の理由をヒアリング
   - 当社の正当な利益が上回る理由がない場合、処理を停止

**対応期限**: 即時(マーケティングメール)、1ヶ月以内(その他)

### 16.5 リクエストの記録

| 記録項目 | 詳細 |
|---------|------|
| **リクエスト受付日時** | いつリクエストを受け付けたか |
| **リクエスト種別** | アクセス権、訂正権、削除権等 |
| **ユーザーID** | 誰からのリクエストか |
| **対応完了日時** | いつ対応が完了したか |
| **対応内容** | どのような対応を行ったか |

**保存期間**: 3年間(説明責任の履行)

**保存場所**: Firestore(/data_subject_requests/{requestId})

---

## 17. データ侵害対応手順

### 17.1 概要

GDPR第33条、第34条に基づき、当社はデータ侵害発生時の対応手順を定めます。

**GDPR第33条(監督機関への個人データ侵害の通知)**:
> 「個人データ侵害を認識した場合、管理者は、実行可能な限り、遅くとも認識してから72時間以内に、監督機関に通知しなければならない。」

**GDPR第34条(データ主体への個人データ侵害の通知)**:
> 「個人データ侵害が自然人の権利及び自由に対して高いリスクを生じさせる可能性がある場合、管理者は、不当な遅延なく、データ主体に個人データ侵害を通知しなければならない。」

**参照**: 要件定義書v3.2 NFR-020、付録B.4(データ侵害対応フロー)

### 17.2 データ侵害の定義

**データ侵害とは**:
- 個人データの偶発的または違法な破壊
- 個人データの消失
- 個人データの改変
- 個人データの不正な開示
- 個人データへの不正なアクセス

### 17.3 対応フロー

#### 17.3.1 検知(Detection)

```
[データ侵害の検知]
 - Cloud Loggingの異常検知
 - 外部からの通報
 - 内部監査
        ↓
[24時間以内に初期評価]
 - 侵害の事実確認
 - 影響範囲の概算
```

**検知手段**:
- Cloud Loggingによる異常アクセスの検知
- Security Command Centerによる脅威検知
- ユーザーや第三者からの通報

#### 17.3.2 評価(Assessment)

```
[影響範囲の詳細調査]
        ↓
[以下を確認]
 1. 侵害されたデータの種類
 2. 影響を受けるユーザー数
 3. 侵害の原因
 4. リスクレベルの評価
```

**リスクレベルの評価基準**:
- **低リスク**: 仮名化されたデータのみ、影響範囲が限定的
- **中リスク**: 個人データの一部が侵害、影響範囲が中程度
- **高リスク**: 機微な個人データが侵害、影響範囲が広範囲

#### 17.3.3 通知(Notification)

##### 監督機関への通知(第33条)

```
[72時間以内に監督機関へ通知]
        ↓
[日本]
 - 個人情報保護委員会
 - https://www.ppc.go.jp/
        ↓
[EEA]
 - 該当国のデータ保護機関
 - (例: アイルランドのData Protection Commission)
        ↓
[通知内容]
 1. 個人データ侵害の性質
 2. データ保護責任者(DPO)の連絡先
 3. 個人データ侵害の可能性のある結果
 4. 管理者が提案または実施した措置
```

##### データ主体への通知(第34条)

```
[高リスクの場合]
 → データ主体へ不当な遅延なく通知
        ↓
[通知方法]
 - メール送信
 - アプリ内通知
 - Webサイト掲載
        ↓
[通知内容]
 1. 個人データ侵害の性質
 2. データ保護責任者(DPO)の連絡先
 3. 個人データ侵害の可能性のある結果
 4. 管理者が提案または実施した措置
 5. データ主体が取るべき措置(例: パスワード変更)
```

**通知不要の例外**(第34条3項):
- 適切な技術的保護措置(暗号化等)が実施されていた場合
- 侵害後、高リスクが生じないことを保証する措置を実施した場合
- 過度な努力を要する場合(代わりに公開コミュニケーション)

#### 17.3.4 対策(Remediation)

```
[即座の対策]
 1. 侵害の拡大防止
 2. 脆弱性の修正
 3. アクセスログの詳細分析
        ↓
[中期的対策]
 1. セキュリティ強化
 2. 監視体制の改善
 3. 再発防止策の実施
        ↓
[長期的対策]
 1. セキュリティポリシーの見直し
 2. 従業員研修の強化
 3. 定期的な脆弱性診断
```

#### 17.3.5 記録(Documentation)

```
[インシデントレポート作成]
        ↓
[記録内容]
 1. 侵害の事実関係
 2. 侵害の影響
 3. 実施した対策
 4. 監督機関への通知内容
 5. データ主体への通知内容
        ↓
[保存期間: 5年間]
```

**保存場所**: 社内のセキュアなドキュメント管理システム

### 17.4 インシデント対応チーム

| 役割 | 責任 |
|-----|------|
| **インシデント対応責任者** | 全体統括、意思決定 |
| **プライバシー担当者** | GDPR遵守の確認、監督機関への通知 |
| **技術責任者** | 技術的対策の実施、脆弱性の修正 |
| **広報担当者** | ユーザーへの通知、メディア対応 |
| **法務担当者** | 法的リスクの評価、監督機関との連絡 |

### 17.5 事後対応

- インシデント後、必ず事後レビューを実施
- 再発防止策を文書化
- ROPAの更新(必要に応じて)
- セキュリティ対策の見直し

---

## 18. 第三者へのデータ移転

### 18.1 概要

GDPR第5章(第三国または国際機関への個人データの移転)に基づき、当社はEEA域外への個人データ移転を適切に管理します。

**参照**: プライバシーポリシーv3.1第4.3条(第三者サービス)

### 18.2 データ処理者一覧

| 処理者名 | 所在国 | サービス | 移転されるデータ | 移転根拠 |
|---------|--------|---------|----------------|---------|
| **Google LLC** | 米国 | Firebase、GCP | すべての個人データ | EU標準契約条項(SCCs) |
| **RevenueCat Inc.** | 米国 | サブスクリプション管理 | サブスクリプション情報 | EU標準契約条項(SCCs) |
| **Apple Inc.** | 米国 | 決済処理(iOS) | 決済情報 | Apple自身のプライバシーポリシー |
| **Google LLC** | 米国 | 決済処理(Android) | 決済情報 | Google自身のプライバシーポリシー |

### 18.3 データ移転の保護措置

#### 18.3.1 EU標準契約条項(SCCs)

**適用先**: Google LLC、RevenueCat Inc.

**SCCsとは**:
- 欧州委員会が承認した契約条項
- EEA域外への個人データ移転を適法化
- 2021年6月に新SCCsが承認

**当社の対応**:
- Google Cloud Customer Agreementに新SCCsが含まれている
- RevenueCatとのData Processing Agreementに新SCCsが含まれている
- 定期的なレビュー(年1回)

#### 18.3.2 データセンターの所在地

| サービス | データセンター | リージョン |
|---------|-------------|----------|
| **Firestore** | Google Cloud | asia-northeast1(東京) |
| **BigQuery** | Google Cloud | asia-northeast1(東京) |
| **Cloud Storage** | Google Cloud | asia-northeast1(東京) |
| **Firebase Authentication** | Google | マルチリージョン(米国含む) |

**注意**: Firebase Authenticationはマルチリージョンのため、米国にもデータが保存される可能性があります。ただし、SCCsにより保護されています。

### 18.4 追加的保護措置

| 保護措置 | 詳細 |
|---------|------|
| **暗号化** | TLS 1.3による通信暗号化、AES-256によるデータ暗号化(at rest) |
| **仮名化** | BigQueryエクスポート時にユーザーIDを仮名化 |
| **アクセス制御** | 最小権限の原則、IAM、Security Rules |
| **監査ログ** | すべてのアクセスをCloud Loggingで記録 |

### 18.5 Schrems II判決への対応

**Schrems II判決(2020年7月)**:
- Privacy Shield(プライバシー・シールド)が無効化
- SCCsは引き続き有効だが、追加的保護措置が必要

**当社の対応**:
1. SCCsの使用(Google、RevenueCatと契約)
2. 追加的保護措置の実施(暗号化、仮名化、アクセス制御)
3. 米国政府による監視のリスク評価
4. Googleのデータセンター(東京)を優先的に使用

**参照**: [Court of Justice of the European Union - Schrems II](https://curia.europa.eu/juris/liste.jsf?num=C-311/18)

---

## 19. データ保存期間と削除

### 19.1 概要

GDPR第5条1項(e)(保存期間の制限)に基づき、当社は個人データを必要な期間のみ保存します。

**GDPR第5条1項(e)**:
> 「個人データは、個人データが処理される目的のために必要な期間に限り、データ主体の識別を可能とする形式で保存されなければならない。」

**参照**: プライバシーポリシーv3.1第3条(データ保存期間)

### 19.2 データ保存期間一覧

| データ種別 | 保存期間 | 法的根拠 | 削除トリガー |
|----------|---------|---------|------------|
| **アカウント情報** | アカウント削除まで | 契約履行(第6条1項(b)) | ユーザー削除リクエスト |
| **プロフィール情報** | アカウント削除まで | 契約履行(第6条1項(b)) | ユーザー削除リクエスト |
| **トレーニング記録** | アカウント削除まで | 契約履行(第6条1項(b)) | ユーザー削除リクエスト |
| **骨格座標データ** | アカウント削除まで | 同意(第6条1項(a)) | ユーザー削除リクエスト、同意撤回 |
| **セッションメタデータ** | 2年間 | 正当な利益(第6条1項(f)) | 自動削除スクリプト |
| **デバイス情報** | 1年間 | 正当な利益(第6条1項(f)) | 自動削除スクリプト |
| **同意記録** | 同意撤回後3年間 | 法的義務(第6条1項(c)) | 自動削除スクリプト |
| **取引履歴** | 7年間 | 法的義務(第6条1項(c)) | 自動削除スクリプト |
| **監査ログ** | 1年間 | 正当な利益(第6条1項(f)) | 自動削除スクリプト |
| **データ削除ログ** | 3年間 | 正当な利益(第6条1項(f)) | 自動削除スクリプト |

### 19.3 自動削除スクリプト

#### 19.3.1 BigQueryの自動削除

**実装**:
```sql
-- 2年以上前のセッションメタデータを削除
DELETE FROM `fitness_analytics.training_sessions`
WHERE createdAt < TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 2 YEAR);

-- 1年以上前のデバイス情報を削除
DELETE FROM `fitness_analytics.user_metadata`
WHERE lastAccessedAt < TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 1 YEAR);
```

**実行頻度**: 日次(Cloud Schedulerで自動実行)

**参照**: BigQuery設計書v3.2第11節(データライフサイクル管理)

#### 19.3.2 Firestoreの自動削除

**実装**:
```javascript
// Cloud Functions(Scheduled)
exports.deleteOldData = functions
  .region('asia-northeast1')
  .pubsub
  .schedule('0 2 * * *') // 毎日午前2時
  .timeZone('Asia/Tokyo')
  .onRun(async (context) => {
    const now = admin.firestore.Timestamp.now();
    const oneYearAgo = new admin.firestore.Timestamp(
      now.seconds - 365 * 24 * 60 * 60,
      now.nanoseconds
    );
    
    // 1年以上前のデバイス情報を削除
    const devicesQuery = admin.firestore()
      .collectionGroup('devices')
      .where('lastAccessedAt', '<', oneYearAgo);
    
    const snapshot = await devicesQuery.get();
    const batch = admin.firestore().batch();
    
    snapshot.docs.forEach(doc => {
      batch.delete(doc.ref);
    });
    
    await batch.commit();
    console.log(`Deleted ${snapshot.size} old device records`);
  });
```

### 19.4 ユーザー削除時の対応

#### 19.4.1 削除フロー

```
[ユーザーがアカウント削除を実行]
        ↓
[Firebase Authenticationでユーザー削除]
        ↓
[Cloud Functions: onUserDelete トリガー]
        ↓
[Firestoreのユーザーデータを削除]
 - /users/{uid}
 - /users/{uid}/subscriptions/*
 - /users/{uid}/devices/*
 - /sessions/{sessionId} where userId == uid
 - /skeleton_data/{dataId} where userId == uid
        ↓
[BigQueryの論理削除フラグを立てる]
 - UPDATE fitness_analytics.training_sessions
   SET deleted = TRUE
   WHERE userIdHash == SHA256(uid)
        ↓
[30日後: 物理削除バッチ処理]
 - DELETE FROM fitness_analytics.training_sessions
   WHERE deleted = TRUE
   AND deletedAt < TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 30 DAY)
        ↓
[削除完了メール送信]
```

**参照**: 要件定義書v3.2 FR-025、BigQuery設計書v3.2第6.2節

#### 19.4.2 削除の例外

**例外**(GDPR第17条3項):
- **法的義務の遵守**: 税法上の保存義務がある取引履歴は7年間保存
- **法的請求の確立、行使、防御**: 訴訟等で必要な場合は保存継続

---

## 20. 監査とレビュー

### 20.1 定期レビュー

| レビュー項目 | 頻度 | 責任者 |
|------------|------|--------|
| **ROPA更新** | 四半期ごと | プライバシー担当者 |
| **プライバシーポリシー見直し** | 年1回、または重大変更時 | プライバシー担当者、法務担当者 |
| **利用規約見直し** | 年1回、または重大変更時 | 法務担当者 |
| **セキュリティ対策レビュー** | 四半期ごと | 技術責任者 |
| **アクセス権限レビュー** | 3ヶ月ごと | 技術責任者 |
| **データ保存期間の確認** | 年1回 | プライバシー担当者 |
| **第三者契約レビュー** | 年1回 | プライバシー担当者、法務担当者 |

### 20.2 内部監査

| 監査項目 | 頻度 | 方法 |
|---------|------|------|
| **GDPR準拠状況** | 年1回 | チェックリストに基づく監査 |
| **セキュリティ対策** | 年2回 | 脆弱性診断、ペネトレーションテスト |
| **アクセスログ分析** | 月次 | Cloud Loggingの分析 |
| **データ削除プロセス** | 年1回 | 削除リクエストのサンプル確認 |

### 20.3 外部監査

| 監査項目 | 頻度 | 備考 |
|---------|------|------|
| **ISO 27001認証** | 検討中 | Phase 3以降で検討 |
| **SOC 2監査** | 検討中 | Phase 3以降で検討 |
| **GDPR準拠監査** | 検討中 | 外部の専門家による監査 |

### 20.4 変更管理

| 変更内容 | 対応 |
|---------|------|
| **新機能追加** | ROPAの更新、プライバシー影響評価(PIA)の実施 |
| **データ処理の変更** | ROPAの更新、必要に応じてユーザーへの通知 |
| **第三者サービスの追加** | Data Processing Agreementの締結、ROPAの更新 |
| **利用規約・プライバシーポリシーの変更** | ユーザーへの通知、同意の再取得(重大な変更の場合) |

### 20.5 継続的改善

- 四半期ごとのGDPR準拠レビュー
- セキュリティインシデントからの学習
- 業界ベストプラクティスの採用
- EDPB(欧州データ保護会議)のガイドラインに基づく改善

---

## 21. まとめ

### 21.1 ROPA作成の目的達成

本データ処理記録(ROPA) v1.0により、以下が実現されました:

✅ **GDPR第30条の完全準拠**: すべての処理活動を文書化
✅ **透明性の確保**: データ主体に対する情報提供の基盤
✅ **説明責任の履行**: 監督機関への説明責任を果たす
✅ **リスク管理**: データ処理に関するリスクの特定と対策
✅ **継続的改善**: 定期的なレビューと更新の基盤

### 21.2 主要な処理活動の要約

| ID | 処理活動名 | 法的根拠 | 保存期間 |
|----|-----------|---------|---------|
| PA-01 | ユーザー認証とアカウント管理 | 契約履行(第6条1項(b)) | アカウント削除まで |
| PA-02 | プロフィール情報管理 | 契約履行(第6条1項(b)) | アカウント削除まで |
| PA-03 | 同意管理 | 法的義務(第6条1項(c)) | 同意撤回後3年間 |
| PA-04 | トレーニングセッション記録 | 契約履行(第6条1項(b)) | アカウント削除まで |
| PA-05 | 骨格座標データ収集 | 同意(第6条1項(a)) | アカウント削除まで |
| PA-06 | セッションメタデータ収集 | 正当な利益(第6条1項(f)) | 2年間 |
| PA-07 | 課金・決済情報処理 | 契約履行(第6条1項(b))、法的義務(第6条1項(c)) | 契約期間中+7年間 |
| PA-08 | デバイス情報収集 | 正当な利益(第6条1項(f)) | 1年間 |
| PA-09 | メール通知 | 契約履行(第6条1項(b))、同意(第6条1項(a)) | アカウント削除まで |
| PA-10 | データ分析(BigQuery) | 正当な利益(第6条1項(f)) | 2年間 |

### 21.3 セキュリティ対策の要約

| カテゴリー | 主な対策 |
|----------|---------|
| **暗号化** | TLS 1.3、AES-256、bcrypt |
| **アクセス制御** | Firebase Authentication、IAM、Security Rules |
| **監査** | Cloud Logging、1年間の保存 |
| **プライバシー** | オンデバイス処理、仮名化、データ最小化 |

### 21.4 データ主体の権利

すべてのデータ主体の権利(GDPR第3章)に対応:
- アクセス権、訂正権、削除権、ポータビリティ権、制限権、異議権
- 対応期限: 即時〜1ヶ月以内

### 21.5 次のステップ

1. **ROPA承認**: 経営陣による承認
2. **定期レビュー**: 四半期ごとにROPAを更新
3. **従業員研修**: 全従業員にGDPR研修を実施
4. **外部監査**: GDPR準拠の外部監査を検討(Phase 3以降)

---

## 22. 承認

| 役割 | 氏名 | 署名 | 日付 |
|-----|------|------|------|
| **プライバシー担当者** | [氏名] | ________ | ________ |
| **技術責任者** | [氏名] | ________ | ________ |
| **法務担当者** | [氏名] | ________ | ________ |
| **代表取締役** | [氏名] | ________ | ________ |

---

## 23. 改訂履歴

| バージョン | 日付 | 変更内容 | 承認者 |
|-----------|------|---------|--------|
| 1.0 | 2025-11-24 | 初版作成 | (承認待ち) |

---

## 24. 参考資料

### 24.1 GDPR関連

- [GDPR Official Text](https://gdpr-info.eu/)
- [EDPB Guidelines](https://edpb.europa.eu/our-work-tools/general-guidance/guidelines-recommendations-best-practices_en)
- [Article 30 GDPR Record of processing activities](https://gdpr-info.eu/art-30-gdpr/)

### 24.2 内部ドキュメント

- 要件定義書 v3.2
- プライバシーポリシー v3.1
- 利用規約 v3.1
- システムアーキテクチャ設計書 v3.2
- Firestoreデータベース設計書 v3.2
- BigQuery設計書 v3.2
- API設計書(Firebase Functions) v3.2

### 24.3 第三者ドキュメント

- [Google Cloud Data Processing Amendment](https://cloud.google.com/terms/data-processing-addendum)
- [Firebase Terms of Service](https://firebase.google.com/terms)
- [RevenueCat Terms of Service](https://www.revenuecat.com/terms)

---

**データ処理記録(ROPA) v1.0 完成**

**作成日**: 2025年11月24日  
**最終更新日**: 2025年11月24日  
**次回レビュー予定日**: 2026年2月24日(3ヶ月後)

---
