# 5種目のフォーム確認ロジック詳細 v3.3 - 目次

**ドキュメント名**: 5種目のフォーム確認ロジック詳細  
**バージョン**: 3.3  
**作成日**: 2025年11月24日  
**ステータス**: Phase 2実装用  

---

## 📂 ドキュメント構成

このドキュメントは、AIフィットネスアプリにおける5種目のトレーニングフォーム確認補助ロジックの詳細仕様を定義する3部構成のドキュメントです。

### Part 1: 基礎と種目1-2 (26KB)
**ファイル**: `form_validation_logic_v3_3_part1.md`

#### 内容
1. **ドキュメント概要**
   - 目的と対象種目
   - 重要な前提条件（法的位置づけ、技術的基盤）
   - パフォーマンス要件

2. **共通定義**
   - MediaPipe Pose 33関節点マッピング
   - 共通データ構造
   - 共通数学関数（角度計算、距離計算、信頼度チェック）
   - スコアリングアルゴリズム

3. **種目1: スクワット**
   - 概要と重要関節点
   - フォーム評価基準（膝角度、膝のつま先超え、背中の姿勢、かかとの浮き）
   - レップカウントロジック（状態機械、フェーズ遷移）
   - スコア計算

4. **種目2: アームカール**
   - 概要と重要関節点
   - フォーム評価基準（肘角度、肘の位置固定、反動の使用、手首の角度）
   - レップカウントロジック
   - スコア計算
   - 補足: 両腕同時実施の検出

---

### Part 2: 種目3-5 (28KB)
**ファイル**: `form_validation_logic_v3_3_part2.md`

#### 内容
1. **種目3: サイドレイズ**
   - 概要と重要関節点
   - フォーム評価基準（腕の挙上角度、肘の角度、左右の対称性、体の揺れ、首すくめの防止）
   - レップカウントロジック
   - スコア計算

2. **種目4: ショルダープレス**
   - 概要と重要関節点
   - フォーム評価基準（肘の角度、手首の高さ、肘の軌道、腰の反り、左右の対称性）
   - レップカウントロジック
   - スコア計算

3. **種目5: プッシュアップ**
   - 概要と重要関節点
   - フォーム評価基準（肘の角度、体のライン、肘の開き具合、首の位置、手の位置）
   - レップカウントロジック
   - スコア計算

---

### Part 3: 統合処理とテスト (33KB)
**ファイル**: `form_validation_logic_v3_3_part3.md`

#### 内容
1. **統合処理フロー**
   - 全体処理アーキテクチャ
   - 種目別評価クラス階層
   - ファクトリーパターン実装

2. **データ収集とBigQuery連携**
   - フレームデータの集約
   - BigQuery連携データ形式
   - データ仮名化処理

3. **テスト戦略**
   - 単体テスト（Unit Tests）
   - 統合テスト（Integration Tests）
   - エンドツーエンドテスト（E2E Tests）
   - パフォーマンステスト

4. **実装ガイド**
   - Flutter/Dartでの実装例
   - MediaPipeの初期化
   - フォーム評価の実装
   - UIとの統合

5. **デバッグとモニタリング**
   - ログ出力
   - Cloud Monitoringとの統合

6. **まとめ**
   - 実装チェックリスト
   - パフォーマンス最適化のヒント
   - 今後の拡張計画

---

## 🎯 対象種目一覧

| No | 種目名 | カテゴリ | 難易度 | 器具 | ドキュメント |
|----|--------|---------|--------|------|------------|
| 1 | スクワット | 下半身 | 初級 | 不要 | Part 1 |
| 2 | アームカール | 腕 | 初級 | ダンベル | Part 1 |
| 3 | サイドレイズ | 肩 | 中級 | ダンベル | Part 2 |
| 4 | ショルダープレス | 肩 | 中級 | ダンベル | Part 2 |
| 5 | プッシュアップ | 胸 | 初級 | 不要 | Part 2 |

---

## 📊 ドキュメント統計

| 項目 | 数値 |
|------|------|
| 総ページ数 | 約150ページ相当 |
| 総ファイルサイズ | 87KB |
| コードサンプル数 | 60+ |
| 評価基準項目数 | 25+ |
| テストケース例 | 20+ |

---

## 🔗 関連ドキュメント

### プロジェクト全体設計
- 要件定義書 v3.3
- システムアーキテクチャ設計書 v3.2
- 画面遷移図 + ワイヤーフレーム v3.3

### データベース設計
- Firestoreデータベース設計書 v3.3
- BigQuery設計書 v3.3
- API設計書（Firebase Functions）v3.3

### 法務・コンプライアンス
- 利用規約 v3.2
- プライバシーポリシー v3.1
- データ処理記録（ROPA）v1.0
- セキュリティポリシー v1.0

### プロジェクト管理
- プロジェクト懸念点分析 v1.0

---

## 📝 使用方法

### 開発者向け

1. **Phase 1: 基本理解**
   - Part 1の「ドキュメント概要」と「共通定義」を熟読
   - MediaPipe Poseの33関節点マッピングを理解
   - 共通数学関数を実装

2. **Phase 2: 種目実装**
   - Part 1-2の各種目の評価基準を理解
   - 1種目ずつ実装（スクワットから推奨）
   - 単体テストで動作確認

3. **Phase 3: 統合とテスト**
   - Part 3の統合処理フローを実装
   - 統合テストとE2Eテストで動作確認
   - パフォーマンステストで30fps維持を確認

4. **Phase 4: 最適化**
   - Part 3のパフォーマンス最適化のヒントを参照
   - デバッグとモニタリングの実装
   - Cloud Monitoringの統合

### プロジェクトマネージャー向け

1. **実装計画の策定**
   - Part 3の「実装チェックリスト」を参照
   - 各Phaseのマイルストーンを設定
   - リソース配分の計画

2. **進捗管理**
   - チェックリストに基づく進捗確認
   - 定期的なコードレビュー
   - テストカバレッジの監視

3. **品質保証**
   - テスト戦略に基づくQA計画
   - パフォーマンス要件の達成確認
   - ユーザビリティテストの実施

### QAエンジニア向け

1. **テスト計画の作成**
   - Part 3の「テスト戦略」を参照
   - 単体テスト、統合テスト、E2Eテストの計画
   - パフォーマンステストのシナリオ作成

2. **テストケースの作成**
   - 各種目の評価基準に基づくテストケース
   - エッジケース（低信頼度、極端な角度）のテスト
   - メモリリークやパフォーマンス劣化のテスト

3. **不具合管理**
   - ログ出力とモニタリングの活用
   - 再現手順の明確化
   - 優先度の適切な設定

---

## ⚠️ 重要な注意事項

### 法的遵守
**本サービスは医療機器ではありません**（利用規約v3.2より）:
- 薬機法に基づく医療機器の承認を受けていません
- 提供する情報は「参考情報」であり、医学的アドバイスではありません
- 診断、治療、予防を目的とするものではありません
- 利用者の最終判断を代替するものではありません

### 技術的制約
- **目標FPS**: 30fps（推奨端末スペックで維持）
- **最低FPS**: 15fps（低スペック端末では自動調整）
- **骨格検出信頼度**: 0.7以上を推奨、0.5以上を最低ライン
- **処理遅延**: 1フレームあたり33ms以下を目標

### データプライバシー
- カメラ映像はサーバーに送信しない（オンデバイス処理）
- BigQueryには仮名化されたデータのみを保存
- GDPR第17条に基づく30日以内のデータ削除

---

## 📞 お問い合わせ

### 技術的な質問
- **担当**: バックエンドエンジニア
- **連絡先**: [メールアドレス]

### プロジェクト全般の質問
- **担当**: プロジェクトマネージャー
- **連絡先**: [メールアドレス]

### 法務・コンプライアンスの質問
- **担当**: データ保護責任者（DPO）
- **連絡先**: dpo@example.com

---

## 📅 更新履歴

| バージョン | 日付 | 主な変更内容 |
|-----------|------|-------------|
| v3.3 | 2025-11-24 | 初版作成。5種目の完全な評価基準とロジック定義。プロジェクト懸念点分析に基づくパフォーマンス要件の追加 |

---

## ✅ ドキュメントレビュー

### 完成度チェック

- [x] 5種目すべての評価基準が定義されている
- [x] MediaPipe Pose 33関節点のマッピングが明確
- [x] 共通データ構造と数学関数が実装可能な詳細度
- [x] レップカウントロジックが各種目で定義されている
- [x] スコア計算アルゴリズムが明確
- [x] 統合処理フローが実装可能な詳細度
- [x] BigQuery連携とデータ仮名化が明確
- [x] テスト戦略が包括的
- [x] Flutter/Dartでの実装例が提供されている
- [x] パフォーマンス最適化のヒントが含まれている

### 要件定義書との整合性

- [x] FR-030（フォーム確認補助）の詳細実装仕様
- [x] FR-031（レップカウント）の詳細実装仕様
- [x] FR-032（警告生成）の詳細実装仕様
- [x] NFR-020（30fps目標）の技術的詳細
- [x] NFR-021（オンデバイス処理）の実装方針
- [x] NFR-022（低信頼度時の動作）の詳細

### 他ドキュメントとの整合性

- [x] Firestoreデータベース設計書v3.3とのデータ構造の整合性
- [x] BigQuery設計書v3.3とのデータ形式の整合性
- [x] 利用規約v3.2との法的位置づけの一致
- [x] プライバシーポリシーv3.1とのデータ処理の一致
- [x] プロジェクト懸念点分析v1.0への対応

---

**このドキュメントは、Phase 2開発の開始時に使用可能な状態です。**

**作成者**: Claude  
**最終確認日**: 2025年11月24日  
**次回レビュー予定**: Phase 2開発開始時
