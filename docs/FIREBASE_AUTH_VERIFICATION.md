# Firebase 認証設定 - 検証チェックシート

**Firebase Project ID**: `tokyo-list-478804-e5`
**作成日**: 2025-12-01
**目的**: 認証設定が正しく完了したことを確認

---

## Phase 1: Firebase Console 設定確認

### 1.1 Email/Password 認証

```
チェック項目:
□ Firebase Console を開く
  URL: https://console.firebase.google.com/project/tokyo-list-478804-e5/authentication

□ Authentication > Sign-in method タブを確認
  期待結果: Email/Password が "Enabled" と表示される

□ パスワードポリシー設定を確認
  期待結果:
    - Minimum password length: 8
    - Require uppercase and lowercase: ☑
    - Require numbers: ☑

実施日時: _______________
実施者: _______________
完了状態: ☐ 完了 ☐ 未完了 ☐ 確認待ち
```

### 1.2 Authorized Domains

```
チェック項目:
□ Authentication > Settings > Authorized domains を確認

□ リストに以下が含まれているか確認:
  ☑ localhost
  ☑ tokyo-list-478804.firebaseapp.com (自動追加)

期待結果: 最低でも localhost が表示される

実施日時: _______________
実施者: _______________
完了状態: ☐ 完了 ☐ 未完了 ☐ 確認待ち
```

### 1.3 メールテンプレート - パスワードリセット

```
チェック項目:
□ Authentication > Settings > Templates を開く

□ Password reset email をクリック

□ 以下の項目が日本語化されているか確認:
  ☑ Subject フィールド: "パスワードリセット" と表示される
  ☑ Body: 日本語のメール本文が含まれている
  ☑ リセットリンク (%%LINK%%) が保持されている

期待結果: 日本語メールテンプレートが表示される

実施日時: _______________
実施者: _______________
完了状態: ☐ 完了 ☐ 未完了 ☐ 確認待ち
```

### 1.4 セキュリティ設定

```
チェック項目:
□ Authentication > Settings > General を確認

□ 以下の設定を確認:
  ☑ Block all sign-ups: チェックなし (推奨)
  ☑ Anonymous sign-in: チェックなし (推奨)
  ☑ Enable Multi-factor Authentication: 未実装 (本番時に検討)

期待結果: 開発環境として適切な設定

実施日時: _______________
実施者: _______________
完了状態: ☐ 完了 ☐ 未完了 ☐ 確認待ち
```

---

## Phase 2: ローカル開発環境での検証

### 2.1 Firebase エミュレータの起動

```
実行コマンド:
$ firebase emulators:start

期待結果:
✓ Firestore Emulator running on 127.0.0.1:8080
✓ Authentication Emulator running on 127.0.0.1:9099
✓ Hub running on 127.0.0.1:4400
✓ Emulator UI running on http://localhost:4000

チェック項目:
□ エミュレータ UI (http://localhost:4000) を開く
□ Authentication セクションが表示される
□ エラーログが表示されない

実施日時: _______________
実施者: _______________
完了状態: ☐ 完了 ☐ 未完了 ☐ 確認待ち
```

### 2.2 Flutter アプリでのユーザー登録テスト

```
テスト環境:
□ Flutter アプリをエミュレータに接続
□ firebase emulators:start が実行中

テスト手順:
1. アプリの「新規登録」画面を開く
2. テストメール: test@example.com
3. テストパスワード: TestPass123!
   (大文字・小文字・数字を含む)
4. 「登録」ボタンをクリック

期待結果:
□ ユーザー登録が成功する
□ Firebase Console (Authentication > Users) で作成されたユーザーが表示される
□ エミュレータログでエラーが表示されない

テスト日時: _______________
テスト実施者: _______________
テスト結果: ☐ 成功 ☐ 失敗 (詳細: ____________)
```

### 2.3 ログイン機能テスト

```
テスト手順:
1. アプリをログアウト（前のテストユーザーがまだログイン中の場合）
2. 「ログイン」画面を開く
3. テストメール: test@example.com
4. テストパスワード: TestPass123!
5. 「ログイン」ボタンをクリック

期待結果:
□ ログインが成功する
□ ホーム画面に遷移する
□ エミュレータログでエラーが表示されない
□ Firebase Console > Users でセッション情報が表示される

テスト日時: _______________
テスト実施者: _______________
テスト結果: ☐ 成功 ☐ 失敗 (詳細: ____________)
```

### 2.4 パスワードリセット機能テスト

```
テスト手順:
1. 「ログイン」画面を開く
2. 「パスワードを忘れた」リンクをクリック
3. テストメール: test@example.com を入力
4. 「リセット送信」ボタンをクリック

期待結果:
□ リセット要求が受け付けられる
□ 確認メッセージが表示される
□ エミュレータ UI (http://localhost:4000) の Emulator Suite > Logs でメール送信ログが表示される
□ メール本文が日本語である

ログ確認方法:
1. http://localhost:4000 を開く
2. 左メニュー > Logs をクリック
3. "Password reset" や "email" で検索
4. メール本文が日本語であることを確認

テスト日時: _______________
テスト実施者: _______________
テスト結果: ☐ 成功 ☐ 失敗 (詳細: ____________)
```

### 2.5 パスワード要件検証テスト

```
テスト手順: 弱いパスワードでの登録試行

テストケース 1: 8文字未満
入力: email@test.com / Pass12
期待結果: ☑ エラーメッセージが表示される

テストケース 2: 小文字のみ
入力: email@test.com / password123
期待結果: ☑ エラーメッセージが表示される

テストケース 3: 大文字のみ
入力: email@test.com / PASSWORD123
期待結果: ☑ エラーメッセージが表示される

テストケース 4: 数字なし
入力: email@test.com / PassWord
期待結果: ☑ エラーメッセージが表示される

テストケース 5: 正規パスワード
入力: email@test.com / ValidPass123
期待結果: ☑ ユーザー登録が成功する

テスト日時: _______________
テスト実施者: _______________
テスト結果: ☐ 全て成功 ☐ 一部失敗 (詳細: ____________)
```

---

## Phase 3: セキュリティ検証

### 3.1 HTTPS/TLS の確認

```
確認項目:
□ Firebase Functions API が HTTPS で通信している
  確認方法: ブラウザの開発ツール (F12) > Network タブで通信プロトコルを確認

期待結果: 全ての通信が https:// で行われている

実施日時: _______________
実施者: _______________
確認結果: ☐ OK ☐ NG (詳細: ____________)
```

### 3.2 GDPR準拠性の確認

```
確認項目:

□ メールテンプレートに関連する GDPR 要件
  - メール本文にデータ処理に関する情報が含まれているか
  - プライバシーポリシーへのリンクが含まれているか
  (参考: docs/specs/プライバシーポリシー_v3.1.md)

□ パスワードリセットリンクの有効期限
  期待値: 24時間以内 (Firebase デフォルト)

確認状態: ☐ 確認済み ☐ 未確認
```

---

## 最終チェックリスト

```
全体進捗確認:

セットアップ完了:
☐ Email/Password 認証が有効化された
☐ パスワードポリシーが設定されている
☐ localhost が Authorized domains に追加されている
☐ メールテンプレートが日本語化されている

ローカル開発環境テスト完了:
☐ Firebase エミュレータが起動できる
☐ ユーザー登録機能が動作している
☐ ログイン機能が動作している
☐ パスワードリセット機能が動作している
☐ パスワード要件検証が機能している

セキュリティ検証完了:
☐ HTTPS通信が確立されている
☐ GDPR準拠性が確認されている

総合判定: ☐ すべてOK ☐ 一部未実施 ☐ エラー有り

判定日時: _______________
判定者: _______________
承認者: _______________
```

---

## 問題発生時の対応

### 問題: Firebase Console でメール/Password が見つからない

```
原因の確認:
☐ 正しいプロジェクト (tokyo-list-478804-e5) を開いているか
☐ ページが完全に読み込まれているか

対応:
1. ページをリロード (F5)
2. キャッシュをクリア (Ctrl+Shift+Delete)
3. 別ブラウザで試す
4. 同じプロジェクト URL で再度アクセス

解決: ☐ 解決 ☐ 未解決
詳細: _______________________________________________
```

### 問題: エミュレータ起動時にエラー

```
エラーメッセージ: _______________________________________________

確認:
☐ Node.js がインストールされているか (node --version)
☐ Firebase CLI がインストールされているか (firebase --version)
☐ プロジェクトディレクトリで実行しているか (firebase.json が存在するか)

対応:
1. npm install を実行
2. firebase login を実行
3. firebase init を実行
4. firebase emulators:start を再度実行

解決: ☐ 解決 ☐ 未解決
詳細: _______________________________________________
```

### 問題: Flutter アプリでエラーが出る

```
エラーメッセージ: _______________________________________________

確認:
☐ Firebase 設定が正しいか (firebase_options.dart を確認)
☐ エミュレータが起動しているか
☐ Firebase プロジェクト ID が正しいか (tokyo-list-478804-e5)

対応:
1. firebase emulators:start でエミュレータを再起動
2. Flutter アプリをホットリスタート (R キー)
3. Firebase Console で Users を確認

解決: ☐ 解決 ☐ 未解決
詳細: _______________________________________________
```

---

## 次のステップ

設定が完了したら、以下の順序で進めてください:

### Immediate (本週中)
1. [ ] このチェックシートを全て完了する
2. [ ] すべてのテストが成功したことを確認
3. [ ] チームメンバーと検証結果を共有

### Short-term (1-2週間)
1. [ ] Firestore セキュリティルール設定
2. [ ] Cloud Functions の追加 API 実装
3. [ ] 統合テスト実施

### Medium-term (本番前)
1. [ ] パスワードポリシー強化（特殊文字必須）
2. [ ] 多要素認証 (MFA) 有効化
3. [ ] 本番ドメイン登録
4. [ ] セキュリティ監査

---

## ドキュメント参照

```
詳細ガイド: docs/FIREBASE_AUTH_SETUP_GUIDE.md
クイックスタート: docs/FIREBASE_AUTH_QUICK_START.md
仕様書: docs/specs/00_要件定義書_v3_3.md (NFR-018)
セキュリティポリシー: docs/specs/07_セキュリティポリシー_v1_0.md
```

---

**確認完了日**: _______________
**確認実施者**: _______________
**確認承認者**: _______________

